K 10
svn:author
V 10
starseeker
K 8
svn:date
V 27
2019-03-29T19:33:31.027293Z
K 7
svn:log
V 814
Something of a last ditch attempt, but refer back to r72661 and r72706 to pull forward the switch from .g to raw bu_external serialization objects for cache objects to try testing it with the current problem cases.  Avoids the db_open/db_close logic, uses the atomic file switching and semaphore guards - doesn't knowingly upset any of the cache.c improvements.  Uses mapped files, but calls free on them only once at the end when the cache is closed.  The only other change is to add some wait-and-recheck sanity checks of file sizes before we allow a read attempt to conclude a pre-existing cache object is useless - shouldn't be necessary if the moves really are atomic, but I'm not 100% confident about the atomic nature of MoveFileEx on Windows based on discussions such as https://stackoverflow.com/q/167414.
END
