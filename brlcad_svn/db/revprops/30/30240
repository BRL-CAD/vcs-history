K 10
svn:author
V 6
brlcad
K 8
svn:date
V 27
2008-02-08T07:31:24.547460Z
K 7
svn:log
V 956
fix a bug introduced with the changeover of db_open to only using standard i/o for all platforms instead of unix i/o with an uninitialized dbi_fd.  the problem was related to the failure case where null is returned, which mged intentionally uses to determine if a file exists, where since with unix i/o a fp and an fd are independently opened (instead of deriving one from the other) so the cleanup code was closing the other.  the close code was only checking for non-negative but with dbi_fd unitialized, this was fd 0 (i.e. stdin) which in turn caused Bad Things (tm) to happen.  the bug was actually only exposed through the spdi regression test since it directs input which is read in with bu_vls_gets (i.e. via gets and stdin), which was of course failing after the db_open call that closed fd 0.  most interestingly, subsequent calls to db_open that succeed would create a valid stream and assign it fd 0. add some file comments while we're in here.
END
