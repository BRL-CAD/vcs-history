head	1.7;
access;
symbols
	ansi-20040405-merged:1.3.4.1
	postmerge-20040405-ansi:1.5
	premerge-20040404-ansi:1.5
	postmerge-autoconf:1.5
	autoconf-freeze:1.3.12.2
	premerge-autoconf:1.5
	ansi-20040316-freeze:1.3
	postmerge-20040315-windows:1.5
	premerge-20040315-windows:1.4
	windows-20040315-freeze:1.3.6.2
	autoconf-20031203:1.3
	autoconf-20031202:1.3
	autoconf-branch:1.3.0.12
	phong-branch:1.3.0.10
	photonmap-branch:1.3.0.8
	rel-6-1-DP:1.3
	windows-branch:1.3.0.6
	rel-6-0-2:1.3
	ansi-branch:1.3.0.4
	rel-6-0-1-branch:1.3.0.2
	hartley-6-0-post:1.3
	hartley-6-0-pre:1.3
	rel-6-0-1:1.3
	rel-6-0:1.3;
locks; strict;
comment	@ * @;


1.7
date	2004.05.21.18.06.23;	author morrison;	state dead;
branches;
next	1.6;

1.6
date	2004.05.10.15.30.44;	author erikg;	state Exp;
branches;
next	1.5;

1.5
date	2004.03.16.19.40.48;	author morrison;	state Exp;
branches;
next	1.4;

1.4
date	2004.02.02.17.39.07;	author morrison;	state Exp;
branches;
next	1.3;

1.3
date	2001.11.02.01.55.18;	author butler;	state Exp;
branches
	1.3.4.1
	1.3.6.1
	1.3.12.1;
next	1.2;

1.2
date	2001.10.15.17.50.08;	author butler;	state Exp;
branches;
next	1.1;

1.1
date	2001.10.12.20.58.40;	author butler;	state Exp;
branches;
next	;

1.3.4.1
date	2004.03.17.21.16.49;	author morrison;	state Exp;
branches;
next	;

1.3.6.1
date	2002.09.26.23.03.51;	author morrison;	state Exp;
branches;
next	1.3.6.2;

1.3.6.2
date	2004.03.11.23.41.49;	author morrison;	state Exp;
branches;
next	;

1.3.12.1
date	2004.02.12.18.39.18;	author erikg;	state Exp;
branches;
next	1.3.12.2;

1.3.12.2
date	2004.03.18.18.08.13;	author erikg;	state Exp;
branches;
next	;


desc
@@


1.7
log
@moved to src/
@
text
@/*
 *			F O P E N _ U N I Q . C
 *
 *  Routine to open a unique filename.
 *
 *  Authors -
 *	Lee A. Butler
 *
 *  Source -
 *	SECAD/VLD Computing Consortium, Bldg 394
 *	The U. S. Army Ballistic Research Laboratory
 *	Aberdeen Proving Ground, Maryland  21005
 *  
 *  Copyright Notice -
 *	This software is Copyright (C) 2001-2004 by the United States Army.
 *	All rights reserved.
 */

#ifdef HAVE_CONFIG_H
# include "config.h"
#endif



#include <stdio.h>
#include <fcntl.h>
#include <errno.h>
#ifndef WIN32
#ifdef BSD
#undef BSD
#include <sys/param.h>
#else
#include <sys/param.h>
#endif
#endif

#include <ctype.h>
#include <math.h>
#ifdef USE_STRING_H
# include <string.h>
#else
# include <strings.h>
#endif

#include "machine.h"
#include "externs.h"
#include "bu.h"

/*  B U _ F O P E N _ U N I Q
 *
 *  Open a file for output.  Assures that the file did not previously exist.
 *
 *  Typical Usages:
 *	static int n = 0;
 *	FILE *fp;
 *
 *	fp = bu_fopen_uniq("writing to %s for results", "output%d.pl", n++);
 *	...
 *	fclose(fp);
 *
 *
 *	fp = bu_fopen_uniq((char *)NULL, "output%d.pl", n++);
 *	...
 *	fclose(fp);
 */
FILE *
bu_fopen_uniq(const char *outfmt, const char *namefmt, int n)
{
    char filename[MAXPATHLEN];
    int fd;
    FILE *fp;

    if ( ! namefmt || ! *namefmt)
	bu_bomb("bu_uniq_file called with null string\n");

    bu_semaphore_acquire( BU_SEM_SYSCALL);
    sprintf(filename, namefmt, n);
    if ((fd = open(filename, O_RDWR|O_CREAT|O_EXCL, 0600)) < 0) {
	fprintf(stderr, "Cannot open %s, %s\n", filename, strerror(errno));
	exit(-1);
    }
    if ( (fp=fdopen(fd, "w")) == (FILE *)NULL) {
	fprintf(stderr, strerror(errno));
	exit(-1);
    }

    if (outfmt)
	fprintf(stderr, outfmt, filename);

    bu_semaphore_release( BU_SEM_SYSCALL);

    return fp;
}
@


1.6
log
@change conf.h to a wrapped config.h
@
text
@@


1.5
log
@merge of windows-6-0-branch into head
@
text
@d19 5
a23 1
#include "conf.h"
@


1.4
log
@update copyright to include span through 2003
@
text
@d24 1
d30 1
@


1.3
log
@Better error logging
@
text
@d15 1
a15 1
 *	This software is Copyright (C) 2001 by the United States Army.
@


1.3.4.1
log
@sync branch with HEAD
@
text
@d15 1
a15 1
 *	This software is Copyright (C) 2001-2004 by the United States Army.
a23 1
#ifndef WIN32
a28 1
#endif
@


1.3.12.1
log
@merge from HEAD
@
text
@d15 1
a15 1
 *	This software is Copyright (C) 2001-2004 by the United States Army.
@


1.3.12.2
log
@merge from head
@
text
@a23 1
#ifndef WIN32
a28 1
#endif
@


1.3.6.1
log
@Modifications (on a 6.0 source distribution) for initial port to windows (merged with sources close to 6.0.2)
@
text
@a23 1
#ifndef WIN32
a28 1
#endif
@


1.3.6.2
log
@sync to HEAD...
@
text
@d15 1
a15 1
 *	This software is Copyright (C) 2001-2004 by the United States Army.
@


1.2
log
@Added mode bits to open(2) call
@
text
@d73 1
a73 1
	fprintf(stderr, strerror(errno));
@


1.1
log
@Added bu_fopen_uniq()
@
text
@d72 1
a72 1
    if ((fd = open(filename, O_WRONLY|O_CREAT|O_EXCL)) < 0) {
@

