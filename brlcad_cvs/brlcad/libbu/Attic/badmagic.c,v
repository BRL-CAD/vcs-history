head	1.10;
access;
symbols
	ansi-20040405-merged:1.7.2.2
	postmerge-20040405-ansi:1.8
	premerge-20040404-ansi:1.7
	postmerge-autoconf:1.7
	autoconf-freeze:1.7
	premerge-autoconf:1.7
	ansi-20040316-freeze:1.7.2.1
	postmerge-20040315-windows:1.7
	premerge-20040315-windows:1.7
	windows-20040315-freeze:1.7
	autoconf-20031203:1.7
	autoconf-20031202:1.7
	autoconf-branch:1.7.0.10
	phong-branch:1.7.0.8
	photonmap-branch:1.7.0.6
	rel-6-1-DP:1.7
	windows-branch:1.7.0.4
	rel-6-0-2:1.5
	ansi-branch:1.7.0.2
	rel-6-0-1-branch:1.5.0.2
	hartley-6-0-post:1.6
	hartley-6-0-pre:1.5
	rel-6-0-1:1.5
	rel-6-0:1.5
	rel-5-4:1.3
	offsite-5-3-pre:1.4
	rel-5-3:1.3
	rel-5-2:1.3
	rel-5-1-branch:1.3.0.2
	rel-5-1:1.3
	rel-5-0:1.3
	rel-5-0-beta:1.3
	rel-4-5:1.3
	ctj-4-5-post:1.2
	ctj-4-5-pre:1.2;
locks; strict;
comment	@ * @;


1.10
date	2004.05.21.18.06.23;	author morrison;	state dead;
branches;
next	1.9;

1.9
date	2004.05.10.15.30.44;	author erikg;	state Exp;
branches;
next	1.8;

1.8
date	2004.04.05.07.46.16;	author morrison;	state Exp;
branches;
next	1.7;

1.7
date	2002.08.20.17.07.39;	author jra;	state Exp;
branches
	1.7.2.1;
next	1.6;

1.6
date	2002.08.15.20.54.50;	author hartley;	state Exp;
branches;
next	1.5;

1.5
date	2001.04.20.22.29.05;	author morrison;	state Exp;
branches;
next	1.4;

1.4
date	2000.07.07.05.21.20;	author cjohnson;	state Exp;
branches;
next	1.3;

1.3
date	98.01.08.03.34.29;	author mike;	state Exp;
branches;
next	1.2;

1.2
date	97.04.04.05.41.00;	author mike;	state Exp;
branches;
next	1.1;

1.1
date	96.08.27.06.18.33;	author mike;	state Exp;
branches;
next	;

1.7.2.1
date	2002.09.19.18.01.11;	author morrison;	state Exp;
branches;
next	1.7.2.2;

1.7.2.2
date	2004.04.05.00.50.06;	author morrison;	state Exp;
branches;
next	;


desc
@badmagic.c
@


1.10
log
@moved to src/
@
text
@/*
 *			B A D M A G I C . C
 *
 *  Routines involved with handling "magic numbers" used to identify
 *  various in-memory data structures.
 *
 *  Authors -
 *	Lee A. Butler
 *	Michael John Muuss
 *  
 *  Source -
 *	The U. S. Army Research Laboratory
 *	Aberdeen Proving Ground, Maryland  21005-5068  USA
 *  
 *  Distribution Status -
 *	Public Domain, Distribution Unlimitied.
 */
#ifndef lint
static const char RCSbadmagic[] = "@@(#)$Header: /n/xoff/cvs/brlcad/libbu/badmagic.c,v 1.9 2004/05/10 15:30:44 erikg Exp $ (ARL)";
#endif

#ifdef HAVE_CONFIG_H
# include "config.h"
#endif



#include <stdio.h>
#include "machine.h"
#include "externs.h"
#include "bu.h"

/*
 *			B U _ B A D M A G I C
 *
 *  Support routine for BU_CKMAG macro
 */
void
bu_badmagic(const long int *ptr, unsigned long int magic, const char *str, const char *file, int line)
{
	char	buf[512];

	if( !(ptr) )  { 
		sprintf(buf, "ERROR: NULL %s pointer, file %s, line %d\n", 
			str, file, line ); 
		bu_bomb(buf); 
	}
	if( ((size_t)(ptr)) & (sizeof(long)-1) )  {
		sprintf(buf, "ERROR: x%lx mis-aligned %s pointer, file %s, line %d\n", 
			(long)ptr, str, file, line ); 
		bu_bomb(buf); 
	}
	if( *(ptr) != (long int)(magic) )  { 
		sprintf(buf, "ERROR: bad pointer x%lx: s/b %s(x%lx), was %s(x%lx), file %s, line %d\n", 
			(long)ptr,
			str, magic,
			bu_identify_magic( *(ptr) ), *(ptr),
			file, line ); 
		bu_bomb(buf); 
	}
}
@


1.9
log
@change conf.h to a wrapped config.h
@
text
@d19 1
a19 1
static const char RCSbadmagic[] = "@@(#)$Header: /cvs/brlcad/libbu/badmagic.c,v 1.8 2004/04/05 07:46:16 morrison Exp $ (ARL)";
@


1.8
log
@merge of ansi-6-0-branch into HEAD
@
text
@d19 1
a19 1
static const char RCSbadmagic[] = "@@(#)$Header$ (ARL)";
d22 5
a26 1
#include "conf.h"
@


1.7
log
@Restoration of entire source tree to Pre-Hartley state
@
text
@d19 1
a19 1
static const char RCSbadmagic[] = "@@(#)$Header: /c/CVS/brlcad/libbu/badmagic.c,v 1.5 2001/04/20 22:29:05 morrison Exp $ (ARL)";
d35 1
a35 6
bu_badmagic( ptr, magic, str, file, line )
const long	*ptr;
long		magic;
const char	*str;
const char	*file;
int		line;
d44 1
a44 1
	if( ((long)(ptr)) & (sizeof(long)-1) )  {
d49 1
a49 1
	if( *(ptr) != (magic) )  { 
@


1.7.2.1
log
@Initial ANSIfication
@
text
@d19 1
a19 1
static const char RCSbadmagic[] = "@@(#)$Header: /c/CVS/brlcad/libbu/badmagic.c,v 1.7 2002/08/20 17:07:39 jra Exp $ (ARL)";
d35 6
a40 1
bu_badmagic(const long int *ptr, long int magic, const char *str, const char *file, int line)
@


1.7.2.2
log
@more quelling of lots of warnings
@
text
@d19 1
a19 1
static const char RCSbadmagic[] = "@@(#)$Header: /n/cad/c/CVS/brlcad/libbu/badmagic.c,v 1.7.2.1 2002/09/19 18:01:11 morrison Exp $ (ARL)";
d35 1
a35 1
bu_badmagic(const long int *ptr, unsigned long int magic, const char *str, const char *file, int line)
d44 1
a44 1
	if( ((size_t)(ptr)) & (sizeof(long)-1) )  {
d49 1
a49 1
	if( *(ptr) != (long int)(magic) )  { 
@


1.6
log
@Converted from K&R to ANSI C - RFH
@
text
@d35 6
a40 1
bu_badmagic(const long int *ptr, long int magic, const char *str, const char *file, int line)
@


1.5
log
@CONST to const
@
text
@d19 1
a19 1
static const char RCSbadmagic[] = "@@(#)$Header: /c/CVS/brlcad/libbu/badmagic.c,v 1.4 2000/07/07 05:21:20 cjohnson Exp $ (ARL)";
d35 1
a35 6
bu_badmagic( ptr, magic, str, file, line )
const long	*ptr;
long		magic;
const char	*str;
const char	*file;
int		line;
@


1.4
log
@LINT plus minor bug fix in bu_tcl.c
@
text
@d19 1
a19 1
static const char RCSbadmagic[] = "@@(#)$Header: /c/CVS/brlcad/libbu/badmagic.c,v 1.3 1998/01/08 03:34:29 mike Exp $ (ARL)";
d36 1
a36 1
CONST long	*ptr;
d38 2
a39 2
CONST char	*str;
CONST char	*file;
@


1.3
log
@Changed to match new BU_CKMAG() macro,
which checks for mis-aligned pointers.
Since we don't have any way of asking the kernel if the pointer is
mapped into our address space, this at least disqualifies 75% of
all garbaged pointers.
@
text
@d19 1
a19 1
static char RCSbadmagic[] = "@@(#)$Header: /m/cad/libbu/RCS/badmagic.c,v 1.2 1997/04/04 05:41:00 mike Exp mike $ (ARL)";
@


1.2
log
@Extended buffer length.
It's on the stack, so size isn't important, and it would be
horrible to run short.  Especially with long paths for __FILE__....
@
text
@d12 2
a13 3
 *	SECAD/VLD Computing Consortium, Bldg 394
 *	The U. S. Army Ballistic Research Laboratory
 *	Aberdeen Proving Ground, Maryland  21005-5066
d19 1
a19 1
static char RCSbadmagic[] = "@@(#)$Header: /m/cad/libbu/RCS/badmagic.c,v 1.1 1996/08/27 06:18:33 mike Exp mike $ (BRL)";
d49 8
a56 3
	if( *((long *)(ptr)) != (magic) )  { 
		sprintf(buf, "ERROR: bad pointer x%x: s/b %s(x%lx), was %s(x%lx), file %s, line %d\n", 
			ptr,
@


1.1
log
@Initial revision
@
text
@d20 1
a20 1
static char RCSbadmagic[] = "@@(#)$Header: /m/cad/librt/RCS/magic.c,v 11.3 1995/06/16 17:50:47 pjt Exp $ (BRL)";
d43 1
a43 1
	char	buf[256];
@
