head	11.14;
access;
symbols
	ansi-20040405-merged:11.9.2.2
	postmerge-20040405-ansi:11.12
	premerge-20040404-ansi:11.11
	postmerge-autoconf:11.10
	autoconf-freeze:11.9.10.1
	premerge-autoconf:11.10
	ansi-20040316-freeze:11.9.2.1
	postmerge-20040315-windows:11.10
	premerge-20040315-windows:11.9
	windows-20040315-freeze:11.9.4.2
	autoconf-20031203:11.9
	autoconf-20031202:11.9
	autoconf-branch:11.9.0.10
	phong-branch:11.9.0.8
	photonmap-branch:11.9.0.6
	rel-6-1-DP:11.9
	windows-branch:11.9.0.4
	rel-6-0-2:11.7
	ansi-branch:11.9.0.2
	rel-6-0-1-branch:11.7.0.2
	hartley-6-0-post:11.8
	hartley-6-0-pre:11.7
	rel-6-0-1:11.7
	rel-6-0:11.7
	rel-5-4:11.5
	offsite-5-3-pre:11.6
	rel-5-3:11.5
	rel-5-2:11.5
	rel-5-1-branch:11.5.0.2
	rel-5-1:11.5
	rel-5-0:11.5
	rel-5-0-beta:11.4;
locks; strict;
comment	@ * @;


11.14
date	2004.05.21.18.06.23;	author morrison;	state dead;
branches;
next	11.13;

11.13
date	2004.05.10.15.30.44;	author erikg;	state Exp;
branches;
next	11.12;

11.12
date	2004.04.05.07.46.16;	author morrison;	state Exp;
branches;
next	11.11;

11.11
date	2004.04.02.19.01.03;	author erikg;	state Exp;
branches;
next	11.10;

11.10
date	2004.03.16.19.40.48;	author morrison;	state Exp;
branches;
next	11.9;

11.9
date	2002.08.20.17.07.39;	author jra;	state Exp;
branches
	11.9.2.1
	11.9.4.1
	11.9.10.1;
next	11.8;

11.8
date	2002.08.15.20.54.50;	author hartley;	state Exp;
branches;
next	11.7;

11.7
date	2001.04.20.22.29.05;	author morrison;	state Exp;
branches;
next	11.6;

11.6
date	2000.07.07.05.21.20;	author cjohnson;	state Exp;
branches;
next	11.5;

11.5
date	99.06.09.19.49.14;	author mike;	state Exp;
branches;
next	11.4;

11.4
date	99.01.13.08.19.35;	author butler;	state Exp;
branches;
next	11.3;

11.3
date	98.09.22.19.44.28;	author bparker;	state Exp;
branches;
next	11.2;

11.2
date	98.08.23.02.02.14;	author mike;	state Exp;
branches;
next	11.1;

11.1
date	98.08.21.20.36.06;	author mike;	state Exp;
branches;
next	;

11.9.2.1
date	2002.09.19.18.01.11;	author morrison;	state Exp;
branches;
next	11.9.2.2;

11.9.2.2
date	2004.03.17.21.16.48;	author morrison;	state Exp;
branches;
next	;

11.9.4.1
date	2002.09.26.23.03.51;	author morrison;	state Exp;
branches;
next	11.9.4.2;

11.9.4.2
date	2003.08.14.08.07.24;	author morrison;	state Exp;
branches;
next	;

11.9.10.1
date	2004.03.18.18.08.13;	author erikg;	state Exp;
branches;
next	;


desc
@@


11.14
log
@moved to src/
@
text
@/*
 *			B R L C A D _ P A T H . C
 *
 *  A support routine to provide the executable code with the path
 *  to where the BRL-CAD programs and libraries are installed.
 *
 *  Author -
 *	Michael John Muuss
 *
 *  Source -
 *	The U. S. Army Research Laboratory
 *	Aberdeen Proving Ground, Maryland  21005-5068  USA
 *  
 *  Distribution Status -
 *      Public Domain, Distribution Unlimitied.
 */
static const char RCSbrlcad_path[] = "@@(#)$Header: /n/xoff/cvs/brlcad/libbu/brlcad_path.c,v 11.13 2004/05/10 15:30:44 erikg Exp $ (BRL)";

#ifdef HAVE_CONFIG_H
# include "config.h"
#endif



#include <stdio.h>
#include <sys/stat.h>
#ifdef USE_STRING_H
#include <string.h>
#else
#include <strings.h>
#endif

#include "machine.h"
#include "externs.h"
#include "bu.h"

/*
 *			B U _ F I L E _ E X I S T S
 *
 *  Returns boolean -
 *	1	The given filename exists.
 *	0	The given filename does not exist.
 */
int
bu_file_exists(const char *path)
{
	struct	stat	sbuf;

	if( path == NULL )  return 0;			/* FAIL */

	/* defined in unistd.h */
#if defined(F_OK)
	if( access( path, F_OK )  == 0 )  return 1;	/* OK */
#endif

	if( stat( path, &sbuf ) == 0 )  return 1;	/* OK */
	return 0;					/* FAIL */
}

/*
 *			B U _ B R L C A D _ P A T H
 *
 *  Locate where the BRL-CAD programs and libraries are located,
 *  contatenate on the rest of the string provided by the caller,
 *  and return a pointer to a STATIC buffer with the full path.
 *  It is the caller's responsibility to call bu_strdup() or make
 *  other provisions to save the returned string, before calling again.
 *  bu_bomb() if unable to find the base path.
 *
 */
char *
bu_brlcad_path(const char *rhs)
{
	static char	result[256];
	char		*lhs;

	/* The environment variable, if set, takes priority */
	if( (lhs = getenv("BRLCAD_ROOT")) != NULL )  {
		if( bu_file_exists(lhs) )
			goto ok;
		bu_log("You set environment variable BRLCAD_ROOT to '%s', which does not exist.  Seeking=%s\n", lhs, rhs);
		bu_bomb("bu_brlcad_path()");
	}

	/* The compiled-in path is used next. */
#ifdef BRLCAD_ROOT
	lhs = BRLCAD_ROOT;
#else
#ifndef WIN32
	lhs = PREFIX;
#else
	/* XXX nastiness that will need to be made dynamic
	lhs = "C:\\brlcad";  /* change as needed*/
#endif
#endif
	if( bu_file_exists(lhs) )
		goto ok;

	/* Can't find the BRL-CAD root directory, this is fatal! */
	/* Could use some huristics here, but being overly clever is probably bad. */

	bu_log("\
Unable to find the directory that BRL-CAD is installed in while seeking: \n\
	%s\n\
This version of LIBBU was compiled to expect BRL-CAD in: \n\
	%s\n\
but it is no longer there.  After you manually locate BRL-CAD,\n\
please set your environment variable BRLCAD_ROOT to the correct path,\n\
and re-run this program.\n\
\n\
csh/tcsh users:\n\
	setenv BRLCAD_ROOT %s\n\
sh/bash users:\n\
	BRLCAD_ROOT=%s; export BRLCAD_ROOT\n",
		rhs, lhs, lhs, lhs);
	bu_bomb("bu_brlcad_path()");

ok:
#ifndef WIN32
	sprintf(result, "%s/%s", lhs, rhs );
#else
	if(strcmp(rhs,"")==0)
		sprintf(result, "%s", lhs );
	else
		sprintf(result, "%s\\%s", lhs, rhs );
#endif
	if( bu_file_exists(result) )
		return result;			/* OK */

	bu_log("\
Unable to find the '%s' subdirectory within the BRL-CAD\n\
software installed in '%s'.\n\
This copy of BRL-CAD does not appear to be fully installed.\n\
Please contact your system administrator for assistance.\n",
	rhs, lhs );
	bu_bomb("bu_brlcad_path()");

	return NULL;				/* NOTREACHED */
}
@


11.13
log
@change conf.h to a wrapped config.h
@
text
@d17 1
a17 1
static const char RCSbrlcad_path[] = "@@(#)$Header: /cvs/brlcad/libbu/brlcad_path.c,v 11.12 2004/04/05 07:46:16 morrison Exp $ (BRL)";
@


11.12
log
@merge of ansi-6-0-branch into HEAD
@
text
@d17 6
a22 1
static const char RCSbrlcad_path[] = "@@(#)$Header$ (BRL)";
a23 1
#include "conf.h"
@


11.11
log
@macosX fixes
@
text
@d17 1
a17 1
static const char RCSbrlcad_path[] = "@@(#)$Header: /cvs/brlcad/libbu/brlcad_path.c,v 11.10 2004/03/16 19:40:48 morrison Exp $ (BRL)";
d41 1
a41 2
bu_file_exists( path )
const char *path;
d68 1
a68 2
bu_brlcad_path( rhs )
const char *rhs;
@


11.10
log
@merge of windows-6-0-branch into head
@
text
@d17 1
a17 1
static const char RCSbrlcad_path[] = "@@(#)$Header$ (BRL)";
d88 1
a88 1
	lhs = "/usr/brlcad";		/* Changed by newbindir.sh */
@


11.9
log
@Restoration of entire source tree to Pre-Hartley state
@
text
@d17 1
a17 1
static const char RCSbrlcad_path[] = "@@(#)$Header: /c/CVS/brlcad/libbu/brlcad_path.c,v 11.7 2001/04/20 22:29:05 morrison Exp $ (BRL)";
d87 1
d89 4
d117 1
d119 6
@


11.9.10.1
log
@merge from head
@
text
@d17 1
a17 1
static const char RCSbrlcad_path[] = "@@(#)$Header$ (BRL)";
a86 1
#ifndef WIN32
a87 4
#else
	/* XXX nastiness that will need to be made dynamic
	lhs = "C:\\brlcad";  /* change as needed*/
#endif
a111 1
#ifndef WIN32
a112 6
#else
	if(strcmp(rhs,"")==0)
		sprintf(result, "%s", lhs );
	else
		sprintf(result, "%s\\%s", lhs, rhs );
#endif
@


11.9.4.1
log
@Modifications (on a 6.0 source distribution) for initial port to windows (merged with sources close to 6.0.2)
@
text
@d17 1
a17 1
static const char RCSbrlcad_path[] = "@@(#)$Header: /c/CVS/brlcad/libbu/brlcad_path.c,v 11.9 2002/08/20 17:07:39 jra Exp $ (BRL)";
a86 1
#ifndef WIN32
a87 3
#else
	lhs = "C:\\code\\brlcad6.0";  /* change as needed*/
#endif
a111 1
#ifndef WIN32
a112 6
#else
	if(strcmp(rhs,"")==0)
		sprintf(result, "%s", lhs );
	else
		sprintf(result, "%s\\%s", lhs, rhs );
#endif
@


11.9.4.2
log
@Survice Engineering patch to clean up the build environment and several runtime issues
@
text
@d17 1
a17 1
static const char RCSbrlcad_path[] = "@@(#)$Header: /c/CVS/brlcad/libbu/brlcad_path.c,v 11.9.4.1 2002/09/26 23:03:51 morrison Exp $ (BRL)";
d90 1
a90 2
	/* XXX nastiness that will need to be made dynamic
	lhs = "C:\\brlcad";  /* change as needed*/
@


11.9.2.1
log
@Initial ANSIfication
@
text
@d17 1
a17 1
static const char RCSbrlcad_path[] = "@@(#)$Header: /c/CVS/brlcad/libbu/brlcad_path.c,v 11.9 2002/08/20 17:07:39 jra Exp $ (BRL)";
d41 2
a42 1
bu_file_exists(const char *path)
d69 2
a70 1
bu_brlcad_path(const char *rhs)
@


11.9.2.2
log
@sync branch with HEAD
@
text
@d17 1
a17 1
static const char RCSbrlcad_path[] = "@@(#)$Header$ (BRL)";
a84 1
#ifndef WIN32
a85 4
#else
	/* XXX nastiness that will need to be made dynamic
	lhs = "C:\\brlcad";  /* change as needed*/
#endif
a109 1
#ifndef WIN32
a110 6
#else
	if(strcmp(rhs,"")==0)
		sprintf(result, "%s", lhs );
	else
		sprintf(result, "%s\\%s", lhs, rhs );
#endif
@


11.8
log
@Converted from K&R to ANSI C - RFH
@
text
@d41 2
a42 1
bu_file_exists(const char *path)
d69 2
a70 1
bu_brlcad_path(const char *rhs)
@


11.7
log
@CONST to const
@
text
@d17 1
a17 1
static const char RCSbrlcad_path[] = "@@(#)$Header: /c/CVS/brlcad/libbu/brlcad_path.c,v 11.6 2000/07/07 05:21:20 cjohnson Exp $ (BRL)";
d41 1
a41 2
bu_file_exists( path )
const char *path;
d68 1
a68 2
bu_brlcad_path( rhs )
const char *rhs;
@


11.6
log
@LINT plus minor bug fix in bu_tcl.c
@
text
@d17 1
a17 1
static const char RCSbrlcad_path[] = "@@(#)$Header: /c/CVS/brlcad/libbu/brlcad_path.c,v 11.5 1999/06/09 19:49:14 mike Exp $ (BRL)";
d42 1
a42 1
CONST char *path;
d70 1
a70 1
CONST char *rhs;
@


11.5
log
@
Added Tcl interface to bu_brlcad_path().
Improved error message from bu_brlcad_path().
@
text
@d17 1
a17 1
static char RCSbrlcad_path[] = "@@(#)$Header: /c/CVS/brlcad/libbu/brlcad_path.c,v 11.4 1999/01/13 08:19:35 butler Exp $ (BRL)";
@


11.4
log
@Made the error message printed a little more extensive, and modified it to
tell the user that BRLCAD_ROOT should point to the location where BRLCAD was
compiled to be installed, rather than just saying "/usr/brlcad"
@
text
@d17 1
a17 1
static char RCSbrlcad_path[] = "@@(#)$Header: /c/CVS/brlcad/libbu/brlcad_path.c,v 11.3 1998/09/22 19:44:28 bparker Exp $ (BRL)";
d92 1
d100 4
a103 1
Please set your environment variable BRLCAD_ROOT with the correct path.\n\
@


11.3
log
@*- specify default root directory using BRLCAD_ROOT
@
text
@d17 1
a17 1
static char RCSbrlcad_path[] = "@@(#)$Header: /c/CVS/brlcad/libbu/brlcad_path.c,v 11.2 1998/08/23 02:02:14 mike Exp $ (BRL)";
d93 1
d95 4
a98 3
Unable to find the directory that BRL-CAD is installed in\n\
while seeking '%s'.\n\
This version of LIBBU was compiled to expect BRL-CAD in '%s'.\n\
d101 1
a101 1
	setenv BRLCAD_ROOT /usr/brlcad\n\
d103 2
a104 2
	BRLCAD_ROOT=/usr/brlcad; export BRLCAD_ROOT\n",
		rhs, lhs);
@


11.2
log
@Changed environment variable name to BRLCAD_ROOT
@
text
@d17 1
a17 1
static char RCSbrlcad_path[] = "@@(#)$Header: /c/CVS/brlcad/libbu/brlcad_path.c,v 11.1 1998/08/21 20:36:06 mike Exp $ (BRL)";
d84 3
d88 1
@


11.1
log
@Added common routine bu_brlcad_path()
and helper bu_file_exists()
@
text
@d17 1
a17 1
static char RCSbrlcad_path[] = "@@(#)$Header: /c/CVS/brlcad/libbu/vls.c,v 1.13 1998/03/25 02:55:34 butler Exp $ (BRL)";
d76 1
a76 1
	if( (lhs = getenv("BRLCAD_BASEDIR")) != NULL )  {
d79 1
a79 1
		bu_log("You set environment variable BRLCAD_BASEDIR to '%s', which does not exist.  Seeking=%s\n", lhs, rhs);
d93 1
a93 1
Please set your environment variable BRLCAD_BASEDIR with the correct path.\n\
d95 1
a95 1
	setenv BRLCAD_BASEDIR /usr/brlcad\n\
d97 1
a97 1
	BRLCAD_BASEDIR=/usr/brlcad; export BRLCAD_BASEDIR\n",
@
