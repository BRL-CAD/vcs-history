head	14.16;
access;
symbols
	rel-7-10-4:14.16
	STABLE:14.16.0.2
	stable-branch:14.5
	rel-7-10-2:14.16
	rel-7-10-0:14.14
	rel-7-8-4:14.10
	rel-7-8-2:14.8
	rel-7-8-0:14.8
	trimnurbs-branch:14.8.0.2
	help:14.8
	temp_tag:14.7
	bobWinPort-20051223-freeze:14.5.2.1
	postmerge-20051223-bobWinPort:14.7
	premerge-20051223-bobWinPort:14.6
	rel-7-6-6:14.6
	rel-7-6-4:14.5
	rel-7-6-2:14.5
	rel-7-6-branch:14.5.0.6
	rel-7-6-0:14.5
	rel-7-4-2:14.5
	rel-7-4-branch:14.5.0.4
	bobWinPort:14.5.0.2
	rel-7-4-0:14.5
	rel-7-2-6:14.5
	rel-7-2-4:14.5
	rel-7-2-2:14.5
	rel-7-2-0:14.4
	rel-7-0-4:14.3
	rel-7-0-2:14.3
	rel-7-0-1:14.3
	opensource-post:14.3
	opensource-pre:1.1
	rel-7-0-branch:1.1.0.2
	rel-7-0:1.1;
locks; strict;
comment	@ * @;


14.16
date	2007.05.26.02.08.00;	author brlcad;	state Exp;
branches;
next	14.15;

14.15
date	2007.05.26.01.45.04;	author brlcad;	state Exp;
branches;
next	14.14;

14.14
date	2007.01.27.01.01.39;	author brlcad;	state Exp;
branches;
next	14.13;

14.13
date	2007.01.23.01.13.20;	author brlcad;	state Exp;
branches;
next	14.12;

14.12
date	2007.01.21.04.45.40;	author brlcad;	state Exp;
branches;
next	14.11;

14.11
date	2007.01.20.14.36.40;	author brlcad;	state Exp;
branches;
next	14.10;

14.10
date	2006.09.18.05.24.07;	author lbutler;	state Exp;
branches;
next	14.9;

14.9
date	2006.07.14.15.02.44;	author erikgreenwald;	state Exp;
branches;
next	14.8;

14.8
date	2006.01.18.06.46.10;	author brlcad;	state Exp;
branches;
next	14.7;

14.7
date	2005.12.23.21.26.25;	author bob1961;	state Exp;
branches;
next	14.6;

14.6
date	2005.12.04.17.32.11;	author brlcad;	state Exp;
branches;
next	14.5;

14.5
date	2005.03.04.05.26.11;	author brlcad;	state Exp;
branches
	14.5.2.1;
next	14.4;

14.4
date	2005.01.30.20.30.10;	author brlcad;	state Exp;
branches;
next	14.3;

14.3
date	2004.12.21.06.23.18;	author morrison;	state Exp;
branches;
next	14.2;

14.2
date	2004.12.21.06.06.38;	author butler;	state Exp;
branches;
next	14.1;

14.1
date	2004.11.16.19.42.10;	author morrison;	state Exp;
branches;
next	1.1;

1.1
date	2004.05.24.04.10.50;	author morrison;	state Exp;
branches;
next	;

14.5.2.1
date	2005.09.08.16.11.51;	author bob1961;	state Exp;
branches;
next	;


desc
@@


14.16
log
@clean up the header protections so that they are all now more consistent with one another via use of __HEADER_H__ for the define names.
@
text
@/*                           D B 5 . H
 * BRL-CAD
 *
 * Copyright (c) 2004-2007 United States Government as represented by
 * the U.S. Army Research Laboratory.
 *
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public License
 * version 2.1 as published by the Free Software Foundation.
 *
 * This library is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this file; see the file named COPYING for more
 * information.
 */
/** @@addtogroup db5 */
/** @@{ */
/** @@file db5.h
 * @@brief
 *  Definition of the BRL-CAD "v5" database format used for new ".g" files.
 *
 * @@author	Michael John Muuss
 * @@author	Lee A. Butler
 * @@author	Paul J. Tanenbaum
 * @@author	John R. Anderson
 *
 *  @@par Source
 *	The U. S. Army Research Laboratory
 *@@n	Aberdeen Proving Ground, Maryland  21005-5068  USA
 */

#ifndef __DB5_H__
#define __DB5_H__

__BEGIN_DECLS

#ifndef DB5_EXPORT
#  if defined(_WIN32) && !defined(__CYGWIN__) && defined(BRLCAD_DLL)
#    ifdef DB5_EXPORT_DLL
#      define DB5_EXPORT __declspec(dllexport)
#    else
#      define DB5_EXPORT __declspec(dllimport)
#    endif
#  else
#    define DB5_EXPORT
#  endif
#endif

/**
 * The format of an object's header as it exists on disk,
 * as best we can describe its variable size with a "C" structure.
 */
struct db5_ondisk_header {
	unsigned char	db5h_magic1;		/* [0] */
	unsigned char	db5h_hflags;		/* [1] */
	unsigned char	db5h_aflags;		/* [2] */
	unsigned char	db5h_bflags;		/* [3] */
	unsigned char	db5h_major_type;	/* [4] */
	unsigned char	db5h_minor_type;	/* [5] */
	/* Next is a mandatory variable-size length field starting at [6] */
	/* Next are optional object name length & data fields */
};

#define DB5HDR_MAGIC1	0x76		/* 'v' */
#define DB5HDR_MAGIC2	0x35		/* '5' */

/* hflags */
#define DB5HDR_HFLAGS_DLI_MASK				0x03
#define DB5HDR_HFLAGS_DLI_APPLICATION_DATA_OBJECT	0
#define DB5HDR_HFLAGS_DLI_HEADER_OBJECT			1
#define DB5HDR_HFLAGS_DLI_FREE_STORAGE			2
#define	DB5HDR_HFLAGS_HIDDEN_OBJECT			0x4
#define DB5HDR_HFLAGS_NAME_PRESENT			0x20
#define DB5HDR_HFLAGS_OBJECT_WIDTH_MASK			0xc0
#define DB5HDR_HFLAGS_OBJECT_WIDTH_SHIFT		6
#define DB5HDR_HFLAGS_NAME_WIDTH_MASK			0x18
#define DB5HDR_HFLAGS_NAME_WIDTH_SHIFT			3

#define DB5HDR_WIDTHCODE_8BIT		0
#define DB5HDR_WIDTHCODE_16BIT		1
#define DB5HDR_WIDTHCODE_32BIT		2
#define DB5HDR_WIDTHCODE_64BIT		3

/* aflags */
#define DB5HDR_AFLAGS_ZZZ_MASK				0x07
#define DB5HDR_AFLAGS_PRESENT				0x20
#define DB5HDR_AFLAGS_WIDTH_MASK			0xc0
#define DB5HDR_AFLAGS_WIDTH_SHIFT			6

/* bflags */
#define DB5HDR_BFLAGS_ZZZ_MASK				0x07
#define DB5HDR_BFLAGS_PRESENT				0x20
#define DB5HDR_BFLAGS_WIDTH_MASK			0xc0
#define DB5HDR_BFLAGS_WIDTH_SHIFT			6

/*************************************************************************
 *
 *	What follows is the C programming API for the routines
 *	implementing the v5 database.
 *	It may want to live in a different header file.
 *
 ************************************************************************/

/* Name of global attribute-only object for storing database title & units */
#define DB5_GLOBAL_OBJECT_NAME			"_GLOBAL"

/* Kinds of compression */
#define DB5_ZZZ_UNCOMPRESSED			0
#define DB5_ZZZ_GNU_GZIP			1
#define DB5_ZZZ_BURROUGHS_WHEELER		2


/* major_type */
#define DB5_MAJORTYPE_RESERVED			 0
#define DB5_MAJORTYPE_BRLCAD			 1
#define DB5_MAJORTYPE_ATTRIBUTE_ONLY		 2
#define DB5_MAJORTYPE_BINARY_MASK		 0x18
#define DB5_MAJORTYPE_BINARY_EXPM		 8
#define DB5_MAJORTYPE_BINARY_UNIF		 9
#define DB5_MAJORTYPE_BINARY_MIME		10

/*
 *	Minor types
 */
/* BRL-CAD */
#define DB5_MINORTYPE_RESERVED			 0
#define DB5_MINORTYPE_BRLCAD_TOR		 1
#define DB5_MINORTYPE_BRLCAD_TGC		 2
#define DB5_MINORTYPE_BRLCAD_ELL		 3
#define DB5_MINORTYPE_BRLCAD_ARB8		 4
#define DB5_MINORTYPE_BRLCAD_ARS		 5
#define DB5_MINORTYPE_BRLCAD_HALF		 6
#define DB5_MINORTYPE_BRLCAD_REC		 7
#define DB5_MINORTYPE_BRLCAD_POLY		 8
#define DB5_MINORTYPE_BRLCAD_BSPLINE		 9
#define DB5_MINORTYPE_BRLCAD_SPH		10
#define	DB5_MINORTYPE_BRLCAD_NMG		11
#define DB5_MINORTYPE_BRLCAD_EBM		12
#define DB5_MINORTYPE_BRLCAD_VOL		13
#define DB5_MINORTYPE_BRLCAD_ARBN		14
#define DB5_MINORTYPE_BRLCAD_PIPE		15
#define DB5_MINORTYPE_BRLCAD_PARTICLE		16
#define DB5_MINORTYPE_BRLCAD_RPC		17
#define DB5_MINORTYPE_BRLCAD_RHC		18
#define DB5_MINORTYPE_BRLCAD_EPA		19
#define DB5_MINORTYPE_BRLCAD_EHY		20
#define DB5_MINORTYPE_BRLCAD_ETO		21
#define DB5_MINORTYPE_BRLCAD_GRIP		22
#define DB5_MINORTYPE_BRLCAD_JOINT		23
#define DB5_MINORTYPE_BRLCAD_HF			24
#define DB5_MINORTYPE_BRLCAD_DSP		25
#define	DB5_MINORTYPE_BRLCAD_SKETCH		26
#define	DB5_MINORTYPE_BRLCAD_EXTRUDE		27
#define DB5_MINORTYPE_BRLCAD_SUBMODEL		28
#define	DB5_MINORTYPE_BRLCAD_CLINE		29
#define	DB5_MINORTYPE_BRLCAD_BOT		30
#define DB5_MINORTYPE_BRLCAD_COMBINATION	31
#define DB5_MINORTYPE_BRLCAD_SUPERELL		32
#define DB5_MINORTYPE_BRLCAD_METABALL		33

/* Uniform-array binary */
#define DB5_MINORTYPE_BINU_WID_MASK		0x30
#define DB5_MINORTYPE_BINU_SGN_MASK		0x08
#define DB5_MINORTYPE_BINU_ATM_MASK		0x07
#define DB5_MINORTYPE_BINU_FLOAT		0x02
#define DB5_MINORTYPE_BINU_DOUBLE		0x03
#define DB5_MINORTYPE_BINU_8BITINT_U		0x04
#define DB5_MINORTYPE_BINU_16BITINT_U		0x05
#define DB5_MINORTYPE_BINU_32BITINT_U		0x06
#define DB5_MINORTYPE_BINU_64BITINT_U		0x07
#define DB5_MINORTYPE_BINU_8BITINT		0x0c
#define DB5_MINORTYPE_BINU_16BITINT		0x0d
#define DB5_MINORTYPE_BINU_32BITINT		0x0e
#define DB5_MINORTYPE_BINU_64BITINT		0x0f

/* this array depends on the values of the above definitions and is defined in db5_bin.c */
extern const char *binu_types[];

/**
 *  The "raw internal" form of one database object.
 *  This is what the low-level database routines will operate on.
 *  Magic number1 has already been checked, and is not stored.
 */
struct db5_raw_internal {
	long		magic;
	unsigned char	h_object_width;		/* DB5HDR_WIDTHCODE_x */
	unsigned char	h_name_hidden;
	unsigned char	h_name_present;
	unsigned char	h_name_width;		/* DB5HDR_WIDTHCODE_x */
	unsigned char	h_dli;
	unsigned char	a_width;		/* DB5HDR_WIDTHCODE_x */
	unsigned char	a_present;
	unsigned char	a_zzz;
	unsigned char	b_width;		/* DB5HDR_WIDTHCODE_x */
	unsigned char	b_present;
	unsigned char	b_zzz;
	unsigned char	major_type;
	unsigned char	minor_type;
	long		object_length;		/* in bytes, on disk */
	/* These three MUST NOT be passed to bu_free_external()! */
	struct bu_external name;
	struct bu_external body;
	struct bu_external attributes;
	unsigned char	*buf;		/* if non-null needs to be bu_free()ed */
};
#define DB5_RAW_INTERNAL_MAGIC	0x64357269	/* "d5ri" */
#define RT_CK_RIP(_ptr)		BU_CKMAG( _ptr, DB5_RAW_INTERNAL_MAGIC, "db5_raw_internal" )

DB5_EXPORT extern const int db5_enc_len[4];	/* convert wid to nbytes */

DB5_EXPORT BU_EXTERN(unsigned char *db5_encode_length,
		     (unsigned char	*cp,
		      long		val,
		      int		format));
DB5_EXPORT BU_EXTERN(const unsigned char *db5_get_raw_internal_ptr,
		     (struct db5_raw_internal *rip,
		      const unsigned char *ip));


__END_DECLS

#endif	/* __DB5_H__ */

/** @@} */
/*
 * Local Variables:
 * mode: C
 * tab-width: 8
 * c-basic-offset: 4
 * indent-tabs-mode: t
 * End:
 * ex: shiftwidth=4 tabstop=8
 */
@


14.15
log
@get rid of RCS variables from the public header files.  this is done in part to reduce recompilation during interface changes, but also to move towards not relying on or publishing the information contained in the variables interface-wise. (they're fine for c sources and private headers)
@
text
@d35 3
a37 2
#ifndef DB5_H
#define DB5_H seen
d226 1
a226 2
#endif	/* DB5_H */

@


14.14
log
@ws, test three
@
text
@a33 2
 *
 *  $Header: /cvsroot/brlcad/brlcad/include/db5.h,v 14.13 2007/01/23 01:13:20 brlcad Exp $
@


14.13
log
@Sweeping license updates.  Documentation is fully relicensed to the BSD Documentation License (a minor variant of the FreeBSD Documentation License and BSD License).  All GPL code (mostly application code) is converted to the LGPL and now also specifically declares version 2.1, revoking the blank check to the FSF.  The intent of these sweeping changes are to simplify the licensing terms and increase overall flexibility of use, both externally (to users for their purposes) and internally (to allow application code to be migrated to libraries without creating GPL libraries).  As a collective work, BRL-CAD is now LGPL.
@
text
@d25 1
a25 1
 *  
d35 1
a35 1
 *  $Header: /cvsroot/brlcad/brlcad/include/db5.h,v 14.12 2007/01/21 04:45:40 brlcad Exp $
a239 1

@


14.12
log
@ugh, what tedium.  put some effort towards cleaning up the doxygen labels and making the headers more consistent.  also exclusively using @@ for doxygen instead of \ to try to keep things more consistent.
@
text
@d9 1
a9 2
 * as published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
d14 1
a14 1
 * Library General Public License for more details.
d35 1
a35 1
 *  $Header: /cvsroot/brlcad/brlcad/include/db5.h,v 14.11 2007/01/20 14:36:40 brlcad Exp $
@


14.11
log
@update copyright to 2007
@
text
@d22 1
a22 1
/*@@{*/
d24 1
a24 1
 *@@brief
d36 1
a36 1
 *  $Header: /cvsroot/brlcad/brlcad/include/db5.h,v 14.10 2006/09/18 05:24:07 lbutler Exp $
d231 1
a231 1
/*@@}*/
@


14.10
log
@Doxygen updates
@
text
@d4 1
a4 1
 * Copyright (c) 2004-2006 United States Government as represented by
d36 1
a36 1
 *  $Header: /cvsroot/brlcad/brlcad/include/db5.h,v 14.9 2006/07/14 15:02:44 erikgreenwald Exp $
@


14.9
log
@claiming a number for metaballs
@
text
@d21 2
d24 1
a24 1
 *
d26 5
d32 1
a32 7
 *  Authors -
 *	Michael John Muuss
 *	Lee A. Butler
 *	Paul J. Tanenbaum
 *	John R. Anderson
 *
 *  Source -
d34 1
a34 1
 *	Aberdeen Proving Ground, Maryland  21005-5068  USA
d36 1
a36 1
 *  $Header: /cvsroot/brlcad/brlcad/include/db5.h,v 14.8 2006/01/18 06:46:10 brlcad Exp $
d55 1
a55 1
/*
d185 1
a185 1
/*
d231 1
a231 1

d241 1
@


14.8
log
@update copyright to 2006
@
text
@d35 1
a35 1
 *  $Header: /cvsroot/brlcad/brlcad/include/db5.h,v 14.7 2005/12/23 21:26:25 bob1961 Exp $
d164 1
@


14.7
log
@Merge of bobWinPort
@
text
@d4 1
a4 1
 * Copyright (C) 2004-2005 United States Government as represented by
d35 1
a35 1
 *  $Header: /cvsroot/brlcad/brlcad/include/db5.h,v 14.6 2005/12/04 17:32:11 brlcad Exp $
@


14.6
log
@reserve a minor type of 0 .. invalid/unset
@
text
@d35 1
a35 1
 *  $Header: /cvsroot/brlcad/brlcad/include/db5.h,v 14.5 2005/03/04 05:26:11 brlcad Exp $
d40 14
d213 9
a221 1
extern const int db5_enc_len[4];	/* convert wid to nbytes */
a222 7
extern unsigned char *db5_encode_length(
	unsigned char	*cp,
	long		val,
	int		format);
const unsigned char *db5_get_raw_internal_ptr(
	struct db5_raw_internal *rip,
	const unsigned char *ip);
d224 1
@


14.5
log
@define the db5 minor type for superell even if it uses the v4 macro
@
text
@d35 1
a35 1
 *  $Header: /cvsroot/brlcad/brlcad/include/db5.h,v 14.4 2005/01/30 20:30:10 brlcad Exp $
d117 1
@


14.5.2.1
log
@Mods for windows port
@
text
@d35 1
a35 1
 *  $Header: /cvsroot/brlcad/brlcad/include/db5.h,v 14.5 2005/03/04 05:26:11 brlcad Exp $
a39 14
__BEGIN_DECLS

#ifndef DB5_EXPORT
#  if defined(_WIN32) && !defined(__CYGWIN__) && defined(BRLCAD_DLL)
#    ifdef DB5_EXPORT_DLL
#      define DB5_EXPORT __declspec(dllexport)
#    else
#      define DB5_EXPORT __declspec(dllimport)
#    endif
#  else
#    define DB5_EXPORT
#  endif
#endif

d198 1
a198 9
DB5_EXPORT extern const int db5_enc_len[4];	/* convert wid to nbytes */

DB5_EXPORT BU_EXTERN(unsigned char *db5_encode_length,
		     (unsigned char	*cp,
		      long		val,
		      int		format));
DB5_EXPORT BU_EXTERN(const unsigned char *db5_get_raw_internal_ptr,
		     (struct db5_raw_internal *rip,
		      const unsigned char *ip));
d200 7
a207 1
__END_DECLS
@


14.4
log
@update copyright to 2005
@
text
@d35 1
a35 1
 *  $Header: /cvsroot/brlcad/brlcad/include/db5.h,v 14.3 2004/12/21 06:23:18 morrison Exp $
d148 2
@


14.3
log
@use perl to M-q format wrapping
@
text
@d4 2
a5 2
 * Copyright (c) 2004 United States Government as represented by the
 * U.S. Army Research Laboratory.
d35 1
a35 1
 *  $Header: /cvs/brlcad/include/db5.h,v 14.2 2004/12/21 06:06:38 butler Exp $
@


14.2
log
@LGPL license changes
@
text
@d17 2
a18 2
 * You should have received a copy of the GNU Lesser General Public License
 * along with this file; see the file named COPYING for more
d35 1
a35 1
 *  $Header: /cvs/brlcad/include/db5.h,v 14.1 2004/11/16 19:42:10 morrison Exp $
@


14.1
log
@dawn of a new revision.  it shall be numbered 14 to match release 7.  begin the convergence by adding emacs/vi local variable footer blocks to encourage consistent formatting.
@
text
@d1 21
a21 2
/*
 *			D B 5 . H
a33 3
 *  
 *  Distribution Status -
 *	Public Domain, Distribution Unlimited.
d35 1
a35 1
 *  $Header: /cvs/brlcad/include/db5.h,v 1.1 2004/05/24 04:10:50 morrison Exp $
@


1.1
log
@moved/renamed from top-level h/ to top-level include/
@
text
@d19 1
a19 1
 *  $Header$
d194 10
@

