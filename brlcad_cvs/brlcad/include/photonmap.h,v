head	14.15;
access;
symbols
	rel-7-10-4:14.14
	STABLE:14.14.0.2
	stable-branch:14.5
	rel-7-10-2:14.14
	rel-7-10-0:14.12
	rel-7-8-4:14.8
	rel-7-8-2:14.7
	rel-7-8-0:14.7
	trimnurbs-branch:14.7.0.2
	help:14.7
	temp_tag:14.6
	bobWinPort-20051223-freeze:14.5
	postmerge-20051223-bobWinPort:14.6
	premerge-20051223-bobWinPort:14.6
	rel-7-6-6:14.6
	rel-7-6-4:14.6
	rel-7-6-2:14.5
	rel-7-6-branch:14.5.0.6
	rel-7-6-0:14.5
	rel-7-4-2:14.5
	rel-7-4-branch:14.5.0.4
	bobWinPort:14.5.0.2
	rel-7-4-0:14.5
	rel-7-2-6:14.5
	rel-7-2-4:14.5
	rel-7-2-2:14.5
	rel-7-2-0:14.4
	rel-7-0-4:14.3
	rel-7-0-2:14.3
	rel-7-0-1:14.3
	opensource-post:14.3
	opensource-pre:1.4
	rel-7-0-branch:1.4.0.2
	rel-7-0:1.4;
locks; strict;
comment	@ * @;


14.15
date	2007.09.15.16.23.03;	author brlcad;	state Exp;
branches;
next	14.14;

14.14
date	2007.07.26.01.13.50;	author brlcad;	state Exp;
branches;
next	14.13;

14.13
date	2007.05.26.01.45.04;	author brlcad;	state Exp;
branches;
next	14.12;

14.12
date	2007.01.27.01.01.40;	author brlcad;	state Exp;
branches;
next	14.11;

14.11
date	2007.01.23.01.13.20;	author brlcad;	state Exp;
branches;
next	14.10;

14.10
date	2007.01.21.04.45.40;	author brlcad;	state Exp;
branches;
next	14.9;

14.9
date	2007.01.20.14.36.40;	author brlcad;	state Exp;
branches;
next	14.8;

14.8
date	2006.09.18.05.24.07;	author lbutler;	state Exp;
branches;
next	14.7;

14.7
date	2006.01.18.06.46.10;	author brlcad;	state Exp;
branches;
next	14.6;

14.6
date	2005.10.23.04.44.26;	author brlcad;	state Exp;
branches;
next	14.5;

14.5
date	2005.03.28.06.31.27;	author bob1961;	state Exp;
branches
	14.5.6.1;
next	14.4;

14.4
date	2005.01.30.20.30.10;	author brlcad;	state Exp;
branches;
next	14.3;

14.3
date	2004.12.21.06.23.18;	author morrison;	state Exp;
branches;
next	14.2;

14.2
date	2004.12.21.06.06.39;	author butler;	state Exp;
branches;
next	14.1;

14.1
date	2004.11.16.19.42.10;	author morrison;	state Exp;
branches;
next	1.4;

1.4
date	2004.09.03.23.30.55;	author morrison;	state Exp;
branches;
next	1.3;

1.3
date	2004.08.02.22.24.40;	author morrison;	state Exp;
branches;
next	1.2;

1.2
date	2004.06.08.23.06.24;	author morrison;	state Exp;
branches;
next	1.1;

1.1
date	2004.05.24.04.10.50;	author morrison;	state Exp;
branches;
next	;

14.5.6.1
date	2005.11.13.13.46.10;	author brlcad;	state Exp;
branches;
next	;


desc
@@


14.15
log
@more c89 embracing.  c89 provides string.h for all of the various str*() and mem*() functions, so remove the check for its presence.  there is still likely to be work required for strict c89 conformance for the various bsd strings.h functions that may be in use.
@
text
@/*                     P H O T O N M A P . H
 * BRL-CAD
 *
 * Copyright (c) 2002-2007 United States Government as represented by
 * the U.S. Army Research Laboratory.
 *
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public License
 * version 2.1 as published by the Free Software Foundation.
 *
 * This library is distributed in the hope that it will be useful, but
 * WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this file; see the file named COPYING for more
 * information.
 */
/** @@addtogroup librt */
/** @@{ */
/** @@file photonmap.h
 *			P H O T O N M A P. H
 * @@brief
 *  Declarations related to Photon Mapping
 *
 * @@author Justin Shumaker
 *
 */

#include "common.h"

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <math.h>
#include "machine.h"
#include "bu.h"
#include "vmath.h"
#include "bn.h"
#include "db.h"
#include "nmg.h"
#include "raytrace.h"
#include "optical.h"
#include "plastic.h"
#include "light.h"


#define	PM_MAPS		4

#define	PM_GLOBAL	0
#define	PM_CAUSTIC	1
#define	PM_SHADOW	2	/* Current not used */
#define	PM_IMPORTANCE	3

#define	PM_SEM		RT_SEM_LAST-1
#define	PM_SEM_INIT	RT_SEM_LAST

/**
 *  Photon Map Data Structure
 */
struct Photon {
  int			Axis;		/**< @@brief Splitting Plane */
  point_t		Pos;		/**< @@brief Photon Position */
  vect_t		Dir;		/**< @@brief Photon Direction */
  vect_t		Normal;		/**< @@brief Normal at Intersection */
  vect_t		Power;		/**< @@brief Photon Power */
  vect_t		Irrad;		/**< @@brief Irradiance */
};


struct PSN {
  struct	Photon	P;
  fastf_t		Dist;
};


/**
 *  Photon Search Structure
 */
struct PhotonSearch {
  int			Max;		/**< @@brief Max Number of Photons */
  int			Found;		/**< @@brief Number of Photons Found */
  vect_t		Normal;		/**< @@brief Normal */
  fastf_t		RadSq;		/**< @@brief Search Radius Sq */
  point_t		Pos;		/**< @@brief Search Position */
  struct	PSN	*List;		/**< @@brief Located Photon List */
};


struct NearestPhotons {
  int			Max;		/**< @@brief Max Number of Photons */
  int			Found;		/**< @@brief Number of Photons Found */
  vect_t		Normal;		/**< @@brief Normal */
  fastf_t		RadSq;		/**< @@brief Search Radius Sq */
  point_t		Pos;		/**< @@brief Search Position */
  struct	Photon	*List;		/**< @@brief Located Photon List */
};


struct PNode {
  struct	Photon	P;
  struct	PNode	*L;
  struct	PNode	*R;
  int			C;		/**< @@brief For Threading Purposes to see if it's been computed yet */
};


struct PhotonMap {
  int			StoredPhotons;
  int			MaxPhotons;
  struct	PNode	*Root;
};


struct IrradNode {
  point_t		Pos;
  vect_t		RGB;
};


struct IrradCache {
  int				Num;
  struct	IrradNode	*List;
};


OPTICAL_EXPORT extern int PM_Activated;	/**< @@brief Photon Mapping Activated, 0=off, 1=on */
OPTICAL_EXPORT extern int PM_Visualize;	/**< @@brief Photon Mapping Visualization of Irradiance Cache */

OPTICAL_EXPORT BU_EXTERN(void BuildPhotonMap,
			 (struct application *ap,
			  point_t eye_pos,
			  int cpus,
			  int width,
			  int height,
			  int Hypersample,
			  int GlobalPhotons,
			  double CausticsPercent,
			  int Rays,
			  double AngularTolerance,
			  int RandomSeed,
			  int ImportanceMapping,
			  int IrradianceHypersampling,
			  int VisualizeIrradiance,
			  double LightIntensity,
			  char pmfile[255]));
OPTICAL_EXPORT BU_EXTERN(void IrradianceEstimate,
			 (struct application *ap,
			  vect_t irrad,
			  point_t pos,
			  vect_t normal,
			  fastf_t rad,
			  int np));
/** @@} */
/*
 * Local Variables:
 * mode: C
 * tab-width: 8
 * c-basic-offset: 4
 * indent-tabs-mode: t
 * End:
 * ex: shiftwidth=4 tabstop=8
 */
@


14.14
log
@remove ephemeral data like phone numbers and addresses, including the misleading 'source' statements on code that is continually evolving and receiving contributions from many many sources
@
text
@a32 5
#ifdef HAVE_STRING_H     /* OPTIONAL, for strcmp() etc. */
#  include <string.h>
#else
#  include <strings.h>
#endif
d35 1
@


14.13
log
@get rid of RCS variables from the public header files.  this is done in part to reduce recompilation during interface changes, but also to move towards not relying on or publishing the information contained in the variables interface-wise. (they're fine for c sources and private headers)
@
text
@a28 4
 * @@par Source
 *	Bldg 238
 * @@n	The U. S. Army Research Laboratory
 * @@n	Aberdeen Proving Ground, Maryland  21005-5066
@


14.12
log
@ws, test three
@
text
@a32 2
 *
 * @@(#)$Header:
@


14.11
log
@Sweeping license updates.  Documentation is fully relicensed to the BSD Documentation License (a minor variant of the FreeBSD Documentation License and BSD License).  All GPL code (mostly application code) is converted to the LGPL and now also specifically declares version 2.1, revoking the blank check to the FSF.  The intent of these sweeping changes are to simplify the licensing terms and increase overall flexibility of use, both externally (to users for their purposes) and internally (to allow application code to be migrated to libraries without creating GPL libraries).  As a collective work, BRL-CAD is now LGPL.
@
text
@a174 1

@


14.10
log
@ugh, what tedium.  put some effort towards cleaning up the doxygen labels and making the headers more consistent.  also exclusively using @@ for doxygen instead of \ to try to keep things more consistent.
@
text
@d9 1
a9 2
 * as published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
d14 1
a14 1
 * Library General Public License for more details.
@


14.9
log
@update copyright to 2007
@
text
@d22 1
a22 1
/*@@{*/
d25 1
a25 1
 *@@brief
d30 1
a30 1
 *  @@par Source
d32 2
a33 2
 *@@n	The U. S. Army Research Laboratory
 *@@n	Aberdeen Proving Ground, Maryland  21005-5066
d35 1
a35 1
 *  @@(#)$Header:
d166 1
a166 1
/*@@}*/
@


14.8
log
@Doxygen updates
@
text
@d4 1
a4 1
 * Copyright (c) 2002-2006 United States Government as represented by
@


14.7
log
@update copyright to 2006
@
text
@d21 2
d25 2
d28 1
a28 1
 *  Declarations related to Photon Mapping
d30 1
a30 1
 *  Source -
d32 2
a33 2
 *	The U. S. Army Research Laboratory
 *	Aberdeen Proving Ground, Maryland  21005-5066
d70 1
a70 1
/*
d74 6
a79 6
  int			Axis;		/* Splitting Plane */
  point_t		Pos;		/* Photon Position */
  vect_t		Dir;		/* Photon Direction */
  vect_t		Normal;		/* Normal at Intersection */
  vect_t		Power;		/* Photon Power */
  vect_t		Irrad;		/* Irradiance */
d89 1
a89 1
/*
d93 6
a98 6
  int			Max;		/* Max Number of Photons */
  int			Found;		/* Number of Photons Found */
  vect_t		Normal;		/* Normal */
  fastf_t		RadSq;		/* Search Radius Sq */
  point_t		Pos;		/* Search Position */
  struct	PSN	*List;		/* Located Photon List */
d103 6
a108 6
  int			Max;		/* Max Number of Photons */
  int			Found;		/* Number of Photons Found */
  vect_t		Normal;		/* Normal */
  fastf_t		RadSq;		/* Search Radius Sq */
  point_t		Pos;		/* Search Position */
  struct	Photon	*List;		/* Located Photon List */
d116 1
a116 1
  int			C;		/* For Threading Purposes to see if it's been computed yet */
d139 2
a140 2
OPTICAL_EXPORT extern int PM_Activated;	/* Photon Mapping Activated, 0=off, 1=on */
OPTICAL_EXPORT extern int PM_Visualize;	/* Photon Mapping Visualization of Irradiance Cache */
d166 1
a166 1

d176 1
@


14.6
log
@trailing ws
@
text
@d4 1
a4 1
 * Copyright (C) 2002-2005 United States Government as represented by
@


14.5
log
@Add code to allow liboptical to be a Windows DLL
@
text
@d30 1
a30 1
 *  
@


14.5.6.1
log
@merge changes from HEAD aka rel-7-6-4 to the rel-7-6-branch just in case someone peeks a gander or tries to continue/build the branch
@
text
@d30 1
a30 1
 *
@


14.4
log
@update copyright to 2005
@
text
@d51 3
a53 1
#include "shadework.h"
d135 2
a136 2
extern	int	PM_Activated;	/* Photon Mapping Activated, 0=off, 1=on */
extern	int	PM_Visualize;	/* Photon Mapping Visualization of Irradiance Cache */
d138 24
a161 2
BU_EXTERN(void BuildPhotonMap, (struct application *ap, point_t eye_pos, int cpus, int width, int height, int Hypersample, int GlobalPhotons, double CausticsPercent, int Rays, double AngularTolerance, int RandomSeed, int ImportanceMapping, int IrradianceHypersampling, int VisualizeIrradiance, double LightIntensity, char pmfile[255]));
BU_EXTERN(void IrradianceEstimate, (struct application *ap, vect_t irrad, point_t pos, vect_t normal, fastf_t rad, int np));
@


14.3
log
@use perl to M-q format wrapping
@
text
@d4 1
a4 1
 * Copyright (c) 2002-2004 United States Government as represented by
@


14.2
log
@LGPL license changes
@
text
@d17 2
a18 2
 * You should have received a copy of the GNU Lesser General Public License
 * along with this file; see the file named COPYING for more
@


14.1
log
@dawn of a new revision.  it shall be numbered 14 to match release 7.  begin the convergence by adding emacs/vi local variable footer blocks to encourage consistent formatting.
@
text
@d1 21
a21 1
/*
a30 4
 *  Copyright Notice -
 *	This software is Copyright (C) 2002-2004 by the United States Army.
 *	All rights reserved.
 *
@


1.4
log
@USE_STRING_H is no more.. it's HAVE_STRING_H
@
text
@d122 10
@


1.3
log
@include common.h instead of the wrapped config.h
@
text
@d20 1
a20 1
#ifdef USE_STRING_H     /* OPTIONAL, for strcmp() etc. */
@


1.2
log
@more externs.h escapees
@
text
@d18 1
a18 3
#ifdef HAVE_CONFIG_H
# include "config.h"
#endif
@


1.1
log
@moved/renamed from top-level h/ to top-level include/
@
text
@a30 1
#include "externs.h"
@

