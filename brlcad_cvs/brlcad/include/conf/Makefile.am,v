head	1.10;
access;
symbols
	rel-7-10-4:1.8
	STABLE:1.8.0.2
	rel-7-10-2:1.8;
locks; strict;
comment	@# @;


1.10
date	2007.11.01.15.01.20;	author brlcad;	state Exp;
branches;
next	1.9;

1.9
date	2007.10.03.19.35.56;	author brlcad;	state Exp;
branches;
next	1.8;

1.8
date	2007.06.02.06.22.47;	author brlcad;	state Exp;
branches
	1.8.2.1;
next	1.7;

1.7
date	2007.06.01.19.40.09;	author brlcad;	state Exp;
branches;
next	1.6;

1.6
date	2007.05.31.22.29.56;	author brlcad;	state Exp;
branches;
next	1.5;

1.5
date	2007.05.31.22.03.12;	author brlcad;	state Exp;
branches;
next	1.4;

1.4
date	2007.05.31.14.17.05;	author brlcad;	state Exp;
branches;
next	1.3;

1.3
date	2007.04.17.12.38.06;	author d_rossberg;	state Exp;
branches;
next	1.2;

1.2
date	2007.04.17.12.19.35;	author brlcad;	state Exp;
branches;
next	1.1;

1.1
date	2007.04.16.21.15.35;	author brlcad;	state Exp;
branches;
next	;

1.8.2.1
date	2007.11.01.15.01.41;	author brlcad;	state Exp;
branches;
next	;


desc
@@


1.10
log
@need all-am to be dependent upon built_sources else someone doing a make install without first running make will end up failing to generate the COUNT, DATE, HOST, USER, PATH files
@
text
@# $Id: Makefile.am,v 1.9 2007/10/03 19:35:56 brlcad Exp $

COUNT: DATE HOST PATH USER
	test -f $@@ && expr `cat COUNT` + 1 > $@@ || echo "1" > $@@

DATE: HOST PATH USER
	echo "\"`date`\"" > $@@

HOST:
	echo "\"`hostname`\"" > $@@

PATH:
	echo "\"$(DESTDIR)$(prefix)\"" > $@@

USER:
	echo "\"`whoami`\"" > $@@

# this causes them to be dependencies on the 'all' target
BUILT_SOURCES = \
	COUNT \
	DATE \
	HOST \
	PATH \
	USER

EXTRA_DIST = \
	$(BUILT_SOURCES) \
	MAJOR \
	MINOR \
	PATCH \
	make.vbs

# remove all except COUNT
CLEANFILES = \
	DATE \
	HOST \
	PATH \
	USER
DISTCLEANFILES = $(CLEANFILES)
MAINTAINERCLEANFILES = COUNT

all-am: $(BUILT_SOURCES)

include $(top_srcdir)/misc/Makefile.defs
@


1.9
log
@remove the MAINTAINERCLEAN rules, they're never really used regardless of the debate over whether the Makefile.in files belong there or not
@
text
@d1 1
a1 1
# $Id: Makefile.am,v 1.8 2007/06/02 06:22:47 brlcad Exp $
d42 2
@


1.8
log
@some versions of expr really don't like the quotes, so check for it
@
text
@d1 1
a1 1
# $Id: Makefile.am,v 1.7 2007/06/01 19:40:09 brlcad Exp $
d40 1
a40 3
MAINTAINERCLEANFILES = \
	COUNT \
	Makefile.in
@


1.8.2.1
log
@merge from head, need built_sources for all-am
@
text
@d1 1
a1 1
# $Id: Makefile.am,v 1.8 2007/06/02 06:22:47 brlcad Exp $
a43 2
all-am: $(BUILT_SOURCES)

@


1.7
log
@return to simplicity, doesn't matter what is in the srcdir
@
text
@d1 1
a1 1
# $Id: Makefile.am,v 1.6 2007/05/31 22:29:56 brlcad Exp $
d4 1
a4 1
	expr "`cat COUNT`" + 1 > $@@
@


1.6
log
@quote the expr so it doesn't error out
@
text
@d1 1
a1 1
# $Id: Makefile.am,v 1.5 2007/05/31 22:03:12 brlcad Exp $
a3 6
	if test -f $(top_srcdir)/include/conf/COUNT ; then \
		touch $@@ ; chmod ug+w $@@ ;\
		cat $(top_srcdir)/include/conf/COUNT > $@@ ;\
	else \
		test -f $@@ || echo "1" > $@@ ;\
	fi
d7 1
a7 6
	if test -f $(top_srcdir)/include/conf/DATE ; then \
		touch $@@ ; chmod ug+w $@@ ;\
		cat $(top_srcdir)/include/conf/DATE > $@@ ;\
	else \
		test -f $@@ || echo "\"`date`\"" > $@@ ;\
	fi
d10 1
a10 6
	if test -f $(top_srcdir)/include/conf/HOST ; then \
		touch $@@ ; chmod ug+w $@@ ;\
		cat $(top_srcdir)/include/conf/HOST > $@@ ;\
	else \
		test -f $@@ || echo "\"`hostname`\"" > $@@ ;\
	fi
d13 1
a13 6
	if test -f $(top_srcdir)/include/conf/PATH ; then \
		touch $@@ ; chmod ug+w $@@ ;\
		cat $(top_srcdir)/include/conf/PATH > $@@ ;\
	else \
		test -f $@@ || echo "\"$(DESTDIR)$(prefix)\"" > $@@ ;\
	fi
d16 1
a16 6
	if test -f $(top_srcdir)/include/conf/USER ; then \
		touch $@@ ; chmod ug+w $@@ ;\
		cat $(top_srcdir)/include/conf/USER > $@@ ;\
	else \
		test -f $@@ || echo "\"`whoami`\"" > $@@ ;\
	fi
@


1.5
log
@attempt yet again, don't use cp since it will complain about identical files -- use the kitten.
@
text
@d1 1
a1 1
# $Id: Makefile.am,v 1.4 2007/05/31 14:17:05 brlcad Exp $
d10 1
a10 1
	expr `cat COUNT` + 1 > $@@
@


1.4
log
@rework the configuration files so that they will work even if they pull read-only files from top_srcdir (e.g. during a distcheck on some platforms).  shouldn't need the all-local with BUILT_SOURCES being defined.
@
text
@d1 1
a1 1
# $Id: Makefile.am,v 1.3 2007/04/17 12:38:06 d_rossberg Exp $
d5 2
a6 2
		cp $(top_srcdir)/include/conf/COUNT $@@ ;\
		chmod ug+w $@@ ;\
d14 2
a15 2
		cp $(top_srcdir)/include/conf/DATE $@@ ;\
		chmod ug+w $@@ ;\
d22 2
a23 2
		cp $(top_srcdir)/include/conf/HOST $@@ ;\
		chmod ug+w $@@ ;\
d30 2
a31 2
		cp $(top_srcdir)/include/conf/PATH $@@ ;\
		chmod ug+w $@@ ;\
d38 2
a39 2
		cp $(top_srcdir)/include/conf/USER $@@ ;\
		chmod ug+w $@@ ;\
@


1.3
log
@update version information on MS Windows
@
text
@d1 1
a1 1
# $Id: Makefile.am,v 1.2 2007/04/17 12:19:35 brlcad Exp $
d4 7
a10 3
	@@test -f $(top_srcdir)/include/conf/COUNT || echo "1" > $@@
	@@test -f $@@ || cp $(top_srcdir)/include/conf/COUNT .
	@@expr `cat COUNT` + 1 > $@@
d13 6
a18 3
	@@test -f $(top_srcdir)/include/conf/DATE || echo "\"`date`\"" > $@@
	@@test -f $@@ || cp $(top_srcdir)/include/conf/DATE .
	@@echo "\"`date`\"" > $@@
d21 6
a26 3
	@@test -f $(top_srcdir)/include/conf/HOST || echo "\"`hostname`\"" > $@@
	@@test -f $@@ || cp $(top_srcdir)/include/conf/HOST .
	@@echo "\"`hostname`\"" > $@@
d29 6
a34 3
	@@test -f $(top_srcdir)/include/conf/PATH || echo "\"$(DESTDIR)$(prefix)\"" > $@@
	@@test -f $@@ || cp $(top_srcdir)/include/conf/PATH .
	@@echo "\"$(DESTDIR)$(prefix)\"" > $@@
d37 6
a42 7
	@@test -f $(top_srcdir)/include/conf/USER || echo "\"`whoami`\"" > $@@
	@@test -f $@@ || cp $(top_srcdir)/include/conf/USER .
	@@echo "\"`whoami`\"" > $@@


all-local: COUNT DATE HOST PATH USER

d44 1
@


1.2
log
@on second thought, try to prevent a rebuild/relink every pass through .. only update the count after a clean.  every pass of make would be ideal, but only we can figure out a way to avoid the dependency check relinkage
@
text
@d1 1
a1 1
# $Id: Makefile.am,v 1.1 2007/04/16 21:15:35 brlcad Exp $
d43 2
a44 1
	PATCH
@


1.1
log
@revamp BRL-CAD's versioning setup.  no longer rely upon the vers.sh script, allowing for a more unified cross-platform configuration.  instead of globals, provide per-library functions that return the version string.  the version numbers are now stored in files in include/conf/.
@
text
@d1 1
a1 1
# $Id: $
d3 1
a3 1
COUNT:
d8 1
a8 1
DATE:
d28 1
a28 1
# make sure that the build is updated every time make is run
d30 1
a30 10
	@@test -f COUNT || cp $(top_srcdir)/include/conf/COUNT .
	@@expr `cat COUNT` + 1 > COUNT
	@@test -f DATE || cp $(top_srcdir)/include/conf/DATE .
	@@echo "\"`date`\"" > DATE
	@@test -f HOST || cp $(top_srcdir)/include/conf/HOST .
	@@echo "\"`hostname`\"" > HOST
	@@test -f PATH || cp $(top_srcdir)/include/conf/PATH .
	@@echo "\"$(DESTDIR)$(prefix)\"" > PATH
	@@test -f USER || cp $(top_srcdir)/include/conf/USER .
	@@echo "\"`whoami`\"" > USER
d45 10
a54 4
DISTCLEANFILES = \
	$(BUILT_SOURCES)

MAINTAINERCLEANFILES = Makefile.in
@

