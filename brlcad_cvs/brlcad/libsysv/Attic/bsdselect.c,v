head	11.2;
access;
symbols
	ansi-20040405-merged:11.1
	postmerge-20040405-ansi:11.1
	premerge-20040404-ansi:11.1
	postmerge-autoconf:11.1
	autoconf-freeze:11.1
	premerge-autoconf:11.1
	ansi-20040316-freeze:11.1
	postmerge-20040315-windows:11.1
	premerge-20040315-windows:11.1
	windows-20040315-freeze:11.1
	autoconf-20031203:11.1
	autoconf-20031202:11.1
	autoconf-branch:11.1.0.14
	phong-branch:11.1.0.12
	photonmap-branch:11.1.0.10
	rel-6-1-DP:11.1
	windows-branch:11.1.0.8
	rel-6-0-2:11.1
	ansi-branch:11.1.0.6
	rel-6-0-1-branch:11.1.0.4
	hartley-6-0-post:11.1
	hartley-6-0-pre:11.1
	rel-6-0-1:11.1
	rel-6-0:11.1
	rel-5-4:11.1
	offsite-5-3-pre:11.1
	rel-5-3:11.1
	rel-5-2:11.1
	rel-5-1-branch:11.1.0.2
	rel-5-1:11.1
	rel-5-0:11.1
	rel-5-0-beta:11.1
	rel-4-5:11.1
	ctj-4-5-post:11.1
	ctj-4-5-pre:11.1
	rel-4-4:11.1
	rel-4-0:10.1
	rel-3-5:9.1;
locks; strict;
comment	@ * @;


11.2
date	2004.05.21.18.07.36;	author morrison;	state dead;
branches;
next	11.1;

11.1
date	95.01.04.09.58.06;	author mike;	state Rel4_4;
branches;
next	10.4;

10.4
date	93.10.25.17.58.50;	author mike;	state Exp;
branches;
next	10.3;

10.3
date	93.10.25.17.56.44;	author mike;	state Exp;
branches;
next	10.2;

10.2
date	93.05.13.17.17.11;	author cjohnson;	state Exp;
branches;
next	10.1;

10.1
date	91.10.12.06.36.19;	author mike;	state Rel4_0;
branches;
next	9.4;

9.4
date	91.08.19.15.12.36;	author stay;	state Exp;
branches;
next	9.3;

9.3
date	90.11.30.01.06.22;	author phil;	state Exp;
branches;
next	9.2;

9.2
date	89.10.22.19.19.25;	author mike;	state Exp;
branches;
next	9.1;

9.1
date	89.05.19.05.45.26;	author mike;	state Rel3_5;
branches;
next	1.3;

1.3
date	89.01.25.04.17.42;	author phil;	state Exp;
branches;
next	1.2;

1.2
date	89.01.24.22.30.38;	author phil;	state Exp;
branches;
next	1.1;

1.1
date	89.01.12.00.46.01;	author phil;	state Exp;
branches;
next	;


desc
@A "portable" select interface for SYSV or BSD
@


11.2
log
@moved to src/
@
text
@/*
 *			B S D S E L E C T
 *
 *  Ordinarily, a stub for select() could have been implemented here,
 *  but the IRIS defines a graphics library routine select().
 *  On non-BSD systems, select() is a name likely to have been reused,
 *  so this special interface has been created.  This also has the slight
 *  advantage of centralizing the struct timeval stuff.
 */
#if __STDC__
# include <unistd.h>
#endif

#if defined(i386) && !defined(BSD)
#	define BSD
#endif
#if defined(BSD)
#	include <sys/types.h>	/* for fd_set macros */
#endif
#if defined(BSD) || defined(CRAY) || defined(aux)
#	include <sys/time.h>	/* for struct timeval.  Includes <time.h> */
#else
#	include <time.h>
#endif
#if defined(sgi)
#	if !defined(mips) || defined(SGI4D_Rel2)
		/* 3D systems, and Rel2 4D systems. */
#		include <bsd/sys/types.h>
#		include <bsd/sys/time.h>
#	else
		/* Rel3 4D systems got it right */
#		include <sys/types.h>
#		include <sys/time.h>
#	endif
#endif
#ifdef stellar
#	include <sys/timeval.h>
#endif

#if defined(__sgi)
#	define _BSD_TYPES		/* Needed for IRIX 5.0.1 */
#		include <sys/types.h>
#		include <sys/time.h>
#endif

#ifdef FD_SET
/* The 4.3 BSD version */
bsdselect( readfds, sec, us )
long readfds;
{
	fd_set	fdset;
	int	width;
	struct	timeval tv;
	int	ret;

	tv.tv_sec = sec;
	tv.tv_usec = us;

	if( (width = getdtablesize()) <= 0 )
		width = 32;
	FD_ZERO( &fdset );
	fdset.fds_bits[0] = readfds;	/* peek inside! */

	if( (ret = select( width, &fdset, (fd_set *)0, (fd_set *)0, &tv )) <= 0 )  {
		if( ret < 0 )  perror("bsdselect/select");
		return(0);		/* no bits ready */
	}

	readfds = fdset.fds_bits[0];
	return( readfds );
}
#else

/* The old version */
bsdselect( readfds, sec, us )
long readfds;
{
#if defined(BSD) || defined(sgi) || defined(stellar) || defined(CRAY) || defined(__sgi) || defined(aux)
	struct timeval tv;
	int	ret;
	long	mask;

	tv.tv_sec = sec;
	tv.tv_usec = us;
	mask = readfds;
	if( (ret = select( 32, &mask, 0L, 0L, &tv )) <= 0 )  {
		if( ret < 0 )  perror("bsdselect/select");
		return(0);	/* No bits ready */
	}
	return( mask );
#else
	return(32-1);	/* SYSV always has lots of input */
#endif
}
#endif /* FD_SET */
@


11.1
log
@Release_4.4
@
text
@@


10.4
log
@IRIX 5.0.1
@
text
@@


10.3
log
@unistd.h
@
text
@d41 1
@


10.2
log
@Added butlers fix from last may and added checks for aux.
@
text
@d10 3
@


10.1
log
@Release_4.0
@
text
@d11 1
a11 1
#if defined(i386)
d17 1
a17 1
#if defined(BSD) || defined(CRAY)
d74 1
a74 1
#if defined(BSD) || defined(sgi) || defined(stellar) || defined(CRAY) || defined(__sgi)
@


9.4
log
@Needed a few defines of (__sgi) for ansi posix 
compiles so that the system select is used.
@
text
@@


9.3
log
@add i386 "support"
@
text
@d37 5
d74 1
a74 1
#if defined(BSD) || defined(sgi) || defined(stellar) || defined(CRAY)
@


9.2
log
@Added a slight amount of error checking
@
text
@d11 3
@


9.1
log
@Release_3.5
@
text
@d42 1
d47 2
a48 1
	width = getdtablesize();
d52 4
a55 2
	if( select( width, &fdset, (fd_set *)0, (fd_set *)0, &tv ) <= 0 )
		return(0);
d68 2
d73 6
a78 3
	if( select( 32, &readfds, 0L, 0L, &tv ) <= 0 )
		return(0);
	return( readfds );
@


1.3
log
@A hopefully portable 4.3 BSD version
(for efficiency sake we peek inside the fd_set struct)
@
text
@@


1.2
log
@The required includes to go with it.
@
text
@d11 3
d34 2
d39 23
d74 1
@


1.1
log
@Initial revision
@
text
@d11 20
@
