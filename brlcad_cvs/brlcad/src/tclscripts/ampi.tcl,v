head	14.17;
access;
symbols
	rel-7-10-4:14.16
	STABLE:14.16.0.2
	stable-branch:14.4
	rel-7-10-2:14.16
	rel-7-10-0:14.16
	rel-7-8-4:14.6
	rel-7-8-2:14.6
	rel-7-8-0:14.6
	trimnurbs-branch:14.6.0.2
	help:14.6
	temp_tag:14.4
	bobWinPort-20051223-freeze:14.4
	postmerge-20051223-bobWinPort:14.4
	premerge-20051223-bobWinPort:14.4
	rel-7-6-6:14.4
	rel-7-6-4:14.4
	rel-7-6-2:14.4
	rel-7-6-branch:14.4.0.6
	rel-7-6-0:14.4
	rel-7-4-2:14.4
	rel-7-4-branch:14.4.0.4
	bobWinPort:14.4.0.2
	rel-7-4-0:14.4
	rel-7-2-6:14.4
	rel-7-2-4:14.4
	rel-7-2-2:14.4
	rel-7-2-0:14.4
	rel-7-0-4:14.3
	rel-7-0-2:14.3
	rel-7-0-1:14.3
	opensource-post:14.3
	opensource-pre:1.4
	rel-7-0-branch:1.4.0.2
	rel-7-0:1.4;
locks; strict;
comment	@# @;


14.17
date	2007.09.14.15.22.05;	author erikgreenwald;	state Exp;
branches;
next	14.16;

14.16
date	2007.04.02.02.24.23;	author brlcad;	state Exp;
branches;
next	14.15;

14.15
date	2007.03.02.02.25.47;	author brlcad;	state Exp;
branches;
next	14.14;

14.14
date	2007.03.02.01.43.24;	author brlcad;	state Exp;
branches;
next	14.13;

14.13
date	2007.03.02.01.32.19;	author brlcad;	state Exp;
branches;
next	14.12;

14.12
date	2007.03.02.01.30.43;	author brlcad;	state Exp;
branches;
next	14.11;

14.11
date	2007.02.20.03.10.30;	author brlcad;	state Exp;
branches;
next	14.10;

14.10
date	2007.01.23.01.13.48;	author brlcad;	state Exp;
branches;
next	14.9;

14.9
date	2007.01.20.14.37.01;	author brlcad;	state Exp;
branches;
next	14.8;

14.8
date	2007.01.19.20.51.20;	author brlcad;	state Exp;
branches;
next	14.7;

14.7
date	2007.01.19.20.45.08;	author brlcad;	state Exp;
branches;
next	14.6;

14.6
date	2006.01.24.17.19.12;	author brlcad;	state Exp;
branches;
next	14.5;

14.5
date	2006.01.18.06.46.24;	author brlcad;	state Exp;
branches;
next	14.4;

14.4
date	2005.01.30.20.31.12;	author brlcad;	state Exp;
branches;
next	14.3;

14.3
date	2004.12.21.05.45.27;	author morrison;	state Exp;
branches;
next	14.2;

14.2
date	2004.12.21.04.55.21;	author morrison;	state Exp;
branches;
next	14.1;

14.1
date	2004.11.16.19.42.31;	author morrison;	state Exp;
branches;
next	1.4;

1.4
date	2004.10.22.18.42.27;	author butler;	state Exp;
branches;
next	1.3;

1.3
date	2004.10.14.12.05.22;	author morrison;	state Exp;
branches;
next	1.2;

1.2
date	2004.10.13.16.21.01;	author morrison;	state Exp;
branches;
next	1.1;

1.1
date	2004.05.20.15.20.56;	author morrison;	state Exp;
branches;
next	;


desc
@@


14.17
log
@removed trailing whitespace
@
text
@#!/bin/sh
#                        A M P I . T C L
# BRL-CAD
#
# Copyright (c) 2004-2007 United States Government as represented by
# the U.S. Army Research Laboratory.
#
# This library is free software; you can redistribute it and/or
# modify it under the terms of the GNU Lesser General Public License
# version 2.1 as published by the Free Software Foundation.
#
# This library is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# Lesser General Public License for more details.
#
# You should have received a copy of the GNU Lesser General Public
# License along with this file; see the file named COPYING for more
# information.
#
###
# This is a comment \
/bin/echo "This is not a shell script"
# This is a comment \
exit

# make the pkgIndex.tcl
if {![info exists argv]} {
    puts "No directory argument provided."
    return 0
}

foreach arg $argv {
    # generate a pkgIndex.tcl file in the arg dir
    puts "Generating pkgIndex.tcl in $arg"
    catch {pkg_mkIndex -verbose $arg *.tcl *.itcl *.itk *.sh}

    if {![file exists "$arg/pkgIndex.tcl"]} {
	puts "ERROR: pkgIndex.tcl does not exist in $arg"
	continue
    }

    set pkgIndex ""
    set header ""

    # sort the pkgIndex.tcl
    set fd [open "$arg/pkgIndex.tcl"]
    while {[gets $fd data] >= 0} {
	if {[string compare -length 7 $data "package"] == 0} {
	    lappend pkgIndex $data
	} else {
	    lappend header $data
	}
    }
    close $fd

    # write out the sorted pkgIndex.tcl
    set fd [open "$arg/pkgIndex.tcl" {WRONLY TRUNC CREAT}]
    foreach line $header {
	puts $fd $line
    }
    foreach line [lsort $pkgIndex] {
	puts $fd $line
    }
    close $fd
}

# Local Variables:
# mode: Tcl
# tab-width: 8
# c-basic-offset: 4
# tcl-indent-level: 4
# indent-tabs-mode: t
# End:
# ex: shiftwidth=4 tabstop=8
@


14.16
log
@the script wasn't correctly parsing multiple directory paths and also similarly did not function with a distcheck or other compilation out of place.  It still has a problem if it cannot write to the source dir since the index is created where the sources files are.
@
text
@d37 1
a37 1
    
d56 1
a56 1
    
@


14.15
log
@aha! enlightenment hath arrived.  creating the index files actually sources the file args provided so when it ends up running the other amp?i.tcl script, it was choking on the error.  just return 0 to indicate success.
@
text
@d28 2
a29 6
if {[info exists argv]} {
    foreach arg $argv {
	catch {pkg_mkIndex -verbose $arg *.tcl *.itcl *.itk *.sh}
	puts $arg
    }
} else {
d33 9
a41 3
if {![file exists pkgIndex.tcl]} {
    puts "ERROR: pkgIndex.tcl does not exist in [pwd]"
}
d43 2
a44 2
lappend pkgIndex
lappend header
d46 15
a60 7
# sort the pkgIndex.tcl
set fd [open pkgIndex.tcl]
while {[gets $fd data] >= 0} {
    if {[string compare -length 7 $data "package"] == 0} {
	lappend pkgIndex $data
    } else {
	lappend header $data
d62 4
a66 11
close $fd

# write out the sorted pkgIndex.tcl
set fd [open pkgIndex.tcl {WRONLY TRUNC CREAT}]
foreach line $header {
    puts $fd $line
}
foreach line [lsort $pkgIndex] {
    puts $fd $line
}
close $fd
@


14.14
log
@heh, there's quality control for ya.. check for existance of variable name so we actually do some work..
@
text
@d27 1
d33 2
a38 1
    exit 1
@


14.13
log
@oop, remove debug print
@
text
@d27 1
a27 1
if {[info exists $argv]} {
@


14.12
log
@abort with a clean message if a pkgIndex.tcl file does not exist since open's failure message is less than ideal
@
text
@a27 1
    puts $argv
@


14.11
log
@make sure argv is set to avoid btclsh sourcing errors
@
text
@d28 1
d35 5
@


14.10
log
@Sweeping license updates.  Documentation is fully relicensed to the BSD Documentation License (a minor variant of the FreeBSD Documentation License and BSD License).  All GPL code (mostly application code) is converted to the LGPL and now also specifically declares version 2.1, revoking the blank check to the FSF.  The intent of these sweeping changes are to simplify the licensing terms and increase overall flexibility of use, both externally (to users for their purposes) and internally (to allow application code to be migrated to libraries without creating GPL libraries).  As a collective work, BRL-CAD is now LGPL.
@
text
@d27 5
a31 3
foreach arg $argv {
    catch {pkg_mkIndex -verbose $arg *.tcl *.itcl *.itk *.sh}
    puts $arg
@


14.9
log
@update copyright to 2007
@
text
@d10 1
a10 2
# as published by the Free Software Foundation; either version 2 of
# the License, or (at your option) any later version.
d15 1
a15 1
# Library General Public License for more details.
@


14.8
log
@initialize the lists, so it doesn't error if there was no header or contents
@
text
@d5 1
a5 1
# Copyright (c) 2004-2006 United States Government as represented by
@


14.7
log
@for ease of (cvs diff) comparisons and review -- and since they are presently stored in CVS for Windows build convenience -- sort the contents of the tclIndex and pkgIndex.tcl files (taking the comment header into account)
@
text
@d33 3
@


14.6
log
@add the verbose flag so that warnings/errors are apparent
@
text
@d33 21
@


14.5
log
@update copyright to 2006
@
text
@d29 1
a29 1
    catch {pkg_mkIndex $arg *.tcl *.itcl *.itk *.sh}
@


14.4
log
@update copyright to 2005
@
text
@d5 1
a5 1
# Copyright (C) 2004-2005 United States Government as represented by
@


14.3
log
@s/GNU Library General/GNU Lesser General/g
@
text
@d5 2
a6 2
# Copyright (c) 2004 United States Government as represented by the
# U.S. Army Research Laboratory.
@


14.2
log
@assign copyright and LGPL
@
text
@d9 1
a9 1
# modify it under the terms of the GNU Library General Public License
d18 1
a18 1
# You should have received a copy of the GNU Library General Public
@


14.1
log
@dawn of a new revision.  it shall be numbered 14 to match release 7.  begin the convergence by adding emacs/vi local variable footer blocks to encourage consistent formatting.
@
text
@d2 21
@


1.4
log
@changes to eliminate BRLCAD_ROOT
@
text
@d11 9
@


1.3
log
@include shell scripts in the generation of the indexes since it may really be a tcl script too
@
text
@d2 4
a5 45
# this is a comment \
if test "$BRLCAD_ROOT" = ""
# this is a comment \
then
# this is a comment \
	BRLCAD_ROOT=/usr/brlcad
# this is a comment \
	export BRLCAD_ROOT
# this is a comment \
fi

# this is a comment \
if test -x ${BRLCAD_ROOT}/bin/btclsh
# this is a comment \
then
# this is a comment \
	BTCLSH=${BRLCAD_ROOT}/bin/btclsh
# this is a comment \
elif test -x /usr/bin/btclsh
# this is a comment \
then
# this is a comment \
	BTCLSH=/usr/bin/btclsh
# this is a comment \
elif test -x /usr/local/bin/btclsh
# this is a comment \
then
# this is a comment \
	BTCLSH=/usr/local/bin/btclsh
# this is a comment \
else
# this is a comment \
	echo "ERROR: could not find btclsh"
# this is a comment \
	exit 1
# this is a comment \
fi
# this is a comment \
DOLLAR_ZERO="$0" ; DOLLAR_AT="$@@" ; EXEC_COMMAND="$BTCLSH $DOLLAR_ZERO $DOLLAR_AT"
# this is a comment \
echo "Running \`exec $EXEC_COMMAND\`"
# the next line restarts using btclsh \
exec $EXEC_COMMAND

# exec $BTCLSH "$0" "$@@"
@


1.2
log
@blather if btclsh cannot be found
@
text
@d49 1
a49 1
    catch {pkg_mkIndex $arg *.tcl *.itcl *.itk}
@


1.1
log
@Vast reorganization begins.  Sources moved from top-level directories into src/.
@
text
@d34 2
@

