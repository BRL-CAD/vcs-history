head	11.9;
access;
symbols
	ansi-20040405-merged:11.7.4.1
	postmerge-20040405-ansi:11.8
	premerge-20040404-ansi:11.8
	postmerge-autoconf:11.8
	autoconf-freeze:11.7.12.1
	premerge-autoconf:11.8
	ansi-20040316-freeze:11.7
	postmerge-20040315-windows:11.8
	premerge-20040315-windows:11.8
	windows-20040315-freeze:11.7.6.1
	autoconf-20031203:11.7
	autoconf-20031202:11.7
	autoconf-branch:11.7.0.12
	phong-branch:11.7.0.10
	photonmap-branch:11.7.0.8
	rel-6-1-DP:11.7
	windows-branch:11.7.0.6
	rel-6-0-2:11.7
	ansi-branch:11.7.0.4
	rel-6-0-1-branch:11.7.0.2
	hartley-6-0-post:11.7
	hartley-6-0-pre:11.7
	rel-6-0-1:11.7
	rel-6-0:11.7
	rel-5-4:11.6
	offsite-5-3-pre:11.7
	rel-5-3:11.6
	rel-5-2:11.6
	rel-5-1-branch:11.6.0.2
	rel-5-1:11.6
	rel-5-0:11.5
	rel-5-0-beta:11.5
	rel-4-5:11.5
	ctj-4-5-post:11.5
	ctj-4-5-pre:11.5
	rel-4-4:11.3
	rel-4-0:10.1;
locks; strict;
comment	@ * @;


11.9
date	2004.05.24.04.01.09;	author morrison;	state dead;
branches;
next	11.8;

11.8
date	2004.02.02.17.39.05;	author morrison;	state Exp;
branches;
next	11.7;

11.7
date	2000.12.08.15.58.15;	author jra;	state Exp;
branches
	11.7.4.1
	11.7.6.1
	11.7.12.1;
next	11.6;

11.6
date	2000.03.29.18.42.49;	author mike;	state Exp;
branches;
next	11.5;

11.5
date	95.12.06.13.25.06;	author jra;	state Exp;
branches;
next	11.4;

11.4
date	95.11.28.21.35.45;	author jra;	state Exp;
branches;
next	11.3;

11.3
date	95.01.04.10.08.10;	author mike;	state Rel4_4;
branches;
next	11.2;

11.2
date	94.08.22.19.13.59;	author gdurf;	state Exp;
branches;
next	11.1;

11.1
date	93.06.28.10.37.42;	author jra;	state Exp;
branches;
next	10.1;

10.1
date	91.10.12.06.45.32;	author mike;	state Rel4_0;
branches;
next	1.2;

1.2
date	91.06.12.20.27.56;	author mike;	state Exp;
branches;
next	1.1;

1.1
date	91.06.12.19.59.42;	author mike;	state Exp;
branches;
next	;

11.7.4.1
date	2004.03.17.21.16.34;	author morrison;	state Exp;
branches;
next	;

11.7.6.1
date	2004.03.11.23.41.16;	author morrison;	state Exp;
branches;
next	;

11.7.12.1
date	2004.02.12.19.41.39;	author erikg;	state Exp;
branches;
next	;


desc
@IGES converter
@


11.9
log
@moved to src/iges/
@
text
@/*
 *  Authors -
 *	John R. Anderson
 *	Susanne L. Muuss
 *	Earl P. Weaver
 *
 *  Source -
 *	VLD/ASB Building 1065
 *	The U. S. Army Ballistic Research Laboratory
 *	Aberdeen Proving Ground, Maryland  21005
 *  
 *  Copyright Notice -
 *	This software is Copyright (C) 1990-2004 by the United States Army.
 *	All rights reserved.
 */

/* Routine to determine record size of IGES file.
	According to the spec, the file should be
	80 characters per record.  The spec does not
	mention anything about CR or LF at the end of records,
	so this routine looks for LF's and returns the actual
	record length.
	Note: this will work for files with records that are
	80 characters long without any CR or LF at end of records,
	also for files with CR-LF at end of records, and for files
	with just LF at end of records.  It will not work for files
	with just CR at end of records (but I haven't seen such an animal
	yet) */

#include "./iges_struct.h"
#include "./iges_extern.h"
#define	NRECS	20	/* Maximum number of records to sample */
#define	NCHAR	256	/* Maximuim number of characters to read
				in case there are no LF's */
extern int errno;

int
Recsize()
{

	int i,j,k=(-1),recl=0,length[NRECS],ch;

	for( j=0 ; j<NRECS ; j++ )
	{
		i = 1;
		while( (ch=getc( fd ) ) != '\n' && i < NCHAR && ch != EOF )
			i++;
		if( i == NCHAR )
		{
			recl = 80;
			break;
		}
		else if( ch == EOF )
		{
			k = j - 1;
			break;
		}
		else
			length[j] = i; /* record this record length */
	}
	if( k == (-1) )	/* We didn't encounter an early EOF */
		k = NRECS;

	if( fseek( fd , 0L , 0 ) ) /* rewind file */
	{
		bu_log( "Cannot rewind file\n" );
		perror( "Recsize" );
		exit( 1 );
	}

	if( recl == 0 )	/* then LF's were found */
	{
		recl = length[1];	/* don't use length[0] */

		/* check for consistent record lengths */
		for( j=2 ; j<k ; j++ )
		{
			if( recl != length[j] )
				return( 0 );
		}
	}
	return( recl );
}

@


11.8
log
@update copyright to include span through 2003
@
text
@@


11.7
log
@Recsize returns int
@
text
@d13 1
a13 1
 *	This software is Copyright (C) 1990 by the United States Army.
@


11.7.4.1
log
@sync branch with HEAD
@
text
@d13 1
a13 1
 *	This software is Copyright (C) 1990-2004 by the United States Army.
@


11.7.6.1
log
@sync to HEAD...
@
text
@d13 1
a13 1
 *	This software is Copyright (C) 1990-2004 by the United States Army.
@


11.7.12.1
log
@merge from HEAD
@
text
@d13 1
a13 1
 *	This software is Copyright (C) 1990-2004 by the United States Army.
@


11.6
log
@
Converted from Release 4 names to know about libbu and libbn
@
text
@d37 1
@


11.5
log
@All logging done via rt_log
@
text
@d65 1
a65 1
		rt_log( "Cannot rewind file\n" );
@


11.4
log
@Mods to handle TNURB BREP. Also added RT_EXTERNS to iges_struct.h.
@
text
@d65 1
a65 1
		fprintf( stderr , "Cannot rewind file\n" );
@


11.3
log
@Release_4.4
@
text
@a29 5
#include "conf.h"

#include <stdio.h>
#include "machine.h"
#include "vmath.h"
@


11.2
log
@Added include of conf.h
@
text
@@


11.1
log
@Major Upgrade to IGES 5.1
@
text
@d30 2
@


10.1
log
@Release_4.0
@
text
@@


1.2
log
@Modified for Release 4.0
@
text
@@


1.1
log
@Initial revision
@
text
@d31 2
@
