head	11.7;
access;
symbols
	ansi-20040405-merged:11.4.2.1
	postmerge-20040405-ansi:11.5
	premerge-20040404-ansi:11.4
	postmerge-autoconf:11.4
	autoconf-freeze:11.4
	premerge-autoconf:11.4
	ansi-20040316-freeze:11.4.2.1
	postmerge-20040315-windows:11.4
	premerge-20040315-windows:11.4
	windows-20040315-freeze:11.4
	autoconf-20031203:11.4
	autoconf-20031202:11.4
	autoconf-branch:11.4.0.10
	phong-branch:11.4.0.8
	photonmap-branch:11.4.0.6
	rel-6-1-DP:11.4
	windows-branch:11.4.0.4
	rel-6-0-2:11.2
	ansi-branch:11.4.0.2
	rel-6-0-1-branch:11.2.0.2
	hartley-6-0-post:11.3
	hartley-6-0-pre:11.2
	rel-6-0-1:11.2
	rel-6-0:11.2
	rel-5-4:11.1
	offsite-5-3-pre:11.1
	rel-5-3:11.1
	rel-5-2:11.1
	rel-5-1-branch:11.1.0.2
	rel-5-1:11.1
	rel-5-0:11.1
	rel-5-0-beta:11.1
	rel-4-5:11.1
	ctj-4-5-post:11.1
	ctj-4-5-pre:11.1
	rel-4-4:11.1
	rel-4-0:10.1
	rel-3-5:9.1
	rel-3-0:8.1
	rel-2-3:7.1
	rel-2-0:5.1
	rel-1-24:5.1
	rel-1-20:4.2
	rel-1-10:4.1;
locks; strict;
comment	@ * @;


11.7
date	2004.05.24.04.13.10;	author morrison;	state dead;
branches;
next	11.6;

11.6
date	2004.05.10.15.30.42;	author erikg;	state Exp;
branches;
next	11.5;

11.5
date	2004.04.05.07.52.17;	author morrison;	state Exp;
branches;
next	11.4;

11.4
date	2002.08.20.17.07.28;	author jra;	state Exp;
branches
	11.4.2.1;
next	11.3;

11.3
date	2002.08.15.20.54.41;	author hartley;	state Exp;
branches;
next	11.2;

11.2
date	2001.08.09.17.45.25;	author jra;	state Exp;
branches;
next	11.1;

11.1
date	95.01.04.10.13.56;	author mike;	state Rel4_4;
branches;
next	10.2;

10.2
date	94.08.23.19.34.31;	author gdurf;	state Exp;
branches;
next	10.1;

10.1
date	91.10.12.06.49.41;	author mike;	state Rel4_0;
branches;
next	9.3;

9.3
date	90.12.10.09.50.19;	author moss;	state Exp;
branches;
next	9.2;

9.2
date	90.11.26.11.19.53;	author moss;	state Exp;
branches;
next	9.1;

9.1
date	89.05.19.06.12.18;	author mike;	state Rel3_5;
branches;
next	8.1;

8.1
date	88.10.05.00.50.12;	author mike;	state Rel3_0;
branches;
next	7.1;

7.1
date	87.11.03.00.10.55;	author mike;	state Rel;
branches;
next	6.1;

6.1
date	87.07.11.08.14.27;	author mike;	state Rel;
branches;
next	5.1;

5.1
date	87.06.24.22.45.37;	author mike;	state Rel;
branches;
next	4.2;

4.2
date	87.02.13.00.52.50;	author mike;	state Exp;
branches;
next	4.1;

4.1
date	86.12.29.02.51.57;	author mike;	state Rel1;
branches;
next	1.3;

1.3
date	86.12.26.22.37.20;	author mike;	state Exp;
branches;
next	1.2;

1.2
date	86.11.12.23.05.27;	author mike;	state Exp;
branches;
next	1.1;

1.1
date	86.11.10.23.10.47;	author mike;	state Exp;
branches;
next	;

11.4.2.1
date	2002.09.19.18.00.50;	author morrison;	state Exp;
branches;
next	;


desc
@Gary Moss' Original Version
@


11.7
log
@moved to src/fbed/
@
text
@/*
	SCCS id:	@@(#) pos_pad.c	2.1
	Modified: 	12/9/86 at 15:54:52 by Gary S. Moss
	Retrieved: 	12/26/86 at 21:54:35
	SCCS archive:	/vld/moss/src/fbed/s.pos_pad.c

	Author:		Douglas P. Kingston III	
			Gary S. Moss
			U. S. Army Ballistic Research Laboratory
			Aberdeen Proving Ground
			Maryland 21005-5066
			(301)278-6651 or DSN 298-6651
*/
#if ! defined( lint )
static const char RCSid[] = "@@(#) pos_pad.c 2.1, modified 12/9/86 at 15:54:52, archive /vld/moss/src/fbed/s.pos_pad.c";
#endif

#ifdef HAVE_CONFIG_H
# include "config.h"
#endif



#include <stdio.h>
#ifdef SYSV
#include <termio.h>
#endif

#include "machine.h"
#include "externs.h"
#include "fb.h"

#include "./std.h"
#include "./ascii.h"
#include "./font.h"
#include "./try.h"
#include "./extern.h"

#define	P_FLAG		0100
#define	P_DATA		0077
#define	P_BUTTONS	0074

#define	PADSIZE		2200

static	int pfd;
static	char *padfile = "/dev/pad";
static	int npoints;

int
pad_open(int n)
{
	if( (pfd = open(padfile, 2)) < 0 )
		{
		perror( padfile );
		return -1;
		}
	save_Tty( pfd );
	set_HUPCL( pfd );
	set_Raw( pfd );
	npoints = n;
	return pfd;
	}

void
pad_close(void)
{
	reset_Tty( pfd );
	(void) close( pfd );
	return;
	}

int
getpos(Point *pos)
{	static char str[1024];
		int buttons = -1;
		static int nread = 0;
		register int just_read = 0;
		register char *cp;
		register char *cend;
		char *last = NULL;
	while( nread < 9 )
		{
		if(	empty( pfd )
		     ||	(just_read = read(pfd, str+nread, (sizeof str) - nread))
		     ==	0
			)
			return -1; /* no input available */
		nread += just_read;
		}
	cend = str + nread - 4;
	nread = 0;
	for( cp = str; cp < cend; cp++ )
		{
		if (!(cp[0] & P_FLAG))
			continue;
		last = cp;
		if ( (buttons = ((cp[0]&P_BUTTONS) >> 2)))
			break;
		}
	if( last == NULL )
		return buttons;	/* no position parsed */
	last++;
	pos->p_x = (int)(((long)((last[0]&P_DATA) | ((last[1]&P_DATA)<<6)
			) * (long)npoints) / PADSIZE);
	pos->p_y = npoints -
			(int)(((long)((last[2]&P_DATA) | ((last[3]&P_DATA)<<6)
			) * (long)npoints) / PADSIZE);
	return buttons;
	}
@


11.6
log
@change conf.h to a wrapped config.h
@
text
@@


11.5
log
@merge of ansi-6-0-branch into HEAD
@
text
@d18 5
a22 1
#include "conf.h"
@


11.4
log
@Restoration of entire source tree to Pre-Hartley state
@
text
@d46 2
a47 3
pad_open(n)
int n;
	{
d61 2
a62 2
pad_close()
	{
d69 2
a70 3
getpos( pos )
Point *pos;
	{	static char str[1024];
@


11.4.2.1
log
@Initial ANSIfication
@
text
@d46 3
a48 2
pad_open(int n)
{
d62 2
a63 2
pad_close(void)
{
d70 3
a72 2
getpos(Point *pos)
{	static char str[1024];
@


11.3
log
@Converted from K&R to ANSI C - RFH
@
text
@d46 3
a48 2
pad_open(int n)
{
d62 2
a63 2
pad_close(void)
{
d70 3
a72 2
getpos(Point *pos)
{	static char str[1024];
@


11.2
log
@Lint
@
text
@d46 2
a47 3
pad_open(n)
int n;
	{
d61 2
a62 2
pad_close()
	{
d69 2
a70 3
getpos( pos )
Point *pos;
	{	static char str[1024];
@


11.1
log
@Release_4.4
@
text
@d15 1
a15 2
static
char sccsTag[] = "@@(#) pos_pad.c 2.1, modified 12/9/86 at 15:54:52, archive /vld/moss/src/fbed/s.pos_pad.c";
d45 1
d69 1
d95 1
a95 1
		if (buttons = (cp[0]&P_BUTTONS) >> 2)
@


10.2
log
@Made includes explicit
@
text
@@


10.1
log
@Release_4.0
@
text
@d19 2
d22 1
a22 1
#ifdef SYS5
d25 9
@


9.3
log
@Added initializations of auto variables that were generating compiler
warnings.
@
text
@@


9.2
log
@Added some commands: draw-rectangle, fill-bounded-region, print-comment,
	change-region-color, set-tolerance-color-match.
Also, default rectangle is entire window.
Checked in for release 4.0.
@
text
@d61 1
a61 1
		int buttons;
d63 1
a63 1
		register int just_read;
d66 1
a66 1
		char *last;
d70 1
a70 1
		     ||	(just_read = read (pfd, str+nread, (sizeof str) - nread))
d73 1
a73 1
			return -1;
d86 2
d91 2
a92 1
	pos->p_y = npoints - (int)(((long)((last[2]&P_DATA) | ((last[3]&P_DATA)<<6)
@


9.1
log
@Release_3.5
@
text
@d12 1
a12 1
			(301)278-6647 or AV-298-6647
d16 1
a16 1
char	sccsTag[] = "@@(#) pos_pad.c 2.1, modified 12/9/86 at 15:54:52, archive /vld/moss/src/fbed/s.pos_pad.c";
d31 3
a33 3
static	int	pfd;
static	char	*padfile = "/dev/pad";
static	int	npoints;
d36 1
a36 1
int	n;
d41 1
a41 1
		return	-1;
d47 1
a47 1
	return	pfd;
d59 8
a66 8
Point	*pos;
	{	static char	str[1024];
		int		buttons;
		static int	nread = 0;
		register int	just_read;
		register char	*cp;
		register char	*cend;
		char	*last;
d73 1
a73 1
			return	-1;
d91 1
a91 1
	return	buttons;
@


8.1
log
@Release_3.0
@
text
@@


7.1
log
@Release 2.3
@
text
@@


6.1
log
@Release 2.0
@
text
@@


5.1
log
@Release 1.24
@
text
@@


4.2
log
@Release 1.20 -- First Formal Release
@
text
@@


4.1
log
@BRL CAD Distribution Release 1.10
@
text
@@


1.3
log
@Latest version from Gary Moss
@
text
@@


1.2
log
@First version that compiles
@
text
@d2 4
a5 4
	SCCS id:	%Z% %M%	%I%
	Modified: 	%G% at %U% by Gary S. Moss
	Retrieved: 	%H% at %T%
	SCCS archive:	%P%
d16 1
a16 1
char	sccsTag[] = "%Z% %M% %I%, modified %G% at %U%, archive %P%";
a22 2
#include "fb.h"
#include "./popup.h"
@


1.1
log
@Initial revision
@
text
@d18 1
d20 1
d22 2
a23 1
#include <fb.h>
d26 1
@
