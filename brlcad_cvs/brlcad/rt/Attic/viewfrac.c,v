head	11.14;
access;
symbols
	ansi-20040405-merged:11.10.2.2
	postmerge-20040405-ansi:11.12
	premerge-20040404-ansi:11.11
	postmerge-autoconf:11.11
	autoconf-freeze:11.10.10.2
	premerge-autoconf:11.11
	postmerge-20040315-windows:11.11
	premerge-20040315-windows:11.11
	windows-20040315-freeze:11.10.4.1
	autoconf-20031203:11.10
	autoconf-20031202:11.10
	autoconf-branch:11.10.0.10
	phong-branch:11.10.0.8
	photonmap-branch:11.10.0.6
	rel-6-1-DP:11.10
	windows-branch:11.10.0.4
	rel-6-0-2:11.8
	ansi-branch:11.10.0.2
	rel-6-0-1-branch:11.8.0.2
	hartley-6-0-post:11.9
	hartley-6-0-pre:11.8
	rel-6-0-1:11.8
	rel-6-0:11.8
	rel-5-4:11.5
	offsite-5-3-pre:11.8
	rel-5-3:11.5
	rel-5-2:11.5
	rel-5-1-branch:11.5.0.2
	rel-5-1:11.5
	rel-5-0:11.5
	rel-5-0-beta:11.4
	rel-4-5:11.3
	ctj-4-5-post:11.3
	ctj-4-5-pre:11.3
	rel-4-4:11.1
	rel-4-0:10.1;
locks; strict;
comment	@ * @;


11.14
date	2004.05.21.17.31.09;	author morrison;	state dead;
branches;
next	11.13;

11.13
date	2004.05.10.15.30.49;	author erikg;	state Exp;
branches;
next	11.12;

11.12
date	2004.04.05.05.45.59;	author morrison;	state Exp;
branches;
next	11.11;

11.11
date	2004.02.02.17.39.39;	author morrison;	state Exp;
branches;
next	11.10;

11.10
date	2002.08.20.17.08.39;	author jra;	state Exp;
branches
	11.10.2.1
	11.10.4.1
	11.10.10.1;
next	11.9;

11.9
date	2002.08.15.20.55.50;	author hartley;	state Exp;
branches;
next	11.8;

11.8
date	2000.08.17.02.41.39;	author mike;	state Exp;
branches;
next	11.7;

11.7
date	2000.07.27.19.32.53;	author butler;	state Exp;
branches;
next	11.6;

11.6
date	2000.07.25.16.39.48;	author butler;	state Exp;
branches;
next	11.5;

11.5
date	99.07.02.22.19.46;	author mike;	state Exp;
branches;
next	11.4;

11.4
date	99.05.28.01.19.29;	author mike;	state Exp;
branches;
next	11.3;

11.3
date	96.08.30.00.08.21;	author butler;	state Exp;
branches;
next	11.2;

11.2
date	95.12.06.17.57.53;	author pjt;	state Exp;
branches;
next	11.1;

11.1
date	95.01.04.10.01.25;	author mike;	state Rel4_4;
branches;
next	10.2;

10.2
date	94.08.11.02.45.51;	author gdurf;	state Exp;
branches;
next	10.1;

10.1
date	91.10.12.06.42.19;	author mike;	state Rel4_0;
branches;
next	1.2;

1.2
date	91.07.06.00.35.28;	author mike;	state Exp;
branches;
next	1.1;

1.1
date	91.05.16.22.30.15;	author mike;	state Exp;
branches;
next	;

11.10.2.1
date	2002.09.19.18.02.16;	author morrison;	state Exp;
branches;
next	11.10.2.2;

11.10.2.2
date	2004.03.17.21.23.01;	author morrison;	state Exp;
branches;
next	;

11.10.4.1
date	2004.03.11.23.48.08;	author morrison;	state Exp;
branches;
next	;

11.10.10.1
date	2004.02.12.19.37.14;	author erikg;	state Exp;
branches;
next	11.10.10.2;

11.10.10.2
date	2004.03.15.14.08.07;	author erikg;	state Exp;
branches;
next	;


desc
@Volume Fraction Generator
@


11.14
log
@moved to src/rt/
@
text
@/*
 *			V I E W F R A C . C
 *
 *  An experimental volume fractions code.
 * 
 *  Author -
 *	Michael John Muuss
 *  
 *  Source -
 *	SECAD/VLD Computing Consortium, Bldg 394
 *	The U. S. Army Ballistic Research Laboratory
 *	Aberdeen Proving Ground, Maryland  21005-5066
 *  
 *  Copyright Notice -
 *	This software is Copyright (C) 1990-2004 by the United States Army.
 *	All rights reserved.
 */
#ifndef lint
static const char RCSview[] = "@@(#)$Header: /n/xoff/cvs/brlcad/rt/viewfrac.c,v 11.13 2004/05/10 15:30:49 erikg Exp $ (BRL)";
#endif

#ifdef HAVE_CONFIG_H
# include "config.h"
#endif



#include <stdio.h>
#include "machine.h"
#include "vmath.h"
#include "raytrace.h"
#include "./ext.h"
#include "rtprivate.h"

double	cell_depth;
int	depth;

/*
 *  If this variable is set to zero, then "air" solids in the model
 *  will be entirely discarded.
 *  If this variable is set non-zero, then "air" solids will be
 *  retained, and can be expected to show up in the partition lists.
 */
int	use_air = 1;		/* Handling of air in librt */

/*
 *  Viewing module specific "set" variables.
 *  Any additional variables that the user may be allowed to change
 *  should be listed here.
 *  They can then be accessed via a "set" command, either from
 *  the command line, or from within an animation script.
 */
struct bu_structparse view_parse[] = {
	{"",	0, (char *)0,	0,	BU_STRUCTPARSE_FUNC_NULL }
};

/*
 *  The usage message for this application.
 */
char usage[] = "\
Usage:  rtfrac [options] model.g objects... >file.frac\n\
Options:\n\
 -s #		Grid size in pixels, default 512\n\
 -a Az		Azimuth in degrees\n\
 -e Elev	Elevation in degrees\n\
 -M		Read matrix, cmds on stdin\n\
 -o file	Output file name, else stdout\n\
 -x #		Set librt debug flags\n\
";

int	rayhit(register struct application *ap, struct partition *PartHeadp);
int	raymiss(register struct application *ap);

/*
 *  			V I E W _ I N I T
 *
 *  Called by main() at the start of a run.
 *  Returns 1 if framebuffer should be opened, else 0.
 */
int
view_init(register struct application *ap, char *file, char *obj, int minus_o)
{
	if( !minus_o )
		outfp = stdout;

	output_is_binary = 0;		/* output is printable ascii */

	if( npsw > 1 )  {
		bu_log("rtfrac:  dropping down to 1 CPU\n");
		npsw = 1;
	}

	return(0);		/* no framebuffer needed */
}

/*
 *			V I E W _ 2 I N I T
 *
 *  The beginning of a frame.
 *  Called by do_frame() just before raytracing starts.
 */
void
view_2init(struct application *ap)
{
	extern double	cell_width;
	extern int	width;

	ap->a_hit = rayhit;
	ap->a_miss = raymiss;
	ap->a_onehit = 1;

	cell_depth = cell_width;
	depth = width;
bu_log("cell_depth=%g, # depth cells=%d\n", cell_depth, depth);
}

/*
 *			V I E W _ P I X E L
 *
 *  Called by worker() after the end of proccessing for each pixel.
 */
void
view_pixel(register struct application *ap)
{
}

/*
 *			V I E W _ E O L
 *
 *  Called by worker() at the end of each line.  Depricated.
 *  Any end-of-line processing should be done in view_pixel().
 */
void
view_eol(register struct application *ap)
{
}

/*
 *			V I E W _ E N D
 *
 *  Called in do_frame() at the end of a frame,
 *  just after raytracing completes.
 */
void
view_end(register struct application *ap)
{
}

/*
 *			V I E W _ S E T U P 
 *
 *  Called by do_prep(), just before rt_prep() is called, in do.c
 *  This allows the lighting model to get set up for this frame,
 *  e.g., generate lights, associate materials routines, etc.
 */
void
view_setup(struct rt_i *rtip)
{
}

/*
 *			V I E W _ C L E A N U P
 *
 *  Called by "clean" command, just before rt_clean() is called, in do.c
 */
void
view_cleanup(struct rt_i *rtip)
{
}

/*
 *			R A Y H I T
 *
 *  Called via a_hit linkage from rt_shootray() when ray hits.
 */
int
rayhit(register struct application *ap, struct partition *PartHeadp)
{
	register struct partition *pp;
	int		d;		/* current depth cell # */
	fastf_t		cur_depth;
	fastf_t		frac;

	d = 0;
	/* examine each partition until we get back to the head */
	for( pp=PartHeadp->pt_forw; pp != PartHeadp; pp = pp->pt_forw )  {
		if( pp->pt_outhit->hit_dist <= 0 )  continue;
		cur_depth = pp->pt_inhit->hit_dist;
		while( cur_depth > (d+1) * cell_depth )  d++;

		/* Partition starts in this cell */
more:
		if( pp->pt_outhit->hit_dist <= (d+1) * cell_depth )  {
			/* Partition ends in this cell */
			frac = (pp->pt_outhit->hit_dist -
				cur_depth) / cell_depth;
			fprintf(outfp,"%d %d %d %d %8f\n",
				ap->a_x, ap->a_y, d,
				pp->pt_regionp->reg_regionid, frac );
			continue;
		}
		/* Partition starts in this cell, ends in some later cell */
		frac = ( (d+1) * cell_depth - cur_depth ) / cell_depth;
		fprintf(outfp,"%d %d %d %d %8f\n",
			ap->a_x, ap->a_y, d,
			pp->pt_regionp->reg_regionid, frac );
		d++;
		goto more;
	}

	return(1);	/* report hit to main routine */
}

/*
 *			R A Y M I S S
 *
 *  Called via a_miss linkage from rt_shootray() when ray misses.
 */
int
raymiss(register struct application *ap)
{
	return(0);
}

void application_init (void) {}
@


11.13
log
@change conf.h to a wrapped config.h
@
text
@d19 1
a19 1
static const char RCSview[] = "@@(#)$Header: /cvs/brlcad/rt/viewfrac.c,v 11.12 2004/04/05 05:45:59 morrison Exp $ (BRL)";
@


11.12
log
@merge of ansi-6-0-branch into head
@
text
@d19 1
a19 1
static const char RCSview[] = "@@(#)$Header$ (BRL)";
d22 5
a26 1
#include "conf.h"
@


11.11
log
@update copyright to include span through 2003
@
text
@d19 1
a19 1
static const char RCSview[] = "@@(#)$Header: /c/CVS/brlcad/rt/viewfrac.c,v 11.10 2002/08/20 17:08:39 jra Exp $ (BRL)";
d67 2
a68 2
int	rayhit();
int	raymiss();
d77 1
a77 5
view_init( ap, file, obj, minus_o )
register struct application *ap;
char	*file;
char	*obj;
int	minus_o;
d99 1
a99 2
view_2init( ap )
struct application *ap;
d119 1
a119 2
view_pixel( ap )
register struct application *ap;
d130 1
a130 2
view_eol( ap )
register struct application *ap;
d141 1
a141 2
view_end( ap )
register struct application	*ap;
d153 1
a153 2
view_setup( rtip )
struct rt_i	*rtip;
d163 1
a163 2
view_cleanup( rtip )
struct rt_i	*rtip;
d173 1
a173 3
rayhit( ap, PartHeadp )
register struct application *ap;
struct partition *PartHeadp;
d216 1
a216 2
raymiss( ap )
register struct application *ap;
d221 1
a221 1
void application_init () {}
@


11.10
log
@Restoration of entire source tree to Pre-Hartley state
@
text
@d15 1
a15 1
 *	This software is Copyright (C) 1990 by the United States Army.
d19 1
a19 1
static const char RCSview[] = "@@(#)$Header: /c/CVS/brlcad/rt/viewfrac.c,v 11.8 2000/08/17 02:41:39 mike Exp $ (BRL)";
@


11.10.4.1
log
@sync to HEAD...
@
text
@d15 1
a15 1
 *	This software is Copyright (C) 1990-2004 by the United States Army.
d19 1
a19 1
static const char RCSview[] = "@@(#)$Header: /n/cad/c/CVS/brlcad/rt/viewfrac.c,v 11.11 2004/02/02 17:39:39 morrison Exp $ (BRL)";
@


11.10.10.1
log
@merge from HEAD
@
text
@d15 1
a15 1
 *	This software is Copyright (C) 1990-2004 by the United States Army.
d19 1
a19 1
static const char RCSview[] = "@@(#)$Header: /c/CVS/brlcad/rt/viewfrac.c,v 11.11 2004/02/02 17:39:39 morrison Exp $ (BRL)";
@


11.10.10.2
log
@merge from head
@
text
@d19 1
a19 1
static const char RCSview[] = "@@(#)$Header: /c/CVS/brlcad/rt/viewfrac.c,v 11.10.10.1 2004/02/12 19:37:14 erikg Exp $ (BRL)";
@


11.10.2.1
log
@Initial ANSIfication
@
text
@d19 1
a19 1
static const char RCSview[] = "@@(#)$Header: /c/CVS/brlcad/rt/viewfrac.c,v 11.10 2002/08/20 17:08:39 jra Exp $ (BRL)";
d67 2
a68 2
int	rayhit(register struct application *ap, struct partition *PartHeadp);
int	raymiss(register struct application *ap);
d77 5
a81 1
view_init(register struct application *ap, char *file, char *obj, int minus_o)
d103 2
a104 1
view_2init(struct application *ap)
d124 2
a125 1
view_pixel(register struct application *ap)
d136 2
a137 1
view_eol(register struct application *ap)
d148 2
a149 1
view_end(register struct application *ap)
d161 2
a162 1
view_setup(struct rt_i *rtip)
d172 2
a173 1
view_cleanup(struct rt_i *rtip)
d183 3
a185 1
rayhit(register struct application *ap, struct partition *PartHeadp)
d228 2
a229 1
raymiss(register struct application *ap)
d234 1
a234 1
void application_init (void) {}
@


11.10.2.2
log
@sync branch with HEAD
@
text
@d15 1
a15 1
 *	This software is Copyright (C) 1990-2004 by the United States Army.
d19 1
a19 1
static const char RCSview[] = "@@(#)$Header$ (BRL)";
@


11.9
log
@Converted from K&R to ANSI C - RFH
@
text
@d67 2
a68 2
int	rayhit(register struct application *ap, struct partition *PartHeadp);
int	raymiss(register struct application *ap);
d77 5
a81 1
view_init(register struct application *ap, char *file, char *obj, int minus_o)
d103 2
a104 1
view_2init(struct application *ap)
d124 2
a125 1
view_pixel(register struct application *ap)
d136 2
a137 1
view_eol(register struct application *ap)
d148 2
a149 1
view_end(register struct application *ap)
d161 2
a162 1
view_setup(struct rt_i *rtip)
d172 2
a173 1
view_cleanup(struct rt_i *rtip)
d183 3
a185 1
rayhit(register struct application *ap, struct partition *PartHeadp)
d228 2
a229 1
raymiss(register struct application *ap)
d234 1
a234 1
void application_init (void) {}
@


11.8
log
@
Added "const" to RCSid, to quiet Gnu C compilers.
@
text
@d19 1
a19 1
static const char RCSview[] = "@@(#)$Header: /c/CVS/brlcad/rt/viewfrac.c,v 11.7 2000/07/27 19:32:53 butler Exp $ (BRL)";
d67 2
a68 2
int	rayhit();
int	raymiss();
d77 1
a77 5
view_init( ap, file, obj, minus_o )
register struct application *ap;
char	*file;
char	*obj;
int	minus_o;
d99 1
a99 2
view_2init( ap )
struct application *ap;
d119 1
a119 2
view_pixel( ap )
register struct application *ap;
d130 1
a130 2
view_eol( ap )
register struct application *ap;
d141 1
a141 2
view_end( ap )
register struct application	*ap;
d153 1
a153 2
view_setup( rtip )
struct rt_i	*rtip;
d163 1
a163 2
view_cleanup( rtip )
struct rt_i	*rtip;
d173 1
a173 3
rayhit( ap, PartHeadp )
register struct application *ap;
struct partition *PartHeadp;
d216 1
a216 2
raymiss( ap )
register struct application *ap;
d221 1
a221 1
void application_init () {}
@


11.7
log
@Added -Q flag to rt, misc compilation warning fixes
@
text
@d19 1
a19 1
static char RCSview[] = "@@(#)$Header: /c/CVS/brlcad/rt/viewfrac.c,v 11.6 2000/07/25 16:39:48 butler Exp $ (BRL)";
@


11.6
log
@Many patches for warning-free compilation on Linux.
Moved rdebug.h to h/rtprivate.h
@
text
@d19 1
a19 1
static char RCSview[] = "@@(#)$Header: /c/CVS/brlcad/rt/viewfrac.c,v 11.5 1999/07/02 22:19:46 mike Exp $ (BRL)";
d76 1
@


11.5
log
@
Removed dependence on compat4.h
@
text
@d19 1
a19 1
static char RCSview[] = "@@(#)$Header: /c/CVS/brlcad/rt/viewfrac.c,v 11.4 1999/05/28 01:19:29 mike Exp $ (BRL)";
d29 1
a29 1
#include "./rdebug.h"
@


11.4
log
@
sed4
@
text
@d19 1
a19 1
static char RCSview[] = "@@(#)$Header: /c/CVS/brlcad/rt/viewfrac.c,v 11.3 1996/08/30 00:08:21 butler Exp $ (BRL)";
d50 1
a50 1
	{"",	0, (char *)0,	0,	FUNC_NULL }
@


11.3
log
@structparse moved to libbu
@
text
@d19 1
a19 1
static char RCSview[] = "@@(#)$Header: /m/cad/rt/RCS/viewfrac.c,v 11.2 1995/12/06 17:57:53 pjt Exp butler $ (BRL)";
d88 1
a88 1
		rt_log("rtfrac:  dropping down to 1 CPU\n");
d114 1
a114 1
rt_log("cell_depth=%g, # depth cells=%d\n", cell_depth, depth);
@


11.2
log
@Added a stub for application_init()
@
text
@d19 1
a19 1
static char RCSview[] = "@@(#)$Header: /m/cad/rt/RCS/viewfrac.c,v 11.1 1995/01/04 10:01:25 mike Rel4_4 pjt $ (BRL)";
d49 1
a49 1
struct structparse view_parse[] = {
@


11.1
log
@Release_4.4
@
text
@d19 1
a19 1
static char RCSview[] = "@@(#)$Header: /m/cad/rt/RCS/viewfrac.c,v 10.2 94/08/11 02:45:51 gdurf Exp $ (BRL)";
d232 2
@


10.2
log
@Added include of conf.h
@
text
@d19 1
a19 1
static char RCSview[] = "@@(#)$Header: /m/cad/rt/RCS/viewfrac.c,v 10.1 1991/10/12 06:42:19 mike Rel4_0 gdurf $ (BRL)";
@


10.1
log
@Release_4.0
@
text
@d19 1
a19 1
static char RCSview[] = "@@(#)$Header: /m/cad/rt/RCS/viewfrac.c,v 1.2 91/07/06 00:35:28 mike Exp $ (BRL)";
d21 2
@


1.2
log
@ANSI structure initialization
@
text
@d19 1
a19 1
static char RCSview[] = "@@(#)$Header: /m/cad/rt/RCS/viewfrac.c,v 1.1 91/05/16 22:30:15 mike Exp $ (BRL)";
@


1.1
log
@Initial revision
@
text
@d19 1
a19 1
static char RCSview[] = "@@(#)$Header$ (BRL)";
d48 1
a48 1
	"",	0, (char *)0,	0,	FUNC_NULL
@
