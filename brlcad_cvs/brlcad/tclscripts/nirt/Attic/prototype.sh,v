head	1.4;
access;
symbols
	ansi-20040405-merged:1.3
	postmerge-20040405-ansi:1.3
	premerge-20040404-ansi:1.3
	postmerge-autoconf:1.3
	autoconf-freeze:1.3
	premerge-autoconf:1.3
	postmerge-20040315-windows:1.3
	premerge-20040315-windows:1.3
	windows-20040315-freeze:1.3
	autoconf-20031203:1.3
	autoconf-20031202:1.3
	autoconf-branch:1.3.0.14
	phong-branch:1.3.0.12
	photonmap-branch:1.3.0.10
	rel-6-1-DP:1.3
	windows-branch:1.3.0.8
	rel-6-0-2:1.3
	ansi-branch:1.3.0.6
	rel-6-0-1-branch:1.3.0.4
	hartley-6-0-post:1.3
	hartley-6-0-pre:1.3
	rel-6-0-1:1.3
	rel-6-0:1.3
	rel-5-4:1.3
	offsite-5-3-pre:1.3
	rel-5-3:1.3
	rel-5-2:1.3
	rel-5-1-branch:1.3.0.2
	rel-5-1:1.3
	rel-5-0:1.3
	rel-5-0-beta:1.3
	rel-4-5:1.2;
locks; strict;
comment	@# @;


1.4
date	2004.05.21.16.41.34;	author morrison;	state dead;
branches;
next	1.3;

1.3
date	98.06.16.19.43.44;	author pjt;	state Exp;
branches;
next	1.2;

1.2
date	97.06.16.19.16.43;	author pjt;	state Exp;
branches;
next	1.1;

1.1
date	97.06.16.17.58.06;	author pjt;	state Exp;
branches;
next	;


desc
@     Prototype of a Tcl/Tk GUI for NIRT(1)
@


1.4
log
@moved to src/tclscripts/
@
text
@#!/bin/sh
#
# restart with wish \
exec wish "$0" "$@@"

wm title . "NIRT"

# wm geometry . {+1-20}
# wm positionfrom . program


########################################################################
#
#	Global Variables
#
########################################################################

set units	"millimeters"
set use_air	0

set x_value	0.0
set y_value	0.0
set z_value	0.0
set h_value	0.0
set v_value	0.0
set d_value	0.0
set az_value	0.0
set el_value	0.0

# Draw caliper legs in geometry windows?
set show_cal_legs	0

# Location of each leg
set cal_leg_loc(1) "1 2 3"
set cal_leg_loc(2) "0 0 0"
set cal_dist ""

########################################################################
#
#	Useful procs
#
########################################################################

proc Tcl_command {} {

    global do_it
    global Tcl_string

    set do_it 0
    toplevel .tcwin
    wm title .tcwin "Tcl command panel"
    frame .tcwin.eline
    frame .tcwin.buttons
    label .tcwin.elabel -text "Tcl string to interpret:"
    entry .tcwin.eentry -width 40 -textvariable Tcl_string
    bind .tcwin.eentry <Return> {set do_it 1; destroy .tcwin}
    button .tcwin.ok -text "OK" -command {set do_it 1; destroy .tcwin}
    button .tcwin.cancel -text "Cancel" -command {destroy .tcwin}
    button .tcwin.clear -text "Clear" -command {.tcwin.eentry delete 0 end}
    pack .tcwin.elabel .tcwin.eentry -in .tcwin.eline -side left
    pack .tcwin.cancel .tcwin.clear .tcwin.ok -in .tcwin.buttons -side left
    pack .tcwin.eline .tcwin.buttons -in .tcwin -side top
    bind .tcwin.elabel <Button-3> {context_help "tc command"}
    bind .tcwin.eentry <Button-3> {context_help "tc command"}
    bind .tcwin.cancel <Button-3> {context_help "tc cancel"}
    bind .tcwin.clear <Button-3> {context_help "tc clear"}
    bind .tcwin.ok <Button-3> {context_help "tc ok"}

    tkwait window .tcwin

    if {$do_it == 1} {
        if {$Tcl_string != ""} {
            printf [eval $Tcl_string]
        }
    }
}

proc printf {string} {
    .rslt_txt insert end $string
}

proc clearf {} {
    .rslt_txt delete 1.0 end
}

proc shoot_a_ray {} {
    set time [exec "date"]

    clearf
    printf "Shooting a ray at $time...\n"

    exec nirt ~pjt/mged/scene.g scene
    
}

proc select_an_mged {mgeds} {

    global mged_answer

    set mged_answer ""
    toplevel .mgeds
    wm title .mgeds "NIRT MGED selector"
    #
    listbox .mgeds.list
    foreach app $mgeds { .mgeds.list insert end $app }
    #
    button .mgeds.cancel -text "Cancel" -command {destroy .mgeds}
    pack .mgeds.list .mgeds.cancel -in .mgeds
    bind .mgeds.list <Double-Button-1> {
	set mged_answer [selection get]
	destroy .mgeds
    }
}

proc link_to_mged {} {

    global mged_answer

    set this_nirt [winfo name .]
    printf "We are $this_nirt\n"

    #
    #	See how many MGEDs there are
    #
    set mgeds []
    foreach app [winfo interps] {
	if {[regexp {mged.*} $app]} {
	    lappend mgeds $app
	}
    }
    if {[llength $mgeds] == 0} {
	printf "There are no mgeds\n"
	return ""
    } elseif {[llength $mgeds] == 1} {
	set mged_answer [lindex $mgeds 0]
    } else {
	select_an_mged $mgeds
	tkwait window .mgeds
	if {$mged_answer == ""} {
	    return ""
	}
    }

    send $mged_answer {puts "Hello from NIRT!\n"}
    send $mged_answer "send $this_nirt \{puts \"Hello from us\\n\"\}"

    set result [send $mged_answer {ae 35 25}]
    printf "The result of the transaction was: <$result>\n"

    return $mged_answer
}

proc set_xyz {} {

    global x_value
    global y_value
    global z_value

    toplevel .xyz
    wm title .xyz "NIRT Set xyz"

    set x_tmp $x_value
    set y_tmp $y_value
    set z_tmp $z_value

    frame .xyz.xline
	label .xyz.xlbl -text "x"
	entry .xyz.xentry -textvariable x_tmp
	pack .xyz.xlbl .xyz.xentry -side left -in .xyz.xline
    frame .xyz.yline
	label .xyz.ylbl -text "y"
	entry .xyz.yentry -textvariable y_tmp
	pack .xyz.ylbl .xyz.yentry -side left -in .xyz.yline
    frame .xyz.zline
	label .xyz.zlbl -text "z"
	entry .xyz.zentry -textvariable z_tmp
	pack .xyz.zlbl .xyz.zentry -side left -in .xyz.zline
    pack .xyz.xline .xyz.yline .xyz.zline

    frame .xyz.bbar
	button .xyz.ok -text "OK" \
	    -command {
		set x_value $x_tmp
		set y_value $y_tmp
		set z_value $z_tmp
		destroy .xyz
	    }
	button .xyz.cancel -text "Cancel" -command {destroy .xyz}
	pack .xyz.ok .xyz.cancel -side left -in .xyz.bbar
    pack .xyz.bbar
}

proc y_coord {string} {
    lindex $string 1
}

proc z_coord {string} {
    lindex $string 2
}

proc calculate_distance {} {
    global cal_leg_loc

    set x [expr [x_coord $cal_leg_loc(1)] - [x_coord $cal_leg_loc(2)]]
    set y [expr [y_coord $cal_leg_loc(1)] - [y_coord $cal_leg_loc(2)]]
    set z [expr [z_coord $cal_leg_loc(1)] - [z_coord $cal_leg_loc(2)]]
    puts "The delta is ($x $y $z)"
    set cal_dist [expr sqrt([expr $x*$x + $y*$y + $z*$z])]
    puts "OK, cal_dist is now $cal_dist\n"
}


    #toplevel .zal 
    #wm title .zal "MGED Calipers"


########################################################################
#
#	The menu bar
#
########################################################################
frame .mbar -relief raised -bd 2
    menubutton .file -text "File" -menu .file.menu
	menu .file.menu
	    .file.menu add cascade -label "Output to..." \
		-menu .file.menu.dest
		menu .file.menu.dest
		    .file.menu.dest add command -label "Display panel" \
			-command {printf "me\n"}
		    .file.menu.dest add command -label "File..." \
			-command {printf "file\n"}
		    .file.menu.dest add command -label "Pipe..." \
			-command {printf "pipe\n"}
	    .file.menu add command -label "State file"
	    .file.menu add command -label "Dump state"
	    .file.menu add command -label "Load state"
	    .file.menu add command -label "Exit" -command {exit}
    menubutton .options -text Options -menu .options.menu
	menu .options.menu
	    .options.menu add cascade -label "Units..." \
		-menu .options.menu.units
		menu .options.menu.units
		    .options.menu.units add radiobutton -label "micrometers" \
			-variable units
		    .options.menu.units add radiobutton -label "millimeters" \
			-variable units
		    .options.menu.units add radiobutton -label "centimeters" \
			-variable units
		    .options.menu.units add radiobutton -label "meters" \
			-variable units
		    .options.menu.units add radiobutton -label "kilometers" \
			-variable units
		    .options.menu.units add separator
		    .options.menu.units add radiobutton -label "inches" \
			-variable units
		    .options.menu.units add radiobutton -label "feet" \
			-variable units
		    .options.menu.units add radiobutton -label "yards" \
			-variable units
		    .options.menu.units add radiobutton -label "miles" \
			-variable units
	    .options.menu add checkbutton -label "Use air" -variable "use_air"
	    .options.menu add command -label "Link to MGED..." \
		-command link_to_mged
	    .options.menu add command -label "Debug flags..." \
		-command {printf "twiddle bits\n"}
    menubutton .formats -text Formats -menu .formats.menu
	menu .formats.menu
	    .formats.menu add command -label "Set output formats"
	    .formats.menu entryconfigure "Set output formats" -state disabled
    button .tcl -bd 0 -text Tcl -command {Tcl_command}
    button .exit -bd 0 -text Exit -command {exit}
    pack .file .options .formats .tcl -side left -in .mbar
    pack .exit -side right -in .mbar
    pack .mbar -fill x -side top

########################################################################
#
#	The main window
#
########################################################################

frame .rayspec
    frame .origin -relief raised -borderwidth 4
	label .origin_lbl -text "Ray Origin"
	frame .origin_mdl
	    button .mdl_lbl -text "Model Coordinates" \
		-command set_xyz
	    #
	    frame .xline
	    label .xlbl -text "x ="
	    label .x_val -textvariable x_value
	    pack .xlbl .x_val -side left -in .xline
	    #
	    frame .yline
	    label .ylbl -text "y ="
	    label .y_val -textvariable y_value
	    pack .ylbl .y_val -side left -in .yline
	    #
	    frame .zline
	    label .zlbl -text "z ="
	    label .z_val -textvariable z_value
	    pack .zlbl .z_val -side left -in .zline
	    #
	    pack .mdl_lbl .xline .yline .zline -side top -in .origin_mdl
	frame .origin_view
	    button .view_lbl -text "View Coordinates"
	    #
	    frame .hline
	    label .hlbl -text "h ="
	    label .h_val -textvariable h_value
	    pack .hlbl .h_val -side left -in .hline
	    #
	    frame .vline
	    label .vlbl -text "v ="
	    label .v_val -textvariable v_value
	    pack .vlbl .v_val -side left -in .vline
	    #
	    frame .dline
	    label .dlbl -text "d ="
	    label .d_val -textvariable d_value
	    pack .dlbl .d_val -side left -in .dline
	    #
	    pack .view_lbl .hline .vline .dline -side top -in .origin_view
	pack .origin_lbl -side top -in .origin
	pack .origin_mdl .origin_view -side left -in .origin

    frame .direc -relief raised -borderwidth 4
	label .direc_lbl -text "Ray Direction"
	frame .direc_mdl
	    button .dir_lbl -text "Model Coordinates"
	    #
	    frame .dxline
	    label .dxlbl -text "dx ="
	    label .dx_val -textvariable x_value
	    pack .dxlbl .dx_val -side left -in .dxline
	    #
	    frame .dyline
	    label .dylbl -text "dy ="
	    label .dy_val -textvariable y_value
	    pack .dylbl .dy_val -side left -in .dyline
	    #
	    frame .dzline
	    label .dzlbl -text "dz ="
	    label .dz_val -textvariable z_value
	    pack .dzlbl .dz_val -side left -in .dzline
	    #
	    pack .dir_lbl .dxline .dyline .dzline -side top -in .direc_mdl
	frame .az_el
	    button .az_el_lbl -text "Azimuth & Elevation"
	    #
	    frame .az_line
	    label .az_lbl -text "az ="
	    label .az_val -textvariable h_value
	    pack .az_lbl .az_val -side left -in .az_line
	    #
	    frame .el_line
	    label .el_lbl -text "el ="
	    label .el_val -textvariable v_value
	    pack .el_lbl .el_val -side left -in .el_line
	    #
	    pack .az_el_lbl .az_line .el_line -side top -in .az_el
	pack .direc_lbl -side top -in .direc
	pack .direc_mdl .az_el -side left -in .direc

    pack .origin .direc -ipadx 1m -ipady 1m -side left -in .rayspec
pack .rayspec -side top

frame .btnbar
    button .backout -text "Back out" -command {printf "Backing out...\n"}
    button .shoot -text "Shoot" -command {shoot_a_ray}
    pack .backout -side left -in .btnbar
    pack .shoot -side right -in .btnbar
pack .btnbar -fill x -side top

frame .result -relief raised -bd 2
    text .rslt_txt -yscrollcommand {.rslt_y set}
#	.rslt_txt insert end "Here are 100 lines\n"
#	for {set i 0} {$i < 100} {incr i} {
#	    .rslt_txt insert end " Line number $i\n"
#	}
    pack .rslt_txt -side left -in .result
    scrollbar .rslt_y -command {.rslt_txt yview}
    pack .rslt_y -side right -fill y -in .result
pack .result -side top

@


1.3
log
@COB 16 Jun 97
@
text
@@


1.2
log
@We can now select from all local MGEDs one in particular,
and compel it to exchange pleasantries with us
@
text
@d21 9
d91 2
d147 3
d153 38
a190 2
proc x_coord {string} {
    lindex $string 0
a264 1
	    #.options.menu entryconfigure "Link to MGED..." -state disabled
d287 2
a288 1
	    label .mdl_lbl -text "Model Coordinates"
d291 3
a293 3
	    label .xlbl -text "x"
	    entry .xentry -textvariable x_value
	    pack .xlbl .xentry -side left -in .xline
d296 3
a298 3
	    label .ylbl -text "y"
	    entry .yentry -textvariable y_value
	    pack .ylbl .yentry -side left -in .yline
d301 3
a303 3
	    label .zlbl -text "z"
	    entry .zentry -textvariable z_value
	    pack .zlbl .zentry -side left -in .zline
d307 1
a307 1
	    label .view_lbl -text "View Coordinates"
d310 3
a312 3
	    label .hlbl -text "h"
	    entry .hentry -textvariable h_value
	    pack .hlbl .hentry -side left -in .hline
d315 3
a317 3
	    label .vlbl -text "v"
	    entry .ventry -textvariable v_value
	    pack .vlbl .ventry -side left -in .vline
d320 3
a322 3
	    label .dlbl -text "d"
	    entry .dentry -textvariable d_value
	    pack .dlbl .dentry -side left -in .dline
d331 1
a331 1
	    label .dir_lbl -text "Model Coordinates"
d334 3
a336 3
	    label .dxlbl -text "dx"
	    entry .dxentry -textvariable x_value
	    pack .dxlbl .dxentry -side left -in .dxline
d339 3
a341 3
	    label .dylbl -text "dy"
	    entry .dyentry -textvariable y_value
	    pack .dylbl .dyentry -side left -in .dyline
d344 3
a346 3
	    label .dzlbl -text "dz"
	    entry .dzentry -textvariable z_value
	    pack .dzlbl .dzentry -side left -in .dzline
d350 1
a350 1
	    label .az_el_lbl -text "Azimuth & Elevation"
d353 3
a355 3
	    label .az_lbl -text "az"
	    entry .az_entry -textvariable h_value
	    pack .az_lbl .az_entry -side left -in .az_line
d358 3
a360 3
	    label .el_lbl -text "el"
	    entry .el_entry -textvariable v_value
	    pack .el_lbl .el_entry -side left -in .el_line
@


1.1
log
@Initial revision
@
text
@d6 1
a6 1
wm title . "Nirt"
d85 25
a109 3
proc do_caliper_leg {leg} {
    global landmarkmode
    global cal_leg_loc
d111 14
a124 4
    if {$landmarkmode == {View center}} {
	set cal_leg_loc($leg) [_mged_viewget center]
    } elseif {$landmarkmode == {Model origin}} {
	set cal_leg_loc($leg) {0 0 0}
d126 5
a130 1
	set cal_leg_loc($leg) {1 2 3}
d132 5
a136 1
    calculate_distance
d213 3
@
