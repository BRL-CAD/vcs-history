head	11.6;
access;
symbols
	ansi-20040405-merged:11.4.2.1
	postmerge-20040405-ansi:11.5
	premerge-20040404-ansi:11.4
	postmerge-autoconf:11.4
	autoconf-freeze:11.4
	premerge-autoconf:11.4
	postmerge-20040315-windows:11.4
	premerge-20040315-windows:11.4
	windows-20040315-freeze:11.4
	autoconf-20031203:11.4
	autoconf-20031202:11.4
	autoconf-branch:11.4.0.10
	phong-branch:11.4.0.8
	photonmap-branch:11.4.0.6
	rel-6-1-DP:11.4
	windows-branch:11.4.0.4
	rel-6-0-2:11.2
	ansi-branch:11.4.0.2
	rel-6-0-1-branch:11.2.0.2
	hartley-6-0-post:11.3
	hartley-6-0-pre:11.2
	rel-6-0-1:11.2
	rel-6-0:11.2
	rel-5-4:11.1
	offsite-5-3-pre:11.2
	rel-5-3:11.1
	rel-5-2:11.1
	rel-5-1-branch:11.1.0.2
	rel-5-1:11.1
	rel-5-0:11.1
	rel-5-0-beta:11.1
	rel-4-5:11.1
	ctj-4-5-post:11.1
	ctj-4-5-pre:11.1
	rel-4-4:11.1
	rel-4-0:1.3;
locks; strict;
comment	@ * @;


11.6
date	2004.05.21.17.47.09;	author morrison;	state dead;
branches;
next	11.5;

11.5
date	2004.04.05.07.39.41;	author morrison;	state Exp;
branches;
next	11.4;

11.4
date	2002.08.20.17.08.30;	author jra;	state Exp;
branches
	11.4.2.1;
next	11.3;

11.3
date	2002.08.15.20.55.44;	author hartley;	state Exp;
branches;
next	11.2;

11.2
date	2000.08.24.23.10.01;	author mike;	state Exp;
branches;
next	11.1;

11.1
date	95.01.04.10.22.21;	author mike;	state Rel4_4;
branches;
next	1.3;

1.3
date	91.02.14.14.01.15;	author pjt;	state Exp;
branches;
next	1.2;

1.2
date	91.02.14.11.02.31;	author pjt;	state Exp;
branches;
next	1.1;

1.1
date	91.02.11.09.56.03;	author pjt;	state Exp;
branches;
next	;

11.4.2.1
date	2002.09.19.18.02.10;	author morrison;	state Exp;
branches;
next	;


desc
@@


11.6
log
@moved to src/nirt/
@
text
@/*			S H O W - S H O T . C
 *
 *	Filter output from NIRT(1) to generate an MGED(1) object
 *	representing a shotline through some geometry.
 *
 *		Written by:	Paul Tanenbaum
 *		Date:		4 December 1990
 *
 *		To compile:	cc -I/usr/include/brlcad source.c
 *
 *		R E V I S I O N   H I S T O R Y
 *
 *	    15 Jan 91	Eliminated the mandatory argument model.g
 *			from the command line.  The database name
 *			wasn't used anyway!
 *	    14 Feb 91	Added check to ensure that the names of
 *			the objects created won't exceed NAMESIZE,
 *			and added the '-n name' option.  Eliminated
 *			the '-d' debug option.
 */

#ifndef lint
static const char RCSid[] = "$Header: /n/xoff/cvs/brlcad/nirt/showshot.c,v 11.5 2004/04/05 07:39:41 morrison Exp $";
#endif

#include <stdio.h>
#include <strings.h>
#include <ctype.h>
#include <machine.h>
#include <vmath.h>
#include <db.h>

#define		BUF_LEN		128
#define		OPT_STRING	"n:r:?"
#define		RAY_COLOR	"255 255 0"
#define		print_usage()	(void) fputs("Usage: 'show-shot [-n name] [-r radius]'\n",\
					stderr)

main (int argc, char **argv)
{
    char	buf[BUF_LEN];	/* Contents of current input line */
    char	*bp;		/* Pointer into buf */
    char	*nlp;		/* Location of newline in buf */
    char	rname[BUF_LEN];	/* Name of current region */
    char	rayname[BUF_LEN];	/* Name of ray */
    fastf_t	ray_radius = 1.0;	/* Thickness of the RCC */
    point_t	entryp;		/* Ray's entry into current region */
    point_t	exitp;		/* Ray's exit from current region */
    point_t	first_entryp;	/* Ray's entry into the entire geometry */
    int		i;		/* Index into rname */
    int		line_nm = 0;	/* Number of current line of input */
    int		opt;		/* Command-line option returned by getopt() */
    int		pid = getpid();	/* Process ID for unique group name */

    extern char *optarg;
    extern int  optind, opterr;

    int         getopt(int, char *const *, const char *);

    *rayname = '\0';
    /* Handle command-line options */
    while ((opt = getopt(argc, argv, OPT_STRING)) != -1)
	switch (opt)
	{
	    case 'n':
		(void) strcpy(rayname, optarg);
		break;
	    case 'r':
		if (sscanf(optarg, "%F", &ray_radius) != 1)
		{
		    (void) fprintf(stderr, "Illegal radius: '%s'\n", optarg);
		    exit (1);
		}
		break;
	    case '?':
		print_usage();
		exit (1);
	}
    
    /* Ensure proper command-line syntax */
    if (optind != argc)
    {
	print_usage();
	exit (1);
    }

    /* Construct the names of the objects to add to the database */
    if (*rayname == '\0')	/* Was one given on command line? */
	(void) sprintf(rayname, "ray.%d", pid);
    if (strlen(rayname) > NAMESIZE - 3)
    {
	(void) fprintf(stderr,
	    "Name '%s.s' for ray solid may not exceed %d characters\n",
	    rayname, NAMESIZE - 1);
	(void) fputs("Use the '-n name' option to specify a different name\n",
	    stderr);
	exit (1);
    }
    (void) printf("in %s.s sph 0 0 0 1\n", rayname);
    (void) printf("r %s.r u %s.s\n", rayname, rayname);
    (void) printf("mater %s.r\n\n\n%s\n\n", rayname, RAY_COLOR);
    (void) printf("g %s", rayname);

    /* Read the input */
    while (fgets(buf, BUF_LEN, stdin) != NULL)
    {
	++line_nm;
	bp = buf;
	if ((nlp = index(bp, '\n')) != 0)
	    *nlp = '\0';

	/* Skip initial white space */
	while (isspace(*bp))
	    ++bp;
	
	/* Get region name */
	for (i = 0; ! isspace(*bp) && (*bp != '\0'); ++i, ++bp)
	    rname[i] = *bp;
	rname[i] = '\0';
	
	/* Read entry and exit coordinates for this partition */
	if (sscanf(bp, "%F%F%F%F%F%F",
		&entryp[X], &entryp[Y], &entryp[Z],
		&exitp[X], &exitp[Y], &exitp[Z])
	    != 6)
	{
	    (void) fprintf(stderr,
		"Illegal data on line %d: '%s'\n", line_nm, bp);
	    exit (1);
	}

	(void) printf(" %s", rname);

	if (line_nm == 1)
	{
	    VMOVE(first_entryp, entryp);
	}
    }
    if (! feof(stdin))
    {
	(void) fputs("Error from fgets().  This shouldn't happen", stderr);
	exit (1);
    }

    (void) printf("\nkill %s.s\nin %s.s rcc\n\t%f %f %f\n\t%f %f %f\n\t%f\n",
	rayname, rayname,
	first_entryp[X], first_entryp[Y], first_entryp[Z],
	exitp[X] - first_entryp[X],
	exitp[Y] - first_entryp[Y],
	exitp[Z] - first_entryp[Z],
	ray_radius);
    (void) printf("g %s %s.r\n", rayname, rayname);
    (void) fprintf(stderr, "Group is '%s'\n", rayname);
}
@


11.5
log
@merge of ansi-6-0-branch into HEAD
@
text
@d23 1
a23 1
static const char RCSid[] = "$Header$";
@


11.4
log
@Restoration of entire source tree to Pre-Hartley state
@
text
@d23 1
a23 1
static const char RCSid[] = "$Header: /c/CVS/brlcad/nirt/showshot.c,v 11.2 2000/08/24 23:10:01 mike Exp $";
d39 1
a39 5
main (argc, argv)

int	argc;
char	**argv;

d58 1
a58 1
    int         getopt();
@


11.4.2.1
log
@Initial ANSIfication
@
text
@d23 1
a23 1
static const char RCSid[] = "$Header: /c/CVS/brlcad/nirt/showshot.c,v 11.4 2002/08/20 17:08:30 jra Exp $";
d39 5
a43 1
main (int argc, char **argv)
d62 1
a62 1
    int         getopt(int, char *const *, const char *);
@


11.3
log
@Converted from K&R to ANSI C - RFH
@
text
@d39 5
a43 1
main (int argc, char **argv)
d62 1
a62 1
    int         getopt(int, char *const *, const char *);
@


11.2
log
@
lint
@
text
@d23 1
a23 1
static const char RCSid[] = "$Header: /c/CVS/brlcad/nirt/showshot.c,v 11.1 1995/01/04 10:22:21 mike Rel4_4 $";
d39 1
a39 5
main (argc, argv)

int	argc;
char	**argv;

d58 1
a58 1
    int         getopt();
@


11.1
log
@Release_4.4
@
text
@d23 1
a23 1
static char RCSid[] = "$Header: /m/cad/nirt/RCS/showshot.c,v 1.3 91/02/14 14:01:15 pjt Exp $";
@


1.3
log
@1. Added check to ensure that the names of the objects created
   won't exced NAMESIZE and added the '-n name' command-line
   option.
2. Eliminated the '-d' command-line option.
@
text
@d23 1
a23 1
static char RCSid[] = "$Header: /gsb/pjt/nirt/wshop/brlcad/RCS/show-shot.c,v 1.2 91/02/14 11:02:31 pjt Exp $";
@


1.2
log
@*** empty log message ***
@
text
@d16 4
d21 1
d23 1
a23 1
static char RCSid[] = "$Header$";
d28 1
d31 1
d34 1
a34 1
#define		OPT_STRING	"dr:?"
d36 1
a36 1
#define		print_usage()	fputs("Usage: 'show-shot [-d] [-r rad]'\n",\
d47 1
a47 1
    char	gname[BUF_LEN];	/* Name of the group */
d49 2
a50 2
    char	rayname[BUF_LEN];/* Name of ray */
    fastf_t	ray_radius=1.0;	/* Thickness of the RCC */
a53 1
    int		debug = 0;	/* Show actions instead of performing them? */
d64 1
d69 2
a70 2
	    case 'd':
		debug = 1;
d75 1
a75 1
		    fprintf(stderr, "Illegal radius: '%s'\n", optarg);
d85 1
a85 1
    if (! debug && (argc != optind))
d91 16
a106 7
    /* Construct the name of the group in which the results will be put */
    sprintf(rayname, "nirt.ray.%d", pid);
    printf("in %s.s sph 0 0 0 1\n", rayname);
    printf("r %s.r u %s.s\n", rayname, rayname);
    printf("mater %s.r\n\n\n%s\n\n", rayname, RAY_COLOR);
    sprintf(gname, "nirt.%d", pid);
    printf("g %s", gname);
a110 2
	char	*nlp;	/* Location of newline in buf */

d131 2
a132 1
	    fprintf(stderr, "Illegal data on line %d: '%s'\n", line_nm, bp);
d136 2
a137 6
	printf(" %s", rname);
#if 0
	printf("entered %s at (%f, %f, %f) and exited at (%f, %f, %f)\n",
	    rname, entryp[X], entryp[Y], entryp[Z], exitp[X], exitp[Y], exitp[Z]);
#endif
	
d145 1
a145 1
	fputs("Error from fgets().  This shouldn't happen", stderr);
d149 1
a149 1
    printf("\nkill %s.s\nin %s.s rcc\n\t%f %f %f\n\t%f %f %f\n\t%f\n",
d156 2
a157 2
    printf("g %s %s.r\n", gname, rayname);
    fprintf(stderr, "Group is '%s'\n", gname);
@


1.1
log
@Initial revision
@
text
@d17 3
@
