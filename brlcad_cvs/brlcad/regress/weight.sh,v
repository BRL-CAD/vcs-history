head	14.17;
access;
symbols
	rel-7-10-4:14.14
	STABLE:14.14.0.2
	rel-7-10-2:14.14
	rel-7-10-0:14.12
	rel-7-8-4:14.9
	rel-7-8-2:14.9
	rel-7-8-0:14.7
	trimnurbs-branch:14.7.0.2
	help:14.7
	temp_tag:14.7
	bobWinPort-20051223-freeze:14.3
	postmerge-20051223-bobWinPort:14.7
	premerge-20051223-bobWinPort:14.7
	rel-7-6-6:14.7
	rel-7-6-4:14.7
	rel-7-6-2:14.6
	rel-7-6-branch:14.6.0.2
	rel-7-6-0:14.6
	rel-7-4-2:14.3
	rel-7-4-branch:14.3.0.4
	bobWinPort:14.3.0.2
	rel-7-4-0:14.3
	rel-7-2-6:14.2
	rel-7-2-4:14.2;
locks; strict;
comment	@# @;


14.17
date	2007.10.22.04.36.21;	author brlcad;	state Exp;
branches;
next	14.16;

14.16
date	2007.10.14.05.31.15;	author brlcad;	state Exp;
branches;
next	14.15;

14.15
date	2007.09.14.15.21.01;	author erikgreenwald;	state Exp;
branches;
next	14.14;

14.14
date	2007.06.03.17.17.38;	author brlcad;	state Exp;
branches;
next	14.13;

14.13
date	2007.06.03.06.32.53;	author brlcad;	state Exp;
branches;
next	14.12;

14.12
date	2007.02.06.16.43.10;	author brlcad;	state Exp;
branches;
next	14.11;

14.11
date	2007.02.06.16.41.24;	author brlcad;	state Exp;
branches;
next	14.10;

14.10
date	2007.01.27.00.31.38;	author brlcad;	state Exp;
branches;
next	14.9;

14.9
date	2006.04.20.21.45.09;	author lbutler;	state Exp;
branches;
next	14.8;

14.8
date	2006.04.20.15.19.53;	author lbutler;	state Exp;
branches;
next	14.7;

14.7
date	2005.10.23.04.44.27;	author brlcad;	state Exp;
branches;
next	14.6;

14.6
date	2005.08.25.20.16.23;	author lbutler;	state Exp;
branches
	14.6.2.1;
next	14.5;

14.5
date	2005.08.25.18.40.45;	author lbutler;	state Exp;
branches;
next	14.4;

14.4
date	2005.08.25.04.18.31;	author lbutler;	state Exp;
branches;
next	14.3;

14.3
date	2005.07.13.01.11.32;	author brlcad;	state Exp;
branches;
next	14.2;

14.2
date	2005.05.04.02.44.40;	author brlcad;	state Exp;
branches;
next	14.1;

14.1
date	2005.04.23.15.19.20;	author lbutler;	state Exp;
branches;
next	;

14.6.2.1
date	2005.11.13.13.46.10;	author brlcad;	state Exp;
branches;
next	;


desc
@@


14.17
log
@more consistent echo output
@
text
@#!/bin/sh

LD_LIBRARY_PATH=../src/other/tcl/unix:../src/other/tk/unix:$$LD_LIBRARY_PATH
DYLD_LIBRARY_PATH=../src/other/tcl/unix:../src/other/tk/unix:$$DYLD_LIBRARY_PATH
export LD_LIBRARY_PATH DYLD_LIBRARY_PATH

TOP_SRCDIR=$1

rm -f weight.log .density weight.g weight.ref weight.out weight.mged

cat > weight.mged <<EOF
opendb weight.g y
units cm
in box rpp 0 1 0 1 0 1
r box.r u box
EOF

../src/mged/mged -c > weight.log 2>&1 << EOF
`cat weight.mged`
EOF

cat > .density <<EOF
1 7.8295        steel
EOF

../src/rt/rtweight -a 25 -e 35 -s128 -o weight.out weight.g box.r > weight.log 2>&1


cat >> weight.ref <<EOF
RT Weight Program Output:

Database Title: "Untitled BRL-CAD Database"
Time Stamp: Day Mon  0 00:00:00 0000


Density Table Used:/path/to/.density

Material  Density(g/cm^3)  Name
    1         7.8295       steel
Weight by region (in grams, density given in g/cm^3):

  Weight Matl LOS  Material Name  Density Name
 ------- ---- --- --------------- ------- -------------
   7.829    1 100 steel            7.8295 /box.r
Weight by item number (in grams):

Item  Weight  Region Names
---- -------- --------------------
1000    7.829 /box.r
RT Weight Program Output:

Database Title: "Untitled BRL-CAD Database"
Time Stamp: Day Mon  0 00:00:00 0000


Total volume = 0.999991 cm.^3

Centroid: X = 0.5 cm.
          Y = 0.5 cm.
          Z = 0.5 cm.

Total mass = 7.82943 grams

EOF

tr -d ' \t' < weight.ref | grep -v DensityTableUsed | grep -v TimeStamp > weight.ref_ns
tr -d ' \t' < weight.out | grep -v DensityTableUsed | grep -v TimeStamp > weight.out_ns

cmp weight.ref_ns weight.out_ns
STATUS=$?
if [ X$STATUS != X0 ] ; then
    echo "rtweight results differ $STATUS"
fi

rm -f weight.out_ns weight.ref_ns

if [ X$STATUS = X0 ] ; then
    echo "-> weight.sh succeeded"
else
    echo "-> weight.sh FAILED"
fi

exit $STATUS

# Local Variables:
# mode: sh
# tab-width: 8
# sh-indentation: 4
# sh-basic-offset: 4
# indent-tabs-mode: t
# End:
# ex: shiftwidth=4 tabstop=8
@


14.16
log
@emphasize the result if it's a failure
@
text
@d78 1
a78 1
    /bin/echo '-> weight.sh succeeded'
d80 1
a80 1
    /bin/echo '-> weight.sh FAILED'
@


14.15
log
@removed trailing whitespace
@
text
@d80 1
a80 1
    /bin/echo '-> weight.sh failed'
d83 1
d85 8
a92 1
exit $STATUS
@


14.14
log
@move more of the mged scripts to their own files so that segfault failures on linux are more brief.
@
text
@d44 1
a44 1
   7.829    1 100 steel            7.8295 /box.r                               
d49 1
a49 1
1000    7.829 /box.r                                                           
@


14.13
log
@set the ld_library_path so the binaries invoked by the test can find the tcl/tk libraries.
@
text
@d9 1
a9 1
rm -f weight.log .density weight.g weight.ref weight.out
d11 1
a11 1
../src/mged/mged -c > weight.log 2>&1 << EOF
d18 4
@


14.12
log
@use name of script as prefix, not wgt
@
text
@d3 3
@


14.11
log
@update script being used for comparison.  whitespace differences cause the test to fail where it should succeed.  include timestamp lines and the density table lines since the script strips them anyways, otherwise a whitespace script might collapse too many consecutive blank lines.
@
text
@d6 1
a6 1
rm -f weight.log .density wgt.out weight.g weight.ref weight.out
d19 1
a19 1
../src/rt/rtweight -a 25 -e 35 -s128 -o wgt.out weight.g box.r > weight.log 2>&1
d60 1
a60 1
tr -d ' \t' < wgt.out | grep -v DensityTableUsed | grep -v TimeStamp > wgt.out_ns
d62 1
a62 1
cmp weight.ref_ns wgt.out_ns
d68 1
a68 1
rm -f wgt.out_ns weight.ref_ns
@


14.10
log
@ws, test two
@
text
@d26 1
d29 2
d37 1
a37 1
   7.829    1 100 steel            7.8295 /box.r
d42 1
a42 1
1000    7.829 /box.r
d46 1
d52 2
a53 2
	  Y = 0.5 cm.
	  Z = 0.5 cm.
@


14.9
log
@Fixed various sh/csh syntax errrors.
@
text
@d16 1
a16 1
1 7.8295	steel
a27 1

d48 2
a49 2
          Y = 0.5 cm.
          Z = 0.5 cm.
@


14.8
log
@Updates to make it easier to check the status of a regression test.  Each test
now reports its notion of whether it succeeded or failed.
@
text
@d67 1
a67 1
if [ $STATUS == 0 ] ; then
d71 1
a71 1
endif
@


14.7
log
@trailing ws
@
text
@d67 7
@


14.6
log
@Miscelaneous bug fixes.
@
text
@d16 1
a16 1
1 7.8295	steel	
d35 1
a35 1
   7.829    1 100 steel            7.8295 /box.r                               
d40 1
a40 1
1000    7.829 /box.r                                                           
@


14.6.2.1
log
@merge changes from HEAD aka rel-7-6-4 to the rel-7-6-branch just in case someone peeks a gander or tries to continue/build the branch
@
text
@d16 1
a16 1
1 7.8295	steel
d35 1
a35 1
   7.829    1 100 steel            7.8295 /box.r
d40 1
a40 1
1000    7.829 /box.r
@


14.5
log
@Getting the nightly tests to work.
Making the scripts report an exit code when things go wrong.
@
text
@a54 6
ref_values="`grep 0 weight.ref | grep -v 'Time Stamp' | sed 's/ 	//g'`"
echo x$ref_values > asdf
if [ "x$ref_values" = "x" ] ; then
    echo "rtweight benchmark failed"
    exit -1
fi
d56 7
a62 5
out_values="`grep 0 wgt.out | grep -v 'Time Stamp' | sed 's/ 	//g'`"
echo x$out_values > fdsa
if [ "x$out_values" = "x" ] ; then
    echo "rtweight benchmark failed (script error)"
    exit -1
d65 1
a65 5
if  [ "x$ref_values" != "x$out_values" ] ; then
	echo "rtweight benchmark failed unequal"
     exit -1
fi
echo "match"
d67 1
a67 1
exit 0
@


14.4
log
@updates so that regression tests run against build tree, not install dir.
Can now be run from build dir other than in source tree.
@
text
@d59 1
d66 1
d71 1
a71 2
else
	echo "match"
d73 3
@


14.3
log
@fix the comparison checks so that they are not whitespace dependant or otherwise so sensitive to simple formatting changes
@
text
@d3 2
a4 2
PREFIX=$1
TOP_SRCDIR=$2
d8 1
a8 1
$PREFIX/bin/mged -c > weight.log 2>&1 << EOF
d19 1
a19 1
$PREFIX/bin/rtweight -a 25 -e 35 -s128 -o wgt.out weight.g box.r > weight.log 2>&1
d55 2
a56 1
ref_values="`grep 0 weight.ref | grep -v 'Time Stamp' | sed 's/ //g'`"
d61 2
a62 1
out_values="`grep 0 wgt.out | grep -v 'Time Stamp' | sed 's/[ \t]//g'`"
d68 1
a68 1
	echo "rtweight benchmark failed"
@


14.2
log
@don't compare the density table line too since it contains a specific path
@
text
@d55 4
a58 1
grep -v "Time Stamp" wgt.out | grep -v "Density Table Used" > weight.out
d60 4
a63 1
cmp -s weight.out weight.ref
d65 1
a65 1
if  [ X$? = X1 ] ; then
@


14.1
log
@added regression test for rtweight.
@
text
@a27 1
Density Table Used:/Users/butler/src/BRLCAD/brlcad/regress/.density
d55 1
a55 1
grep -v Time wgt.out > weight.out
@

