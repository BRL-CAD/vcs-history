head	11.15;
access;
symbols
	ansi-20040405-merged:11.12.2.1
	postmerge-20040405-ansi:11.13
	premerge-20040404-ansi:11.12
	postmerge-autoconf:11.12
	autoconf-freeze:11.12
	premerge-autoconf:11.12
	postmerge-20040315-windows:11.12
	premerge-20040315-windows:11.12
	windows-20040315-freeze:11.12
	autoconf-20031203:11.12
	autoconf-20031202:11.12
	autoconf-branch:11.12.0.10
	phong-branch:11.12.0.8
	photonmap-branch:11.12.0.6
	rel-6-1-DP:11.12
	windows-branch:11.12.0.4
	rel-6-0-2:11.10
	ansi-branch:11.12.0.2
	rel-6-0-1-branch:11.10.0.2
	hartley-6-0-post:11.11
	hartley-6-0-pre:11.10
	rel-6-0-1:11.10
	rel-6-0:11.9
	rel-5-4:11.2
	offsite-5-3-pre:11.8
	rel-5-3:11.2
	rel-5-2:11.2
	rel-5-1-branch:11.2.0.2
	rel-5-1:11.2
	rel-5-0:11.1
	rel-5-0-beta:11.1
	rel-4-5:11.1
	ctj-4-5-post:11.1
	ctj-4-5-pre:11.1
	rel-4-4:11.1
	rel-4-0:10.1
	rel-3-5:9.1
	rel-3-0:8.1;
locks; strict;
comment	@ * @;


11.15
date	2004.05.21.17.33.43;	author morrison;	state dead;
branches;
next	11.14;

11.14
date	2004.05.10.15.30.49;	author erikg;	state Exp;
branches;
next	11.13;

11.13
date	2004.04.05.05.45.58;	author morrison;	state Exp;
branches;
next	11.12;

11.12
date	2002.08.20.17.08.34;	author jra;	state Exp;
branches
	11.12.2.1;
next	11.11;

11.11
date	2002.08.15.20.55.46;	author hartley;	state Exp;
branches;
next	11.10;

11.10
date	2002.05.17.12.42.24;	author morrison;	state Exp;
branches;
next	11.9;

11.9
date	2001.03.31.01.57.27;	author morrison;	state Exp;
branches;
next	11.8;

11.8
date	2000.08.24.04.37.33;	author mike;	state Exp;
branches;
next	11.7;

11.7
date	2000.07.12.21.59.07;	author mike;	state Exp;
branches;
next	11.6;

11.6
date	2000.07.12.03.16.33;	author mike;	state Exp;
branches;
next	11.5;

11.5
date	2000.07.10.23.46.49;	author mike;	state Exp;
branches;
next	11.4;

11.4
date	2000.07.10.23.38.21;	author mike;	state Exp;
branches;
next	11.3;

11.3
date	2000.07.10.23.35.38;	author mike;	state Exp;
branches;
next	11.2;

11.2
date	2000.03.31.03.07.31;	author mike;	state Exp;
branches;
next	11.1;

11.1
date	95.01.04.10.06.11;	author mike;	state Rel4_4;
branches;
next	10.4;

10.4
date	94.11.14.22.12.27;	author mike;	state Exp;
branches;
next	10.3;

10.3
date	94.10.21.20.05.53;	author mike;	state Exp;
branches;
next	10.2;

10.2
date	94.08.09.19.10.45;	author gdurf;	state Exp;
branches;
next	10.1;

10.1
date	91.10.12.06.44.36;	author mike;	state Rel4_0;
branches;
next	9.2;

9.2
date	90.11.01.05.15.05;	author mike;	state Exp;
branches;
next	9.1;

9.1
date	89.05.19.06.04.42;	author mike;	state Rel3_5;
branches;
next	8.2;

8.2
date	89.04.30.21.33.44;	author mike;	state Exp;
branches;
next	8.1;

8.1
date	88.10.05.00.38.16;	author mike;	state Rel3_0;
branches;
next	1.3;

1.3
date	88.08.20.07.26.31;	author phil;	state Exp;
branches;
next	1.2;

1.2
date	88.05.15.23.00.13;	author mike;	state Exp;
branches;
next	1.1;

1.1
date	87.12.24.06.56.16;	author mike;	state Exp;
branches;
next	;

11.12.2.1
date	2002.09.19.18.02.12;	author morrison;	state Exp;
branches;
next	;


desc
@Common routines for clutter, room
@


11.15
log
@moved to src/proc-db/
@
text
@/*
 *			C O M M O N . C
 * 
 *  Subroutines common to several procedural database generators.
 *
 *  Author -
 *	Michael John Muuss
 *  
 *  Source -
 *	SECAD/VLD Computing Consortium, Bldg 394
 *	The U. S. Army Ballistic Research Laboratory
 *	Aberdeen Proving Ground, Maryland  21005-5066
 *  
 *  Copyright 
 *	This software is Copyright (C) 1986,1988 by the United States Army.
 *	All rights reserved.
 */
#ifndef lint
static const char RCSid[] = "@@(#)$Header: /n/xoff/cvs/brlcad/proc-db/common.c,v 11.14 2004/05/10 15:30:49 erikg Exp $ (BRL)";
#endif

#ifdef HAVE_CONFIG_H
# include "config.h"
#endif



#include <stdio.h>
#include <math.h>
#include "machine.h"
#include "vmath.h"
#include "raytrace.h"
#include "wdb.h"

extern struct rt_wdb	*outfp;

struct colors {
	char		*name;
	unsigned char	c_pixel[3];
}colortab[] = {
	{"black",	{20,20,20}},
	{"blue",	{0,0,255}},
	{"brown",	{200,130,0}},
	{"cyan",	{0,255,200}},
	{"flesh",	{255,200,160}},
	{"gray",	{120,120,120}},
	{"green",	{0,255,0}},
	{"lime", 	{200,255,0}},
	{"magenta",	{255,0,255}},
	{"olive",	{220,190,0}},
	{"orange",	{255,100,0}},
	{"pink",	{255,200,200}},
	{"red",		{255,0,0}},
	{"rose",	{255,0,175}},
	{"rust",	{200,100,0}},
	{"silver",	{237,237,237}},
	{"sky",		{0,255,255}},
	{"violet",	{200,0,255}},
	{"white",	{255,255,255}},
	{"yellow",	{255,200,0}},
	{"",		{0,0,0}}
};
int	ncolors = sizeof(colortab)/sizeof(struct colors);
int	curcolor = 0;

void
get_rgb( unsigned char *rgb )
{
	register struct colors *cp;
	if( ++curcolor >= ncolors )  curcolor = 0;
	cp = &colortab[curcolor];
	rgb[0] = cp->c_pixel[0];
	rgb[1] = cp->c_pixel[1];
	rgb[2] = cp->c_pixel[2];
}

void
do_light(char *name, fastf_t *pos, fastf_t *dir_at, int da_flag, double r, unsigned char *rgb, struct wmember *headp)
    	      
       	    
      	       		/* direction or aim point */
   	        	/* 0 = direction, !0 = aim point */
      	  		/* radius of light */
             	     
              	       
{
	char	nbuf[64];
	vect_t	center;
	mat_t	rot;
	mat_t	xlate;
	mat_t	both;
	vect_t	from;
	vect_t	dir;

	if( da_flag )  {
		VSUB2( dir, dir_at, pos );
		VUNITIZE( dir );
	} else {
		VMOVE( dir, dir_at );
	}

	sprintf( nbuf, "%s.s", name );
	VSETALL( center, 0 );
	mk_sph( outfp, nbuf, center, r );

	/*
	 * Need to rotate from 0,0,-1 to vect "dir",
	 * then xlate to final position.
	 */
	VSET( from, 0, 0, -1 );
	bn_mat_fromto( rot, from, dir );
	MAT_IDN( xlate );
	MAT_DELTAS( xlate, pos[X], pos[Y], pos[Z] );
	bn_mat_mul( both, xlate, rot );

	mk_region1( outfp, name, nbuf, "light", "shadows=1", rgb );
	(void)mk_addmember( name, &(headp->l), NULL, WMOP_UNION );
}
@


11.14
log
@change conf.h to a wrapped config.h
@
text
@d19 1
a19 1
static const char RCSid[] = "@@(#)$Header: /cvs/brlcad/proc-db/common.c,v 11.13 2004/04/05 05:45:58 morrison Exp $ (BRL)";
@


11.13
log
@merge of ansi-6-0-branch into head
@
text
@d19 1
a19 1
static const char RCSid[] = "@@(#)$Header$ (BRL)";
d22 5
a26 1
#include "conf.h"
@


11.12
log
@Restoration of entire source tree to Pre-Hartley state
@
text
@d19 1
a19 1
static const char RCSid[] = "@@(#)$Header: /c/CVS/brlcad/proc-db/common.c,v 11.10 2002/05/17 12:42:24 morrison Exp $ (BRL)";
d74 8
a81 8
do_light( name, pos, dir_at, da_flag, r, rgb, headp )
char	*name;
point_t	pos;
vect_t	dir_at;		/* direction or aim point */
int	da_flag;	/* 0 = direction, !0 = aim point */
double	r;		/* radius of light */
unsigned char	*rgb;
struct wmember	*headp;
@


11.12.2.1
log
@Initial ANSIfication
@
text
@d19 1
a19 1
static const char RCSid[] = "@@(#)$Header: /c/CVS/brlcad/proc-db/common.c,v 11.12 2002/08/20 17:08:34 jra Exp $ (BRL)";
d74 8
a81 8
do_light(char *name, fastf_t *pos, fastf_t *dir_at, int da_flag, double r, unsigned char *rgb, struct wmember *headp)
    	      
       	    
      	       		/* direction or aim point */
   	        	/* 0 = direction, !0 = aim point */
      	  		/* radius of light */
             	     
              	       
@


11.11
log
@Converted from K&R to ANSI C - RFH
@
text
@d74 8
a81 8
do_light(char *name, fastf_t *pos, fastf_t *dir_at, int da_flag, double r, unsigned char *rgb, struct wmember *headp)
    	      
       	    
      	       		/* direction or aim point */
   	        	/* 0 = direction, !0 = aim point */
      	  		/* radius of light */
             	     
              	       
@


11.10
log
@added matrix parameter to mk_addmember()
@
text
@d19 1
a19 1
static const char RCSid[] = "@@(#)$Header: /c/CVS/brlcad/proc-db/common.c,v 11.9 2001/03/31 01:57:27 morrison Exp $ (BRL)";
d74 8
a81 8
do_light( name, pos, dir_at, da_flag, r, rgb, headp )
char	*name;
point_t	pos;
vect_t	dir_at;		/* direction or aim point */
int	da_flag;	/* 0 = direction, !0 = aim point */
double	r;		/* radius of light */
unsigned char	*rgb;
struct wmember	*headp;
@


11.9
log
@Deprecated bn_mat_idn() and bn_mat_zero(), updated calls to h/vmath.h's MAT_IDN() and MAT_ZERO() performance improved macros.
@
text
@d19 1
a19 1
static const char RCSid[] = "@@(#)$Header: /c/CVS/brlcad/proc-db/common.c,v 11.8 2000/08/24 04:37:33 mike Exp $ (BRL)";
d113 1
a113 1
	(void)mk_addmember( name, &(headp->l), WMOP_UNION );
@


11.8
log
@
mk_addmember
@
text
@d19 1
a19 1
static const char RCSid[] = "@@(#)$Header: /c/CVS/brlcad/proc-db/common.c,v 11.7 2000/07/12 21:59:07 mike Exp $ (BRL)";
d108 1
a108 1
	bn_mat_idn( xlate );
@


11.7
log
@
Converted to use new version of LIBWDB.
@
text
@d19 1
a19 1
static const char RCSid[] = "@@(#)$Header: /c/CVS/brlcad/proc-db/common.c,v 11.6 2000/07/12 03:16:33 mike Exp $ (BRL)";
d113 1
a113 1
	(void)mk_addmember( name, headp, WMOP_UNION );
@


11.6
log
@
Modified to use mk_region1() instead of old routines
@
text
@d19 1
a19 1
static const char RCSid[] = "@@(#)$Header: /c/CVS/brlcad/proc-db/common.c,v 11.5 2000/07/10 23:46:49 mike Exp $ (BRL)";
d31 1
d63 1
a63 2
get_rgb( rgb )
register unsigned char	*rgb;
d100 1
a100 1
	mk_sph( stdout, nbuf, center, r );
d112 1
a112 1
	mk_region1( stdout, name, nbuf, "light", "shadows=1", rgb );
@


11.5
log
@
lint
@
text
@d19 1
a19 1
static const char RCSid[] = "@@(#)$Header: /c/CVS/brlcad/proc-db/common.c,v 11.4 2000/07/10 23:38:21 mike Exp $ (BRL)";
d112 1
a112 2
	mk_comb( stdout, name, 1, 1, "light", "shadows=1", rgb, 0 );
	mk_memb( stdout, nbuf, both, WMOP_UNION );
@


11.4
log
@
const RCSid
@
text
@d19 1
a19 1
static const char RCSid[] = "@@(#)$Header: /c/CVS/brlcad/proc-db/common.c,v 11.3 2000/07/10 23:35:38 mike Exp $ (BRL)";
d36 21
a56 20
	"black",	20,20,20,
	"blue",		0,0,255,
	"brown",	200,130,0,
	"cyan",		0,255,200,
	"flesh",	255,200,160,
	"gray",		120,120,120,
	"green",	0,255,0,
	"lime", 	200,255,0,
	"magenta",	255,0,255,
	"olive",	220,190,0,
	"orange",	255,100,0,
	"pink",		255,200,200,
	"red",		255,0,0,
	"rose",		255,0,175,
	"rust",		200,100,0,
	"silver",	237,237,237,
	"sky",		0,255,255,
	"violet",	200,0,255,
	"white",	255,255,255,
	"yellow",	255,200,0
@


11.3
log
@
raytrace.h before wdb.h
Eliminated use of db.h
@
text
@d19 1
a19 1
static char RCSid[] = "@@(#)$Header: /c/CVS/brlcad/proc-db/common.c,v 11.2 2000/03/31 03:07:31 mike Exp $ (BRL)";
@


11.2
log
@
Changed RT_ to BU_ / BN_
@
text
@d19 1
a19 1
static char RCSid[] = "@@(#)$Header: /c/CVS/brlcad/proc-db/common.c,v 11.1 1995/01/04 10:06:11 mike Rel4_4 $ (BRL)";
a26 1
#include "db.h"
d28 1
d112 1
a112 1
	mk_memb( stdout, nbuf, both, UNION );
@


11.1
log
@Release_4.4
@
text
@d19 1
a19 1
static char RCSid[] = "@@(#)$Header: /m/cad/proc-db/RCS/common.c,v 10.4 94/11/14 22:12:27 mike Exp $ (BRL)";
d106 2
a107 2
	mat_fromto( rot, from, dir );
	mat_idn( xlate );
d109 1
a109 1
	mat_mul( both, xlate, rot );
@


10.4
log
@Irix 6
@
text
@d19 1
a19 1
static char RCSid[] = "@@(#)$Header: /m/cad/proc-db/RCS/common.c,v 10.3 94/10/21 20:05:53 mike Exp Locker: mike $ (BRL)";
@


10.3
log
@rgb is unsigned char now.
@
text
@d19 1
a19 1
static char RCSid[] = "@@(#)$Header: /m/cad/proc-db/RCS/common.c,v 10.2 94/08/09 19:10:45 gdurf Exp Locker: mike $ (BRL)";
a86 2
	vect_t	begin;
	vect_t	trial;
@


10.2
log
@Added include of conf.h
@
text
@d19 1
a19 1
static char RCSid[] = "@@(#)$Header: /m/cad/proc-db/RCS/common.c,v 10.1 1991/10/12 06:44:36 mike Rel4_0 gdurf $ (BRL)";
d62 1
a62 1
register char	*rgb;
d79 1
a79 1
char	*rgb;
@


10.1
log
@Release_4.0
@
text
@d19 1
a19 1
static char RCSid[] = "@@(#)$Header: /m/cad/proc-db/RCS/common.c,v 9.2 90/11/01 05:15:05 mike Exp $ (BRL)";
d21 2
@


9.2
log
@Changed calling sequence to mk_addmember().  Added boolean op as 3rd arg.
@
text
@d19 1
a19 1
static char RCSid[] = "@@(#)$Header: /m/cad/proc-db/RCS/common.c,v 9.1 89/05/19 06:04:42 mike Rel3_5 $ (BRL)";
@


9.1
log
@Release_3.5
@
text
@d19 1
a19 1
static char RCSid[] = "@@(#)$Header: common.c,v 8.2 89/04/30 21:33:44 mike Exp $ (BRL)";
d113 1
a113 1
	(void)mk_addmember( name, headp );
@


8.2
log
@No longer requires mathtab.h
@
text
@d19 1
a19 1
static char RCSid[] = "@@(#)$Header: common.c,v 8.1 88/10/05 00:38:16 mike Locked $ (BRL)";
@


8.1
log
@Release_3.0
@
text
@d19 1
a19 1
static char RCSid[] = "@@(#)$Header: common.c,v 1.3 88/08/20 07:26:31 phil Exp $ (BRL)";
a27 2

#include "../rt/mathtab.h"
@


1.3
log
@libwdb changes
@
text
@d19 1
a19 1
static char RCSid[] = "@@(#)$Header: common.c,v 1.2 88/05/15 23:00:13 phil Locked $ (BRL)";
@


1.2
log
@lint fixes
@
text
@d19 1
a19 1
static char RCSid[] = "@@(#)$Header: common.c,v 1.1 87/12/24 06:56:16 mike Locked $ (BRL)";
d113 1
a113 1
	mk_mcomb( stdout, name, 1, 1, "light", "shadows=1", 1, rgb );
@


1.1
log
@Initial revision
@
text
@d19 1
a19 1
static char RCSid[] = "@@(#)$Header: clutter.c,v 1.7 87/10/30 15:34:11 mike Exp $ (BRL)";
d60 1
d72 1
a116 2

rt_log(str) {fprintf(stderr,"rt_log: %s\n", str);}
@
