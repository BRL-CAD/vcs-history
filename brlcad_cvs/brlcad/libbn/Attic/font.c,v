head	11.14;
access;
symbols
	ansi-20040405-merged:11.11.2.1
	postmerge-20040405-ansi:11.12
	premerge-20040404-ansi:11.11
	postmerge-autoconf:11.11
	autoconf-freeze:11.11
	premerge-autoconf:11.11
	ansi-20040316-freeze:11.11.2.1
	postmerge-20040315-windows:11.11
	premerge-20040315-windows:11.11
	windows-20040315-freeze:11.11
	autoconf-20031203:11.11
	autoconf-20031202:11.11
	autoconf-branch:11.11.0.10
	phong-branch:11.11.0.8
	photonmap-branch:11.11.0.6
	rel-6-1-DP:11.11
	windows-branch:11.11.0.4
	rel-6-0-2:11.9
	ansi-branch:11.11.0.2
	rel-6-0-1-branch:11.9.0.2
	hartley-6-0-post:11.10
	hartley-6-0-pre:11.9
	rel-6-0-1:11.9
	rel-6-0:11.9
	rel-5-4:11.5
	offsite-5-3-pre:11.7
	rel-5-3:11.5
	rel-5-2:11.5
	rel-5-1-branch:11.5.0.2
	rel-5-1:11.5
	rel-5-0:11.5
	rel-5-0-beta:11.4
	rel-4-5:11.2
	ctj-4-5-post:11.2
	ctj-4-5-pre:11.2
	rel-4-4:11.1;
locks; strict;
comment	@ * @;


11.14
date	2004.05.21.18.06.22;	author morrison;	state dead;
branches;
next	11.13;

11.13
date	2004.05.10.15.30.43;	author erikg;	state Exp;
branches;
next	11.12;

11.12
date	2004.04.05.07.46.41;	author morrison;	state Exp;
branches;
next	11.11;

11.11
date	2002.08.20.17.07.36;	author jra;	state Exp;
branches
	11.11.2.1;
next	11.10;

11.10
date	2002.08.15.20.54.48;	author hartley;	state Exp;
branches;
next	11.9;

11.9
date	2001.04.20.22.29.01;	author morrison;	state Exp;
branches;
next	11.8;

11.8
date	2001.03.31.01.56.48;	author morrison;	state Exp;
branches;
next	11.7;

11.7
date	2000.10.18.18.10.32;	author butler;	state Exp;
branches;
next	11.6;

11.6
date	2000.07.11.23.30.38;	author cjohnson;	state Exp;
branches;
next	11.5;

11.5
date	99.07.02.19.11.25;	author mike;	state Exp;
branches;
next	11.4;

11.4
date	99.05.27.21.52.12;	author mike;	state Exp;
branches;
next	11.3;

11.3
date	99.05.27.19.16.26;	author mike;	state Exp;
branches;
next	11.2;

11.2
date	97.01.08.03.35.48;	author mike;	state Exp;
branches;
next	11.1;

11.1
date	95.01.04.09.56.25;	author mike;	state Rel4_4;
branches;
next	1.5;

1.5
date	94.11.04.05.42.20;	author mike;	state Exp;
branches;
next	1.4;

1.4
date	94.08.10.18.22.50;	author gdurf;	state Exp;
branches;
next	1.3;

1.3
date	94.03.18.01.04.58;	author mike;	state Exp;
branches;
next	1.2;

1.2
date	94.01.14.13.14.41;	author jra;	state Exp;
branches;
next	1.1;

1.1
date	94.01.12.17.58.44;	author mike;	state Exp;
branches;
next	;

11.11.2.1
date	2002.09.19.18.01.08;	author morrison;	state Exp;
branches;
next	;


desc
@Routines for making vector fonts in vlist, out of character strings.
@


11.14
log
@moved to src/
@
text
@/*
 *			F O N T . C
 *
 *  Author -
 *	Michael John Muuss
 *	John Anderson
 *  
 *  Source -
 *	The U. S. Army Research Laboratory
 *	Aberdeen Proving Ground, Maryland  21005-5068  USA
 *  
 *  Distribution Status -
 *	Public Domain, Distribution Unlimitied.
 */
#ifndef lint
static const char RCSid[] = "@@(#)$Header: /n/xoff/cvs/brlcad/libbn/font.c,v 11.13 2004/05/10 15:30:43 erikg Exp $ (ARL)";
#endif

#ifdef HAVE_CONFIG_H
# include "config.h"
#endif



#include <stdio.h>
#include <math.h>
#ifdef HAVE_STRING_H
#include <string.h>
#endif

#include "machine.h"
#include "vmath.h"
#include "bu.h"
#include "bn.h"
#include "vectfont.h"

/* References tp_xxx symbols from libbn/vectfont.c */

/*
 *			B N _ V L I S T _ 3 S T R I N G
 *
 *  'scale' is the width, in mm, of one character.
 */
void
bn_vlist_3string(struct bu_list *vhead, struct bu_list *free_hd, const char *string, const fastf_t *origin, const fastf_t *rot, double scale)
              	       
              	         	/* source of free vlists */
          	        	/* string of chars to be plotted */
             	       		/* lower left corner of 1st char */
           	    		/* Transform matrix (WARNING: may xlate) */
      		      		/* scale factor to change 1x1 char sz */
{
	register unsigned char *cp;
	double	offset;			/* offset of char from given x,y */
	int	ysign;			/* sign of y motion, either +1 or -1 */
	vect_t	temp;
	vect_t	loc;
	mat_t	xlate_to_origin;
	mat_t	mat;

	if( string == NULL || *string == '\0' )
		return;			/* done before begun! */

	/*
	 *  The point "origin" will be the center of the axis rotation.
	 *  The text is located in a local coordinate system with the
	 *  lower left corner of the first character at (0,0,0), with
	 *  the text proceeding onward towards +X.
	 *  We need to rotate the text around it's local (0,0,0),
	 *  and then translate to the user's designated "origin".
	 *  If the user provided translation or
	 *  scaling in his matrix, it will *also* be applied.
	 */
	MAT_IDN( xlate_to_origin );
	MAT_DELTAS( xlate_to_origin,	origin[X], origin[Y], origin[Z] );
	bn_mat_mul( mat, xlate_to_origin, rot );

	/* Check to see if initialization is needed */
	if( tp_cindex[040] == 0 )  tp_setup();

	/* Draw each character in the input string */
	offset = 0;
	for( cp = (unsigned char *)string ; *cp; cp++, offset += scale )  {
		register TINY	*p;	/* pointer to stroke table */
		register int	stroke;

		VSET( temp, offset, 0, 0 );
		MAT4X3PNT( loc, mat, temp );
		BN_ADD_VLIST(free_hd, vhead, loc, BN_VLIST_LINE_MOVE );

		for( p = tp_cindex[*cp]; ((stroke= *p)) != LAST; p++ )  {
			int	draw;

			if( (stroke)==NEGY )  {
				ysign = (-1);
				stroke = *++p;
			} else
				ysign = 1;

			/* Detect & process pen control */
			if( stroke < 0 )  {
				stroke = -stroke;
				draw = 0;
			} else
				draw = 1;

			/* stroke co-ordinates in string coord system */
			VSET( temp, (stroke/11) * 0.1 * scale + offset,
				   (ysign * (stroke%11)) * 0.1 * scale, 0 );
			MAT4X3PNT( loc, mat, temp );
			if( draw )  {
				BN_ADD_VLIST( free_hd, vhead, loc, BN_VLIST_LINE_DRAW );
			} else {
				BN_ADD_VLIST( free_hd, vhead, loc, BN_VLIST_LINE_MOVE );
			}
		}
	}
}


/*
 *			B N _ V L I S T _ 2 S T R I N G
 *
 *  A simpler interface, for those cases where the text lies
 *  in the X-Y plane.
 */
void
bn_vlist_2string(struct bu_list *vhead, struct bu_list *free_hd, const char *string, double x, double y, double scale, double theta)
              	       
              	         	/* source of free vlists */
          	        	/* string of chars to be plotted */
      	  			/* x,y of lower left corner of 1st char */
      	  
      	      			/* scale factor to change 1x1 char sz */
      	      			/* degrees ccw from X-axis */
{
	mat_t	mat;
	vect_t	p;

	bn_mat_angles( mat, 0.0, 0.0, theta );
	VSET( p, x, y, 0 );
	bn_vlist_3string( vhead, free_hd, string, p, mat, scale );
}
@


11.13
log
@change conf.h to a wrapped config.h
@
text
@d16 1
a16 1
static const char RCSid[] = "@@(#)$Header: /cvs/brlcad/libbn/font.c,v 11.12 2004/04/05 07:46:41 morrison Exp $ (ARL)";
@


11.12
log
@merge of ansi-6-0-branch into HEAD
@
text
@d16 1
a16 1
static const char RCSid[] = "@@(#)$Header$ (ARL)";
d19 5
a23 1
#include "conf.h"
@


11.11
log
@Restoration of entire source tree to Pre-Hartley state
@
text
@d16 1
a16 1
static const char RCSid[] = "@@(#)$Header: /c/CVS/brlcad/libbn/font.c,v 11.9 2001/04/20 22:29:01 morrison Exp $ (ARL)";
d41 7
a47 7
bn_vlist_3string( vhead, free_hd, string, origin, rot, scale )
struct bu_list	*vhead;
struct bu_list	*free_hd;	/* source of free vlists */
const char	*string;	/* string of chars to be plotted */
const point_t	origin;		/* lower left corner of 1st char */
const mat_t	rot;		/* Transform matrix (WARNING: may xlate) */
double		scale;		/* scale factor to change 1x1 char sz */
d124 8
a131 8
bn_vlist_2string( vhead, free_hd, string, x, y, scale, theta )
struct bu_list	*vhead;
struct bu_list	*free_hd;	/* source of free vlists */
const char	*string;	/* string of chars to be plotted */
double	x;			/* x,y of lower left corner of 1st char */
double	y;
double	scale;			/* scale factor to change 1x1 char sz */
double	theta;			/* degrees ccw from X-axis */
@


11.11.2.1
log
@Initial ANSIfication
@
text
@d16 1
a16 1
static const char RCSid[] = "@@(#)$Header: /c/CVS/brlcad/libbn/font.c,v 11.11 2002/08/20 17:07:36 jra Exp $ (ARL)";
d41 7
a47 7
bn_vlist_3string(struct bu_list *vhead, struct bu_list *free_hd, const char *string, const fastf_t *origin, const fastf_t *rot, double scale)
              	       
              	         	/* source of free vlists */
          	        	/* string of chars to be plotted */
             	       		/* lower left corner of 1st char */
           	    		/* Transform matrix (WARNING: may xlate) */
      		      		/* scale factor to change 1x1 char sz */
d124 8
a131 8
bn_vlist_2string(struct bu_list *vhead, struct bu_list *free_hd, const char *string, double x, double y, double scale, double theta)
              	       
              	         	/* source of free vlists */
          	        	/* string of chars to be plotted */
      	  			/* x,y of lower left corner of 1st char */
      	  
      	      			/* scale factor to change 1x1 char sz */
      	      			/* degrees ccw from X-axis */
@


11.10
log
@Converted from K&R to ANSI C - RFH
@
text
@d41 7
a47 7
bn_vlist_3string(struct bu_list *vhead, struct bu_list *free_hd, const char *string, const fastf_t *origin, const fastf_t *rot, double scale)
              	       
              	         	/* source of free vlists */
          	        	/* string of chars to be plotted */
             	       		/* lower left corner of 1st char */
           	    		/* Transform matrix (WARNING: may xlate) */
      		      		/* scale factor to change 1x1 char sz */
d124 8
a131 8
bn_vlist_2string(struct bu_list *vhead, struct bu_list *free_hd, const char *string, double x, double y, double scale, double theta)
              	       
              	         	/* source of free vlists */
          	        	/* string of chars to be plotted */
      	  			/* x,y of lower left corner of 1st char */
      	  
      	      			/* scale factor to change 1x1 char sz */
      	      			/* degrees ccw from X-axis */
@


11.9
log
@CONST to const
@
text
@d16 1
a16 1
static const char RCSid[] = "@@(#)$Header: /c/CVS/brlcad/libbn/font.c,v 11.8 2001/03/31 01:56:48 morrison Exp $ (ARL)";
d41 7
a47 7
bn_vlist_3string( vhead, free_hd, string, origin, rot, scale )
struct bu_list	*vhead;
struct bu_list	*free_hd;	/* source of free vlists */
const char	*string;	/* string of chars to be plotted */
const point_t	origin;		/* lower left corner of 1st char */
const mat_t	rot;		/* Transform matrix (WARNING: may xlate) */
double		scale;		/* scale factor to change 1x1 char sz */
d124 8
a131 8
bn_vlist_2string( vhead, free_hd, string, x, y, scale, theta )
struct bu_list	*vhead;
struct bu_list	*free_hd;	/* source of free vlists */
const char	*string;	/* string of chars to be plotted */
double	x;			/* x,y of lower left corner of 1st char */
double	y;
double	scale;			/* scale factor to change 1x1 char sz */
double	theta;			/* degrees ccw from X-axis */
@


11.8
log
@Deprecated bn_mat_idn() and bn_mat_zero(), updated calls to h/vmath.h's MAT_IDN() and MAT_ZERO() performance improved macros.
@
text
@d16 1
a16 1
static const char RCSid[] = "@@(#)$Header: /c/CVS/brlcad/libbn/font.c,v 11.7 2000/10/18 18:10:32 butler Exp $ (ARL)";
d44 3
a46 3
CONST char	*string;	/* string of chars to be plotted */
CONST point_t	origin;		/* lower left corner of 1st char */
CONST mat_t	rot;		/* Transform matrix (WARNING: may xlate) */
d127 1
a127 1
CONST char	*string;	/* string of chars to be plotted */
@


11.7
log
@Patches for compiling under RedHat 7.0
@
text
@d16 1
a16 1
static const char RCSid[] = "@@(#)$Header: /c/CVS/brlcad/libbn/font.c,v 11.6 2000/07/11 23:30:38 cjohnson Exp $ (ARL)";
d70 1
a70 1
	bn_mat_idn( xlate_to_origin );
@


11.6
log
@LINT picking.  Missing includes and static const for RCSids
@
text
@d16 1
a16 1
static const char RCSid[] = "@@(#)$Header: /c/CVS/brlcad/libbn/font.c,v 11.5 1999/07/02 19:11:25 mike Exp $ (ARL)";
d23 4
@


11.5
log
@
Removed dependency on compat4.h
@
text
@d16 1
a16 1
static char RCSid[] = "@@(#)$Header: /c/CVS/brlcad/libbn/font.c,v 11.4 1999/05/27 21:52:12 mike Exp $ (ARL)";
@


11.4
log
@
About to move librt/font.c to libbn/font.c
@
text
@d16 1
a16 1
static char RCSid[] = "@@(#)$Header: /c/CVS/brlcad/librt/font.c,v 11.3 1999/05/27 19:16:26 mike Exp $ (ARL)";
d81 1
a81 1
		BN_ADD_VLIST(free_hd, vhead, loc, RT_VLIST_LINE_MOVE );
d104 1
a104 1
				BN_ADD_VLIST( free_hd, vhead, loc, RT_VLIST_LINE_DRAW );
d106 1
a106 1
				BN_ADD_VLIST( free_hd, vhead, loc, RT_VLIST_LINE_MOVE );
@


11.3
log
@
sed4
@
text
@d16 1
a16 1
static char RCSid[] = "@@(#)$Header: /c/CVS/brlcad/librt/font.c,v 11.2 1997/01/08 03:35:48 mike Exp $ (ARL)";
d25 2
a26 1
#include "raytrace.h"
d32 1
a32 1
 *			R T _ V L I S T _ 3 S T R I N G
d37 1
a37 1
rt_vlist_3string( vhead, string, origin, rot, scale )
d39 1
d81 1
a81 1
		RT_ADD_VLIST( vhead, loc, RT_VLIST_LINE_MOVE );
d104 1
a104 1
				RT_ADD_VLIST( vhead, loc, RT_VLIST_LINE_DRAW );
d106 1
a106 1
				RT_ADD_VLIST( vhead, loc, RT_VLIST_LINE_MOVE );
d114 1
a114 1
 *			R T _ V L I S T _ 2 S T R I N G
d120 1
a120 1
rt_vlist_2string( vhead, string, x, y, scale, theta )
d122 1
d134 1
a134 1
	rt_vlist_3string( vhead, string, p, mat, scale );
@


11.2
log
@libplot --> libbn
@
text
@d16 1
a16 1
static char RCSid[] = "@@(#)$Header: /m/cad/librt/RCS/font.c,v 11.1 1995/01/04 09:56:25 mike Rel4_4 mike $ (ARL)";
d37 1
a37 1
struct rt_list	*vhead;
d64 1
a64 1
	mat_idn( xlate_to_origin );
d66 1
a66 1
	mat_mul( mat, xlate_to_origin, rot );
d119 1
a119 1
struct rt_list	*vhead;
d129 1
a129 1
	mat_angles( mat, 0.0, 0.0, theta );
@


11.1
log
@Release_4.4
@
text
@d16 1
a16 1
static char RCSid[] = "@@(#)$Header: /m/cad/librt/RCS/font.c,v 1.5 94/11/04 05:42:20 mike Exp $ (ARL)";
d28 1
a28 4
/*
 *  Big bit of magic:  include some of TIG-PACK (LIBPLOT3) source here.
 */
#include "../libplot3/vectfont.c"
@


1.5
log
@Irix 6
@
text
@d16 1
a16 1
static char RCSid[] = "@@(#)$Header: /m/cad/librt/RCS/font.c,v 1.4 94/08/10 18:22:50 gdurf Exp Locker: mike $ (ARL)";
@


1.4
log
@Added include of conf.h
@
text
@d16 1
a16 1
static char RCSid[] = "@@(#)$Header: /m/cad/librt/RCS/font.c,v 1.3 1994/03/18 01:04:58 mike Exp gdurf $ (ARL)";
a51 1
	mat_t	mtemp;
@


1.3
log
@Added comment.
@
text
@d16 1
a16 1
static char RCSid[] = "@@(#)$Header: /m/cad/librt/RCS/font.c,v 1.2 94/01/14 13:14:41 jra Exp Locker: mike $ (ARL)";
d18 2
@


1.2
log
@Quick fix for font.c (removed &0xFF from stroke)
@
text
@d16 1
a16 1
static char RCSid[] = "@@(#)$Header: /m/cad/librt/RCS/font.c,v 1.1 94/01/12 17:58:44 mike Exp Locker: jra $ (ARL)";
d33 2
@


1.1
log
@Initial revision
@
text
@d16 1
a16 1
static char RCSid[] = "@@(#)$Header$ (ARL)";
d81 1
a81 1
		for( p = tp_cindex[*cp]; ((stroke= *p)&0xFF) != LAST; p++ )  {
d84 1
a84 1
			if( (stroke&0xFF)==NEGY )  {
@
