head	14.98;
access;
symbols
	rel-7-10-4:14.97
	STABLE:14.97.0.2
	stable-branch:14.28
	rel-7-10-2:14.97
	rel-7-10-0:14.84
	rel-7-8-4:14.53
	rel-7-8-2:14.44
	rel-7-8-0:14.44
	trimnurbs-branch:14.44.0.2
	help:14.44
	temp_tag:14.42
	bobWinPort-20051223-freeze:14.30
	postmerge-20051223-bobWinPort:14.42
	premerge-20051223-bobWinPort:14.42
	rel-7-6-6:14.42
	rel-7-6-4:14.39
	rel-7-6-2:14.31
	rel-7-6-branch:14.31.0.2
	rel-7-6-0:14.31
	rel-7-4-2:14.30
	rel-7-4-branch:14.30.0.4
	bobWinPort:14.30.0.2
	rel-7-4-0:14.30
	rel-7-2-6:14.29
	rel-7-2-4:14.28
	rel-7-2-2:14.28
	rel-7-2-0:14.23
	rel-7-0-4:14.15
	rel-7-0-2:14.2
	rel-7-0-1:14.1
	opensource-post:14.1
	opensource-pre:1.38
	rel-7-0-branch:1.37.0.2
	rel-7-0:1.37
	postmerge-20040405-ansi:1.1
	premerge-20040404-ansi:1.1;
locks; strict;
comment	@# @;


14.98
date	2007.09.14.15.20.51;	author erikgreenwald;	state Exp;
branches;
next	14.97;

14.97
date	2007.06.18.22.25.02;	author brlcad;	state Exp;
branches;
next	14.96;

14.96
date	2007.05.27.04.28.19;	author brlcad;	state Exp;
branches;
next	14.95;

14.95
date	2007.05.27.04.21.23;	author brlcad;	state Exp;
branches;
next	14.94;

14.94
date	2007.05.26.22.39.18;	author brlcad;	state Exp;
branches;
next	14.93;

14.93
date	2007.05.18.05.04.15;	author brlcad;	state Exp;
branches;
next	14.92;

14.92
date	2007.05.17.19.02.33;	author brlcad;	state Exp;
branches;
next	14.91;

14.91
date	2007.05.17.04.43.22;	author brlcad;	state Exp;
branches;
next	14.90;

14.90
date	2007.05.09.05.55.51;	author brlcad;	state Exp;
branches;
next	14.89;

14.89
date	2007.05.09.04.04.07;	author brlcad;	state Exp;
branches;
next	14.88;

14.88
date	2007.05.09.03.34.52;	author brlcad;	state Exp;
branches;
next	14.87;

14.87
date	2007.05.04.21.50.11;	author brlcad;	state Exp;
branches;
next	14.86;

14.86
date	2007.05.04.04.15.13;	author brlcad;	state Exp;
branches;
next	14.85;

14.85
date	2007.04.29.06.01.46;	author brlcad;	state Exp;
branches;
next	14.84;

14.84
date	2007.03.09.21.46.48;	author brlcad;	state Exp;
branches;
next	14.83;

14.83
date	2007.03.09.20.05.08;	author brlcad;	state Exp;
branches;
next	14.82;

14.82
date	2007.03.09.19.51.40;	author brlcad;	state Exp;
branches;
next	14.81;

14.81
date	2007.03.09.19.33.33;	author brlcad;	state Exp;
branches;
next	14.80;

14.80
date	2007.03.09.14.13.25;	author brlcad;	state Exp;
branches;
next	14.79;

14.79
date	2007.03.09.13.18.27;	author brlcad;	state Exp;
branches;
next	14.78;

14.78
date	2007.03.09.13.13.55;	author brlcad;	state Exp;
branches;
next	14.77;

14.77
date	2007.03.09.09.30.27;	author brlcad;	state Exp;
branches;
next	14.76;

14.76
date	2007.03.05.05.28.15;	author brlcad;	state Exp;
branches;
next	14.75;

14.75
date	2007.03.03.15.08.33;	author brlcad;	state Exp;
branches;
next	14.74;

14.74
date	2007.02.27.05.59.30;	author brlcad;	state Exp;
branches;
next	14.73;

14.73
date	2007.02.26.09.04.47;	author brlcad;	state Exp;
branches;
next	14.72;

14.72
date	2007.02.26.08.59.19;	author brlcad;	state Exp;
branches;
next	14.71;

14.71
date	2007.02.26.05.13.25;	author brlcad;	state Exp;
branches;
next	14.70;

14.70
date	2007.02.24.01.46.05;	author brlcad;	state Exp;
branches;
next	14.69;

14.69
date	2007.02.23.13.33.52;	author brlcad;	state Exp;
branches;
next	14.68;

14.68
date	2007.02.18.07.27.24;	author brlcad;	state Exp;
branches;
next	14.67;

14.67
date	2007.02.18.07.20.13;	author brlcad;	state Exp;
branches;
next	14.66;

14.66
date	2007.02.13.18.28.33;	author brlcad;	state Exp;
branches;
next	14.65;

14.65
date	2007.02.13.18.15.26;	author brlcad;	state Exp;
branches;
next	14.64;

14.64
date	2007.02.09.22.41.02;	author brlcad;	state Exp;
branches;
next	14.63;

14.63
date	2007.02.09.22.00.22;	author brlcad;	state Exp;
branches;
next	14.62;

14.62
date	2007.02.09.00.39.16;	author brlcad;	state Exp;
branches;
next	14.61;

14.61
date	2007.02.09.00.30.30;	author brlcad;	state Exp;
branches;
next	14.60;

14.60
date	2007.02.08.08.37.10;	author brlcad;	state Exp;
branches;
next	14.59;

14.59
date	2007.02.06.20.31.45;	author brlcad;	state Exp;
branches;
next	14.58;

14.58
date	2007.01.27.01.41.28;	author brlcad;	state Exp;
branches;
next	14.57;

14.57
date	2007.01.20.14.10.40;	author brlcad;	state Exp;
branches;
next	14.56;

14.56
date	2007.01.18.18.26.58;	author brlcad;	state Exp;
branches;
next	14.55;

14.55
date	2006.12.07.04.46.38;	author brlcad;	state Exp;
branches;
next	14.54;

14.54
date	2006.11.10.13.05.21;	author brlcad;	state Exp;
branches;
next	14.53;

14.53
date	2006.08.11.20.04.21;	author brlcad;	state Exp;
branches;
next	14.52;

14.52
date	2006.07.24.03.25.15;	author brlcad;	state Exp;
branches;
next	14.51;

14.51
date	2006.07.23.20.11.20;	author brlcad;	state Exp;
branches;
next	14.50;

14.50
date	2006.07.23.16.15.43;	author brlcad;	state Exp;
branches;
next	14.49;

14.49
date	2006.07.23.07.18.53;	author brlcad;	state Exp;
branches;
next	14.48;

14.48
date	2006.07.23.04.28.49;	author brlcad;	state Exp;
branches;
next	14.47;

14.47
date	2006.07.23.04.15.32;	author brlcad;	state Exp;
branches;
next	14.46;

14.46
date	2006.07.23.03.27.58;	author brlcad;	state Exp;
branches;
next	14.45;

14.45
date	2006.07.22.21.44.23;	author brlcad;	state Exp;
branches;
next	14.44;

14.44
date	2006.01.18.06.46.09;	author brlcad;	state Exp;
branches;
next	14.43;

14.43
date	2006.01.15.08.48.35;	author brlcad;	state Exp;
branches;
next	14.42;

14.42
date	2005.12.12.23.10.45;	author brlcad;	state Exp;
branches;
next	14.41;

14.41
date	2005.11.20.06.15.16;	author brlcad;	state Exp;
branches;
next	14.40;

14.40
date	2005.11.18.09.40.55;	author brlcad;	state Exp;
branches;
next	14.39;

14.39
date	2005.11.11.21.34.28;	author brlcad;	state Exp;
branches;
next	14.38;

14.38
date	2005.11.08.03.20.41;	author brlcad;	state Exp;
branches;
next	14.37;

14.37
date	2005.10.28.19.07.53;	author brlcad;	state Exp;
branches;
next	14.36;

14.36
date	2005.10.22.17.50.18;	author brlcad;	state Exp;
branches;
next	14.35;

14.35
date	2005.10.22.17.10.03;	author brlcad;	state Exp;
branches;
next	14.34;

14.34
date	2005.10.02.00.29.23;	author brlcad;	state Exp;
branches;
next	14.33;

14.33
date	2005.10.01.18.08.46;	author brlcad;	state Exp;
branches;
next	14.32;

14.32
date	2005.10.01.17.52.11;	author brlcad;	state Exp;
branches;
next	14.31;

14.31
date	2005.08.22.23.27.01;	author brlcad;	state Exp;
branches
	14.31.2.1;
next	14.30;

14.30
date	2005.07.10.22.00.43;	author brlcad;	state Exp;
branches;
next	14.29;

14.29
date	2005.06.01.17.29.07;	author brlcad;	state Exp;
branches;
next	14.28;

14.28
date	2005.03.14.22.46.18;	author brlcad;	state Exp;
branches;
next	14.27;

14.27
date	2005.03.14.16.12.17;	author brlcad;	state Exp;
branches;
next	14.26;

14.26
date	2005.03.14.02.42.42;	author brlcad;	state Exp;
branches;
next	14.25;

14.25
date	2005.03.14.02.37.02;	author brlcad;	state Exp;
branches;
next	14.24;

14.24
date	2005.03.11.21.26.23;	author brlcad;	state Exp;
branches;
next	14.23;

14.23
date	2005.02.21.18.09.15;	author brlcad;	state Exp;
branches;
next	14.22;

14.22
date	2005.02.19.07.33.42;	author brlcad;	state Exp;
branches;
next	14.21;

14.21
date	2005.02.11.19.12.23;	author brlcad;	state Exp;
branches;
next	14.20;

14.20
date	2005.02.11.19.02.30;	author brlcad;	state Exp;
branches;
next	14.19;

14.19
date	2005.02.11.07.59.00;	author brlcad;	state Exp;
branches;
next	14.18;

14.18
date	2005.01.31.04.10.59;	author brlcad;	state Exp;
branches;
next	14.17;

14.17
date	2005.01.30.20.30.08;	author brlcad;	state Exp;
branches;
next	14.16;

14.16
date	2005.01.30.05.06.49;	author brlcad;	state Exp;
branches;
next	14.15;

14.15
date	2005.01.26.07.20.19;	author brlcad;	state Exp;
branches;
next	14.14;

14.14
date	2005.01.25.04.45.54;	author brlcad;	state Exp;
branches;
next	14.13;

14.13
date	2005.01.25.03.25.48;	author brlcad;	state Exp;
branches;
next	14.12;

14.12
date	2005.01.25.02.31.56;	author brlcad;	state Exp;
branches;
next	14.11;

14.11
date	2005.01.24.21.03.05;	author brlcad;	state Exp;
branches;
next	14.10;

14.10
date	2005.01.19.09.20.04;	author brlcad;	state Exp;
branches;
next	14.9;

14.9
date	2005.01.19.08.57.14;	author brlcad;	state Exp;
branches;
next	14.8;

14.8
date	2005.01.19.07.34.41;	author brlcad;	state Exp;
branches;
next	14.7;

14.7
date	2005.01.16.05.36.18;	author brlcad;	state Exp;
branches;
next	14.6;

14.6
date	2005.01.15.01.40.50;	author brlcad;	state Exp;
branches;
next	14.5;

14.5
date	2005.01.11.03.48.31;	author brlcad;	state Exp;
branches;
next	14.4;

14.4
date	2005.01.11.03.34.16;	author brlcad;	state Exp;
branches;
next	14.3;

14.3
date	2005.01.11.03.19.28;	author brlcad;	state Exp;
branches;
next	14.2;

14.2
date	2005.01.04.22.39.11;	author brlcad;	state Exp;
branches;
next	14.1;

14.1
date	2004.11.16.19.42.08;	author morrison;	state Exp;
branches;
next	1.38;

1.38
date	2004.11.06.02.04.10;	author morrison;	state Exp;
branches;
next	1.37;

1.37
date	2004.10.29.13.35.09;	author morrison;	state Exp;
branches;
next	1.36;

1.36
date	2004.10.21.17.17.31;	author morrison;	state Exp;
branches;
next	1.35;

1.35
date	2004.10.14.18.02.46;	author morrison;	state Exp;
branches;
next	1.34;

1.34
date	2004.10.14.17.45.53;	author kermit;	state Exp;
branches;
next	1.33;

1.33
date	2004.10.14.17.19.41;	author morrison;	state Exp;
branches;
next	1.32;

1.32
date	2004.10.07.10.50.30;	author morrison;	state Exp;
branches;
next	1.31;

1.31
date	2004.10.04.15.22.50;	author morrison;	state Exp;
branches;
next	1.30;

1.30
date	2004.09.29.04.15.34;	author morrison;	state Exp;
branches;
next	1.29;

1.29
date	2004.09.29.01.22.29;	author morrison;	state Exp;
branches;
next	1.28;

1.28
date	2004.09.07.15.37.42;	author morrison;	state Exp;
branches;
next	1.27;

1.27
date	2004.08.02.07.21.40;	author morrison;	state Exp;
branches;
next	1.26;

1.26
date	2004.08.02.03.08.08;	author morrison;	state Exp;
branches;
next	1.25;

1.25
date	2004.07.26.20.38.40;	author morrison;	state Exp;
branches;
next	1.24;

1.24
date	2004.07.26.20.12.45;	author morrison;	state Exp;
branches;
next	1.23;

1.23
date	2004.07.26.19.37.19;	author morrison;	state Exp;
branches;
next	1.22;

1.22
date	2004.07.26.19.01.59;	author morrison;	state Exp;
branches;
next	1.21;

1.21
date	2004.07.26.18.59.54;	author morrison;	state Exp;
branches;
next	1.20;

1.20
date	2004.07.26.17.35.15;	author morrison;	state Exp;
branches;
next	1.19;

1.19
date	2004.07.26.07.43.37;	author morrison;	state Exp;
branches;
next	1.18;

1.18
date	2004.07.25.03.57.36;	author morrison;	state Exp;
branches;
next	1.17;

1.17
date	2004.07.16.19.46.26;	author morrison;	state Exp;
branches;
next	1.16;

1.16
date	2004.06.30.03.24.35;	author morrison;	state Exp;
branches;
next	1.15;

1.15
date	2004.05.26.20.10.26;	author morrison;	state Exp;
branches;
next	1.14;

1.14
date	2004.05.26.20.08.47;	author morrison;	state Exp;
branches;
next	1.13;

1.13
date	2004.05.25.14.23.58;	author morrison;	state Exp;
branches;
next	1.12;

1.12
date	2004.05.25.14.06.41;	author morrison;	state Exp;
branches;
next	1.11;

1.11
date	2004.05.11.19.11.34;	author morrison;	state Exp;
branches;
next	1.10;

1.10
date	2004.05.04.23.37.29;	author morrison;	state Exp;
branches;
next	1.9;

1.9
date	2004.05.04.21.40.17;	author morrison;	state Exp;
branches;
next	1.8;

1.8
date	2004.05.04.21.38.35;	author morrison;	state Exp;
branches;
next	1.7;

1.7
date	2004.04.21.01.16.26;	author morrison;	state Exp;
branches;
next	1.6;

1.6
date	2004.04.21.01.13.02;	author morrison;	state Exp;
branches;
next	1.5;

1.5
date	2004.04.20.18.36.31;	author morrison;	state Exp;
branches;
next	1.4;

1.4
date	2004.04.20.14.29.43;	author morrison;	state Exp;
branches;
next	1.3;

1.3
date	2004.04.15.11.24.25;	author morrison;	state Exp;
branches;
next	1.2;

1.2
date	2004.04.05.13.57.02;	author morrison;	state Exp;
branches;
next	1.1;

1.1
date	2004.04.01.03.31.31;	author morrison;	state Exp;
branches;
next	;

14.31.2.1
date	2005.11.13.13.46.08;	author brlcad;	state Exp;
branches;
next	;


desc
@@


14.98
log
@removed trailing whitespace
@
text
@#!/bin/sh
#                        a u t o g e n . s h
#
# Copyright (c) 2005-2007 United States Government as represented by
# the U.S. Army Research Laboratory.
#
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions
# are met:
#
# 1. Redistributions of source code must retain the above copyright
# notice, this list of conditions and the following disclaimer.
#
# 2. Redistributions in binary form must reproduce the above
# copyright notice, this list of conditions and the following
# disclaimer in the documentation and/or other materials provided
# with the distribution.
#
# 3. The name of the author may not be used to endorse or promote
# products derived from this software without specific prior written
# permission.
#
# THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS
# OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
# WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
# ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY
# DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
# DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
# GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
# INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
# NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
# SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
#
###
#
# Script for automatically preparing the sources for compilation by
# performing the myrid of necessary steps.  The script attempts to
# detect proper version support, and outputs warnings about particular
# systems that have autotool peculiarities.
#
# Basically, if everything is set up and installed correctly, the
# script will validate that minimum versions of the GNU Build System
# tools are installed, account for several common configuration
# issues, and then simply run autoreconf for you.
#
# If autoreconf fails, which can happen for many valid configurations,
# this script proceeds to run manual preparation steps effectively
# providing a POSIX shell script (mostly complete) reimplementation of
# autoreconf.
#
# The AUTORECONF, AUTOCONF, AUTOMAKE, LIBTOOLIZE, ACLOCAL, AUTOHEADER
# environment variables and corresponding _OPTIONS variables (e.g.
# AUTORECONF_OPTIONS) may be used to override the default automatic
# detection behaviors.  Similarly the _VERSION variables will override
# the minimum required version numbers.
#
# Examples:
#
#   To obtain help on usage:
#     ./autogen.sh --help
#
#   To obtain verbose output:
#     ./autogen.sh --verbose
#
#   To skip autoreconf and prepare manually:
#     AUTORECONF=false ./autogen.sh
#
#   To verbosely try running with an older (unsupported) autoconf:
#     AUTOCONF_VERSION=2.50 ./autogen.sh --verbose
#
# Author: Christopher Sean Morrison <morrison@@brlcad.org>
#
######################################################################

# set to minimum acceptible version of autoconf
if [ "x$AUTOCONF_VERSION" = "x" ] ; then
    AUTOCONF_VERSION=2.52
fi
# set to minimum acceptible version of automake
if [ "x$AUTOMAKE_VERSION" = "x" ] ; then
    AUTOMAKE_VERSION=1.6.0
fi
# set to minimum acceptible version of libtool
if [ "x$LIBTOOL_VERSION" = "x" ] ; then
    LIBTOOL_VERSION=1.4.2
fi


##################
# ident function #
##################
ident ( ) {
    # extract copyright from header
    __copyright="`grep Copyright $AUTOGEN_SH | head -${HEAD_N}1 | awk '{print $4}'`"
    if [ "x$__copyright" = "x" ] ; then
	__copyright="`date +%Y`"
    fi

    # extract version from CVS Id string
    __id="$Id: autogen.sh,v 14.97 2007/06/18 22:25:02 brlcad Exp $"
    __version="`echo $__id | sed 's/.*\([0-9][0-9][0-9][0-9]\)[-\/]\([0-9][0-9]\)[-\/]\([0-9][0-9]\).*/\1\2\3/'`"
    if [ "x$__version" = "x" ] ; then
	__version=""
    fi

    echo "autogen.sh build preparation script by Christopher Sean Morrison"
    echo "revised 3-clause BSD-style license, copyright (c) $__copyright"
    echo "script version $__version, ISO/IEC 9945 POSIX shell script"
}


##################
# USAGE FUNCTION #
##################
usage ( ) {
    echo "Usage: $AUTOGEN_SH [-h|--help] [-v|--verbose] [-q|--quiet] [--version]"
    echo "    --help     Help on $NAME_OF_AUTOGEN usage"
    echo "    --verbose  Verbose progress output"
    echo "    --quiet    Quiet suppressed progress output"
    echo "    --version  Only perform GNU Build System version checks"
    echo
    echo "Description: This script will validate that minimum versions of the"
    echo "GNU Build System tools are installed and then run autoreconf for you."
    echo "Should autoreconf fail, manual preparation steps will be run"
    echo "potentially accounting for several common preparation issues.  The"

    echo "AUTORECONF, AUTOCONF, AUTOMAKE, LIBTOOLIZE, ACLOCAL, AUTOHEADER,"
    echo "PROJECT, & CONFIGURE environment variables and corresponding _OPTIONS"
    echo "variables (e.g. AUTORECONF_OPTIONS) may be used to override the"
    echo "default automatic detection behavior."
    echo

    ident

    return 0
}


##########################
# VERSION_ERROR FUNCTION #
##########################
version_error ( ) {
    if [ "x$1" = "x" ] ; then
	echo "INTERNAL ERROR: version_error was not provided a version"
	exit 1
    fi
    if [ "x$2" = "x" ] ; then
	echo "INTERNAL ERROR: version_error was not provided an application name"
	exit 1
    fi
    $ECHO
    $ECHO "ERROR:  To prepare the ${PROJECT} build system from scratch,"
    $ECHO "        at least version $1 of $2 must be installed."
    $ECHO
    $ECHO "$NAME_OF_AUTOGEN does not need to be run on the same machine that will"
    $ECHO "run configure or make.  Either the GNU Autotools will need to be installed"
    $ECHO "or upgraded on this system, or $NAME_OF_AUTOGEN must be run on the source"
    $ECHO "code on another system and then transferred to here. -- Cheers!"
    $ECHO
}

##########################
# VERSION_CHECK FUNCTION #
##########################
version_check ( ) {
    if [ "x$1" = "x" ] ; then
	echo "INTERNAL ERROR: version_check was not provided a minimum version"
	exit 1
    fi
    _min="$1"
    if [ "x$2" = "x" ] ; then
	echo "INTERNAL ERROR: version check was not provided a comparison version"
	exit 1
    fi
    _cur="$2"

    # needed to handle versions like 1.10 and 1.4-p6
    _min="`echo ${_min}. | sed 's/[^0-9]/./g' | sed 's/\.\././g'`"
    _cur="`echo ${_cur}. | sed 's/[^0-9]/./g' | sed 's/\.\././g'`"

    _min_major="`echo $_min | cut -d. -f1`"
    _min_minor="`echo $_min | cut -d. -f2`"
    _min_patch="`echo $_min | cut -d. -f3`"

    _cur_major="`echo $_cur | cut -d. -f1`"
    _cur_minor="`echo $_cur | cut -d. -f2`"
    _cur_patch="`echo $_cur | cut -d. -f3`"

    if [ "x$_min_major" = "x" ] ; then
	_min_major=0
    fi
    if [ "x$_min_minor" = "x" ] ; then
	_min_minor=0
    fi
    if [ "x$_min_patch" = "x" ] ; then
	_min_patch=0
    fi
    if [ "x$_cur_minor" = "x" ] ; then
	_cur_major=0
    fi
    if [ "x$_cur_minor" = "x" ] ; then
	_cur_minor=0
    fi
    if [ "x$_cur_patch" = "x" ] ; then
	_cur_patch=0
    fi

    $VERBOSE_ECHO "Checking if ${_cur_major}.${_cur_minor}.${_cur_patch} is greater than ${_min_major}.${_min_minor}.${_min_patch}"

    if [ $_min_major -lt $_cur_major ] ; then
	return 0
    elif [ $_min_major -eq $_cur_major ] ; then
	if [ $_min_minor -lt $_cur_minor ] ; then
	    return 0
	elif [ $_min_minor -eq $_cur_minor ] ; then
	    if [ $_min_patch -lt $_cur_patch ] ; then
		return 0
	    elif [ $_min_patch -eq $_cur_patch ] ; then
		return 0
	    fi
	fi
    fi
    return 1
}


######################################
# LOCATE_CONFIGURE_TEMPLATE FUNCTION #
######################################
locate_configure_template ( ) {
    _pwd="`pwd`"
    if test -f "./configure.ac" ; then
	echo "./configure.ac"
    elif test -f "./configure.in" ; then
	echo "./configure.in"
    elif test -f "$_pwd/configure.ac" ; then
	echo "$_pwd/configure.ac"
    elif test -f "$_pwd/configure.in" ; then
	echo "$_pwd/configure.in"
    elif test -f "$PATH_TO_AUTOGEN/configure.ac" ; then
	echo "$PATH_TO_AUTOGEN/configure.ac"
    elif test -f "$PATH_TO_AUTOGEN/configure.in" ; then
	echo "$PATH_TO_AUTOGEN/configure.in"
    fi
}


##################
# argument check #
##################
ARGS="$*"
PATH_TO_AUTOGEN="`dirname $0`"
NAME_OF_AUTOGEN="`basename $0`"
AUTOGEN_SH="$PATH_TO_AUTOGEN/$NAME_OF_AUTOGEN"

LIBTOOL_M4="${PATH_TO_AUTOGEN}/misc/libtool.m4"

if [ "x$HELP" = "x" ] ; then
    HELP=no
fi
if [ "x$QUIET" = "x" ] ; then
    QUIET=no
fi
if [ "x$VERBOSE" = "x" ] ; then
    VERBOSE=no
fi
if [ "x$VERSION_ONLY" = "x" ] ; then
    VERSION_ONLY=no
fi
if [ "x$AUTORECONF_OPTIONS" = "x" ] ; then
    AUTORECONF_OPTIONS="-i -f"
fi
if [ "x$AUTOCONF_OPTIONS" = "x" ] ; then
    AUTOCONF_OPTIONS="-f"
fi
if [ "x$AUTOMAKE_OPTIONS" = "x" ] ; then
    AUTOMAKE_OPTIONS="-a -c -f"
fi
ALT_AUTOMAKE_OPTIONS="-a -c"
if [ "x$LIBTOOLIZE_OPTIONS" = "x" ] ; then
    LIBTOOLIZE_OPTIONS="--automake -c -f"
fi
ALT_LIBTOOLIZE_OPTIONS="--automake --copy --force"
if [ "x$ACLOCAL_OPTIONS" = "x" ] ; then
    ACLOCAL_OPTIONS=""
fi
if [ "x$AUTOHEADER_OPTIONS" = "x" ] ; then
    AUTOHEADER_OPTIONS=""
fi
for arg in $ARGS ; do
    case "x$arg" in
	x--help) HELP=yes ;;
	x-[hH]) HELP=yes ;;
	x--quiet) QUIET=yes ;;
	x-[qQ]) QUIET=yes ;;
	x--verbose) VERBOSE=yes ;;
	x-[vV]) VERBOSE=yes ;;
	x--version) VERSION_ONLY=yes ;;
	*)
	    echo "Unknown option: $arg"
	    echo
	    usage
	    exit 1
	    ;;
    esac
done


#####################
# environment check #
#####################

# sanity check before recursions potentially begin
if [ ! -f "$AUTOGEN_SH" ] ; then
    echo "INTERNAL ERROR: $AUTOGEN_SH does not exist"
    if [ ! "x$0" = "x$AUTOGEN_SH" ] ; then
	echo "INTERNAL ERROR: dirname/basename inconsistency: $0 != $AUTOGEN_SH"
    fi
    exit 1
fi

# force locale setting to C so things like date output as expected
LC_ALL=C

# commands that this script expects
for __cmd in echo head tail pwd ; do
    echo "test" | $__cmd > /dev/null 2>&1
    if [ $? != 0 ] ; then
	echo "INTERNAL ERROR: '${__cmd}' command is required"
	exit 2
    fi
done
echo "test" | grep "test" > /dev/null 2>&1
if test ! x$? = x0 ; then
    echo "INTERNAL ERROR: grep command is required"
    exit 1
fi
echo "test" | sed "s/test/test/" > /dev/null 2>&1
if test ! x$? = x0 ; then
    echo "INTERNAL ERROR: sed command is required"
    exit 1
fi


# determine the behavior of echo
case `echo "testing\c"; echo 1,2,3`,`echo -n testing; echo 1,2,3` in
    *c*,-n*) ECHO_N= ECHO_C='
' ECHO_T='	' ;;
    *c*,*  ) ECHO_N=-n ECHO_C= ECHO_T= ;;
    *)       ECHO_N= ECHO_C='\c' ECHO_T= ;;
esac

# determine the behavior of head
case "x`echo 'head' | head -n 1 2>&1`" in
    *xhead*) HEAD_N="n " ;;
    *) HEAD_N="" ;;
esac

# determine the behavior of tail
case "x`echo 'tail' | tail -n 1 2>&1`" in
    *xtail*) TAIL_N="n " ;;
    *) TAIL_N="" ;;
esac

VERBOSE_ECHO=:
ECHO=:
if [ "x$QUIET" = "xyes" ] ; then
    if [ "x$VERBOSE" = "xyes" ] ; then
	echo "Verbose output quelled by quiet option.  Further output disabled."
    fi
else
    ECHO=echo
    if [ "x$VERBOSE" = "xyes" ] ; then
	echo "Verbose output enabled"
	VERBOSE_ECHO=echo
    fi
fi


# allow a recursive run to disable further recursions
if [ "x$RUN_RECURSIVE" = "x" ] ; then
    RUN_RECURSIVE=yes
fi


################################################
# check for help arg and bypass version checks #
################################################
if [ "x`echo $ARGS | sed 's/.*[hH][eE][lL][pP].*/help/'`" = "xhelp" ] ; then
    HELP=yes
fi
if [ "x$HELP" = "xyes" ] ; then
    usage
    $ECHO "---"
    $ECHO "Help was requested.  No preparation or configuration will be performed."
    exit 0
fi


#######################
# set up signal traps #
#######################
untrap_abnormal ( ) {
    for sig in 1 2 13 15; do
	trap - $sig
    done
}

# do this cleanup whenever we exit.
trap '
    # start from the root
    if test -d "$START_PATH" ; then
	cd "$START_PATH"
    fi

    # restore/delete backup files
    if test "x$PFC_INIT" = "x1" ; then
	recursive_restore
    fi
' 0

# trap SIGHUP (1), SIGINT (2), SIGPIPE (13), SIGTERM (15)
for sig in 1 2 13 15; do
    trap '
	$ECHO ""
	$ECHO "Aborting $NAME_OF_AUTOGEN: caught signal '$sig'"

	# start from the root
	if test -d "$START_PATH" ; then
	    cd "$START_PATH"
	fi

	# clean up on abnormal exit
	$VERBOSE_ECHO "rm -rf autom4te.cache"
	rm -rf autom4te.cache

	if test -f "acinclude.m4.$$.backup" ; then
	    $VERBOSE_ECHO "cat acinclude.m4.$$.backup > acinclude.m4"
	    chmod u+w acinclude.m4
	    cat acinclude.m4.$$.backup > acinclude.m4

	    $VERBOSE_ECHO "rm -f acinclude.m4.$$.backup"
	    rm -f acinclude.m4.$$.backup
        fi

	{ (exit 1); exit 1; }
' $sig
done


#############################
# look for a configure file #
#############################
if [ "x$CONFIGURE" = "x" ] ; then
    CONFIGURE="`locate_configure_template`"
    if [ ! "x$CONFIGURE" = "x" ] ; then
	$VERBOSE_ECHO "Found a configure template: $CONFIGURE"
    fi
else
    $ECHO "Using CONFIGURE environment variable override: $CONFIGURE"
fi
if [ "x$CONFIGURE" = "x" ] ; then
    if [ "x$VERSION_ONLY" = "xyes" ] ; then
	CONFIGURE=/dev/null
    else
	$ECHO
	$ECHO "A configure.ac or configure.in file could not be located implying"
	$ECHO "that the GNU Build System is at least not used in this directory.  In"
	$ECHO "any case, there is nothing to do here without one of those files."
	$ECHO
	$ECHO "ERROR: No configure.in or configure.ac file found in `pwd`"
	exit 1
    fi
fi

####################
# get project name #
####################
if [ "x$PROJECT" = "x" ] ; then
    PROJECT="`grep AC_INIT $CONFIGURE | grep -v '.*#.*AC_INIT' | tail -${TAIL_N}1 | sed 's/^[ 	]*AC_INIT(\([^,)]*\).*/\1/' | sed 's/.*\[\(.*\)\].*/\1/'`"
    if [ "x$PROJECT" = "xAC_INIT" ] ; then
	# projects might be using the older/deprecated arg-less AC_INIT .. look for AM_INIT_AUTOMAKE instead
	PROJECT="`grep AM_INIT_AUTOMAKE $CONFIGURE | grep -v '.*#.*AM_INIT_AUTOMAKE' | tail -${TAIL_N}1 | sed 's/^[ 	]*AM_INIT_AUTOMAKE(\([^,)]*\).*/\1/' | sed 's/.*\[\(.*\)\].*/\1/'`"
    fi
    if [ "x$PROJECT" = "xAM_INIT_AUTOMAKE" ] ; then
	PROJECT="project"
    fi
    if [ "x$PROJECT" = "x" ] ; then
	PROJECT="project"
    fi
else
    $ECHO "Using PROJECT environment variable override: $PROJECT"
fi
$ECHO "Preparing the $PROJECT build system...please wait"
$ECHO


########################
# check for autoreconf #
########################
HAVE_AUTORECONF=no
if [ "x$AUTORECONF" = "x" ] ; then
    for AUTORECONF in autoreconf ; do
	$VERBOSE_ECHO "Checking autoreconf version: $AUTORECONF --version"
	$AUTORECONF --version > /dev/null 2>&1
	if [ $? = 0 ] ; then
	    HAVE_AUTORECONF=yes
	    break
	fi
    done
else
    HAVE_AUTORECONF=yes
    $ECHO "Using AUTORECONF environment variable override: $AUTORECONF"
fi


##########################
# autoconf version check #
##########################
_acfound=no
if [ "x$AUTOCONF" = "x" ] ; then
    for AUTOCONF in autoconf ; do
	$VERBOSE_ECHO "Checking autoconf version: $AUTOCONF --version"
	$AUTOCONF --version > /dev/null 2>&1
	if [ $? = 0 ] ; then
	    _acfound=yes
	    break
	fi
    done
else
    _acfound=yes
    $ECHO "Using AUTOCONF environment variable override: $AUTOCONF"
fi

_report_error=no
if [ ! "x$_acfound" = "xyes" ] ; then
    $ECHO "ERROR:  Unable to locate GNU Autoconf."
    _report_error=yes
else
    _version="`$AUTOCONF --version | head -${HEAD_N}1 | sed 's/[^0-9]*\([0-9\.][0-9\.]*\)/\1/'`"
    if [ "x$_version" = "x" ] ; then
	_version="0.0.0"
    fi
    $ECHO "Found GNU Autoconf version $_version"
    version_check "$AUTOCONF_VERSION" "$_version"
    if [ $? -ne 0 ] ; then
	_report_error=yes
    fi
fi
if [ "x$_report_error" = "xyes" ] ; then
    version_error "$AUTOCONF_VERSION" "GNU Autoconf"
    exit 1
fi


##########################
# automake version check #
##########################
_amfound=no
if [ "x$AUTOMAKE" = "x" ] ; then
    for AUTOMAKE in automake ; do
	$VERBOSE_ECHO "Checking automake version: $AUTOMAKE --version"
	$AUTOMAKE --version > /dev/null 2>&1
	if [ $? = 0 ] ; then
	    _amfound=yes
	    break
	fi
    done
else
    _amfound=yes
    $ECHO "Using AUTOMAKE environment variable override: $AUTOMAKE"
fi


_report_error=no
if [ ! "x$_amfound" = "xyes" ] ; then
    $ECHO
    $ECHO "ERROR: Unable to locate GNU Automake."
    _report_error=yes
else
    _version="`$AUTOMAKE --version | head -${HEAD_N}1 | sed 's/[^0-9]*\([0-9\.][0-9\.]*\)/\1/'`"
    if [ "x$_version" = "x" ] ; then
	_version="0.0.0"
    fi
    $ECHO "Found GNU Automake version $_version"
    version_check "$AUTOMAKE_VERSION" "$_version"
    if [ $? -ne 0 ] ; then
	_report_error=yes
    fi
fi
if [ "x$_report_error" = "xyes" ] ; then
    version_error "$AUTOMAKE_VERSION" "GNU Automake"
    exit 1
fi


########################
# check for libtoolize #
########################
HAVE_LIBTOOLIZE=yes
HAVE_ALT_LIBTOOLIZE=no
_ltfound=no
if [ "x$LIBTOOLIZE" = "x" ] ; then
    LIBTOOLIZE=libtoolize
    $VERBOSE_ECHO "Checking libtoolize version: $LIBTOOLIZE --version"
    $LIBTOOLIZE --version > /dev/null 2>&1
    if [ ! $? = 0 ] ; then
	HAVE_LIBTOOLIZE=no
	$ECHO
	if [ "x$HAVE_AUTORECONF" = "xno" ] ; then
	    $ECHO "Warning:  libtoolize does not appear to be available."
	else
	    $ECHO "Warning:  libtoolize does not appear to be available.  This means that"
	    $ECHO "the automatic build preparation via autoreconf will probably not work."
	    $ECHO "Preparing the build by running each step individually, however, should"
	    $ECHO "work and will be done automatically for you if autoreconf fails."
	fi

	# look for some alternates
	for tool in glibtoolize libtoolize15 libtoolize14 libtoolize13 ; do
	    $VERBOSE_ECHO "Checking libtoolize alternate: $tool --version"
	    _glibtoolize="`$tool --version > /dev/null 2>&1`"
	    if [ $? = 0 ] ; then
		$VERBOSE_ECHO "Found $tool --version"
		_glti="`which $tool`"
		if [ "x$_glti" = "x" ] ; then
		    $VERBOSE_ECHO "Cannot find $tool with which"
		    continue;
		fi
		if test ! -f "$_glti" ; then
		    $VERBOSE_ECHO "Cannot use $tool, $_glti is not a file"
		    continue;
		fi
		_gltidir="`dirname $_glti`"
		if [ "x$_gltidir" = "x" ] ; then
		    $VERBOSE_ECHO "Cannot find $tool path with dirname of $_glti"
		    continue;
		fi
		if test ! -d "$_gltidir" ; then
		    $VERBOSE_ECHO "Cannot use $tool, $_gltidir is not a directory"
		    continue;
		fi
		HAVE_ALT_LIBTOOLIZE=yes
		LIBTOOLIZE="$tool"
		$ECHO
		$ECHO "Fortunately, $tool was found which means that your system may simply"
		$ECHO "have a non-standard or incomplete GNU Autotools install.  If you have"
		$ECHO "sufficient system access, it may be possible to quell this warning by"
		$ECHO "running:"
		$ECHO
		sudo -V > /dev/null 2>&1
		if [ $? = 0 ] ; then
		    $ECHO "   sudo ln -s $_glti $_gltidir/libtoolize"
		    $ECHO
		else
		    $ECHO "   ln -s $_glti $_gltidir/libtoolize"
		    $ECHO
		    $ECHO "Run that as root or with proper permissions to the $_gltidir directory"
		    $ECHO
		fi
		_ltfound=yes
		break
	    fi
	done
    else
	_ltfound=yes
    fi
else
    _ltfound=yes
    $ECHO "Using LIBTOOLIZE environment variable override: $LIBTOOLIZE"
fi


############################
# libtoolize version check #
############################
_report_error=no
if [ ! "x$_ltfound" = "xyes" ] ; then
    $ECHO
    $ECHO "ERROR: Unable to locate GNU Libtool."
    _report_error=yes
else
    _version="`$LIBTOOLIZE --version | head -${HEAD_N}1 | sed 's/[^0-9]*\([0-9\.][0-9\.]*\)/\1/'`"
    if [ "x$_version" = "x" ] ; then
	_version="0.0.0"
    fi
    $ECHO "Found GNU Libtool version $_version"
    version_check "$LIBTOOL_VERSION" "$_version"
    if [ $? -ne 0 ] ; then
	_report_error=yes
    fi
fi
if [ "x$_report_error" = "xyes" ] ; then
    version_error "$LIBTOOL_VERSION" "GNU Libtool"
    exit 1
fi


#####################
# check for aclocal #
#####################
if [ "x$ACLOCAL" = "x" ] ; then
    for ACLOCAL in aclocal ; do
	$VERBOSE_ECHO "Checking aclocal version: $ACLOCAL --version"
	$ACLOCAL --version > /dev/null 2>&1
	if [ $? = 0 ] ; then
	    break
	fi
    done
else
    $ECHO "Using ACLOCAL environment variable override: $ACLOCAL"
fi


########################
# check for autoheader #
########################
if [ "x$AUTOHEADER" = "x" ] ; then
    for AUTOHEADER in autoheader ; do
	$VERBOSE_ECHO "Checking autoheader version: $AUTOHEADER --version"
	$AUTOHEADER --version > /dev/null 2>&1
	if [ $? = 0 ] ; then
	    break
	fi
    done
else
    $ECHO "Using AUTOHEADER environment variable override: $AUTOHEADER"
fi


#########################
# check if version only #
#########################
$VERBOSE_ECHO "Checking whether to only output version information"
if [ "x$VERSION_ONLY" = "xyes" ] ; then
    $ECHO
    ident
    $ECHO "---"
    $ECHO "Version requested.  No preparation or configuration will be performed."
    exit 0
fi


#################################
# PROTECT_FROM_CLOBBER FUNCTION #
#################################
protect_from_clobber ( ) {
    PFC_INIT=1

    # protect COPYING & INSTALL from overwrite by automake.  the
    # automake force option will (inappropriately) ignore the existing
    # contents of a COPYING and/or INSTALL files (depending on the
    # version) instead of just forcing *missing* files like it does
    # for AUTHORS, NEWS, and README. this is broken but extremely
    # prevalent behavior, so we protect against it by keeping a backup
    # of the file that can later be restored.

    if test -f COPYING ; then
	if test -f COPYING.$$.protect_from_automake.backup ; then
	    $VERBOSE_ECHO "Already backed up COPYING in `pwd`"
	else
	    $VERBOSE_ECHO "Backing up COPYING in `pwd`"
	    $VERBOSE_ECHO "cp -p COPYING COPYING.$$.protect_from_automake.backup"
	    cp -p COPYING COPYING.$$.protect_from_automake.backup
	fi
    fi
    if test -f INSTALL ; then
	if test -f INSTALL.$$.protect_from_automake.backup ; then
	    $VERBOSE_ECHO "Already backed up INSTALL in `pwd`"
	else
	    $VERBOSE_ECHO "Backing up INSTALL in `pwd`"
	    $VERBOSE_ECHO "cp -p INSTALL INSTALL.$$.protect_from_automake.backup"
	    cp -p INSTALL INSTALL.$$.protect_from_automake.backup
	fi
    fi
}


##############################
# RECURSIVE_PROTECT FUNCTION #
##############################
recursive_protect ( ) {

    # for projects using recursive configure, run the build
    # preparation steps for the subdirectories.  this function assumes
    # START_PATH was set to pwd before recursion begins so that
    # relative paths work.

    # git 'r done, protect COPYING and INSTALL from being clobbered
    protect_from_clobber

    if test -d autom4te.cache ; then
	$VERBOSE_ECHO "Found an autom4te.cache directory, deleting it"
	$VERBOSE_ECHO "rm -rf autom4te.cache"
	rm -rf autom4te.cache
    fi

    # find configure template
    _configure="`locate_configure_template`"
    if [ "x$_configure" = "x" ] ; then
	return
    fi
    # $VERBOSE_ECHO "Looking for configure template found `pwd`/$_configure"

    # look for subdirs
    # $VERBOSE_ECHO "Looking for subdirs in `pwd`"
    _det_config_subdirs="`grep AC_CONFIG_SUBDIRS $_configure | grep -v '.*#.*AC_CONFIG_SUBDIRS' | sed 's/^[ 	]*AC_CONFIG_SUBDIRS(\(.*\)).*/\1/' | sed 's/.*\[\(.*\)\].*/\1/'`"
    CHECK_DIRS=""
    for dir in $_det_config_subdirs ; do
	if test -d "`pwd`/$dir" ; then
	    CHECK_DIRS="$CHECK_DIRS \"`pwd`/$dir\""
	fi
    done

    # process subdirs
    if [ ! "x$CHECK_DIRS" = "x" ] ; then
	$VERBOSE_ECHO "Recursively scanning the following directories:"
	$VERBOSE_ECHO "  $CHECK_DIRS"
	for dir in $CHECK_DIRS ; do
	    $VERBOSE_ECHO "Protecting files from automake in $dir"
	    cd "$START_PATH"
	    eval "cd $dir"

	    # recursively git 'r done
	    recursive_protect
	done
    fi
} # end of recursive_protect


#############################
# RESTORE_CLOBBERED FUNCION #
#############################
restore_clobbered ( ) {

    # The automake (and autoreconf by extension) -f/--force-missing
    # option may overwrite COPYING and INSTALL even if they do exist.
    # Here we restore the files if necessary.

    spacer=no

    # COPYING
    if test -f COPYING.$$.protect_from_automake.backup ; then
	if test -f COPYING ; then
	    # compare entire content, restore if needed
	    if test "x`cat COPYING`" != "x`cat COPYING.$$.protect_from_automake.backup`" ; then
		if test "x$spacer" = "xno" ; then
		    $VERBOSE_ECHO
		    spacer=yes
		fi
		# restore the backup
		$VERBOSE_ECHO "Restoring COPYING from backup (automake -f likely clobbered it)"
		$VERBOSE_ECHO "rm -f COPYING"
		rm -f COPYING
		$VERBOSE_ECHO "mv COPYING.$$.protect_from_automake.backup COPYING"
		mv COPYING.$$.protect_from_automake.backup COPYING
	    fi # check contents
	elif test -f COPYING.$$.protect_from_automake.backup ; then
	    $VERBOSE_ECHO "mv COPYING.$$.protect_from_automake.backup COPYING"
	    mv COPYING.$$.protect_from_automake.backup COPYING
	fi # -f COPYING

	# just in case
	$VERBOSE_ECHO "rm -f COPYING.$$.protect_from_automake.backup"
	rm -f COPYING.$$.protect_from_automake.backup
    fi # -f COPYING.$$.protect_from_automake.backup

    # INSTALL
    if test -f INSTALL.$$.protect_from_automake.backup ; then
	if test -f INSTALL ; then
	    # compare entire content, restore if needed
	    if test "x`cat INSTALL`" != "x`cat INSTALL.$$.protect_from_automake.backup`" ; then
		if test "x$spacer" = "xno" ; then
		    $VERBOSE_ECHO
		    spacer=yes
		fi
		# restore the backup
		$VERBOSE_ECHO "Restoring INSTALL from backup (automake -f likely clobbered it)"
		$VERBOSE_ECHO "rm -f INSTALL"
		rm -f INSTALL
		$VERBOSE_ECHO "mv INSTALL.$$.protect_from_automake.backup INSTALL"
		mv INSTALL.$$.protect_from_automake.backup INSTALL
	    fi # check contents
	elif test -f INSTALL.$$.protect_from_automake.backup ; then
	    $VERBOSE_ECHO "mv INSTALL.$$.protect_from_automake.backup INSTALL"
	    mv INSTALL.$$.protect_from_automake.backup INSTALL
	fi # -f INSTALL

	# just in case
	$VERBOSE_ECHO "rm -f INSTALL.$$.protect_from_automake.backup"
	rm -f INSTALL.$$.protect_from_automake.backup
    fi # -f INSTALL.$$.protect_from_automake.backup

    CONFIGURE="`locate_configure_template`"
    if [ "x$CONFIGURE" = "x" ] ; then
	return
    fi

    _aux_dir="`grep AC_CONFIG_AUX_DIR $CONFIGURE | grep -v '.*#.*AC_CONFIG_AUX_DIR' | tail -${TAIL_N}1 | sed 's/^[ 	]*AC_CONFIG_AUX_DIR(\(.*\)).*/\1/' | sed 's/.*\[\(.*\)\].*/\1/'`"
    if test ! -d "$_aux_dir" ; then
	_aux_dir=.
    fi

    for file in config.guess config.sub ltmain.sh ; do
	if test -f "${_aux_dir}/${file}" ; then
	    $VERBOSE_ECHO "rm -f \"${_aux_dir}/${file}.backup\""
	    rm -f "${_aux_dir}/${file}.backup"
	fi
    done
} # end of restore_clobbered


##############################
# RECURSIVE_RESTORE FUNCTION #
##############################
recursive_restore ( ) {

    # restore COPYING and INSTALL from backup if they were clobbered
    # for each directory recursively.

    # git 'r undone
    restore_clobbered

    # find configure template
    _configure="`locate_configure_template`"
    if [ "x$_configure" = "x" ] ; then
	return
    fi

    # look for subdirs
    _det_config_subdirs="`grep AC_CONFIG_SUBDIRS $_configure | grep -v '.*#.*AC_CONFIG_SUBDIRS' | sed 's/^[ 	]*AC_CONFIG_SUBDIRS(\(.*\)).*/\1/' | sed 's/.*\[\(.*\)\].*/\1/'`"
    CHECK_DIRS=""
    for dir in $_det_config_subdirs ; do
	if test -d "`pwd`/$dir" ; then
	    CHECK_DIRS="$CHECK_DIRS \"`pwd`/$dir\""
	fi
    done

    # process subdirs
    if [ ! "x$CHECK_DIRS" = "x" ] ; then
	$VERBOSE_ECHO "Recursively scanning the following directories:"
	$VERBOSE_ECHO "  $CHECK_DIRS"
	for dir in $CHECK_DIRS ; do
	    $VERBOSE_ECHO "Checking files for automake damage in $dir"
	    cd "$START_PATH"
	    eval "cd $dir"

	    # recursively git 'r undone
	    recursive_restore
	done
    fi
} # end of recursive_restore


#######################
# INITIALIZE FUNCTION #
#######################
initialize ( ) {

    # this routine performs a variety of directory-specific
    # initializations.  some are sanity checks, some are preventive,
    # and some are necessary setup detection.
    #
    # this function sets:
    #   CONFIGURE
    #   SEARCH_DIRS
    #   CONFIG_SUBDIRS

    ##################################
    # check for a configure template #
    ##################################
    CONFIGURE="`locate_configure_template`"
    if [ "x$CONFIGURE" = "x" ] ; then
	$ECHO
	$ECHO "A configure.ac or configure.in file could not be located implying"
	$ECHO "that the GNU Build System is at least not used in this directory.  In"
	$ECHO "any case, there is nothing to do here without one of those files."
	$ECHO
	$ECHO "ERROR: No configure.in or configure.ac file found in `pwd`"
	exit 1
    fi

    #####################
    # detect an aux dir #
    #####################
    _aux_dir="`grep AC_CONFIG_AUX_DIR $CONFIGURE | grep -v '.*#.*AC_CONFIG_AUX_DIR' | tail -${TAIL_N}1 | sed 's/^[ 	]*AC_CONFIG_AUX_DIR(\(.*\)).*/\1/' | sed 's/.*\[\(.*\)\].*/\1/'`"
    if test ! -d "$_aux_dir" ; then
	_aux_dir=.
    else
	$VERBOSE_ECHO "Detected auxillary directory: $_aux_dir"
    fi

    ################################
    # detect a recursive configure #
    ################################
    CONFIG_SUBDIRS=""
    _det_config_subdirs="`grep AC_CONFIG_SUBDIRS $CONFIGURE | grep -v '.*#.*AC_CONFIG_SUBDIRS' | sed 's/^[ 	]*AC_CONFIG_SUBDIRS(\(.*\)).*/\1/' | sed 's/.*\[\(.*\)\].*/\1/'`"
    for dir in $_det_config_subdirs ; do
	if test -d "`pwd`/$dir" ; then
	    $VERBOSE_ECHO "Detected recursive configure directory: `pwd`/$dir"
	    CONFIG_SUBDIRS="$CONFIG_SUBDIRS `pwd`/$dir"
	fi
    done

    ##########################################
    # make sure certain required files exist #
    ##########################################
    for file in AUTHORS COPYING ChangeLog INSTALL NEWS README ; do
	if test ! -f $file ; then
	    $VERBOSE_ECHO "Touching ${file} since it does not exist"
	    touch $file
	fi
    done

    ##################################################
    # make sure certain generated files do not exist #
    ##################################################
    for file in config.guess config.sub ltmain.sh ; do
	if test -f "${_aux_dir}/${file}" ; then
	    $VERBOSE_ECHO "mv -f \"${_aux_dir}/${file}\" \"${_aux_dir}/${file}.backup\""
	    mv -f "${_aux_dir}/${file}" "${_aux_dir}/${file}.backup"
	fi
    done

    ############################
    # search alternate m4 dirs #
    ############################
    SEARCH_DIRS=""
    for dir in m4 ; do
	if [ -d $dir ] ; then
	    $VERBOSE_ECHO "Found extra aclocal search directory: $dir"
	    SEARCH_DIRS="$SEARCH_DIRS -I $dir"
	fi
    done

    ######################################
    # remove any previous build products #
    ######################################
    if test -d autom4te.cache ; then
	$VERBOSE_ECHO "Found an autom4te.cache directory, deleting it"
	$VERBOSE_ECHO "rm -rf autom4te.cache"
	rm -rf autom4te.cache
    fi
# tcl/tk (and probably others) have a customized aclocal.m4, so can't delete it
#     if test -f aclocal.m4 ; then
# 	$VERBOSE_ECHO "Found an aclocal.m4 file, deleting it"
# 	$VERBOSE_ECHO "rm -f aclocal.m4"
# 	rm -f aclocal.m4
#     fi

} # end of initialize()


##############
# initialize #
##############

# stash path
START_PATH="`pwd`"

# Before running autoreconf or manual steps, some prep detection work
# is necessary or useful.  Only needs to occur once per directory, but
# does need to traverse the entire subconfigure hierarchy to protect
# files from being clobbered even by autoreconf.
recursive_protect

# start from where we started
cd "$START_PATH"

# get ready to process
initialize


############################################
# prepare build via autoreconf or manually #
############################################
reconfigure_manually=no
if [ "x$HAVE_AUTORECONF" = "xyes" ] ; then
    $ECHO
    $ECHO $ECHO_N "Automatically preparing build ... $ECHO_C"

    $VERBOSE_ECHO "$AUTORECONF $SEARCH_DIRS $AUTORECONF_OPTIONS"
    autoreconf_output="`$AUTORECONF $SEARCH_DIRS $AUTORECONF_OPTIONS 2>&1`"
    ret=$?
    $VERBOSE_ECHO "$autoreconf_output"

    if [ ! $ret = 0 ] ; then
	if [ "x$HAVE_ALT_LIBTOOLIZE" = "xyes" ] ; then
	    if [ ! "x`echo \"$autoreconf_output\" | grep libtoolize | grep \"No such file or directory\"`" = "x" ] ; then
		$ECHO
		$ECHO "Warning: autoreconf failed but due to what is usually a common libtool"
		$ECHO "misconfiguration issue.  This problem is encountered on systems that"
		$ECHO "have installed libtoolize under a different name without providing a"
		$ECHO "symbolic link or without setting the LIBTOOLIZE environment variable."
		$ECHO
		$ECHO "Restarting the preparation steps with LIBTOOLIZE set to $LIBTOOLIZE"

		export LIBTOOLIZE
		RUN_RECURSIVE=no
		export RUN_RECURSIVE
		untrap_abnormal

		$VERBOSE_ECHO sh $AUTOGEN_SH "$1" "$2" "$3" "$4" "$5" "$6" "$7" "$8" "$9"
		sh "$AUTOGEN_SH" "$1" "$2" "$3" "$4" "$5" "$6" "$7" "$8" "$9"
		exit $?
	    fi
	fi

	$ECHO "Warning: $AUTORECONF failed"

	if test -f ltmain.sh ; then
	    $ECHO "libtoolize being run by autoreconf is not creating ltmain.sh in the auxillary directory like it should"
	fi

	$ECHO "Attempting to run the preparation steps individually"
	reconfigure_manually=yes
    fi
else
    reconfigure_manually=yes
fi


############################
# LIBTOOL_FAILURE FUNCTION #
############################
libtool_failure ( ) {

    # libtool is rather error-prone in comparison to the other
    # autotools and this routine attempts to compensate for some
    # common failures.  the output after a libtoolize failure is
    # parsed for an error related to AC_PROG_LIBTOOL and if found, we
    # attempt to inject a project-provided libtool.m4 file.

    _autoconf_output="$1"

    if [ "x$RUN_RECURSIVE" = "xno" ] ; then
	# we already tried the libtool.m4, don't try again
	return 1
    fi

    if test -f "$LIBTOOL_M4" ; then
	found_libtool="`$ECHO $_autoconf_output | grep AC_PROG_LIBTOOL`"
	if test ! "x$found_libtool" = "x" ; then
	    if test -f acinclude.m4 ; then
		rm -f acinclude.m4.$$.backup
		$VERBOSE_ECHO "cat acinclude.m4 > acinclude.m4.$$.backup"
		cat acinclude.m4 > acinclude.m4.$$.backup
	    fi
	    $VERBOSE_ECHO "cat \"$LIBTOOL_M4\" >> acinclude.m4"
	    chmod u+w acinclude.m4
	    cat "$LIBTOOL_M4" >> acinclude.m4

	    # don't keep doing this
	    RUN_RECURSIVE=no
	    export RUN_RECURSIVE
	    untrap_abnormal

	    $ECHO
	    $ECHO "Restarting the preparation steps with libtool macros in acinclude.m4"
	    $VERBOSE_ECHO sh $AUTOGEN_SH "$1" "$2" "$3" "$4" "$5" "$6" "$7" "$8" "$9"
	    sh "$AUTOGEN_SH" "$1" "$2" "$3" "$4" "$5" "$6" "$7" "$8" "$9"
	    exit $?
	fi
    fi
}


###########################
# MANUAL_AUTOGEN FUNCTION #
###########################
manual_autogen ( ) {

    ##################################################
    # Manual preparation steps taken are as follows: #
    #   aclocal [-I m4]                              #
    #   libtoolize --automake -c -f                  #
    #   aclocal [-I m4]                              #
    #   autoconf -f                                  #
    #   autoheader                                   #
    #   automake -a -c -f                            #
    ##################################################

    ###########
    # aclocal #
    ###########
    $VERBOSE_ECHO "$ACLOCAL $SEARCH_DIRS $ACLOCAL_OPTIONS"
    aclocal_output="`$ACLOCAL $SEARCH_DIRS $ACLOCAL_OPTIONS 2>&1`"
    ret=$?
    $VERBOSE_ECHO "$aclocal_output"
    if [ ! $ret = 0 ] ; then $ECHO "ERROR: $ACLOCAL failed" && exit 2 ; fi

    ##############
    # libtoolize #
    ##############
    need_libtoolize=no
    for feature in AC_PROG_LIBTOOL LT_INIT ; do
	$VERBOSE_ECHO "Searching for $feature in $CONFIGURE"
	found="`grep \"^$feature.*\" $CONFIGURE`"
	if [ ! "x$found" = "x" ] ; then
	    need_libtoolize=yes
	    break
	fi
    done
    if [ "x$need_libtoolize" = "xyes" ] ; then
	if [ "x$HAVE_LIBTOOLIZE" = "xyes" ] ; then
	    $VERBOSE_ECHO "$LIBTOOLIZE $LIBTOOLIZE_OPTIONS"
	    libtoolize_output="`$LIBTOOLIZE $LIBTOOLIZE_OPTIONS 2>&1`"
	    ret=$?
	    $VERBOSE_ECHO "$libtoolize_output"

	    if [ ! $ret = 0 ] ; then $ECHO "ERROR: $LIBTOOLIZE failed" && exit 2 ; fi
	else
	    if [ "x$HAVE_ALT_LIBTOOLIZE" = "xyes" ] ; then
		$VERBOSE_ECHO "$LIBTOOLIZE $ALT_LIBTOOLIZE_OPTIONS"
		libtoolize_output="`$LIBTOOLIZE $ALT_LIBTOOLIZE_OPTIONS 2>&1`"
		ret=$?
		$VERBOSE_ECHO "$libtoolize_output"

		if [ ! $ret = 0 ] ; then $ECHO "ERROR: $LIBTOOLIZE failed" && exit 2 ; fi
	    fi
	fi

	###########
	# aclocal #
	###########
	# re-run again as instructed by libtoolize
	$VERBOSE_ECHO "$ACLOCAL $SEARCH_DIRS $ACLOCAL_OPTIONS"
	aclocal_output="`$ACLOCAL $SEARCH_DIRS $ACLOCAL_OPTIONS 2>&1`"
	ret=$?
	$VERBOSE_ECHO "$aclocal_output"

	# libtoolize might put ltmain.sh in the wrong place
	if test -f ltmain.sh ; then
	    if test ! -f "${_aux_dir}/ltmain.sh" ; then
		$ECHO
		$ECHO "Warning:  $LIBTOOLIZE is creating ltmain.sh in the wrong directory"
		$ECHO
		$ECHO "Fortunately, the problem can be worked around by simply copying the"
		$ECHO "file to the appropriate location (${_aux_dir}/).  This has been done for you."
		$ECHO
		$VERBOSE_ECHO "cp -p ltmain.sh \"${_aux_dir}/ltmain.sh\""
		cp -p ltmain.sh "${_aux_dir}/ltmain.sh"
		$ECHO $ECHO_N "Continuing build preparation ... $ECHO_C"
	    fi
	fi # ltmain.sh
    fi # need_libtoolize

    ############
    # autoconf #
    ############
    $VERBOSE_ECHO
    $VERBOSE_ECHO "$AUTOCONF $AUTOCONF_OPTIONS"
    autoconf_output="`$AUTOCONF $AUTOCONF_OPTIONS 2>&1`"
    ret=$?
    $VERBOSE_ECHO "$autoconf_output"

    if [ ! $ret = 0 ] ; then
	# retry without the -f and check for usage of macros that are too new
	ac2_59_macros="AC_C_RESTRICT AC_INCLUDES_DEFAULT AC_LANG_ASSERT AC_LANG_WERROR AS_SET_CATFILE"
	ac2_55_macros="AC_COMPILER_IFELSE AC_FUNC_MBRTOWC AC_HEADER_STDBOOL AC_LANG_CONFTEST AC_LANG_SOURCE AC_LANG_PROGRAM AC_LANG_CALL AC_LANG_FUNC_TRY_LINK AC_MSG_FAILURE AC_PREPROC_IFELSE"
	ac2_54_macros="AC_C_BACKSLASH_A AC_CONFIG_LIBOBJ_DIR AC_GNU_SOURCE AC_PROG_EGREP AC_PROG_FGREP AC_REPLACE_FNMATCH AC_FUNC_FNMATCH_GNU AC_FUNC_REALLOC AC_TYPE_MBSTATE_T"

	macros_to_search=""
	ac_major="`echo ${AUTOCONF_VERSION}. | cut -d. -f1 | sed 's/[^0-9]//g'`"
	ac_minor="`echo ${AUTOCONF_VERSION}. | cut -d. -f2 | sed 's/[^0-9]//g'`"

	if [ $ac_major -lt 2 ] ; then
	    macros_to_search="$ac2_59_macros $ac2_55_macros $ac2_54_macros"
	else
	    if [ $ac_minor -lt 54 ] ; then
		macros_to_search="$ac2_59_macros $ac2_55_macros $ac2_54_macros"
	    elif [ $ac_minor -lt 55 ] ; then
		macros_to_search="$ac2_59_macros $ac2_55_macros"
	    elif [ $ac_minor -lt 59 ] ; then
		macros_to_search="$ac2_59_macros"
	    fi
	fi

	configure_ac_macros=__none__
	for feature in $macros_to_search ; do
	    $VERBOSE_ECHO "Searching for $feature in $CONFIGURE"
	    found="`grep \"^$feature.*\" $CONFIGURE`"
	    if [ ! "x$found" = "x" ] ; then
		if [ "x$configure_ac_macros" = "x__none__" ] ; then
		    configure_ac_macros="$feature"
		else
		    configure_ac_macros="$feature $configure_ac_macros"
		fi
	    fi
	done
	if [ ! "x$configure_ac_macros" = "x__none__" ] ; then
	    $ECHO
	    $ECHO "Warning:  Unsupported macros were found in $CONFIGURE"
	    $ECHO
	    $ECHO "The `echo $CONFIGURE | basename` file was scanned in order to determine if any"
	    $ECHO "unsupported macros are used that exceed the minimum version"
	    $ECHO "settings specified within this file.  As such, the following macros"
	    $ECHO "should be removed from configure.ac or the version numbers in this"
	    $ECHO "file should be increased:"
	    $ECHO
	    $ECHO "$configure_ac_macros"
	    $ECHO
	    $ECHO $ECHO_N "Ignorantly continuing build preparation ... $ECHO_C"
	fi

	###################
	# autoconf, retry #
	###################
	$VERBOSE_ECHO
	$VERBOSE_ECHO "$AUTOCONF"
	autoconf_output="`$AUTOCONF 2>&1`"
	ret=$?
	$VERBOSE_ECHO "$autoconf_output"

	if [ ! $ret = 0 ] ; then
	    # test if libtool is busted
	    libtool_failure "$autoconf_output"

	    # let the user know what went wrong
	    cat <<EOF
$autoconf_output
EOF
	    $ECHO "ERROR: $AUTOCONF failed"
	    exit 2
	else
	    # autoconf sans -f and possibly sans unsupported options succeed so warn verbosely
	    $ECHO
	    $ECHO "Warning: autoconf seems to have succeeded by removing the following options:"
	    $ECHO "	AUTOCONF_OPTIONS=\"$AUTOCONF_OPTIONS\""
	    $ECHO
	    $ECHO "Removing those options should not be necessary and indicate some other"
	    $ECHO "problem with the build system.  The build preparation is highly suspect"
	    $ECHO "and may result in configuration or compilation errors.  Consider"
	    if [ "x$VERBOSE_ECHO" = "x:" ] ; then
		$ECHO "rerunning the build preparation with verbose output enabled."
		$ECHO "	$AUTOGEN_SH --verbose"
	    else
		$ECHO "reviewing the minimum GNU Autotools version settings contained in"
		$ECHO "this script along with the macros being used in your `echo $CONFIGURE | basename` file."
	    fi
	    $ECHO
	    $ECHO $ECHO_N "Continuing build preparation ... $ECHO_C"
	fi # autoconf ret = 0
    fi # autoconf ret = 0

    ##############
    # autoheader #
    ##############
    need_autoheader=no
    for feature in AM_CONFIG_HEADER AC_CONFIG_HEADER ; do
	$VERBOSE_ECHO "Searching for $feature in $CONFIGURE"
	found="`grep \"^$feature.*\" $CONFIGURE`"
	if [ ! "x$found" = "x" ] ; then
	    need_autoheader=yes
	    break
	fi
    done
    if [ "x$need_autoheader" = "xyes" ] ; then
	$VERBOSE_ECHO "$AUTOHEADER $AUTOHEADER_OPTIONS"
	autoheader_output="`$AUTOHEADER $AUTOHEADER_OPTIONS 2>&1`"
	ret=$?
	$VERBOSE_ECHO "$autoheader_output"
	if [ ! $ret = 0 ] ; then $ECHO "ERROR: $AUTOHEADER failed" && exit 2 ; fi
    fi # need_autoheader

    ############
    # automake #
    ############
    need_automake=no
    for feature in AM_INIT_AUTOMAKE ; do
	$VERBOSE_ECHO "Searching for $feature in $CONFIGURE"
	found="`grep \"^$feature.*\" $CONFIGURE`"
	if [ ! "x$found" = "x" ] ; then
	    need_automake=yes
	    break
	fi
    done

    if [ "x$need_automake" = "xyes" ] ; then
	$VERBOSE_ECHO "$AUTOMAKE $AUTOMAKE_OPTIONS"
	automake_output="`$AUTOMAKE $AUTOMAKE_OPTIONS 2>&1`"
	ret=$?
	$VERBOSE_ECHO "$automake_output"

	if [ ! $ret = 0 ] ; then

	    ###################
	    # automake, retry #
	    ###################
	    $VERBOSE_ECHO
	    $VERBOSE_ECHO "$AUTOMAKE $ALT_AUTOMAKE_OPTIONS"
	    # retry without the -f
	    automake_output="`$AUTOMAKE $ALT_AUTOMAKE_OPTIONS 2>&1`"
	    ret=$?
	    $VERBOSE_ECHO "$automake_output"

	    if [ ! $ret = 0 ] ; then
	 	# test if libtool is busted
		libtool_failure "$automake_output"

		# let the user know what went wrong
		cat <<EOF
$automake_output
EOF
		$ECHO "ERROR: $AUTOMAKE failed"
		exit 2
	    fi # automake retry
	fi # automake ret = 0
    fi # need_automake
} # end of manual_autogen


#####################################
# RECURSIVE_MANUAL_AUTOGEN FUNCTION #
#####################################
recursive_manual_autogen ( ) {

    # run the build preparation steps manually for this directory
    manual_autogen

    # for projects using recursive configure, run the build
    # preparation steps for the subdirectories.
    if [ ! "x$CONFIG_SUBDIRS" = "x" ] ; then
	$VERBOSE_ECHO "Recursively configuring the following directories:"
	$VERBOSE_ECHO "  $CONFIG_SUBDIRS"
	for dir in $CONFIG_SUBDIRS ; do
	    $VERBOSE_ECHO "Processing recursive configure in $dir"
	    cd "$START_PATH"
	    cd "$dir"

	    # new directory, prepare
	    initialize

	    # run manual steps for the subdir and any others below
	    recursive_manual_autogen
	done
    fi
}


################################
# run manual preparation steps #
################################
if [ "x$reconfigure_manually" = "xyes" ] ; then
    $ECHO
    $ECHO $ECHO_N "Preparing build ... $ECHO_C"

    recursive_manual_autogen
fi


#########################
# restore and summarize #
#########################
cd "$START_PATH"

# restore COPYING and INSTALL from backup if necessary
recursive_restore

# make sure we end up with a configure script
config_ac="`locate_configure_template`"
config="`echo $config_ac | sed 's/\.ac$//' | sed 's/\.in$//'`"
if [ "x$config" = "x" ] ; then
    $VERBOSE_ECHO "Could not locate the configure template (from `pwd`)"
fi

# summarize
$ECHO "done"
$ECHO
if test "x$config" = "x" -o ! -f "$config" ; then
    $ECHO "WARNING: The $PROJECT build system should now be prepared but there"
    $ECHO "does not seem to be a resulting configure file.  This is unexpected"
    $ECHO "and likely the result of an error.  You should run $NAME_OF_AUTOGEN"
    $ECHO "with the --verbose option to get more details on a potential"
    $ECHO "misconfiguration."
else
    $ECHO "The $PROJECT build system is now prepared.  To build here, run:"
    $ECHO "  $config"
    $ECHO "  make"
fi


# Local Variables:
# mode: sh
# tab-width: 8
# sh-basic-offset: 4
# sh-indentation: 4
# indent-tabs-mode: t
# End:
# ex: shiftwidth=4 tabstop=8
@


14.97
log
@report the directory when we can't find configure.ac
@
text
@d101 1
a101 1
    __id="$Id: autogen.sh,v 14.96 2007/05/27 04:28:19 brlcad Exp $"
d587 1
a587 1
    version_check "$AUTOMAKE_VERSION" "$_version" 
d689 1
a689 1
    version_check "$LIBTOOL_VERSION" "$_version" 
d1211 1
a1211 1
	    
d1219 1
a1219 1
		
d1267 1
a1267 1
	
d1385 1
a1385 1
	
d1397 1
a1397 1
	    
@


14.96
log
@oops, one char typo -- try again
@
text
@d101 1
a101 1
    __id="$Id: autogen.sh,v 14.95 2007/05/27 04:21:23 brlcad Exp $"
d472 1
a472 1
	$ECHO "ERROR: No configure.in or configure.ac file found."
d980 1
a980 1
	$ECHO "ERROR: No configure.in or configure.ac file found."
@


14.95
log
@gnu sed apparently doesn't read from stdin, so make a custom test for it.
@
text
@d101 1
a101 1
    __id="$Id: autogen.sh,v 14.94 2007/05/26 22:39:18 brlcad Exp $"
d339 1
a339 1
echo "test" | sed "s/test/test" > /dev/null 2>&1
@


14.94
log
@search for sed and pwd
@
text
@d101 1
a101 1
    __id="$Id: autogen.sh,v 14.93 2007/05/18 05:04:15 brlcad Exp $"
d327 1
a327 1
for __cmd in echo head tail sed pwd ; do
d334 11
@


14.93
log
@include a contact e-mail
@
text
@d101 1
a101 1
    __id="$Id: autogen.sh,v 14.92 2007/05/17 19:02:33 brlcad Exp $"
d327 1
a327 1
for __cmd in echo head tail ; do
a368 5
_have_sed="`echo no | sed 's/no/yes/' 2>/dev/null`"
if [ $? -ne 0 ] ; then
    $ECHO "ERROR:  sed does not appear to be available."
    exit 2
fi
@


14.92
log
@grr, newer versions of automake replace the clobbered COPYING/INSTALL files with mode 444.  delete them if we're going to restore.
@
text
@d72 1
a72 1
# Author: Christopher Sean Morrison
d101 1
a101 1
    __id="$Id: autogen.sh,v 14.91 2007/05/17 04:43:22 brlcad Exp $"
@


14.91
log
@fix a bug where an automake failure after a libtool failure resulted in silent termination instead of showing the automake error.
@
text
@d101 1
a101 1
    __id="$Id: autogen.sh,v 14.90 2007/05/09 05:55:51 brlcad Exp $"
d434 1
d836 2
d848 4
a851 2
		$VERBOSE_ECHO "cat COPYING.$$.protect_from_automake.backup > COPYING"
		cat COPYING.$$.protect_from_automake.backup > COPYING
a852 2
	    $VERBOSE_ECHO "rm -f COPYING.$$.protect_from_automake.backup"
	    rm -f COPYING.$$.protect_from_automake.backup
d857 4
d862 2
d874 4
a877 2
		$VERBOSE_ECHO "cat INSTALL.$$.protect_from_automake.backup > INSTALL"
		cat INSTALL.$$.protect_from_automake.backup > INSTALL
a878 2
	    $VERBOSE_ECHO "rm -f INSTALL.$$.protect_from_automake.backup"
	    rm -f INSTALL.$$.protect_from_automake.backup
d883 4
d1145 1
@


14.90
log
@change the trap cleanup awesomeness so that we only untrap the abnormal signals when invoking a subshell (so proper protect_from_automake backup files are all cleaned up correctly).  remove need for SIGNAL var with a little restructuring.
@
text
@d101 1
a101 1
    __id="$Id: autogen.sh,v 14.89 2007/05/09 04:04:07 brlcad Exp $"
d1120 1
a1120 1
	exit 5
a1228 1

d1359 1
d1367 1
a1378 1
		
d1386 3
a1388 3
	    fi
	    $ECHO "ERROR: $AUTOMAKE failed"
	    exit 2
@


14.89
log
@dear ghod, how did that typo go undetected for so long .. we need to run automake during manual steps
@
text
@d101 1
a101 1
    __id="$Id: autogen.sh,v 14.88 2007/05/09 03:34:52 brlcad Exp $"
d398 7
a405 10
    # do this cleanup whenever we exit.

    if test "$SIGNAL" != 0 ; then
	$ECHO ""
	$ECHO "Aborting $NAME_OF_AUTOGEN: caught signal $SIGNAL"

	# clear out the signal
        SIGNAL=0
    fi

d415 1
d417 12
a428 2
    # clean up on abnormal exit
    if test "x$SIGNAL" != "x0" ; then
d438 1
a438 3
	fi
    fi
' 0
d440 2
a441 3
# trap SIGHUP (1), SIGINT (2), SIGPIPE (13), SIGTERM (15)
for sig in 1 2 13 15; do
    trap 'SIGNAL='$sig'; { (exit 1); exit 1; }' $sig
a442 1
SIGNAL=0
d848 1
d868 1
d1083 1
a1083 1
		trap - 0
d1137 1
a1137 1
	    trap - 0
@


14.88
log
@readd support for running to completion even if there's no configure.ac file (e.g. when trying to just check --version results)
@
text
@d101 1
a101 1
    __id="$Id: autogen.sh,v 14.87 2007/05/04 21:50:11 brlcad Exp $"
d1350 1
a1350 1
	    config_header=yes
@


14.87
log
@clean up after all backup files, starting from the source root
@
text
@d101 1
a101 1
    __id="$Id: autogen.sh 14179 2007-05-04 04:16:22Z brlcad $"
a394 11
#############################
# look for a configure file #
#############################
if [ "x$CONFIGURE" = "x" ] ; then
    CONFIGURE="`locate_configure_template`"
    $VERBOSE_ECHO "Found a configure template: $CONFIGURE"
else
    $ECHO "Using CONFIGURE environment variable override: $CONFIGURE"
fi


d441 25
@


14.86
log
@revert the stashing of COPYING and INSTALL into memory due to issues with a handful of shells/environments where it would cause unpredictable shell behavior.  instead, save backup files as needed (recursively).  additional awesomeness, set up trap signal handlers to clean up regardless of how/when autogen.sh terminates or is otherwise aborted.
@
text
@d101 1
a101 1
    __id="$Id: autogen.sh,v 14.85 2007/04/29 06:01:46 brlcad Exp $"
d420 5
d856 16
@


14.85
log
@fix recursive configure support for when the recursion goes more than one level deep.  add more documentation on example use and vars that can be overridden.
@
text
@d101 1
a101 1
    __id="$Id: autogen.sh 13974 2007-04-05 14:10:45Z brlcad $"
d406 41
a714 16
###################
# ESCAPE_FUNCTION #
###################
escape ( ) {
    echo "$*" | sed 's/\$/AG_D_SH/g' | sed 's/`/AG_B_SH/g' | sed 's/"/AG_Q_SH/g' | sed "s/'/AG_S_SH/g"
}


#####################
# UNESCAPE_FUNCTION #
#####################
unescape ( ) {
    echo "$*" | sed "s/AG_S_SH/'/g" | sed 's/AG_Q_SH/"/g' | sed 's/AG_B_SH/`/g' | sed 's/AG_D_SH/$/g'
}


d719 1
d727 1
a727 2
    # of the file contents (in a path-specific variable) that can
    # later be restored.
d729 7
a735 16
    COPYING_NAME="`pwd | sed 's/[^a-zA-Z]//g'`COPYING_BACKUP"
    cmd="echo \"\$$COPYING_NAME\""
    contents="`eval $cmd`"
    if [ "x$contents" = "x" ] ; then
	eval "${COPYING_NAME}=__none__"
	if test -f COPYING ; then
	    contents="`cat COPYING`"
            # make sure the file actually fits in memory
	    if [ "x`echo \"$contents\"`" = "x`cat COPYING`" ] ; then
		$VERBOSE_ECHO "Stashing an in-memory backup of COPYING"
		stash="${COPYING_NAME}=\"`escape \"$contents\"`\""
		contents=""
		eval "$stash"
		stash=""
		eval "export $COPYING_NAME"
	    fi
d738 7
a744 16
    INSTALL_NAME="`pwd | sed 's/[^a-zA-Z]//g'`INSTALL_BACKUP"
    cmd="echo \"\$$INSTALL_NAME\""
    contents="`eval $cmd`"
    if [ "x$contents" = "x" ] ; then
	eval "${INSTALL_NAME}=__none__"
	if test -f INSTALL ; then
	    contents="`cat INSTALL`"
            # make sure the file actually fits in memory
	    if [ "x`echo \"$contents\"`" = "x`cat INSTALL`" ] ; then
		$VERBOSE_ECHO "Stashing an in-memory backup of INSTALL"
		stash="${INSTALL_NAME}=\"`escape \"\$contents\"`\""
		contents=""
		eval "$stash"
		stash=""
		eval "export $INSTALL_NAME"
	    fi
a746 1
    contents=""
d757 1
a757 1
    # _prev_path was set to pwd before recursion begins so that
a772 2
    elif ! test -f "$_configure" ; then
	return
d792 1
a792 1
	    cd "$_prev_path"
d802 94
a913 1
    config_fail=no
a914 5
	config_fail=yes
    elif ! test -f $CONFIGURE ; then
	config_fail=yes
    fi
    if [ "x$config_fail" = "xyes" ] ; then
d1000 1
a1000 1
_prev_path="`pwd`"
d1009 1
a1009 1
cd "$_prev_path"
d1038 1
d1042 2
d1086 3
a1088 4
		if test ! -f acinclude.m4.backup ; then
		    $VERBOSE_ECHO cp acinclude.m4 acinclude.m4.backup
		    cp acinclude.m4 acinclude.m4.backup
		fi
d1090 1
a1090 1
	    $VERBOSE_ECHO cat "$LIBTOOL_M4" >> acinclude.m4
d1096 1
d1099 1
a1099 1
	    $ECHO "Restarting the preparation steps with a local libtool.m4"
d1181 2
a1182 2
		$VERBOSE_ECHO "cp ltmain.sh \"${_aux_dir}/ltmain.sh\""
		cp ltmain.sh "${_aux_dir}/ltmain.sh"
a1352 101
#############################
# RESTORE_CLOBBERED FUNCION #
#############################
restore_clobbered ( ) {

    # The automake (and autoreconf by extension) -f/--force-missing
    # option may overwrite COPYING and INSTALL even if they do exist.
    # We stashed a copy of those file contents into a
    # directory-specific variable during 'initialize' just in case it
    # is blown away.  Here we restore the contents if necessary.

    spacer=no
    if test -f COPYING ; then
	# compare entire content, restore if needed
	COPYING_NAME="`pwd | sed 's/[^a-zA-Z]//g'`COPYING_BACKUP"
	cmd="echo \"\$$COPYING_NAME\""
	contents="`eval $cmd`"
	contents="`unescape \"$contents\"`"
	if test "x$contents" != "x__none__" -a "x$contents" != "x`cat COPYING`" ; then
	    if test "x$spacer" = "xno" ; then
		$VERBOSE_ECHO
		spacer=yes
	    fi
	    # restore the backup
	    $VERBOSE_ECHO "Restoring COPYING from backup (automake -f likely clobbered it)"
	    $VERBOSE_ECHO "echo \"\$$COPYING_NAME\" > COPYING"
	    rm -f COPYING
	    echo "$contents" > COPYING
	    # release content
	    eval "$COPYING_NAME=\"\""
	    eval "export $COPYING_NAME"
	fi # check contents
    fi # -f COPYING
    if test -f INSTALL ; then
	INSTALL_NAME="`pwd | sed 's/[^a-zA-Z]//g'`INSTALL_BACKUP"
	cmd="echo \"\$$INSTALL_NAME\""
	contents="`eval $cmd`"
	contents="`unescape \"$contents\"`"
	# compare entire content, restore if needed
	if test "x$contents" != "x__none__" -a "x$contents" != "x`cat INSTALL`" ; then
	    if test "x$spacer" = "xno" ; then
		$VERBOSE_ECHO
		spacer=yes
	    fi
	    # restore the backup
	    $VERBOSE_ECHO "Restoring INSTALL from backup (automake -f likely clobbered it)"
	    $VERBOSE_ECHO "echo \"\$$INSTALL_NAME\" > INSTALL"
	    rm -f INSTALL
	    echo "$contents" > INSTALL
	    # release content
	    eval "$INSTALL_NAME=\"\""
	    eval "export $INSTALL_NAME"
	fi # check contents
    fi # -f install
} # end of restore_clobbered


##############################
# RECURSIVE_RESTORE FUNCTION #
##############################
recursive_restore ( ) {

    # restore COPYING and INSTALL from backup if they were clobbered
    # for each directory recursively.

    # git 'r undone
    restore_clobbered

    # find configure template
    _configure="`locate_configure_template`"
    if [ "x$_configure" = "x" ] ; then
	return
    elif ! test -f "$_configure" ; then
	return
    fi

    # look for subdirs
    _det_config_subdirs="`grep AC_CONFIG_SUBDIRS $_configure | grep -v '.*#.*AC_CONFIG_SUBDIRS' | sed 's/^[ 	]*AC_CONFIG_SUBDIRS(\(.*\)).*/\1/' | sed 's/.*\[\(.*\)\].*/\1/'`"
    CHECK_DIRS=""
    for dir in $_det_config_subdirs ; do
	if test -d "`pwd`/$dir" ; then
	    CHECK_DIRS="$CHECK_DIRS \"`pwd`/$dir\""
	fi
    done

    # process subdirs
    if [ ! "x$CHECK_DIRS" = "x" ] ; then
	$VERBOSE_ECHO "Recursively scanning the following directories:"
	$VERBOSE_ECHO "  $CHECK_DIRS"
	for dir in $CHECK_DIRS ; do
	    $VERBOSE_ECHO "Checking files for automake damage in $dir"
	    cd "$_prev_path"
	    eval "cd $dir"

	    # recursively git 'r undone
	    recursive_restore
	done
    fi
} # end of recursive_restore


d1368 1
a1368 1
	    cd "$_prev_path"
d1395 1
a1395 1
cd "$_prev_path"
d1404 1
a1404 5
    $VERBOSE_ECHO "WARNING: path to configure could not be found"
fi
if [ ! -f "$config" ] ; then
    $VERBOSE_ECHO "WARNING: expected configure file does not exist"
    config=""
d1410 1
a1410 1
if [ "x$config" = "x" ] ; then
@


14.84
log
@need to recursively delete the autom4te.cache directories else there can be a plethora of build problems of the "Can't locate object method "path" via package "Request" sort.
@
text
@d53 18
a70 2
# environment variables may be used to override the default detected
# applications.
d101 2
a102 2
    __id="$Id: autogen.sh,v 14.83 2007/03/09 20:05:08 brlcad Exp $"
    __version="`echo $__id | sed 's/.*\([0-9][0-9][0-9][0-9]\)\/\([0-9][0-9]\)\/\([0-9][0-9]\).*/\1\2\3/'`"
d770 1
d773 1
a773 1
    _subdirs=""
d775 1
d777 2
a778 2
	if test -d "$dir" ; then
	    _subdirs="$_subdirs $dir"
d783 1
a783 1
    if [ ! "x$_subdirs" = "x" ] ; then
d785 2
a786 2
	$VERBOSE_ECHO "  $_subdirs"
	for dir in $_subdirs ; do
d789 1
a789 1
	    cd "$dir"
d848 3
a850 3
	if test -d "$dir" ; then
	    $VERBOSE_ECHO "Detected recursive configure directory: $dir"
	    CONFIG_SUBDIRS="$CONFIG_SUBDIRS $dir"
a1334 1
    _subdirs=""
d1336 1
d1338 2
a1339 2
	if test -d "$dir" ; then
	    _subdirs="$_subdirs $dir"
d1344 1
a1344 1
    if [ ! "x$_subdirs" = "x" ] ; then
d1346 2
a1347 2
	$VERBOSE_ECHO "  $_subdirs"
	for dir in $_subdirs ; do
d1350 1
a1350 1
	    cd "$dir"
@


14.83
log
@remove debug printing
@
text
@d85 1
a85 1
    __id="$Id: autogen.sh,v 14.82 2007/03/09 19:51:40 brlcad Exp $"
d741 6
@


14.82
log
@initialize from the starting directory
@
text
@d85 1
a85 1
    __id="$Id: autogen.sh,v 14.81 2007/03/09 19:33:33 brlcad Exp $"
a859 1
    echo "done searching"
@


14.81
log
@avoid the square brackets
@
text
@d85 1
a85 1
    __id="$Id: autogen.sh,v 14.80 2007/03/09 14:13:25 brlcad Exp $"
d860 1
d893 3
a898 3
# start from where we started
cd "$_prev_path"

@


14.80
log
@be extra careful about clearing out variables when we're done with them and utilizing even less space when encoding string chars.. we're right up against the ARG_MAX limit on irix and (some) bsd systems where keeping two copies of our COPYING file in memory is turning out to be too much, but everything is fine if we only ever have just one copy of the file retained in memory.  ahh, such abusive fun with environment variables.
@
text
@d85 1
a85 1
    __id="$Id: autogen.sh,v 14.79 2007/03/09 13:18:27 brlcad Exp $"
d662 1
a662 2
    echo "$*" | sed 's/\$/[AG_D]/g' | sed 's/`/[AG_B]/g' | sed 's/"/[AG_Q]/g' | sed "s/'/[AG_S]/g"
# | sed 's/[ ]/AG_S_AG/g'
d670 1
a670 1
    echo "$*" | sed "s/[AG_S]/'/g" | sed 's/[AG_Q]/"/g' | sed 's/[AG_B]/`/g' | sed 's/[AG_D]/$/g'
@


14.79
log
@order
@
text
@d85 1
a85 1
    __id="$Id: autogen.sh,v 14.78 2007/03/09 13:13:55 brlcad Exp $"
d662 2
a663 1
    echo "$*" | sed 's/\$/AUTOGEN_DOLLAR_AUTOGEN/g' | sed 's/`/AUTOGEN_BACKTICK_AUTOGEN/g' | sed 's/"/AUTOGEN_QUOTE_AUTOGEN/g' | sed "s/'/AUTOGEN_SQUOTE_AUTOGEN/g"
d671 1
a671 1
    echo "$*" | sed "s/AUTOGEN_SQUOTE_AUTOGEN/'/g" | sed 's/AUTOGEN_QUOTE_AUTOGEN/"/g' | sed 's/AUTOGEN_BACKTICK_AUTOGEN/`/g' | sed 's/AUTOGEN_DOLLAR_AUTOGEN/$/g'
d700 1
d702 1
d718 1
d720 1
a724 1
    stash=""
@


14.78
log
@missing the case where the number matches exactly, check patch -eq patch
@
text
@d85 1
a85 1
    __id="$Id: autogen.sh,v 14.77 2007/03/09 09:30:27 brlcad Exp $"
a673 46
##############################
# RECURSIVE_PROTECT FUNCTION #
##############################
recursive_protect ( ) {

    # for projects using recursive configure, run the build
    # preparation steps for the subdirectories.  this function assumes
    # _prev_path was set to pwd before recursion begins so that
    # relative paths work.

    # git 'r done, protect COPYING and INSTALL from being clobbered
    protect_from_clobber

    # find configure template
    _configure="`locate_configure_template`"
    if [ "x$_configure" = "x" ] ; then
	return
    elif ! test -f "$_configure" ; then
	return
    fi

    # look for subdirs
    _subdirs=""
    _det_config_subdirs="`grep AC_CONFIG_SUBDIRS $_configure | grep -v '.*#.*AC_CONFIG_SUBDIRS' | sed 's/^[ 	]*AC_CONFIG_SUBDIRS(\(.*\)).*/\1/' | sed 's/.*\[\(.*\)\].*/\1/'`"
    for dir in $_det_config_subdirs ; do
	if test -d "$dir" ; then
	    _subdirs="$_subdirs $dir"
	fi
    done

    # process subdirs
    if [ ! "x$_subdirs" = "x" ] ; then
	$VERBOSE_ECHO "Recursively scanning the following directories:"
	$VERBOSE_ECHO "  $_subdirs"
	for dir in $_subdirs ; do
	    $VERBOSE_ECHO "Protecting files from automake in $dir"
	    cd "$_prev_path"
	    cd "$dir"

	    # recursively git 'r done
	    recursive_protect
	done
    fi
} # end of recursive_protect


d725 46
@


14.77
log
@major update.  this change adds support for protected recursive build preparations, saving copies of all the relevant COPYING/INSTALL files that might get stomped on by automake/autoreconf (EVEN WHEN USING AC_CONFIG_SUBDIRS).  the files are even still stashed into memory too by using tricksy path-specific variables.  this fix will restore the files correctly regardless of whether autoreconf or manual steps are taken.  t'is a royal hassle just to compensate for automake's bad behavior, but it at least all seems to be working well.
@
text
@d85 1
a85 1
    __id="$Id: autogen.sh,v 14.76 2007/03/05 05:28:15 brlcad Exp $"
d203 2
@


14.76
log
@improve the version number processing so that older oddities like automake 1.4-p6 are better parsed and compared as that the old version doesn't sneak in as 1.46 but as 1.4.6 instead.  add a verbose debug line so it's more obvious what's being compared.
@
text
@d85 1
a85 1
    __id="$Id: autogen.sh,v 14.75 2007/03/03 15:08:33 brlcad Exp $"
d656 113
d774 9
a802 1

a812 1

a824 1

a834 27

    ########################################################
    # protect COPYING & INSTALL from overwrite by automake #
    ########################################################
    COPYING_BACKUP=__none__
    if test -f COPYING ; then
        # determine if they actually fit in memory
	COPYING_BACKUP="`cat COPYING`"
	if [ "x$COPYING_BACKUP" = "x`cat COPYING`" ] ; then
	    $VERBOSE_ECHO "Stashing an in-memory backup of COPYING"
	    export COPYING_BACKUP
	else
	    COPYING_BACKUP="__none__"
	fi
    fi
    INSTALL_BACKUP=__none__
    if test -f INSTALL ; then
	INSTALL_BACKUP="`cat INSTALL`"
	if [ "x$INSTALL_BACKUP" = "x`cat INSTALL`" ] ; then
	    $VERBOSE_ECHO "Stashing an in-memory backup of INSTALL"
	    export INSTALL_BACKUP
	else
	    INSTALL_BACKUP="__none__"
	fi
    fi


a844 1

a855 1

d864 1
d882 6
a887 1
# is necessary or useful.  Only needs to occur once per directory.
d890 3
d911 4
a914 5
		$ECHO "Warning: autoreconf failed but for for a reason that seems to be"
		$ECHO "a common libtool misconfiguration issue.  This problem is commonly"
		$ECHO "found on systems that have installed libtoolize under a different"
		$ECHO "name without providing a symbolic link or a LIBTOOLIZE environment"
		$ECHO "variable."
d944 7
d954 1
d988 1
d1226 2
a1227 1
}
d1229 4
d1234 5
a1238 3
recursive_manual_autogen ( ) {
    # run the build preparation steps manually for this directory
    manual_autogen
a1239 3
    #########################################
    # restore COPYING & INSTALL from backup #
    #########################################
d1242 6
a1247 2
    # compare entire content, restore if needed
	if test "x$COPYING_BACKUP" != "x__none__" -a "x`cat COPYING`" != "x$COPYING_BACKUP" ; then
d1252 1
a1252 1
	# restore the backup
d1254 1
a1254 1
	    $VERBOSE_ECHO "echo \"\$COPYING_BACKUP\" > COPYING"
d1256 6
a1261 6
	    echo "$COPYING_BACKUP" > COPYING
	# release content
	    COPYING_BACKUP=""
	    export COPYING_BACKUP
	fi
    fi
d1263 6
a1268 2
    # compare entire content, restore if needed
	if test "x$INSTALL_BACKUP" != "x__none__" -a "x`cat INSTALL`" != "x$INSTALL_BACKUP" ; then
d1273 1
a1273 1
	# restore the backup
d1275 1
a1275 1
	    $VERBOSE_ECHO "echo \"\$INSTALL_BACKUP\" > INSTALL"
d1277 34
a1310 4
	    echo "$INSTALL_BACKUP" > INSTALL
	# release content
	    INSTALL_BACKUP=""
	    export INSTALL_BACKUP
d1312 14
d1327 10
d1347 2
d1350 2
d1373 5
d1387 2
@


14.75
log
@fix leftover from previous version separation, need to extract the numbers if we want to check them directly here. fixes unary operator expected errors.
@
text
@d85 1
a85 1
    __id="$Id: autogen.sh,v 14.74 2007/02/27 05:59:30 brlcad Exp $"
d162 11
a172 7
    _min_major="`echo ${_min}. | cut -d. -f1 | sed 's/[^0-9]//g'`"
    _min_minor="`echo ${_min}. | cut -d. -f2 | sed 's/[^0-9]//g'`"
    _min_patch="`echo ${_min}. | cut -d. -f3 | sed 's/[^0-9]//g'`"

    _cur_major="`echo ${_cur}. | cut -d. -f1 | sed 's/[^0-9]//g'`"
    _cur_minor="`echo ${_cur}. | cut -d. -f2 | sed 's/[^0-9]//g'`"
    _cur_patch="`echo ${_cur}. | cut -d. -f3 | sed 's/[^0-9]//g'`"
d193 2
@


14.74
log
@hmm.. such a conundrum.. it is nice to clean up and blow away the aclocal.m4 that configure drops in but now that recursive configure works, tcl/tk actually use their own custom aclocal.m4 (instead of acinclude.m4) so deleting the file has undesireable impact on build prep.  disable aclocal.m4 deletion for now.
@
text
@d85 1
a85 1
    __id="$Id: autogen.sh,v 14.73 2007/02/26 09:04:47 brlcad Exp $"
d968 4
a971 1
	if [ $AUTOCONF_MAJOR_VERSION -lt 2 ] ; then
d974 1
a974 1
	    if [ $AUTOCONF_MINOR_VERSION -lt 54 ] ; then
d976 1
a976 1
	    elif [ $AUTOCONF_MINOR_VERSION -lt 55 ] ; then
d978 1
a978 1
	    elif [ $AUTOCONF_MINOR_VERSION -lt 59 ] ; then
@


14.73
log
@some versions of automake report apple's dumb libtoolize problem differently, so try to be more general.
@
text
@d85 1
a85 1
    __id="$Id: autogen.sh,v 2.30 2007/02/26 08:56:15 brlcad Exp $"
d768 5
a772 5
    if test -f aclocal.m4 ; then
	$VERBOSE_ECHO "Found an aclocal.m4 file, deleting it"
	$VERBOSE_ECHO "rm -f aclocal.m4"
	rm -f aclocal.m4
    fi
@


14.72
log
@support projects that use the older/deprecated arg-less AC_INIT and instead search for an AM_INIT_AUTOMAKE declaration hopefully instead.  also fix a couple missing 'no' typos during manual processing.
@
text
@d804 1
a804 1
	    if [ ! "x`echo \"$autoreconf_output\" | grep \"failed to run libtoolize: No such file or directory\"`" = "x" ] ; then
@


14.71
log
@major modification, now supporting projects that don't use one or more of the various autotools (e.g. not using automake, libtool, autoheader, libtool).  also now supports projects that have recursive configures that go more than one level deep.
@
text
@d85 1
a85 1
    __id="$Id: autogen.sh,v 14.70 2007/02/24 01:46:05 brlcad Exp $"
d387 7
a395 2
    else
	$VERBOSE_ECHO "Detected project name: $PROJECT"
d907 1
a907 1
    if [ "x$need_libtoolize" = "x" ] ; then
d1059 1
a1059 1
    if [ "x$need_autoheader" = "x" ] ; then
d1079 1
a1079 1
    if [ "x$need_automake" = "x" ] ; then
@


14.70
log
@add a function to locate the configure template so that we find the right files when running autogen.sh from an ac_config_subdirs directory, perhaps being configured/compiled in isolation (without making a copy of this script).  also add a sanity check that we did indeed end up with a configure script when all was said and done.
@
text
@d85 1
a85 1
    __id="$Id: autogen.sh,v 14.69 2007/02/23 13:33:52 brlcad Exp $"
d650 21
d685 1
a686 1
    CONFIG_SUBDIRS=""
d798 19
a879 13
    $ECHO
    $ECHO $ECHO_N "Preparing build ... $ECHO_C"

    if ! test -f configure.in -o -f configure.ac ; then
	$ECHO
	$ECHO
	$ECHO "A configure.ac or configure.in file could not be located implying"
	$ECHO "that the GNU Build System is at least not used in this directory.  In"
	$ECHO "any case, there is nothing to do here without one of those files."
	$ECHO
	$ECHO "ERROR: No configure.in or configure.ac file found."
	exit 1
    fi
d893 13
a905 11
    if [ "x$HAVE_LIBTOOLIZE" = "xyes" ] ; then
	$VERBOSE_ECHO "$LIBTOOLIZE $LIBTOOLIZE_OPTIONS"
	libtoolize_output="`$LIBTOOLIZE $LIBTOOLIZE_OPTIONS 2>&1`"
	ret=$?
	$VERBOSE_ECHO "$libtoolize_output"

	if [ ! $ret = 0 ] ; then $ECHO "ERROR: $LIBTOOLIZE failed" && exit 2 ; fi
    else
	if [ "x$HAVE_ALT_LIBTOOLIZE" = "xyes" ] ; then
	    $VERBOSE_ECHO "$LIBTOOLIZE $ALT_LIBTOOLIZE_OPTIONS"
	    libtoolize_output="`$LIBTOOLIZE $ALT_LIBTOOLIZE_OPTIONS 2>&1`"
d908 1
a908 1

d910 9
a919 1
    fi
d921 24
a944 8
    ###########
    # aclocal #
    ###########
    # re-run again as instructed by libtoolize
    $VERBOSE_ECHO "$ACLOCAL $SEARCH_DIRS $ACLOCAL_OPTIONS"
    aclocal_output="`$ACLOCAL $SEARCH_DIRS $ACLOCAL_OPTIONS 2>&1`"
    ret=$?
    $VERBOSE_ECHO "$aclocal_output"
a945 14
    # libtoolize might put ltmain.sh in the wrong place
    if test -f ltmain.sh ; then
	if test ! -f "${_aux_dir}/ltmain.sh" ; then
	    $ECHO
	    $ECHO "Warning:  $LIBTOOLIZE is creating ltmain.sh in the wrong directory"
	    $ECHO
	    $ECHO "Fortunately, the problem can be worked around by simply copying the"
	    $ECHO "file to the appropriate location (${_aux_dir}/).  This has been done for you."
	    $ECHO
	    $VERBOSE_ECHO "cp ltmain.sh \"${_aux_dir}/ltmain.sh\""
	    cp ltmain.sh "${_aux_dir}/ltmain.sh"
	    $ECHO $ECHO_N "Continuing build preparation ... $ECHO_C"
	fi
    fi
d1039 2
a1040 2
	fi
    fi
d1045 16
a1060 5
    $VERBOSE_ECHO "$AUTOHEADER $AUTOHEADER_OPTIONS"
    autoheader_output="`$AUTOHEADER $AUTOHEADER_OPTIONS 2>&1`"
    ret=$?
    $VERBOSE_ECHO "$autoheader_output"
    if [ ! $ret = 0 ] ; then $ECHO "ERROR: $AUTOHEADER failed" && exit 2 ; fi
d1065 12
a1076 13
    $VERBOSE_ECHO "$AUTOMAKE $AUTOMAKE_OPTIONS"
    automake_output="`$AUTOMAKE $AUTOMAKE_OPTIONS 2>&1`"
    ret=$?
    $VERBOSE_ECHO "$automake_output"

    if [ ! $ret = 0 ] ; then
	###################
	# automake, retry #
	###################
	$VERBOSE_ECHO
	$VERBOSE_ECHO "$AUTOMAKE $ALT_AUTOMAKE_OPTIONS"
	# retry without the -f
	automake_output="`$AUTOMAKE $ALT_AUTOMAKE_OPTIONS 2>&1`"
d1079 1
a1079 1

d1081 14
d1096 2
a1097 5
	    # test if libtool is busted
	    libtool_failure "$automake_output"

	    # let the user know what went wrong
	    cat <<EOF
d1100 5
a1104 4
	fi
	$ECHO "ERROR: $AUTOMAKE failed"
	exit 2
    fi
d1108 1
a1108 24
##################################
# run manual preparation steps #
##################################
if [ "x$reconfigure_manually" = "xyes" ] ; then

    # XXX if this is a recursive configure, manual steps don't work
    # yet .. assume it's the libtool/glibtool problem.
    if [ ! "x$CONFIG_SUBDIRS" = "x" ] ; then
	$ECHO "Running the preparation steps individually does not yet work"
	$ECHO "well with a recursive configure."
	if [ ! "x$HAVE_ALT_LIBTOOLIZE" = "xyes" ] ; then
	    exit 3
	fi
	$ECHO "Assuming this is a libtoolize problem..."
	export LIBTOOLIZE
	RUN_RECURSIVE=no
	export RUN_RECURSIVE
	$ECHO
	$ECHO "Restarting the preparation steps with LIBTOOLIZE set to $LIBTOOLIZE"
	$VERBOSE_ECHO sh $AUTOGEN_SH "$1" "$2" "$3" "$4" "$5" "$6" "$7" "$8" "$9"
	sh "$AUTOGEN_SH" "$1" "$2" "$3" "$4" "$5" "$6" "$7" "$8" "$9"
	exit $?
    fi

d1112 5
a1116 16
    # for projects using recursive configure, run the build
    # preparation steps for the subdirectories.
    for dir in $CONFIG_SUBDIRS ; do
	$VERBOSE_ECHO "Processing recursive configure in $dir"
	cd "$_prev_path"
	cd "$dir"
	manual_autogen
    done
fi


#########################################
# restore COPYING & INSTALL from backup #
#########################################
spacer=no
if test -f COPYING ; then
d1118 5
a1122 5
    if test "x$COPYING_BACKUP" != "x__none__" -a "x`cat COPYING`" != "x$COPYING_BACKUP" ; then
	if test "x$spacer" = "xno" ; then
	    $VERBOSE_ECHO
	    spacer=yes
	fi
d1124 4
a1127 4
	$VERBOSE_ECHO "Restoring COPYING from backup (automake -f likely clobbered it)"
	$VERBOSE_ECHO "echo \"\$COPYING_BACKUP\" > COPYING"
	rm -f COPYING
	echo "$COPYING_BACKUP" > COPYING
d1129 3
a1131 2
	COPYING_BACKUP=""
	export COPYING_BACKUP
d1133 1
a1133 2
fi
if test -f INSTALL ; then
d1135 5
a1139 5
    if test "x$INSTALL_BACKUP" != "x__none__" -a "x`cat INSTALL`" != "x$INSTALL_BACKUP" ; then
	if test "x$spacer" = "xno" ; then
	    $VERBOSE_ECHO
	    spacer=yes
	fi
d1141 4
a1144 4
	$VERBOSE_ECHO "Restoring INSTALL from backup (automake -f likely clobbered it)"
	$VERBOSE_ECHO "echo \"\$INSTALL_BACKUP\" > INSTALL"
	rm -f INSTALL
	echo "$INSTALL_BACKUP" > INSTALL
d1146 17
a1162 2
	INSTALL_BACKUP=""
	export INSTALL_BACKUP
d1164 11
@


14.69
log
@make sure we can restore COPYING/INSTALL when automake decides to ignore our umask
@
text
@d85 1
a85 1
    __id="$Id: autogen.sh,v 14.68 2007/02/18 07:27:24 brlcad Exp $"
d204 21
d375 2
a376 6
    CONFIGURE=/dev/null
    if test -f configure.ac ; then
	CONFIGURE=configure.ac
    elif test -f configure.in ; then
	CONFIGURE=configure.in
    fi
d952 1
a952 1
	    $ECHO "The $CONFIGURE file was scanned in order to determine if any"
d996 1
a996 1
		$ECHO "this script along with the macros being used in your $CONFIGURE file."
d1129 9
d1140 11
a1150 3
$ECHO "The $PROJECT build system is now prepared.  To build here, run:"
$ECHO "  $PATH_TO_AUTOGEN/configure"
$ECHO "  make"
@


14.68
log
@simplify some more, make sed a requirement and abort if it seems to be unavailable
@
text
@d85 1
a85 1
    __id="$Id: autogen.sh,v 14.67 2007/02/18 07:20:13 brlcad Exp $"
d1082 1
d1099 1
@


14.67
log
@collapse the version checks into one routine.  improve the version checks so that they work more reliably for various version string formats.  this refactoring should fix a bug in the script where automake 1.10 was being incorrectly processed as 1.1.0 among other benefits and code simplification.
@
text
@d85 1
a85 1
    __id="$Id: autogen.sh,v 14.66 2007/02/13 18:28:33 brlcad Exp $"
d325 3
a327 7
HAVE_SED=no
if [ $? = 0 ] ; then
    [ "x$_have_sed" = "xyes" ] && HAVE_SED=yes
fi
if [ "x$HAVE_SED" = "xno" ] ; then
    $ECHO "Warning:  sed does not appear to be available."
    $ECHO "GNU Autotools version checks are disabled."
d339 2
a340 4
if [ "x$HAVE_SED" = "xyes" ] ; then
    if [ "x`echo $ARGS | sed 's/.*[hH][eE][lL][pP].*/help/'`" = "xhelp" ] ; then
	HELP=yes
    fi
d636 5
a640 8
    _aux_dir=.
    if test "x$HAVE_SED" = "xyes" ; then
	_aux_dir="`grep AC_CONFIG_AUX_DIR $CONFIGURE | grep -v '.*#.*AC_CONFIG_AUX_DIR' | tail -${TAIL_N}1 | sed 's/^[ 	]*AC_CONFIG_AUX_DIR(\(.*\)).*/\1/' | sed 's/.*\[\(.*\)\].*/\1/'`"
	if test ! -d "$_aux_dir" ; then
	    _aux_dir=.
	else
	    $VERBOSE_ECHO "Detected auxillary directory: $_aux_dir"
	fi
d902 9
a910 8
	if test "x$HAVE_SED" = "xyes" ; then

	    ac2_59_macros="AC_C_RESTRICT AC_INCLUDES_DEFAULT AC_LANG_ASSERT AC_LANG_WERROR AS_SET_CATFILE"
	    ac2_55_macros="AC_COMPILER_IFELSE AC_FUNC_MBRTOWC AC_HEADER_STDBOOL AC_LANG_CONFTEST AC_LANG_SOURCE AC_LANG_PROGRAM AC_LANG_CALL AC_LANG_FUNC_TRY_LINK AC_MSG_FAILURE AC_PREPROC_IFELSE"
	    ac2_54_macros="AC_C_BACKSLASH_A AC_CONFIG_LIBOBJ_DIR AC_GNU_SOURCE AC_PROG_EGREP AC_PROG_FGREP AC_REPLACE_FNMATCH AC_FUNC_FNMATCH_GNU AC_FUNC_REALLOC AC_TYPE_MBSTATE_T"

	    macros_to_search=""
	    if [ $AUTOCONF_MAJOR_VERSION -lt 2 ] ; then
d912 4
a915 8
	    else
		if [ $AUTOCONF_MINOR_VERSION -lt 54 ] ; then
		    macros_to_search="$ac2_59_macros $ac2_55_macros $ac2_54_macros"
		elif [ $AUTOCONF_MINOR_VERSION -lt 55 ] ; then
		    macros_to_search="$ac2_59_macros $ac2_55_macros"
		elif [ $AUTOCONF_MINOR_VERSION -lt 59 ] ; then
		    macros_to_search="$ac2_59_macros"
		fi
d917 1
d919 9
a927 10
	    configure_ac_macros=__none__
	    for feature in $macros_to_search ; do
		$VERBOSE_ECHO "Searching for $feature in $CONFIGURE"
		found="`grep \"^$feature.*\" $CONFIGURE`"
		if [ ! "x$found" = "x" ] ; then
		    if [ "x$configure_ac_macros" = "x__none__" ] ; then
			configure_ac_macros="$feature"
		    else
			configure_ac_macros="$feature $configure_ac_macros"
		    fi
a928 14
	    done
	    if [ ! "x$configure_ac_macros" = "x__none__" ] ; then
		$ECHO
		$ECHO "Warning:  Unsupported macros were found in $CONFIGURE"
		$ECHO
		$ECHO "The $CONFIGURE file was scanned in order to determine if any"
		$ECHO "unsupported macros are used that exceed the minimum version"
		$ECHO "settings specified within this file.  As such, the following macros"
		$ECHO "should be removed from configure.ac or the version numbers in this"
		$ECHO "file should be increased:"
		$ECHO
		$ECHO "$configure_ac_macros"
		$ECHO
		$ECHO $ECHO_N "Ignorantly continuing build preparation ... $ECHO_C"
d930 14
a945 1

@


14.66
log
@check for autoreconf before autoconv/automake/libtool
@
text
@d61 3
a63 4
AUTOCONF_MAJOR_VERSION=2
AUTOCONF_MINOR_VERSION=52
AUTOCONF_PATCH_VERSION=0

d65 3
a67 4
AUTOMAKE_MAJOR_VERSION=1
AUTOMAKE_MINOR_VERSION=6
AUTOMAKE_PATCH_VERSION=0

d69 3
a71 3
LIBTOOL_MAJOR_VERSION=1
LIBTOOL_MINOR_VERSION=4
LIBTOOL_PATCH_VERSION=2
d85 1
a85 1
    __id="$Id: autogen.sh,v 14.65 2007/02/13 18:15:26 brlcad Exp $"
d147 56
d430 8
a437 18
    _version_line="`$AUTOCONF --version | head -${HEAD_N}1`"
    if [ "x$HAVE_SED" = "xyes" ] ; then
	_maj_version="`echo $_version_line | sed 's/.* \([0-9]\)\.[0-9][0-9].*/\1/'`"
	_maj_version="`echo $_maj_version | sed 's/.*[A-Z].*//'`"
	[ "x$_maj_version" = "x" ] && _maj_version=0
	_min_version="`echo $_version_line | sed 's/.* [0-9]\.\([0-9][0-9]\).*/\1/'`"
	_min_version="`echo $_min_version | sed 's/.*[A-Z].*//'`"
	[ "x$_min_version" = "x" ] && _min_version=0

	if [ $_maj_version -lt $AUTOCONF_MAJOR_VERSION ] ; then
	    _report_error=yes
	elif [ $_maj_version -eq $AUTOCONF_MAJOR_VERSION ] ; then
	    if [ $_min_version -lt $AUTOCONF_MINOR_VERSION ] ; then
		_report_error=yes
	    fi
	fi

	$ECHO "Found GNU Autoconf version $_maj_version.$_min_version"
d441 1
a441 1
    version_error "$AUTOCONF_MAJOR_VERSION.$AUTOCONF_MINOR_VERSION.$AUTOCONF_PATCH_VERSION" "GNU Autoconf"
d471 8
a478 25
    _version_line="`$AUTOMAKE --version | head -${HEAD_N}1`"
    if [ "x$HAVE_SED" = "xyes" ] ; then
	_maj_version="`echo $_version_line | sed 's/.* \([0-9]\)\.[0-9].*/\1/'`"
	_maj_version="`echo $_maj_version | sed 's/.*[A-Z].*//'`"
	[ "x$_maj_version" = "x" ] && _maj_version=0
	_min_version="`echo $_version_line | sed 's/.* [0-9]\.\([0-9]\).*/\1/'`"
	_min_version="`echo $_min_version | sed 's/.*[A-Z].*//'`"
	[ "x$_min_version" = "x" ] && _min_version=0
	_pat_version="`echo $_version_line | sed 's/.* [0-9]\.[0-9][\.-]p*\([0-9]*\).*/\1/'`"
	_pat_version="`echo $_pat_version | sed 's/.*[A-Z].*//'`"
	[ "x$_pat_version" = "x" ] && _pat_version=0

	if [ $_maj_version -lt $AUTOMAKE_MAJOR_VERSION ] ; then
	    _report_error=yes
	elif [ $_maj_version -eq $AUTOMAKE_MAJOR_VERSION ] ; then
	    if [ $_min_version -lt $AUTOMAKE_MINOR_VERSION ] ; then
		_report_error=yes
	    elif [ $_min_version -eq $AUTOMAKE_MINOR_VERSION ] ; then
		if [ $_pat_version -lt $AUTOMAKE_PATCH_VERSION ] ; then
		    _report_error=yes
		fi
	    fi
	fi

	$ECHO "Found GNU Automake version $_maj_version.$_min_version.$_pat_version"
d482 1
a482 1
    version_error "$AUTOMAKE_MAJOR_VERSION.$AUTOMAKE_MINOR_VERSION.$AUTOMAKE_PATCH_VERSION" "GNU Automake"
d573 8
a580 26
    _version_line="`$LIBTOOLIZE --version | head -${HEAD_N}1`"
    if [ "x$HAVE_SED" = "xyes" ] ; then
	_maj_version="`echo $_version_line | sed 's/.* \([0-9]\)\.[0-9].*/\1/'`"
	_maj_version="`echo $_maj_version | sed 's/.*[A-Z].*//'`"
	[ "x$_maj_version" = "x" ] && _maj_version=0
	_min_version="`echo $_version_line | sed 's/.* [0-9]\.\([0-9]\).*/\1/'`"
	_min_version="`echo $_min_version | sed 's/.*[A-Z].*//'`"
	[ "x$_min_version" = "x" ] && _min_version=0
	_pat_version="`echo $_version_line | sed 's/.* [0-9]\.[0-9][\.-]p*\([0-9]*\).*/\1/'`"
	_pat_version="`echo $_pat_version | sed 's/.*[A-Z].*//'`"
	[ "x$_pat_version" = "x" ] && _pat_version=0

	if [ $_maj_version -lt $LIBTOOL_MAJOR_VERSION ] ; then
	    _report_error=yes
	elif [ $_maj_version -eq $LIBTOOL_MAJOR_VERSION ] ; then
	    if [ $_min_version -lt $LIBTOOL_MINOR_VERSION ] ; then
		_report_error=yes
	    elif [ $_min_version -eq $LIBTOOL_MINOR_VERSION ] ; then
		if [ $_pat_version -lt $LIBTOOL_PATCH_VERSION ] ; then
		    _report_error=yes
		fi
	    fi
	fi

	$ECHO "Found GNU Libtool version $_maj_version.$_min_version.$_pat_version"

d584 1
a584 1
    version_error "$LIBTOOL_MAJOR_VERSION.$LIBTOOL_MINOR_VERSION.$LIBTOOL_PATCH_VERSION" "GNU Libtool"
@


14.65
log
@report the ident footer (which includes the version of this script now) with --version output
@
text
@d87 1
a87 1
    __id="$Id: autogen.sh,v 14.64 2007/02/09 22:41:02 brlcad Exp $"
d334 19
a460 19
# check for autoreconf #
########################
HAVE_AUTORECONF=no
if [ "x$AUTORECONF" = "x" ] ; then
    for AUTORECONF in autoreconf ; do
	$VERBOSE_ECHO "Checking autoreconf version: $AUTORECONF --version"
	$AUTORECONF --version > /dev/null 2>&1
	if [ $? = 0 ] ; then
	    HAVE_AUTORECONF=yes
	    break
	fi
    done
else
    HAVE_AUTORECONF=yes
    $ECHO "Using AUTORECONF environment variable override: $AUTORECONF"
fi


########################
@


14.64
log
@make autogen.sh now report a version number based on the last commit date as well as an auto-extracted copyright range.  turn the version error reporting into a function so it can be updated in one place and fix/remove the trailing _SH that didn't belong.  add comments at the beginning of each of the manual steps.  when stashing COPYING and INSTALL in memory, make sure they actually fit -- irix seems to have issues.
@
text
@d87 1
a87 1
    __id="$Id: autogen.sh,v 14.63 2007/02/09 22:00:22 brlcad Exp $"
d617 2
d620 1
a620 1
    $ECHO "Version info requested.  No preparation or configuration will be performed."
@


14.63
log
@stash a cvs id for version reporting
@
text
@d48 1
a48 1
# this script proceeds to run manual configuration steps effectively
d77 23
d112 1
a112 1
    echo "potentially accounting for several common configuration issues.  The"
a118 2
    
    __id="$Id: $"
d120 2
a121 2
    echo "autogen.sh build preparation script by Christopher Sean Morrison"
    echo "POSIX shell script, BSD style license, copyright 2005-2006"
d126 24
d378 1
a378 8
    $ECHO
    $ECHO "ERROR:  To prepare the ${PROJECT} build system from scratch,"
    $ECHO "        at least version $AUTOCONF_MAJOR_VERSION.$AUTOCONF_MINOR_VERSION.$AUTOCONF_PATCH_VERSION of GNU Autoconf must be installed."
    $ECHO
    $ECHO "$NAME_OF_AUTOGEN_SH does not need to be run on the same machine that will"
    $ECHO "run configure or make.  Either the GNU Autotools will need to be installed"
    $ECHO "or upgraded on this system, or $NAME_OF_AUTOGEN_SH must be run on the source"
    $ECHO "code on another system and then transferred to here. -- Cheers!"
d436 1
a436 8
    $ECHO
    $ECHO "ERROR:  To prepare the ${PROJECT} build system from scratch,"
    $ECHO "        at least version $AUTOMAKE_MAJOR_VERSION.$AUTOMAKE_MINOR_VERSION.$AUTOMAKE_PATCH_VERSION of GNU Automake must be installed."
    $ECHO
    $ECHO "$NAME_OF_AUTOGEN_SH does not need to be run on the same machine that will"
    $ECHO "run configure or make.  Either the GNU Autotools will need to be installed"
    $ECHO "or upgraded on this system, or $NAME_OF_AUTOGEN_SH must be run on the source"
    $ECHO "code on another system and then transferred to here. -- Cheers!"
d575 1
a575 8
    $ECHO
    $ECHO "ERROR:  To prepare the ${PROJECT} build system from scratch,"
    $ECHO "        at least version $LIBTOOL_MAJOR_VERSION.$LIBTOOL_MINOR_VERSION.$LIBTOOL_PATCH_VERSION of GNU Libtool must be installed."
    $ECHO
    $ECHO "$NAME_OF_AUTOGEN_SH does not need to be run on the same machine that will"
    $ECHO "run configure or make.  Either the GNU Autotools will need to be installed"
    $ECHO "or upgraded on this system, or $NAME_OF_AUTOGEN_SH must be run on the source"
    $ECHO "code on another system and then transferred to here. -- Cheers!"
d671 1
a671 1
	$VERBOSE_ECHO "Stashing an in-memory backup of COPYING"
d673 6
a678 1
	export COPYING_BACKUP
a681 1
	$VERBOSE_ECHO "Stashing an in-memory backup of INSTALL"
d683 6
a688 1
	export INSTALL_BACKUP
d764 1
a764 1
	$ECHO "Attempting to run the configuration steps individually"
d771 1
d799 1
a799 1
	    $ECHO "Restarting the configuration steps with a local libtool.m4"
a810 8
# Manual configuration steps taken are as follows:
#  aclocal [-I m4]
#  libtoolize --automake -c -f
#  aclocal [-I m4]
#  autoconf -f
#  autoheader
#  automake -a -c -f
####
d812 9
d835 3
d842 1
d844 3
a846 1
    if [ ! $ret = 0 ] ; then $ECHO "ERROR: $ACLOCAL failed" && exit 2 ; fi
d865 3
d889 3
d947 4
d988 3
a994 1

d997 3
d1006 3
a1008 1
	# retry without the -f
d1011 1
d1033 1
a1033 1
# run manual configuration steps #
d1040 1
a1040 1
	$ECHO "Running the configuration steps individually does not yet work"
d1050 1
a1050 1
	$ECHO "Restarting the configuration steps with LIBTOOLIZE set to $LIBTOOLIZE"
d1056 1
a1056 1
    # run the build configuration steps manually for this directory
d1060 1
a1060 1
    # configuration steps for the subdirectories.
d1075 1
a1075 1
    # compare entire content
d1091 1
a1091 1
    # compare entire content
@


14.62
log
@missing var init when printing summary of invalid macros in use
@
text
@d96 3
@


14.61
log
@gah, search the configure.ac file instead of just sitting there idle
@
text
@d869 1
d874 1
a874 1
		    if [ "x$configure_ac_macros" = "xno" ] ; then
d881 14
a894 14
	fi
	if [ ! "x$configure_ac_macros" = "xno" ] ; then
	    $ECHO
	    $ECHO "Warning:  Unsupported macros were found in $CONFIGURE"
	    $ECHO
	    $ECHO "The $CONFIGURE file was scanned in order to determine if any"
	    $ECHO "unsupported macros are used that exceed the minimum version"
	    $ECHO "settings specified within this file.  As such, the following macros"
	    $ECHO "should be removed from configure.ac or the version numbers in this"
	    $ECHO "file should be increased:"
	    $ECHO
	    $ECHO "$configure_ac_macros"
	    $ECHO
	    $ECHO $ECHO_N "Ignorantly continuing build preparation ... $ECHO_C"
@


14.60
log
@change the way COPYING and INSTALL are protected from being clobbered by automake's stupid behavior of overwriting our files with generic GNU content.  instead of saving a backup to a file in the aux dir, save the contents of the file to memory (that is even preserved across internal restarts).  restore as needed if/when the content is clobbered.
@
text
@d871 1
a871 1
		found="`grep \"^$feature.*\"`"
@


14.59
log
@instead of automatically modifying the configure.ac file if there are unsupported known macros being used, just report what those macros are and blather on about how that really indicates that probably the version of the autotools is specified incorrectly in autogen.sh or that inappropriate macros are being used in configure.ac.
@
text
@d642 12
a653 7
    for file in COPYING INSTALL ; do
	if test ! -f $file ; then
	    continue
	fi
	$VERBOSE_ECHO "cp -pf ${file} \"${_aux_dir}/${file}.backup\""
	cp -pf ${file} "${_aux_dir}/${file}.backup"
    done
d1011 14
a1024 8
for file in COPYING INSTALL ; do
    curr="$file"
    if test ! -f "$curr" ; then
	continue
    fi
    back="${_aux_dir}/${file}.backup"
    if test ! -f "$back" ; then
	continue
d1026 4
a1029 5

    # full contents for comparison
    current="`cat $curr`"
    backup="`cat $back`"
    if test "x$current" != "x$backup" ; then
d1035 6
a1040 3
	$VERBOSE_ECHO "Restoring $file from backup (automake -f likely clobbered it)"
	$VERBOSE_ECHO "cp -pf \"$back\" \"${curr}\""
	cp -pf "$back" "$curr"
d1042 1
a1042 1
done
@


14.58
log
@ws. lots and lots of ws.  see sh/ws.sh for details (cases 'abcdeg').
@
text
@d844 1
a844 3
	# retry without the -f and with backwards support for missing macros
	configure_ac_changed="no"
	configure_ac_backupd="no"
a845 5
	    if test ! -f ${CONFIGURE}.backup ; then
		$VERBOSE_ECHO cp $CONFIGURE ${CONFIGURE}.backup
		cp $CONFIGURE ${CONFIGURE}.backup
		configure_ac_backupd="yes"
	    fi
d864 8
a871 12
	    if [ -w $CONFIGURE ] ; then
		for feature in $macros_to_search ; do
		    $VERBOSE_ECHO "Searching for $feature in $CONFIGURE with sed"
		    sed "s/^\($feature.*\)$/dnl \1/g" < $CONFIGURE > ${CONFIGURE}.sed
		    if [ ! "x`cat $CONFIGURE`" = "x`cat ${CONFIGURE}.sed`" ] ; then
			$VERBOSE_ECHO cp ${CONFIGURE}.sed $CONFIGURE
			cp ${CONFIGURE}.sed $CONFIGURE
			if [ "x$configure_ac_changed" = "xno" ] ; then
			    configure_ac_changed="$feature"
			else
			    configure_ac_changed="$feature $configure_ac_changed"
			fi
d873 16
a888 5
		    rm -f ${CONFIGURE}.sed
		done
	    else
		$VERBOSE_ECHO "$CONFIGURE is not writable so not attempting to edit"
	    fi
d890 1
a897 10

	    # failed so restore the backup
	    if test -f ${CONFIGURE}.backup ; then
		# make sure we made the backup file
		if test "x$configure_ac_backupd" = "xyes" ; then
		    $VERBOSE_ECHO cp ${CONFIGURE}.backup $CONFIGURE
		    cp ${CONFIGURE}.backup $CONFIGURE
		fi
	    fi

a906 1

d908 14
a921 16
	    # autoconf sans -f and possibly sans unsupported options succeeded so warn verbosely

	    if [ ! "x$configure_ac_changed" = "xno" ] ; then
		$ECHO
		$ECHO "Warning:  Unsupported macros were found and removed from $CONFIGURE"
		$ECHO
		$ECHO "The $CONFIGURE file was edited in an attempt to successfully run"
		$ECHO "autoconf by commenting out the unsupported macros.  Since you are"
		$ECHO "reading this, autoconf succeeded after the edits were made.  The"
		$ECHO "original $CONFIGURE is saved as ${CONFIGURE}.backup but you should"
		$ECHO "consider either increasing the minimum version of autoconf required"
		$ECHO "by this script or removing the following macros from ${CONFIGURE}:"
		$ECHO
		$ECHO "$configure_ac_changed"
		$ECHO
		$ECHO $ECHO_N "Continuing build preparation ... $ECHO_C"
d923 2
@


14.57
log
@update copyright to 2007
@
text
@d448 1
a448 1
        # look for some alternates
d687 1
a687 1
    
d978 1
a978 1
    
@


14.56
log
@remove more previous build products, now including aclocal.m4 too
@
text
@d4 1
a4 1
# Copyright (c) 2005-2006 United States Government as represented by
@


14.55
log
@update that moves towards a unified project agnostic script.  the project name is now pulled from the configure template instead of necessarily being embedded in here.  allow overrides on the CONFIGURE template and the PROJECT name via env vars.
@
text
@d674 3
a676 3
    #######################################
    # remove the autom4te.cache directory #
    #######################################
d682 5
@


14.54
log
@add a check during manual configuration for whether the gbs is even used, i.e. whether a configure template is found so that we can abort more cleanly early
@
text
@a59 3
# set to the name of this project
SUITE="BRL-CAD"

d90 5
a94 4
    echo "AUTORECONF, AUTOCONF, AUTOMAKE, LIBTOOLIZE, ACLOCAL, AUTOHEADER"
    echo "environment variables and corresponding _OPTIONS variables"
    echo "(e.g. AUTORECONF_OPTIONS) may be used to override the default"
    echo "automatic detection behavior."
d254 32
d331 1
a331 1
    $ECHO "ERROR:  To prepare the ${SUITE} build system from scratch,"
d396 1
a396 1
    $ECHO "ERROR:  To prepare the ${SUITE} build system from scratch,"
d542 1
a542 1
    $ECHO "ERROR:  To prepare the ${SUITE} build system from scratch,"
a603 7
    _configure_file=/dev/null
    if test -f configure.ac ; then
	_configure_file=configure.ac
    elif test -f configure.in ; then
	_configure_file=configure.in
    fi

d606 1
a606 1
	_aux_dir="`grep AC_CONFIG_AUX_DIR $_configure_file | grep -v '.*#.*AC_CONFIG_AUX_DIR' | tail -${TAIL_N}1 | sed 's/^[ 	]*AC_CONFIG_AUX_DIR(\(.*\)).*/\1/' | sed 's/.*\[\(.*\)\].*/\1/'`"
d618 1
a618 1
    _det_config_subdirs="`grep AC_CONFIG_SUBDIRS $_configure_file | grep -v '.*#.*AC_CONFIG_SUBDIRS' | sed 's/^[ 	]*AC_CONFIG_SUBDIRS(\(.*\)).*/\1/' | sed 's/.*\[\(.*\)\].*/\1/'`"
d843 3
a845 3
	    if test ! -f configure.ac.backup ; then
		$VERBOSE_ECHO cp $_configure_file configure.ac.backup
		cp $_configure_file configure.ac.backup
d866 1
a866 1
	    if [ -w $_configure_file ] ; then
d868 5
a872 5
		    $VERBOSE_ECHO "Searching for $feature in $_configure_file with sed"
		    sed "s/^\($feature.*\)$/dnl \1/g" < $_configure_file > configure.ac.sed
		    if [ ! "x`cat $_configure_file`" = "x`cat configure.ac.sed`" ] ; then
			$VERBOSE_ECHO cp configure.ac.sed $_configure_file
			cp configure.ac.sed $_configure_file
d879 1
a879 1
		    rm -f configure.ac.sed
d882 1
a882 1
		$VERBOSE_ECHO "$_configure_file is not writable so not attempting to edit"
d894 1
a894 1
	    if test -f configure.ac.backup ; then
d897 2
a898 2
		    $VERBOSE_ECHO cp configure.ac.backup $_configure_file
		    cp configure.ac.backup $_configure_file
d917 1
a917 1
		$ECHO "Warning:  Unsupported macros were found and removed from $_configure_file"
d919 1
a919 1
		$ECHO "The $_configure_file file was edited in an attempt to successfully run"
d922 1
a922 1
		$ECHO "original $_configure_file is saved as configure.ac.backup but you should"
d924 1
a924 1
		$ECHO "by this script or removing the following macros from $_configure_file:"
d1043 1
a1043 1
$ECHO "The $SUITE build system is now prepared.  To build here, run:"
@


14.53
log
@if autogen.sh exists, consider it good enough.  otherwise then print error cruftage.
@
text
@d753 11
@


14.52
log
@oop,  isn't set until after the environment is checked (and usage is potentially before the env check) so just use echo
@
text
@d170 5
a174 2
if [ ! "x$0" = "x$AUTOGEN_SH" ] ; then
    echo "INTERNAL ERROR: dirname/basename inconsistency: $0 != $AUTOGEN_SH"
@


14.51
log
@woot, this little "script" is in excess of 1000 lines... in celebration, finally break tradition with other autogen.sh convention by adding a more useful --help option instead of passing it on to configure.  also add support to override any of the command (autoreconf, automake, etc) options via a set of _OPTIONS environment variables.
@
text
@d83 18
a100 17
    $ECHO "Usage: $AUTOGEN_SH [-h|--help] [-v|--verbose] [-q|--quiet] [--version]"
    $ECHO "    --help     Help on $NAME_OF_AUTOGEN usage"
    $ECHO "    --verbose  Verbose progress output"
    $ECHO "    --quiet    Quiet suppressed progress output"
    $ECHO "    --version  Only perform GNU Build System version checks"
    $ECHO
    $ECHO "Description: This script will validate that minimum versions of the"
    $ECHO "GNU Build System tools are installed and then run autoreconf for you."
    $ECHO "Should autoreconf fail, manual preparation steps will be run"
    $ECHO "potentially accounting for several common configuration issues.  The"
    $ECHO "AUTORECONF, AUTOCONF, AUTOMAKE, LIBTOOLIZE, ACLOCAL, AUTOHEADER"
    $ECHO "environment variables and corresponding _OPTIONS variables"
    $ECHO "(e.g. AUTORECONF_OPTIONS) may be used to override the default"
    $ECHO "automatic detection behavior."
    $ECHO
    $ECHO "autogen.sh build preparation script by Christopher Sean Morrison"
    $ECHO "POSIX shell script, BSD style license, copyright 2005-2006"
@


14.50
log
@allow environment variable overrides on AUTORECONF, AUTOCONF, AUTOMAKE, LIBTOOLIZE, ACLOCAL, AUTOHEADER.  fix --help so it works again (need to rewrite so it's not just a configure pass-through)
@
text
@d80 24
d125 20
d156 2
d170 1
a170 1
    echo "ERROR: Internal dirname/basename inconsistency: $0 != $AUTOGEN_SH"
d181 1
a181 1
	echo "ERROR: '${__cmd}' command is required"
d236 16
d468 4
d556 2
a561 6
##############
# stash path #
##############
_prev_path="`pwd`"


d662 4
d679 2
a680 2
    $VERBOSE_ECHO "$AUTORECONF $SEARCH_DIRS -i -f"
    autoreconf_output="`$AUTORECONF $SEARCH_DIRS -i -f 2>&1`"
d749 2
a750 2
    $VERBOSE_ECHO "$ACLOCAL $SEARCH_DIRS"
    aclocal_output="`$ACLOCAL $SEARCH_DIRS 2>&1`"
d756 2
a757 2
	$VERBOSE_ECHO "$LIBTOOLIZE --automake -c -f"
	libtoolize_output="`$LIBTOOLIZE --automake -c -f 2>&1`"
d764 2
a765 2
	    $VERBOSE_ECHO "$LIBTOOLIZE --automake --copy --force"
	    libtoolize_output="`$LIBTOOLIZE --automake --copy --force 2>&1`"
d774 2
a775 2
    $VERBOSE_ECHO "$ACLOCAL $SEARCH_DIRS"
    aclocal_output="`$ACLOCAL $SEARCH_DIRS 2>&1`"
d795 2
a796 2
    $VERBOSE_ECHO "$AUTOCONF -f"
    autoconf_output="`$AUTOCONF -f 2>&1`"
d895 2
a896 2
    $VERBOSE_ECHO "$AUTOHEADER"
    autoheader_output="`$AUTOHEADER 2>&1`"
d902 2
a903 2
    $VERBOSE_ECHO "$AUTOMAKE -a -c -f"
    automake_output="`$AUTOMAKE -a -c -f 2>&1`"
d910 2
a911 2
	$VERBOSE_ECHO "$AUTOMAKE -a -c"
	automake_output="`$AUTOMAKE -a -c 2>&1`"
d999 3
a1001 3
################
# restore path #
################
d1005 1
a1005 23


###############################################
# check for help arg, and bypass running make #
###############################################
if [ "x$HAVE_SED" = "xyes" ] ; then
    if [ "x`echo $ARGS | sed 's/.*[hH][eE][lL][pP].*/help/'`" = "xhelp" ] ; then
	HELP=yes
    fi
fi
if [ "x$HELP" = "xyes" ] ; then
    echo "Help was requested.  No configuration and compilation will be done."
    echo "Running: $PATH_TO_AUTOGEN/configure $ARGS"
    $VERBOSE_ECHO "$PATH_TO_AUTOGEN/configure $ARGS"
    $PATH_TO_AUTOGEN/configure $ARGS
    exit 0
fi


#############
# summarize #
#############
$ECHO "The ${SUITE} build system is now prepared.  To build here, run:"
@


14.49
log
@add a manual_autogen function that runs the manual configuration steps.  this makes it possible to add support for manual recursive configure build support.
@
text
@d42 14
d194 13
a206 8
for AUTOCONF in autoconf ; do
    $VERBOSE_ECHO "Checking autoconf version: $AUTOCONF --version"
    $AUTOCONF --version > /dev/null 2>&1
    if [ $? = 0 ] ; then
	_acfound=yes
	break
    fi
done
d250 14
a263 8
for AUTOMAKE in automake ; do
    $VERBOSE_ECHO "Checking automake version: $AUTOMAKE --version"
    $AUTOMAKE --version > /dev/null 2>&1
    if [ $? = 0 ] ; then
	_amfound=yes
	break
    fi
done
d315 13
a327 8
for AUTORECONF in autoreconf ; do
    $VERBOSE_ECHO "Checking autoreconf version: $AUTORECONF --version"
    $AUTORECONF --version > /dev/null 2>&1
    if [ $? = 0 ] ; then
	HAVE_AUTORECONF=yes
	break
    fi
done
a334 1
LIBTOOLIZE=libtoolize
d336 15
a350 13
$VERBOSE_ECHO "Checking libtoolize version: $LIBTOOLIZE --version"
$LIBTOOLIZE --version > /dev/null 2>&1
if [ ! $? = 0 ] ; then
    HAVE_LIBTOOLIZE=no
    $ECHO
    if [ "x$HAVE_AUTORECONF" = "xno" ] ; then
	$ECHO "Warning:  libtoolize does not appear to be available."
    else
	$ECHO "Warning:  libtoolize does not appear to be available.  This means that"
	$ECHO "the automatic build preparation via autoreconf will probably not work."
	$ECHO "Preparing the build by running each step individually, however, should"
	$ECHO "work and will be done automatically for you if autoreconf fails."
    fi
d352 4
a355 33
    # look for some alternates
    for tool in glibtoolize libtoolize15 libtoolize14 libtoolize13 ; do
	$VERBOSE_ECHO "Checking libtoolize alternate: $tool --version"
	_glibtoolize="`$tool --version > /dev/null 2>&1`"
	if [ $? = 0 ] ; then
	    $VERBOSE_ECHO "Found $tool --version"
	    _glti="`which $tool`"
	    if [ "x$_glti" = "x" ] ; then
		$VERBOSE_ECHO "Cannot find $tool with which"
		continue;
	    fi
	    if test ! -f "$_glti" ; then
		$VERBOSE_ECHO "Cannot use $tool, $_glti is not a file"
		continue;
	    fi
	    _gltidir="`dirname $_glti`"
	    if [ "x$_gltidir" = "x" ] ; then
		$VERBOSE_ECHO "Cannot find $tool path with dirname of $_glti"
		continue;
	    fi
	    if test ! -d "$_gltidir" ; then
		$VERBOSE_ECHO "Cannot use $tool, $_gltidir is not a directory"
		continue;
	    fi
	    HAVE_ALT_LIBTOOLIZE=yes
	    LIBTOOLIZE="$tool"
	    $ECHO
	    $ECHO "Fortunately, $tool was found which means that your system may simply"
	    $ECHO "have a non-standard or incomplete GNU Autotools install.  If you have"
	    $ECHO "sufficient system access, it may be possible to quell this warning by"
	    $ECHO "running:"
	    $ECHO
	    sudo -V > /dev/null 2>&1
d357 21
a377 4
		$ECHO "   sudo ln -s $_glti $_gltidir/libtoolize"
		$ECHO
	    else
		$ECHO "   ln -s $_glti $_gltidir/libtoolize"
d379 4
a382 1
		$ECHO "Run that as root or with proper permissions to the $_gltidir directory"
d384 12
d397 4
a400 4
	    _ltfound=yes
	    break
	fi
    done
d403 1
d456 11
a466 7
for ACLOCAL in aclocal ; do
    $VERBOSE_ECHO "Checking aclocal version: $ACLOCAL --version"
    $ACLOCAL --version > /dev/null 2>&1
    if [ $? = 0 ] ; then
	break
    fi
done
d472 11
a482 7
for AUTOHEADER in autoheader ; do
    $VERBOSE_ECHO "Checking autoheader version: $AUTOHEADER --version"
    $AUTOHEADER --version > /dev/null 2>&1
    if [ $? = 0 ] ; then
	break
    fi
done
d946 1
a946 1
	_help=yes
@


14.48
log
@utilize the RUN_RECURSIVE define so that we don't recurse more than once during autogening
@
text
@d625 3
a627 1
###
d636 1
a636 21
if [ "x$reconfigure_manually" = "xyes" ] ; then
    
    # XXX if this is a recursive configure, manual steps don't work
    # yet .. assume it's the libtool/glibtool problem.
    if [ ! "x$CONFIG_SUBDIRS" = "x" ] ; then
	$ECHO "Running the configuration steps individually does not yet work"
	$ECHO "well with a recursive configure."
	if [ ! "x$HAVE_ALT_LIBTOOLIZE" = "xyes" ] ; then
	    exit 3
	fi
	$ECHO "Assuming this is a libtoolize problem..."
	export LIBTOOLIZE
	RUN_RECURSIVE=no
	export RUN_RECURSIVE
	$ECHO
	$ECHO "Restarting the configuration steps with LIBTOOLIZE set to $LIBTOOLIZE"
	$VERBOSE_ECHO sh $AUTOGEN_SH "$1" "$2" "$3" "$4" "$5" "$6" "$7" "$8" "$9"
	sh "$AUTOGEN_SH" "$1" "$2" "$3" "$4" "$5" "$6" "$7" "$8" "$9"
	exit $?
    fi
    
d819 38
@


14.47
log
@allow external overrides on HELP, QUIET, VERBOSE, and VERSION_ONLY.  document the settable project defaults
@
text
@d594 5
d610 5
d646 2
@


14.46
log
@yet another fairly massive rewrite, this time mostly just restructuring.  keep track of the basename for better output messages and refactor the initialization steps into a function.  also refactor the libtool failure check into a function while we're at it as well.  all steps towards being able to cleanly handle manual build steps of projects using recursive configure. oh, and this change removes the directory change to the autogen.sh script, so it must once again be run from the top source dir at least for the time being.
@
text
@d46 1
a46 5
ARGS="$*"
PATH_TO_AUTOGEN="`dirname $0`"
NAME_OF_AUTOGEN="`basename $0`"
AUTOGEN_SH="$PATH_TO_AUTOGEN/$NAME_OF_AUTOGEN"

d49 1
d54 1
d59 1
a63 1
LIBTOOL_M4="${PATH_TO_AUTOGEN}/misc/libtool.m4"
d68 19
a86 4
HELP=no
QUIET=no
VERBOSE=no
VERSION_ONLY=no
@


14.45
log
@detect a recursive configure, it's not really properly supported yet.. but if the problem is glibtool, we should be able to continue through a restart with LIBTOOLIZE set
@
text
@d48 2
a66 1

d95 6
d157 5
d206 1
a206 1
    $ECHO "$PATH_TO_AUTOGEN/autogen.sh does not need to be run on the same machine that will"
d208 1
a208 1
    $ECHO "or upgraded on this system, or $PATH_TO_AUTOGEN/autogen.sh must be run on the source"
d265 1
a265 1
    $ECHO "$PATH_TO_AUTOGEN/autogen.sh does not need to be run on the same machine that will"
d267 1
a267 1
    $ECHO "or upgraded on this system, or $PATH_TO_AUTOGEN/autogen.sh must be run on the source"
d397 1
a397 1
    $ECHO "$PATH_TO_AUTOGEN/autogen.sh does not need to be run on the same machine that will"
d399 1
a399 1
    $ECHO "or upgraded on this system, or $PATH_TO_AUTOGEN/autogen.sh must be run on the source"
a441 1
cd "$PATH_TO_AUTOGEN"
d444 25
a468 9
#####################
# detect an aux dir #
#####################
_configure_file=/dev/null
if test -f configure.ac ; then
    _configure_file=configure.ac
elif test -f configure.in ; then
    _configure_file=configure.in
fi
d470 11
a480 9
_aux_dir=.
if test "x$HAVE_SED" = "xyes" ; then
    _aux_dir="`grep AC_CONFIG_AUX_DIR $_configure_file | grep -v '.*#.*AC_CONFIG_AUX_DIR' | tail -${TAIL_N}1 | sed 's/^[ 	]*AC_CONFIG_AUX_DIR(\(.*\)).*/\1/' | sed 's/.*\[\(.*\)\].*/\1/'`"
    if test ! -d "$_aux_dir" ; then
	_aux_dir=.
    else
	$VERBOSE_ECHO "Detected auxillary directory: $_aux_dir"
    fi
fi
d483 9
a491 11
################################
# detect a recursive configure #
################################
_det_config_subdirs="`grep AC_CONFIG_SUBDIRS $_configure_file | grep -v '.*#.*AC_CONFIG_SUBDIRS' | sed 's/^[ 	]*AC_CONFIG_SUBDIRS(\(.*\)).*/\1/' | sed 's/.*\[\(.*\)\].*/\1/'`"
CONFIG_SUBDIRS=""
for dir in $_det_config_subdirs ; do
    if test -d "$dir" ; then
	$VERBOSE_ECHO "Detected recursive configure directory: $dir"
	CONFIG_SUBDIRS="$CONFIG_SUBDIRS $dir"
    fi
done
d494 10
a503 10
##########################################
# make sure certain required files exist #
##########################################

for file in AUTHORS COPYING ChangeLog INSTALL NEWS README ; do
    if test ! -f $file ; then
	$VERBOSE_ECHO "Touching ${file} since it does not exist"
	touch $file
    fi
done
d506 9
a514 10
########################################################
# protect COPYING & INSTALL from overwrite by automake #
########################################################
for file in COPYING INSTALL ; do
    if test ! -f $file ; then
	continue
    fi
    $VERBOSE_ECHO "cp -pf ${file} \"${_aux_dir}/${file}.backup\""
    cp -pf ${file} "${_aux_dir}/${file}.backup"
done
d517 10
a526 9
##################################################
# make sure certain generated files do not exist #
##################################################
for file in config.guess config.sub ltmain.sh ; do
    if test -f "${_aux_dir}/${file}" ; then
	$VERBOSE_ECHO "mv -f \"${_aux_dir}/${file}\" \"${_aux_dir}/${file}.backup\""
	mv -f "${_aux_dir}/${file}" "${_aux_dir}/${file}.backup"
    fi
done
d529 7
a535 8
############################
# search alternate m4 dirs #
############################
SEARCH_DIRS=""
for dir in m4 ; do
    if [ -d $dir ] ; then
	$VERBOSE_ECHO "Found extra aclocal search directory: $dir"
	SEARCH_DIRS="$SEARCH_DIRS -I $dir"
d537 2
a538 1
done
d541 6
a546 8
#######################################
# remove the autom4te.cache directory #
#######################################
if test -d autom4te.cache ; then
    $VERBOSE_ECHO "Found an autom4te.cache directory, deleting it"
    $VERBOSE_ECHO "rm -rf autom4te.cache"
    rm -rf autom4te.cache
fi
d576 26
d603 1
a603 1
# Steps taken are as follows:
d625 2
a626 2
	$VERBOSE_ECHO sh $0 "$1" "$2" "$3" "$4" "$5" "$6" "$7" "$8" "$9"
	sh "$0" "$1" "$2" "$3" "$4" "$5" "$6" "$7" "$8" "$9"
d749 1
a749 14
	    if test -f "$LIBTOOL_M4" ; then
		found_libtool="`$ECHO $autoconf_output | grep AC_PROG_LIBTOOL`"
		if test ! "x$found_libtool" = "x" ; then
		    if test -f acinclude.m4 ; then
			if test ! -f acinclude.m4.backup ; then
			    $VERBOSE_ECHO cp acinclude.m4 acinclude.m4.backup
			    cp acinclude.m4 acinclude.m4.backup
			fi
		    fi
		    $VERBOSE_ECHO cat "$LIBTOOL_M4" >> acinclude.m4
		    cat "$LIBTOOL_M4" >> acinclude.m4

		    $ECHO
		    $ECHO "Restarting the configuration steps with a local libtool.m4"
d751 1
a751 5
		    $VERBOSE_ECHO sh $0 "$1" "$2" "$3" "$4" "$5" "$6" "$7" "$8" "$9"
		    sh "$0" "$1" "$2" "$3" "$4" "$5" "$6" "$7" "$8" "$9"
		    exit $?
		fi
	    fi
a799 11
	    if test -f "$LIBTOOL_M4" ; then
		found_libtool="`$ECHO $automake_output | grep AC_PROG_LIBTOOL`"
		if test ! "x$found_libtool" = "x" ; then
		    if test -f acinclude.m4 ; then
			if test ! -f acinclude.m4.backup ; then
			    $VERBOSE_ECHO cp acinclude.m4 acinclude.m4.backup
			    cp acinclude.m4 acinclude.m4.backup
			fi
		    fi
		    $VERBOSE_ECHO cat "$LIBTOOL_M4" >> acinclude.m4
		    cat "$LIBTOOL_M4" >> acinclude.m4
d801 2
a802 2
		    $ECHO
		    $ECHO "Restarting the configuration steps with a local libtool.m4"
d804 1
a804 5
		    $VERBOSE_ECHO sh $0 "$1" "$2" "$3" "$4" "$5" "$6" "$7" "$8" "$9"
		    sh "$0" "$1" "$2" "$3" "$4" "$5" "$6" "$7" "$8" "$9"
		    exit $?
		fi
	    fi
@


14.44
log
@update copyright to 2006
@
text
@d445 1
a445 1
    _aux_dir="`cat $_configure_file | grep AC_CONFIG_AUX_DIR | tail -${TAIL_N}1 | sed 's/^[ ]*AC_CONFIG_AUX_DIR(\(.*\)).*/\1/'`"
d454 13
d561 18
@


14.43
log
@fix a problem where the an aborted autogen.sh would leave a configure.ac.backup and a subsequent failing autoconf would restore the wrong/old backup.  only restore if we made the backup.
@
text
@d4 1
a4 1
# Copyright (C) 2005 United States Government as represented by
@


14.42
log
@instead of not even trying autoreconf on a configuration where it's well known to not work (e.g. mac os x), give it a try anyways but with a little more explanation.  perhaps raise awareness of broken configurations.
@
text
@d506 1
a506 1
    $VERBOSE_ECHO "rm -f autom4te.cache"
d605 1
d610 1
d659 5
a663 2
		$VERBOSE_ECHO cp configure.ac.bacukp $_configure_file
		cp configure.ac.backup $_configure_file
@


14.41
log
@simplify the autom4te.cache management by deleting the directory if it exists.  this should prevent aclocal and automake from failing when there is an out of date or corrupted cache.
@
text
@d286 1
d291 3
a293 1
	$ECHO "autoreconf cannot be used."
d515 1
a515 1
if [ "x$HAVE_AUTORECONF" = "xyes" ] && [ "x$HAVE_LIBTOOLIZE" = "xyes" ] ; then
@


14.40
log
@aclocal will fail with an autom4te error if cache is way out of date .. probably should just obliterate the cache dir on autogen regardless, but try this for now
@
text
@d498 10
a552 35
    if [ ! $ret = 0 ] ; then
	if [ ! "x`echo $aclocal_output | grep autom4te`" = "x" ] ; then
	    # retry without an autom4te.cache directory if it exists

	    if test -d autom4te.cache ; then
		if test -d autom4te.cache.backup ; then
		    $ECHO "ERROR: $ACLOCAL failed"
		    $VERBOSE_ECHO
		    $VERBOSE_ECHO "Unable to retry aclocal without autom4te.cache"
		    $VERBOSE_ECHO "There is an autom4te.cache.backup directory in the way"
		    $VERBOSE_ECHO "Suggest running: rm -rf *cache*"
		    exit 2
		else
		    $VERBOSE_ECHO "mv autom4te.cache autom4te.cache.backup"
		    mv autom4te.cache autom4te.cache.backup
		fi
		$VERBOSE_ECHO "Retrying aclocal without the autom4te.cache directory"
		$VERBOSE_ECHO "$ACLOCAL $SEARCH_DIRS"
		aclocal_output="`$ACLOCAL $SEARCH_DIRS 2>&1`"
		ret=$?
		$VERBOSE_ECHO "$aclocal_output"

		if [ ! $ret = 0 ] ; then
		    # still did not work after we removed the backup, so restore it
		    $VERBOSE_ECHO "mv autom4te.cache.backup autom4te.cache"
		    mv autom4te.cache.backup autom4te.cache
		else
		    # worked after we removed the backup, so remove the backup
		    $VERBOSE_ECHO "rm -rf autom4te.cache.backup"
		    rm -rf autom4te.cache.backup
		fi
	    fi
	fi
    fi

a599 34
 	# retry without an autom4te.cache directory if it exists
	if [ ! "x`echo $autoconf_output | grep autom4te`" = "x" ] ; then
	    if test -d autom4te.cache ; then
		if test -d autom4te.cache.backup ; then
		    $ECHO "ERROR: $AUTOCONF failed"
		    $VERBOSE_ECHO
		    $VERBOSE_ECHO "Unable to retry autoconf without autom4te.cache"
		    $VERBOSE_ECHO "There is an autom4te.cache.backup directory in the way"
		    $VERBOSE_ECHO "Suggest running: rm -rf *cache*"
		    exit 2
		else
		    $VERBOSE_ECHO "mv autom4te.cache autom4te.cache.backup"
		    mv autom4te.cache autom4te.cache.backup
		fi
		$VERBOSE_ECHO "Retrying autoconf without the autom4te.cache directory"
		$VERBOSE_ECHO "$AUTOCONF -f"
		autoconf_output="`$AUTOCONF -f 2>&1`"
		ret=$?
		$VERBOSE_ECHO "$autoconf_output"

		if [ ! $ret = 0 ] ; then
		    # still did not work after we removed the backup, so restore it
		    $VERBOSE_ECHO "mv autom4te.cache.backup autom4te.cache"
		    mv autom4te.cache.backup autom4te.cache
		else
		    # worked after we removed the backup, so remove the backup
		    $VERBOSE_ECHO "rm -rf autom4te.cache.backup"
		    rm -rf autom4te.cache.backup
		fi
	    fi
	fi
    fi

    if [ ! $ret = 0 ] ; then
@


14.39
log
@more consistency between the tail/head checking for the functionality of -n.  check for head and tail separately
@
text
@d544 1
a544 1
	if [ ! "x`echo $aclocal_output | grep cache`" = "x" ] ; then
@


14.38
log
@bogus autom4te.cache protection.  handle corrupted/invalid cache dirs that will cause aclocal to fail.  handle out-of-date cache dirs that autoconf 'should' recognize but obviously doesn't for at least most current versions of autoconf as well resulting in an unnecessary failure.  cache files shouldn't halt tools, stupid lame gnu build system tools.
@
text
@d97 10
d113 12
a124 5
TAIL_N=""
echo "test" | tail -n 1 2>/dev/null 1>&2
if [ $? = 0 ] ; then
    TAIL_N="n "
fi
d169 1
a169 1
    _version_line="`$AUTOCONF --version | head -${TAIL_N}1`"
d221 1
a221 1
    _version_line="`$AUTOMAKE --version | head -${TAIL_N}1`"
d349 1
a349 1
    _version_line="`$LIBTOOLIZE --version | head -${TAIL_N}1`"
d439 9
a447 5
_aux_dir="`cat $_configure_file | grep AC_CONFIG_AUX_DIR | tail -${TAIL_N}1 | sed 's/^[ ]*AC_CONFIG_AUX_DIR(\(.*\)).*/\1/'`"
if test ! -d "$_aux_dir" ; then
    _aux_dir=.
else
    $VERBOSE_ECHO "Detected auxillary directory: $_aux_dir"
@


14.37
log
@since autogen.sh is a succint step, presume that we simply want to end up with the same COPYING and INSTALL that we started with, so restore from backup if they change regardless of the current revision
@
text
@d485 6
a490 7
    if [ "x$VERBOSE" = "xyes" ] ; then
	$VERBOSE_ECHO "$AUTORECONF $SEARCH_DIRS -i -f"
	$AUTORECONF $SEARCH_DIRS -i -f
    else
	$AUTORECONF $SEARCH_DIRS -i -f > /dev/null 2>&1
    fi
    if [ ! $? = 0 ] ; then
d518 38
a555 1
    $ACLOCAL $SEARCH_DIRS
d557 1
a557 1
    if [ ! $? = 0 ] ; then $ECHO "ERROR: $ACLOCAL failed" && exit 2 ; fi
d560 5
a564 2
	$LIBTOOLIZE --automake -c -f
	if [ ! $? = 0 ] ; then $ECHO "ERROR: $LIBTOOLIZE failed" && exit 2 ; fi
d568 5
a572 2
	    $LIBTOOLIZE --automake --copy --force
	    if [ ! $? = 0 ] ; then $ECHO "ERROR: $LIBTOOLIZE failed" && exit 2 ; fi
d578 3
a580 1
    $ACLOCAL $SEARCH_DIRS
d599 39
a637 2
    autoconf_output=`$AUTOCONF -f 2>&1`
    if [ ! $? = 0 ] ; then
d684 5
a688 2
	autoconf_output=`$AUTOCONF 2>&1`
	if [ ! $? = 0 ] ; then
d745 5
a749 2
    $AUTOHEADER
    if [ ! $? = 0 ] ; then $ECHO "ERROR: $AUTOHEADER failed" && exit 2 ; fi
d752 5
a756 2
    automake_output=`$AUTOMAKE -a -c -f 2>&1`
    if [ ! $? = 0 ] ; then
d760 5
a764 2
	automake_output=`$AUTOMAKE -a -c 2>&1`
	if [ ! $? = 0 ] ; then
@


14.36
log
@add a check to see if automake chokes on libtool as well (since sans -f autoconf may complete successfully)
@
text
@a415 1
_aux_dir=.
d442 10
a451 12
############################################
# protect COPYING & INSTALL from overwrite #
############################################
if test -d "${_aux_dir}" ; then
    for file in COPYING INSTALL ; do
	if test ! -f $file ; then
	    continue
	fi
	$VERBOSE_ECHO "cp -pf ${file} \"${_aux_dir}/${file}.backup\""
	cp -pf ${file} "${_aux_dir}/${file}.backup"
    done
fi
d706 9
a714 10
if test "x$HAVE_SED" = "xyes" ; then
    for file in COPYING INSTALL ; do
	curr="$file"
	if test ! -f "$curr" ; then
	    continue
	fi
	back="${_aux_dir}/${file}.backup"
	if test ! -f "$back" ; then
	    continue
	fi
d716 7
a722 23
	current="`cat $curr`"
	backup="`cat $back`"
	if test "x$current" != "x$backup" ; then
	    current_rev=`grep '$Revision' "$curr" | sed 's/.*[^0-9]\([0-9][0-9]*\.[0-9][0-9]*\)[^0-9].*/\1/' | sed 's/\.//g'`
	    $VERBOSE_ECHO "Revision of $curr is \"${current_rev}\""
	    if test "x$current_rev" = "x" ; then
		current_rev=0
	    fi
	    backup_rev=`grep '$Revision' "$back" | sed 's/.*[^0-9]\([0-9][0-9]*\.[0-9][0-9]*\)[^0-9].*/\1/' | sed 's/\.//g'`
	    $VERBOSE_ECHO "Revision of $back is \"${backup_rev}\""
	    if test "x$backup_rev" = "x" ; then
		backup_rev=0
	    fi
	    if test "$current_rev" -lt "$backup_rev" ; then
		if test "x$spacer" = "xno" ; then
		    $VERBOSE_ECHO
		    spacer=yes
		fi
		# restore the backup
		$VERBOSE_ECHO "Need to restore $file from backup (automake -f clobbered it)"
		$VERBOSE_ECHO "cp -pf \"$back\" \"${curr}\""
		cp -pf "$back" "$curr"
	    fi
d724 6
a729 2
    done
fi
@


14.35
log
@search for libtoolize14, make sure that we can pinpoint the alternate libtoolize's location via which/dirname in order to print instructions correctly.  fix typo on glti
@
text
@d14 1
a14 1
# 2. Redistributions in binary form must reproduce the above 
d160 1
a160 1
	
d168 1
a168 1
	
d176 1
a176 1
    $ECHO 
d215 1
a215 1
	
d227 1
a227 1
	
d235 1
a235 1
    $ECHO 
d275 1
a275 1
    
d302 1
a302 1
	    $ECHO 
d314 1
a314 1
		$ECHO 
d343 1
a343 1
	
d355 1
a355 1
	
d357 1
a357 1
	
d364 1
a364 1
    $ECHO 
d487 1
a487 1
    
d496 1
a496 1
	
d500 1
a500 1
	
d520 1
a520 1
    
d523 1
a523 1
    
d525 1
a525 1
    if [ "x$HAVE_LIBTOOLIZE" = "xyes" ] ; then 
d536 1
a536 1
    
d555 1
a555 1
    
d563 1
a563 1
	    if ! test -f configure.ac.backup ; then
d618 1
a618 1
		if ! test "x$found_libtool" = "x" ; then
d620 1
a620 1
			if ! test -f acinclude.m4.backup ; then
d627 1
a627 1
		    
d630 1
a630 1
		    
d666 1
a666 1
    
d668 34
a701 2
    $AUTOMAKE -a -c -f
    if [ ! $? = 0 ] ; then $ECHO "ERROR: $AUTOMAKE failed" && exit 2 ; fi
@


14.34
log
@don't buy into the philosophy of requiring a minimum version so strictly.  add extra failure support for configure.ac files that are actually using autoconf macros newer than the stated minimum requirement on the half-presumption that they are perhaps not strictly necessary for the build.  warn verbosely about any edits iff it helps autoconf succeed.  this helps everything 'just work' even for the maintainers without requiring tools to be updated for potentially insignificant _yet_still_ useful macros. the gnu autotools folks really suck for making forward/backwards cross-platform version support such a pain (both bugs and by trying to force devs onto a single version across all supported platforms).  issues like this make scons more appealing every day, impractical idiots.
@
text
@d262 1
a262 1
HAVE_ALTLIBTOOLIZE=no
d277 1
a277 1
    for tool in glibtoolize libtoolize15 libtoolize13 ; do
d281 20
a300 1
	    HAVE_ALTLIBTOOLIZE=yes
a309 2
		_glti="`which $tool`"
		_gltidir="`dirname $_glti`"
d313 1
a313 1
		$ECHO "   ln -s $glti $_gltidir/libtoolize"
d530 1
a530 1
	if [ "x$HAVE_ALTLIBTOOLIZE" = "xyes" ] ; then
@


14.33
log
@follow our own ws rules
@
text
@d543 44
a586 1
	# retry without the -f
d591 8
d624 19
@


14.32
log
@autoconf 2.52 on os x 10.2 does not support the -f option, so try to continue without it if autoconf fails
@
text
@d74 13
a86 13
  case "x$arg" in
    x--help) HELP=yes ;;
    x-[hH]) HELP=yes ;;
    x--quiet) QUIET=yes ;;
    x-[qQ]) QUIET=yes ;;
    x--verbose) VERBOSE=yes ;;
    x-[vV]) VERBOSE=yes ;;
    x--version) VERSION_ONLY=yes ;;
    *)
      echo "Unknown option: $arg"
      exit 1
      ;;
  esac
d98 1
a98 1
  *c*,-n*) ECHO_N= ECHO_C='
d100 2
a101 2
  *c*,*  ) ECHO_N=-n ECHO_C= ECHO_T= ;;
  *)       ECHO_N= ECHO_C='\c' ECHO_T= ;;
d112 3
a114 3
  if [ "x$VERBOSE" = "xyes" ] ; then
    echo "Verbose output quelled by quiet option.  Further output disabled."
  fi
d116 5
a120 5
  ECHO=echo
  if [ "x$VERBOSE" = "xyes" ] ; then
    echo "Verbose output enabled"
    VERBOSE_ECHO=echo
  fi
d126 1
a126 1
  [ "x$_have_sed" = "xyes" ] && HAVE_SED=yes
d129 2
a130 2
  $ECHO "Warning:  sed does not appear to be available."
  $ECHO "GNU Autotools version checks are disabled."
d139 6
a144 6
  $VERBOSE_ECHO "Checking autoconf version: $AUTOCONF --version"
  $AUTOCONF --version > /dev/null 2>&1
  if [ $? = 0 ] ; then
    _acfound=yes
    break
  fi
d149 2
a150 2
  $ECHO "ERROR:  Unable to locate GNU Autoconf."
  _report_error=yes
d152 18
a169 15
  _version_line="`$AUTOCONF --version | head -${TAIL_N}1`"
  if [ "x$HAVE_SED" = "xyes" ] ; then
    _maj_version="`echo $_version_line | sed 's/.* \([0-9]\)\.[0-9][0-9].*/\1/'`"
    _maj_version="`echo $_maj_version | sed 's/.*[A-Z].*//'`"
    [ "x$_maj_version" = "x" ] && _maj_version=0
    _min_version="`echo $_version_line | sed 's/.* [0-9]\.\([0-9][0-9]\).*/\1/'`"
    _min_version="`echo $_min_version | sed 's/.*[A-Z].*//'`"
    [ "x$_min_version" = "x" ] && _min_version=0

    if [ $_maj_version -lt $AUTOCONF_MAJOR_VERSION ] ; then
      _report_error=yes
    elif [ $_maj_version -eq $AUTOCONF_MAJOR_VERSION ] ; then
      if [ $_min_version -lt $AUTOCONF_MINOR_VERSION ] ; then
	_report_error=yes
      fi
a170 3

    $ECHO "Found GNU Autoconf version $_maj_version.$_min_version"
  fi
d173 9
a181 9
  $ECHO
  $ECHO "ERROR:  To prepare the ${SUITE} build system from scratch,"
  $ECHO "        at least version $AUTOCONF_MAJOR_VERSION.$AUTOCONF_MINOR_VERSION.$AUTOCONF_PATCH_VERSION of GNU Autoconf must be installed."
  $ECHO 
  $ECHO "$PATH_TO_AUTOGEN/autogen.sh does not need to be run on the same machine that will"
  $ECHO "run configure or make.  Either the GNU Autotools will need to be installed"
  $ECHO "or upgraded on this system, or $PATH_TO_AUTOGEN/autogen.sh must be run on the source"
  $ECHO "code on another system and then transferred to here. -- Cheers!"
  exit 1
d190 6
a195 6
  $VERBOSE_ECHO "Checking automake version: $AUTOMAKE --version"
  $AUTOMAKE --version > /dev/null 2>&1
  if [ $? = 0 ] ; then
    _amfound=yes
    break
  fi
d200 3
a202 3
  $ECHO
  $ECHO "ERROR: Unable to locate GNU Automake."
  _report_error=yes
d204 22
a225 20
  _version_line="`$AUTOMAKE --version | head -${TAIL_N}1`"
  if [ "x$HAVE_SED" = "xyes" ] ; then
    _maj_version="`echo $_version_line | sed 's/.* \([0-9]\)\.[0-9].*/\1/'`"
    _maj_version="`echo $_maj_version | sed 's/.*[A-Z].*//'`"
    [ "x$_maj_version" = "x" ] && _maj_version=0
    _min_version="`echo $_version_line | sed 's/.* [0-9]\.\([0-9]\).*/\1/'`"
    _min_version="`echo $_min_version | sed 's/.*[A-Z].*//'`"
    [ "x$_min_version" = "x" ] && _min_version=0
    _pat_version="`echo $_version_line | sed 's/.* [0-9]\.[0-9][\.-]p*\([0-9]*\).*/\1/'`"
    _pat_version="`echo $_pat_version | sed 's/.*[A-Z].*//'`"
    [ "x$_pat_version" = "x" ] && _pat_version=0

    if [ $_maj_version -lt $AUTOMAKE_MAJOR_VERSION ] ; then
      _report_error=yes
    elif [ $_maj_version -eq $AUTOMAKE_MAJOR_VERSION ] ; then
      if [ $_min_version -lt $AUTOMAKE_MINOR_VERSION ] ; then
	_report_error=yes
      elif [ $_min_version -eq $AUTOMAKE_MINOR_VERSION ] ; then
	if [ $_pat_version -lt $AUTOMAKE_PATCH_VERSION ] ; then
	  _report_error=yes
d227 2
a228 1
      fi
a229 3

    $ECHO "Found GNU Automake version $_maj_version.$_min_version.$_pat_version"
  fi
d232 9
a240 9
  $ECHO
  $ECHO "ERROR:  To prepare the ${SUITE} build system from scratch,"
  $ECHO "        at least version $AUTOMAKE_MAJOR_VERSION.$AUTOMAKE_MINOR_VERSION.$AUTOMAKE_PATCH_VERSION of GNU Automake must be installed."
  $ECHO 
  $ECHO "$PATH_TO_AUTOGEN/autogen.sh does not need to be run on the same machine that will"
  $ECHO "run configure or make.  Either the GNU Autotools will need to be installed"
  $ECHO "or upgraded on this system, or $PATH_TO_AUTOGEN/autogen.sh must be run on the source"
  $ECHO "code on another system and then transferred to here. -- Cheers!"
  exit 1
d249 6
a254 6
  $VERBOSE_ECHO "Checking autoreconf version: $AUTORECONF --version"
  $AUTORECONF --version > /dev/null 2>&1
  if [ $? = 0 ] ; then
    HAVE_AUTORECONF=yes
    break
  fi
d268 6
a273 35
  HAVE_LIBTOOLIZE=no
  if [ "x$HAVE_AUTORECONF" = "xno" ] ; then
    $ECHO "Warning:  libtoolize does not appear to be available."
  else
    $ECHO "Warning:  libtoolize does not appear to be available.  This means that"
    $ECHO "autoreconf cannot be used."
  fi

  # look for some alternates
  for tool in glibtoolize libtoolize15 libtoolize13 ; do
    $VERBOSE_ECHO "Checking libtoolize alternate: $tool --version"
    _glibtoolize="`$tool --version > /dev/null 2>&1`"
    if [ $? = 0 ] ; then
      HAVE_ALTLIBTOOLIZE=yes
      LIBTOOLIZE="$tool"
      $ECHO 
      $ECHO "Fortunately, $tool was found which means that your system may simply"
      $ECHO "have a non-standard or incomplete GNU Autotools install.  If you have"
      $ECHO "sufficient system access, it may be possible to quell this warning by"
      $ECHO "running:"
      $ECHO
      sudo -V > /dev/null 2>&1
      if [ $? = 0 ] ; then
	_glti="`which $tool`"
	_gltidir="`dirname $_glti`"
	$ECHO "   sudo ln -s $_glti $_gltidir/libtoolize"
	$ECHO
      else
	$ECHO "   ln -s $glti $_gltidir/libtoolize"
	$ECHO 
	$ECHO "Run that as root or with proper permissions to the $_gltidir directory"
	$ECHO
      fi
      _ltfound=yes
      break
d275 30
a304 1
  done
d306 1
a306 1
  _ltfound=yes
d311 3
a313 3
  $ECHO
  $ECHO "ERROR: Unable to locate GNU Libtool."
  _report_error=yes
d315 22
a336 20
  _version_line="`$LIBTOOLIZE --version | head -${TAIL_N}1`"
  if [ "x$HAVE_SED" = "xyes" ] ; then
    _maj_version="`echo $_version_line | sed 's/.* \([0-9]\)\.[0-9].*/\1/'`"
    _maj_version="`echo $_maj_version | sed 's/.*[A-Z].*//'`"
    [ "x$_maj_version" = "x" ] && _maj_version=0
    _min_version="`echo $_version_line | sed 's/.* [0-9]\.\([0-9]\).*/\1/'`"
    _min_version="`echo $_min_version | sed 's/.*[A-Z].*//'`"
    [ "x$_min_version" = "x" ] && _min_version=0
    _pat_version="`echo $_version_line | sed 's/.* [0-9]\.[0-9][\.-]p*\([0-9]*\).*/\1/'`"
    _pat_version="`echo $_pat_version | sed 's/.*[A-Z].*//'`"
    [ "x$_pat_version" = "x" ] && _pat_version=0

    if [ $_maj_version -lt $LIBTOOL_MAJOR_VERSION ] ; then
      _report_error=yes
    elif [ $_maj_version -eq $LIBTOOL_MAJOR_VERSION ] ; then
      if [ $_min_version -lt $LIBTOOL_MINOR_VERSION ] ; then
	_report_error=yes
      elif [ $_min_version -eq $LIBTOOL_MINOR_VERSION ] ; then
	if [ $_pat_version -lt $LIBTOOL_PATCH_VERSION ] ; then
	  _report_error=yes
d338 3
a340 1
      fi
a341 4

    $ECHO "Found GNU Libtool version $_maj_version.$_min_version.$_pat_version"

  fi
d344 9
a352 9
  $ECHO
  $ECHO "ERROR:  To prepare the ${SUITE} build system from scratch,"
  $ECHO "        at least version $LIBTOOL_MAJOR_VERSION.$LIBTOOL_MINOR_VERSION.$LIBTOOL_PATCH_VERSION of GNU Libtool must be installed."
  $ECHO 
  $ECHO "$PATH_TO_AUTOGEN/autogen.sh does not need to be run on the same machine that will"
  $ECHO "run configure or make.  Either the GNU Autotools will need to be installed"
  $ECHO "or upgraded on this system, or $PATH_TO_AUTOGEN/autogen.sh must be run on the source"
  $ECHO "code on another system and then transferred to here. -- Cheers!"
  exit 1
d360 5
a364 5
  $VERBOSE_ECHO "Checking aclocal version: $ACLOCAL --version"
  $ACLOCAL --version > /dev/null 2>&1
  if [ $? = 0 ] ; then
    break
  fi
d372 5
a376 5
  $VERBOSE_ECHO "Checking autoheader version: $AUTOHEADER --version"
  $AUTOHEADER --version > /dev/null 2>&1
  if [ $? = 0 ] ; then
    break
  fi
d385 1
a385 1
  exit 0
d402 1
a402 1
  _configure_file=configure.ac
d404 1
a404 1
  _configure_file=configure.in
d408 1
a408 1
  _aux_dir=.
d410 1
a410 1
  $VERBOSE_ECHO "Detected auxillary directory: $_aux_dir"
d419 4
a422 4
  if test ! -f $file ; then
    $VERBOSE_ECHO "Touching ${file} since it does not exist"
    touch $file
  fi
d430 7
a436 7
  for file in COPYING INSTALL ; do
    if test ! -f $file ; then
      continue
    fi
    $VERBOSE_ECHO "cp -pf ${file} \"${_aux_dir}/${file}.backup\""
    cp -pf ${file} "${_aux_dir}/${file}.backup"
  done
d444 4
a447 4
  if test -f "${_aux_dir}/${file}" ; then
    $VERBOSE_ECHO "mv -f \"${_aux_dir}/${file}\" \"${_aux_dir}/${file}.backup\""
    mv -f "${_aux_dir}/${file}" "${_aux_dir}/${file}.backup"
  fi
d456 4
a459 4
  if [ -d $dir ] ; then
    $VERBOSE_ECHO "Found extra aclocal search directory: $dir"
    SEARCH_DIRS="$SEARCH_DIRS -I $dir"
  fi
d468 18
a485 14
  $ECHO
  $ECHO $ECHO_N "Automatically preparing build ... $ECHO_C"

  if [ "x$VERBOSE" = "xyes" ] ; then
    $VERBOSE_ECHO "$AUTORECONF $SEARCH_DIRS -i -f"
    $AUTORECONF $SEARCH_DIRS -i -f
  else
    $AUTORECONF $SEARCH_DIRS -i -f > /dev/null 2>&1
  fi
  if [ ! $? = 0 ] ; then
    $ECHO "Warning: $AUTORECONF failed"

    if test -f ltmain.sh ; then
      $ECHO "libtoolize being run by autoreconf is not creating ltmain.sh in the auxillary directory like it should"
d487 1
a487 2

    $ECHO "Attempting to run the configuration steps individually"
a488 3
  fi
else
  reconfigure_manually=yes
d501 22
a522 2
  $ECHO
  $ECHO $ECHO_N "Preparing build ... $ECHO_C"
d524 45
a568 65
  $VERBOSE_ECHO "$ACLOCAL $SEARCH_DIRS"
  $ACLOCAL $SEARCH_DIRS

  if [ ! $? = 0 ] ; then $ECHO "ERROR: $ACLOCAL failed" && exit 2 ; fi
  if [ "x$HAVE_LIBTOOLIZE" = "xyes" ] ; then 
    $VERBOSE_ECHO "$LIBTOOLIZE --automake -c -f"
    $LIBTOOLIZE --automake -c -f
    if [ ! $? = 0 ] ; then $ECHO "ERROR: $LIBTOOLIZE failed" && exit 2 ; fi
  else
    if [ "x$HAVE_ALTLIBTOOLIZE" = "xyes" ] ; then
      $VERBOSE_ECHO "$LIBTOOLIZE --automake --copy --force"
      $LIBTOOLIZE --automake --copy --force
      if [ ! $? = 0 ] ; then $ECHO "ERROR: $LIBTOOLIZE failed" && exit 2 ; fi
    fi
  fi

  # re-run again as instructed by libtoolize
  $VERBOSE_ECHO "$ACLOCAL $SEARCH_DIRS"
  $ACLOCAL $SEARCH_DIRS

  # libtoolize might put ltmain.sh in the wrong place
  if test -f ltmain.sh ; then
    if test ! -f "${_aux_dir}/ltmain.sh" ; then
      $ECHO
      $ECHO "Warning:  $LIBTOOLIZE is creating ltmain.sh in the wrong directory"
      $ECHO
      $ECHO "Fortunately, the problem can be worked around by simply copying the"
      $ECHO "file to the appropriate location (${_aux_dir}/).  This has been done for you."
      $ECHO
      $VERBOSE_ECHO "cp ltmain.sh \"${_aux_dir}/ltmain.sh\""
      cp ltmain.sh "${_aux_dir}/ltmain.sh"
      $ECHO $ECHO_N "Continuing build preparation ... $ECHO_C"
    fi
  fi

  $VERBOSE_ECHO
  $VERBOSE_ECHO "$AUTOCONF -f"
  autoconf_output=`$AUTOCONF -f 2>&1`
  if [ ! $? = 0 ] ; then
      # retry without the -f
      $VERBOSE_ECHO
      $VERBOSE_ECHO "$AUTOCONF"
      autoconf_output=`$AUTOCONF 2>&1`
      if [ ! $? = 0 ] ; then
	  if test -f "$LIBTOOL_M4" ; then
	      found_libtool="`$ECHO $autoconf_output | grep AC_PROG_LIBTOOL`"
	      if ! test "x$found_libtool" = "x" ; then
		  if test -f acinclude.m4 ; then
		      if ! test -f acinclude.m4.backup ; then
			  $VERBOSE_ECHO cp acinclude.m4 acinclude.m4.backup
			  cp acinclude.m4 acinclude.m4.backup
		      fi
		  fi
		  $VERBOSE_ECHO cat "$LIBTOOL_M4" >> acinclude.m4
		  cat "$LIBTOOL_M4" >> acinclude.m4
		  
		  $ECHO
		  $ECHO "Restarting the configuration steps with a local libtool.m4"

		  $VERBOSE_ECHO sh $0 "$1" "$2" "$3" "$4" "$5" "$6" "$7" "$8" "$9"
		  sh "$0" "$1" "$2" "$3" "$4" "$5" "$6" "$7" "$8" "$9"
		  exit $?
	      fi
	  fi
	  cat <<EOF
d571 12
a582 12
	  $ECHO "ERROR: $AUTOCONF failed"
	  exit 2
      fi
  fi

  $VERBOSE_ECHO "$AUTOHEADER"
  $AUTOHEADER
  if [ ! $? = 0 ] ; then $ECHO "ERROR: $AUTOHEADER failed" && exit 2 ; fi

  $VERBOSE_ECHO "$AUTOMAKE -a -c -f"
  $AUTOMAKE -a -c -f
  if [ ! $? = 0 ] ; then $ECHO "ERROR: $AUTOMAKE failed" && exit 2 ; fi
d641 3
a643 3
  if [ "x`echo $ARGS | sed 's/.*[hH][eE][lL][pP].*/help/'`" = "xhelp" ] ; then
    _help=yes
  fi
d646 5
a650 5
  echo "Help was requested.  No configuration and compilation will be done."
  echo "Running: $PATH_TO_AUTOGEN/configure $ARGS"
  $VERBOSE_ECHO "$PATH_TO_AUTOGEN/configure $ARGS"
  $PATH_TO_AUTOGEN/configure $ARGS
  exit 0
@


14.31
log
@apply Enrique Perez-Terron's suggestions/fixes regarding assumption that sed exists when verbose is enabled, now should properly test sed
@
text
@d543 24
a566 7
    if test -f "$LIBTOOL_M4" ; then
      found_libtool="`$ECHO $autoconf_output | grep AC_PROG_LIBTOOL`"
      if ! test "x$found_libtool" = "x" ; then
	if test -f acinclude.m4 ; then
	  if ! test -f acinclude.m4.backup ; then
	    $VERBOSE_ECHO cp acinclude.m4 acinclude.m4.backup
	    cp acinclude.m4 acinclude.m4.backup
d568 1
a568 13
	fi
	$VERBOSE_ECHO cat "$LIBTOOL_M4" >> acinclude.m4
	cat "$LIBTOOL_M4" >> acinclude.m4

	$ECHO
	$ECHO "Restarting the configuration steps with a local libtool.m4"

	$VERBOSE_ECHO sh $0 "$1" "$2" "$3" "$4" "$5" "$6" "$7" "$8" "$9"
	sh "$0" "$1" "$2" "$3" "$4" "$5" "$6" "$7" "$8" "$9"
	exit $?
      fi
    fi
    cat <<EOF
d571 3
a573 2
    $ECHO "ERROR: $AUTOCONF failed"
    exit 2
@


14.31.2.1
log
@merge changes from HEAD aka rel-7-6-4 to the rel-7-6-branch just in case someone peeks a gander or tries to continue/build the branch
@
text
@d14 1
a14 1
# 2. Redistributions in binary form must reproduce the above
d74 13
a86 13
    case "x$arg" in
	x--help) HELP=yes ;;
	x-[hH]) HELP=yes ;;
	x--quiet) QUIET=yes ;;
	x-[qQ]) QUIET=yes ;;
	x--verbose) VERBOSE=yes ;;
	x-[vV]) VERBOSE=yes ;;
	x--version) VERSION_ONLY=yes ;;
	*)
	    echo "Unknown option: $arg"
	    exit 1
	    ;;
    esac
a96 10
# commands that this script expects
for __cmd in echo head tail ; do
    echo "test" | $__cmd > /dev/null 2>&1
    if [ $? != 0 ] ; then
	echo "ERROR: '${__cmd}' command is required"
	exit 2
    fi
done

# determine the behavior of echo
d98 1
a98 1
    *c*,-n*) ECHO_N= ECHO_C='
d100 2
a101 14
    *c*,*  ) ECHO_N=-n ECHO_C= ECHO_T= ;;
    *)       ECHO_N= ECHO_C='\c' ECHO_T= ;;
esac

# determine the behavior of head
case "x`echo 'head' | head -n 1 2>&1`" in
    *xhead*) HEAD_N="n " ;;
    *) HEAD_N="" ;;
esac

# determine the behavior of tail
case "x`echo 'tail' | tail -n 1 2>&1`" in
    *xtail*) TAIL_N="n " ;;
    *) TAIL_N="" ;;
d103 5
d112 3
a114 3
    if [ "x$VERBOSE" = "xyes" ] ; then
	echo "Verbose output quelled by quiet option.  Further output disabled."
    fi
d116 5
a120 5
    ECHO=echo
    if [ "x$VERBOSE" = "xyes" ] ; then
	echo "Verbose output enabled"
	VERBOSE_ECHO=echo
    fi
d126 1
a126 1
    [ "x$_have_sed" = "xyes" ] && HAVE_SED=yes
d129 2
a130 2
    $ECHO "Warning:  sed does not appear to be available."
    $ECHO "GNU Autotools version checks are disabled."
d139 6
a144 6
    $VERBOSE_ECHO "Checking autoconf version: $AUTOCONF --version"
    $AUTOCONF --version > /dev/null 2>&1
    if [ $? = 0 ] ; then
	_acfound=yes
	break
    fi
d149 2
a150 2
    $ECHO "ERROR:  Unable to locate GNU Autoconf."
    _report_error=yes
d152 16
a167 16
    _version_line="`$AUTOCONF --version | head -${HEAD_N}1`"
    if [ "x$HAVE_SED" = "xyes" ] ; then
	_maj_version="`echo $_version_line | sed 's/.* \([0-9]\)\.[0-9][0-9].*/\1/'`"
	_maj_version="`echo $_maj_version | sed 's/.*[A-Z].*//'`"
	[ "x$_maj_version" = "x" ] && _maj_version=0
	_min_version="`echo $_version_line | sed 's/.* [0-9]\.\([0-9][0-9]\).*/\1/'`"
	_min_version="`echo $_min_version | sed 's/.*[A-Z].*//'`"
	[ "x$_min_version" = "x" ] && _min_version=0

	if [ $_maj_version -lt $AUTOCONF_MAJOR_VERSION ] ; then
	    _report_error=yes
	elif [ $_maj_version -eq $AUTOCONF_MAJOR_VERSION ] ; then
	    if [ $_min_version -lt $AUTOCONF_MINOR_VERSION ] ; then
		_report_error=yes
	    fi
	fi
d169 2
a170 2
	$ECHO "Found GNU Autoconf version $_maj_version.$_min_version"
    fi
d173 9
a181 9
    $ECHO
    $ECHO "ERROR:  To prepare the ${SUITE} build system from scratch,"
    $ECHO "        at least version $AUTOCONF_MAJOR_VERSION.$AUTOCONF_MINOR_VERSION.$AUTOCONF_PATCH_VERSION of GNU Autoconf must be installed."
    $ECHO
    $ECHO "$PATH_TO_AUTOGEN/autogen.sh does not need to be run on the same machine that will"
    $ECHO "run configure or make.  Either the GNU Autotools will need to be installed"
    $ECHO "or upgraded on this system, or $PATH_TO_AUTOGEN/autogen.sh must be run on the source"
    $ECHO "code on another system and then transferred to here. -- Cheers!"
    exit 1
d190 6
a195 6
    $VERBOSE_ECHO "Checking automake version: $AUTOMAKE --version"
    $AUTOMAKE --version > /dev/null 2>&1
    if [ $? = 0 ] ; then
	_amfound=yes
	break
    fi
d200 3
a202 3
    $ECHO
    $ECHO "ERROR: Unable to locate GNU Automake."
    _report_error=yes
d204 20
a223 22
    _version_line="`$AUTOMAKE --version | head -${HEAD_N}1`"
    if [ "x$HAVE_SED" = "xyes" ] ; then
	_maj_version="`echo $_version_line | sed 's/.* \([0-9]\)\.[0-9].*/\1/'`"
	_maj_version="`echo $_maj_version | sed 's/.*[A-Z].*//'`"
	[ "x$_maj_version" = "x" ] && _maj_version=0
	_min_version="`echo $_version_line | sed 's/.* [0-9]\.\([0-9]\).*/\1/'`"
	_min_version="`echo $_min_version | sed 's/.*[A-Z].*//'`"
	[ "x$_min_version" = "x" ] && _min_version=0
	_pat_version="`echo $_version_line | sed 's/.* [0-9]\.[0-9][\.-]p*\([0-9]*\).*/\1/'`"
	_pat_version="`echo $_pat_version | sed 's/.*[A-Z].*//'`"
	[ "x$_pat_version" = "x" ] && _pat_version=0

	if [ $_maj_version -lt $AUTOMAKE_MAJOR_VERSION ] ; then
	    _report_error=yes
	elif [ $_maj_version -eq $AUTOMAKE_MAJOR_VERSION ] ; then
	    if [ $_min_version -lt $AUTOMAKE_MINOR_VERSION ] ; then
		_report_error=yes
	    elif [ $_min_version -eq $AUTOMAKE_MINOR_VERSION ] ; then
		if [ $_pat_version -lt $AUTOMAKE_PATCH_VERSION ] ; then
		    _report_error=yes
		fi
	    fi
d225 2
d228 2
a229 2
	$ECHO "Found GNU Automake version $_maj_version.$_min_version.$_pat_version"
    fi
d232 9
a240 9
    $ECHO
    $ECHO "ERROR:  To prepare the ${SUITE} build system from scratch,"
    $ECHO "        at least version $AUTOMAKE_MAJOR_VERSION.$AUTOMAKE_MINOR_VERSION.$AUTOMAKE_PATCH_VERSION of GNU Automake must be installed."
    $ECHO
    $ECHO "$PATH_TO_AUTOGEN/autogen.sh does not need to be run on the same machine that will"
    $ECHO "run configure or make.  Either the GNU Autotools will need to be installed"
    $ECHO "or upgraded on this system, or $PATH_TO_AUTOGEN/autogen.sh must be run on the source"
    $ECHO "code on another system and then transferred to here. -- Cheers!"
    exit 1
d249 6
a254 6
    $VERBOSE_ECHO "Checking autoreconf version: $AUTORECONF --version"
    $AUTORECONF --version > /dev/null 2>&1
    if [ $? = 0 ] ; then
	HAVE_AUTORECONF=yes
	break
    fi
d262 1
a262 1
HAVE_ALT_LIBTOOLIZE=no
d268 35
a302 6
    HAVE_LIBTOOLIZE=no
    if [ "x$HAVE_AUTORECONF" = "xno" ] ; then
	$ECHO "Warning:  libtoolize does not appear to be available."
    else
	$ECHO "Warning:  libtoolize does not appear to be available.  This means that"
	$ECHO "autoreconf cannot be used."
d304 1
a304 47

    # look for some alternates
    for tool in glibtoolize libtoolize15 libtoolize14 libtoolize13 ; do
	$VERBOSE_ECHO "Checking libtoolize alternate: $tool --version"
	_glibtoolize="`$tool --version > /dev/null 2>&1`"
	if [ $? = 0 ] ; then
	    $VERBOSE_ECHO "Found $tool --version"
	    _glti="`which $tool`"
	    if [ "x$_glti" = "x" ] ; then
		$VERBOSE_ECHO "Cannot find $tool with which"
		continue;
	    fi
	    if test ! -f "$_glti" ; then
		$VERBOSE_ECHO "Cannot use $tool, $_glti is not a file"
		continue;
	    fi
	    _gltidir="`dirname $_glti`"
	    if [ "x$_gltidir" = "x" ] ; then
		$VERBOSE_ECHO "Cannot find $tool path with dirname of $_glti"
		continue;
	    fi
	    if test ! -d "$_gltidir" ; then
		$VERBOSE_ECHO "Cannot use $tool, $_gltidir is not a directory"
		continue;
	    fi
	    HAVE_ALT_LIBTOOLIZE=yes
	    LIBTOOLIZE="$tool"
	    $ECHO
	    $ECHO "Fortunately, $tool was found which means that your system may simply"
	    $ECHO "have a non-standard or incomplete GNU Autotools install.  If you have"
	    $ECHO "sufficient system access, it may be possible to quell this warning by"
	    $ECHO "running:"
	    $ECHO
	    sudo -V > /dev/null 2>&1
	    if [ $? = 0 ] ; then
		$ECHO "   sudo ln -s $_glti $_gltidir/libtoolize"
		$ECHO
	    else
		$ECHO "   ln -s $_glti $_gltidir/libtoolize"
		$ECHO
		$ECHO "Run that as root or with proper permissions to the $_gltidir directory"
		$ECHO
	    fi
	    _ltfound=yes
	    break
	fi
    done
d306 1
a306 1
    _ltfound=yes
d311 3
a313 3
    $ECHO
    $ECHO "ERROR: Unable to locate GNU Libtool."
    _report_error=yes
d315 20
a334 22
    _version_line="`$LIBTOOLIZE --version | head -${HEAD_N}1`"
    if [ "x$HAVE_SED" = "xyes" ] ; then
	_maj_version="`echo $_version_line | sed 's/.* \([0-9]\)\.[0-9].*/\1/'`"
	_maj_version="`echo $_maj_version | sed 's/.*[A-Z].*//'`"
	[ "x$_maj_version" = "x" ] && _maj_version=0
	_min_version="`echo $_version_line | sed 's/.* [0-9]\.\([0-9]\).*/\1/'`"
	_min_version="`echo $_min_version | sed 's/.*[A-Z].*//'`"
	[ "x$_min_version" = "x" ] && _min_version=0
	_pat_version="`echo $_version_line | sed 's/.* [0-9]\.[0-9][\.-]p*\([0-9]*\).*/\1/'`"
	_pat_version="`echo $_pat_version | sed 's/.*[A-Z].*//'`"
	[ "x$_pat_version" = "x" ] && _pat_version=0

	if [ $_maj_version -lt $LIBTOOL_MAJOR_VERSION ] ; then
	    _report_error=yes
	elif [ $_maj_version -eq $LIBTOOL_MAJOR_VERSION ] ; then
	    if [ $_min_version -lt $LIBTOOL_MINOR_VERSION ] ; then
		_report_error=yes
	    elif [ $_min_version -eq $LIBTOOL_MINOR_VERSION ] ; then
		if [ $_pat_version -lt $LIBTOOL_PATCH_VERSION ] ; then
		    _report_error=yes
		fi
	    fi
d336 2
d339 1
a339 1
	$ECHO "Found GNU Libtool version $_maj_version.$_min_version.$_pat_version"
d341 1
a341 1
    fi
d344 9
a352 9
    $ECHO
    $ECHO "ERROR:  To prepare the ${SUITE} build system from scratch,"
    $ECHO "        at least version $LIBTOOL_MAJOR_VERSION.$LIBTOOL_MINOR_VERSION.$LIBTOOL_PATCH_VERSION of GNU Libtool must be installed."
    $ECHO
    $ECHO "$PATH_TO_AUTOGEN/autogen.sh does not need to be run on the same machine that will"
    $ECHO "run configure or make.  Either the GNU Autotools will need to be installed"
    $ECHO "or upgraded on this system, or $PATH_TO_AUTOGEN/autogen.sh must be run on the source"
    $ECHO "code on another system and then transferred to here. -- Cheers!"
    exit 1
d360 5
a364 5
    $VERBOSE_ECHO "Checking aclocal version: $ACLOCAL --version"
    $ACLOCAL --version > /dev/null 2>&1
    if [ $? = 0 ] ; then
	break
    fi
d372 5
a376 5
    $VERBOSE_ECHO "Checking autoheader version: $AUTOHEADER --version"
    $AUTOHEADER --version > /dev/null 2>&1
    if [ $? = 0 ] ; then
	break
    fi
d385 1
a385 1
    exit 0
d399 1
d402 1
a402 1
    _configure_file=configure.ac
d404 1
a404 1
    _configure_file=configure.in
d406 5
a410 9

_aux_dir=.
if test "x$HAVE_SED" = "xyes" ; then
    _aux_dir="`cat $_configure_file | grep AC_CONFIG_AUX_DIR | tail -${TAIL_N}1 | sed 's/^[ ]*AC_CONFIG_AUX_DIR(\(.*\)).*/\1/'`"
    if test ! -d "$_aux_dir" ; then
	_aux_dir=.
    else
	$VERBOSE_ECHO "Detected auxillary directory: $_aux_dir"
    fi
d419 4
a422 4
    if test ! -f $file ; then
	$VERBOSE_ECHO "Touching ${file} since it does not exist"
	touch $file
    fi
d426 5
a430 4
########################################################
# protect COPYING & INSTALL from overwrite by automake #
########################################################
for file in COPYING INSTALL ; do
d432 1
a432 1
	continue
d436 2
a437 1
done
d444 4
a447 4
    if test -f "${_aux_dir}/${file}" ; then
	$VERBOSE_ECHO "mv -f \"${_aux_dir}/${file}\" \"${_aux_dir}/${file}.backup\""
	mv -f "${_aux_dir}/${file}" "${_aux_dir}/${file}.backup"
    fi
d456 4
a459 4
    if [ -d $dir ] ; then
	$VERBOSE_ECHO "Found extra aclocal search directory: $dir"
	SEARCH_DIRS="$SEARCH_DIRS -I $dir"
    fi
d468 2
a469 2
    $ECHO
    $ECHO $ECHO_N "Automatically preparing build ... $ECHO_C"
d471 1
d473 6
a478 3
    autoreconf_output="`$AUTORECONF $SEARCH_DIRS -i -f 2>&1`"
    ret=$?
    $VERBOSE_ECHO "$autoreconf_output"
d480 3
a482 2
    if [ ! $ret = 0 ] ; then
	$ECHO "Warning: $AUTORECONF failed"
d484 3
a486 7
	if test -f ltmain.sh ; then
	    $ECHO "libtoolize being run by autoreconf is not creating ltmain.sh in the auxillary directory like it should"
	fi

	$ECHO "Attempting to run the configuration steps individually"
	reconfigure_manually=yes
    fi
d488 1
a488 1
    reconfigure_manually=yes
d501 2
a502 67
    $ECHO
    $ECHO $ECHO_N "Preparing build ... $ECHO_C"

    $VERBOSE_ECHO "$ACLOCAL $SEARCH_DIRS"
    aclocal_output="`$ACLOCAL $SEARCH_DIRS 2>&1`"
    ret=$?
    $VERBOSE_ECHO "$aclocal_output"

    if [ ! $ret = 0 ] ; then
	if [ ! "x`echo $aclocal_output | grep cache`" = "x" ] ; then
	    # retry without an autom4te.cache directory if it exists

	    if test -d autom4te.cache ; then
		if test -d autom4te.cache.backup ; then
		    $ECHO "ERROR: $ACLOCAL failed"
		    $VERBOSE_ECHO
		    $VERBOSE_ECHO "Unable to retry aclocal without autom4te.cache"
		    $VERBOSE_ECHO "There is an autom4te.cache.backup directory in the way"
		    $VERBOSE_ECHO "Suggest running: rm -rf *cache*"
		    exit 2
		else
		    $VERBOSE_ECHO "mv autom4te.cache autom4te.cache.backup"
		    mv autom4te.cache autom4te.cache.backup
		fi
		$VERBOSE_ECHO "Retrying aclocal without the autom4te.cache directory"
		$VERBOSE_ECHO "$ACLOCAL $SEARCH_DIRS"
		aclocal_output="`$ACLOCAL $SEARCH_DIRS 2>&1`"
		ret=$?
		$VERBOSE_ECHO "$aclocal_output"

		if [ ! $ret = 0 ] ; then
		    # still did not work after we removed the backup, so restore it
		    $VERBOSE_ECHO "mv autom4te.cache.backup autom4te.cache"
		    mv autom4te.cache.backup autom4te.cache
		else
		    # worked after we removed the backup, so remove the backup
		    $VERBOSE_ECHO "rm -rf autom4te.cache.backup"
		    rm -rf autom4te.cache.backup
		fi
	    fi
	fi
    fi

    if [ ! $ret = 0 ] ; then $ECHO "ERROR: $ACLOCAL failed" && exit 2 ; fi
    if [ "x$HAVE_LIBTOOLIZE" = "xyes" ] ; then
	$VERBOSE_ECHO "$LIBTOOLIZE --automake -c -f"
	libtoolize_output="`$LIBTOOLIZE --automake -c -f 2>&1`"
	ret=$?
	$VERBOSE_ECHO "$libtoolize_output"

	if [ ! $ret = 0 ] ; then $ECHO "ERROR: $LIBTOOLIZE failed" && exit 2 ; fi
    else
	if [ "x$HAVE_ALT_LIBTOOLIZE" = "xyes" ] ; then
	    $VERBOSE_ECHO "$LIBTOOLIZE --automake --copy --force"
	    libtoolize_output="`$LIBTOOLIZE --automake --copy --force 2>&1`"
	    ret=$?
	    $VERBOSE_ECHO "$libtoolize_output"

	    if [ ! $ret = 0 ] ; then $ECHO "ERROR: $LIBTOOLIZE failed" && exit 2 ; fi
	fi
    fi

    # re-run again as instructed by libtoolize
    $VERBOSE_ECHO "$ACLOCAL $SEARCH_DIRS"
    aclocal_output="`$ACLOCAL $SEARCH_DIRS 2>&1`"
    ret=$?
    $VERBOSE_ECHO "$aclocal_output"
d504 2
a505 14
    # libtoolize might put ltmain.sh in the wrong place
    if test -f ltmain.sh ; then
	if test ! -f "${_aux_dir}/ltmain.sh" ; then
	    $ECHO
	    $ECHO "Warning:  $LIBTOOLIZE is creating ltmain.sh in the wrong directory"
	    $ECHO
	    $ECHO "Fortunately, the problem can be worked around by simply copying the"
	    $ECHO "file to the appropriate location (${_aux_dir}/).  This has been done for you."
	    $ECHO
	    $VERBOSE_ECHO "cp ltmain.sh \"${_aux_dir}/ltmain.sh\""
	    cp ltmain.sh "${_aux_dir}/ltmain.sh"
	    $ECHO $ECHO_N "Continuing build preparation ... $ECHO_C"
	fi
    fi
d507 55
a561 38
    $VERBOSE_ECHO
    $VERBOSE_ECHO "$AUTOCONF -f"
    autoconf_output="`$AUTOCONF -f 2>&1`"
    ret=$?
    $VERBOSE_ECHO "$autoconf_output"

    if [ ! $ret = 0 ] ; then
 	# retry without an autom4te.cache directory if it exists
	if [ ! "x`echo $autoconf_output | grep autom4te`" = "x" ] ; then
	    if test -d autom4te.cache ; then
		if test -d autom4te.cache.backup ; then
		    $ECHO "ERROR: $AUTOCONF failed"
		    $VERBOSE_ECHO
		    $VERBOSE_ECHO "Unable to retry autoconf without autom4te.cache"
		    $VERBOSE_ECHO "There is an autom4te.cache.backup directory in the way"
		    $VERBOSE_ECHO "Suggest running: rm -rf *cache*"
		    exit 2
		else
		    $VERBOSE_ECHO "mv autom4te.cache autom4te.cache.backup"
		    mv autom4te.cache autom4te.cache.backup
		fi
		$VERBOSE_ECHO "Retrying autoconf without the autom4te.cache directory"
		$VERBOSE_ECHO "$AUTOCONF -f"
		autoconf_output="`$AUTOCONF -f 2>&1`"
		ret=$?
		$VERBOSE_ECHO "$autoconf_output"

		if [ ! $ret = 0 ] ; then
		    # still did not work after we removed the backup, so restore it
		    $VERBOSE_ECHO "mv autom4te.cache.backup autom4te.cache"
		    mv autom4te.cache.backup autom4te.cache
		else
		    # worked after we removed the backup, so remove the backup
		    $VERBOSE_ECHO "rm -rf autom4te.cache.backup"
		    rm -rf autom4te.cache.backup
		fi
	    fi
	fi
d563 1
a563 82

    if [ ! $ret = 0 ] ; then
	# retry without the -f and with backwards support for missing macros
	configure_ac_changed="no"
	if test "x$HAVE_SED" = "xyes" ; then
	    if test ! -f configure.ac.backup ; then
		$VERBOSE_ECHO cp $_configure_file configure.ac.backup
		cp $_configure_file configure.ac.backup
	    fi

	    ac2_59_macros="AC_C_RESTRICT AC_INCLUDES_DEFAULT AC_LANG_ASSERT AC_LANG_WERROR AS_SET_CATFILE"
	    ac2_55_macros="AC_COMPILER_IFELSE AC_FUNC_MBRTOWC AC_HEADER_STDBOOL AC_LANG_CONFTEST AC_LANG_SOURCE AC_LANG_PROGRAM AC_LANG_CALL AC_LANG_FUNC_TRY_LINK AC_MSG_FAILURE AC_PREPROC_IFELSE"
	    ac2_54_macros="AC_C_BACKSLASH_A AC_CONFIG_LIBOBJ_DIR AC_GNU_SOURCE AC_PROG_EGREP AC_PROG_FGREP AC_REPLACE_FNMATCH AC_FUNC_FNMATCH_GNU AC_FUNC_REALLOC AC_TYPE_MBSTATE_T"

	    macros_to_search=""
	    if [ $AUTOCONF_MAJOR_VERSION -lt 2 ] ; then
		macros_to_search="$ac2_59_macros $ac2_55_macros $ac2_54_macros"
	    else
		if [ $AUTOCONF_MINOR_VERSION -lt 54 ] ; then
		    macros_to_search="$ac2_59_macros $ac2_55_macros $ac2_54_macros"
		elif [ $AUTOCONF_MINOR_VERSION -lt 55 ] ; then
		    macros_to_search="$ac2_59_macros $ac2_55_macros"
		elif [ $AUTOCONF_MINOR_VERSION -lt 59 ] ; then
		    macros_to_search="$ac2_59_macros"
		fi
	    fi

	    if [ -w $_configure_file ] ; then
		for feature in $macros_to_search ; do
		    $VERBOSE_ECHO "Searching for $feature in $_configure_file with sed"
		    sed "s/^\($feature.*\)$/dnl \1/g" < $_configure_file > configure.ac.sed
		    if [ ! "x`cat $_configure_file`" = "x`cat configure.ac.sed`" ] ; then
			$VERBOSE_ECHO cp configure.ac.sed $_configure_file
			cp configure.ac.sed $_configure_file
			if [ "x$configure_ac_changed" = "xno" ] ; then
			    configure_ac_changed="$feature"
			else
			    configure_ac_changed="$feature $configure_ac_changed"
			fi
		    fi
		    rm -f configure.ac.sed
		done
	    else
		$VERBOSE_ECHO "$_configure_file is not writable so not attempting to edit"
	    fi
	fi
	$VERBOSE_ECHO
	$VERBOSE_ECHO "$AUTOCONF"
	autoconf_output="`$AUTOCONF 2>&1`"
	ret=$?
	$VERBOSE_ECHO "$autoconf_output"

	if [ ! $ret = 0 ] ; then

	    # failed so restore the backup
	    if test -f configure.ac.backup ; then
		$VERBOSE_ECHO cp configure.ac.bacukp $_configure_file
		cp configure.ac.backup $_configure_file
	    fi

	    # test if libtool is busted
	    if test -f "$LIBTOOL_M4" ; then
		found_libtool="`$ECHO $autoconf_output | grep AC_PROG_LIBTOOL`"
		if test ! "x$found_libtool" = "x" ; then
		    if test -f acinclude.m4 ; then
			if test ! -f acinclude.m4.backup ; then
			    $VERBOSE_ECHO cp acinclude.m4 acinclude.m4.backup
			    cp acinclude.m4 acinclude.m4.backup
			fi
		    fi
		    $VERBOSE_ECHO cat "$LIBTOOL_M4" >> acinclude.m4
		    cat "$LIBTOOL_M4" >> acinclude.m4

		    $ECHO
		    $ECHO "Restarting the configuration steps with a local libtool.m4"

		    $VERBOSE_ECHO sh $0 "$1" "$2" "$3" "$4" "$5" "$6" "$7" "$8" "$9"
		    sh "$0" "$1" "$2" "$3" "$4" "$5" "$6" "$7" "$8" "$9"
		    exit $?
		fi
	    fi
	    cat <<EOF
d566 11
a576 72
	    $ECHO "ERROR: $AUTOCONF failed"
	    exit 2

	else
	    # autoconf sans -f and possibly sans unsupported options succeeded so warn verbosely

	    if [ ! "x$configure_ac_changed" = "xno" ] ; then
		$ECHO
		$ECHO "Warning:  Unsupported macros were found and removed from $_configure_file"
		$ECHO
		$ECHO "The $_configure_file file was edited in an attempt to successfully run"
		$ECHO "autoconf by commenting out the unsupported macros.  Since you are"
		$ECHO "reading this, autoconf succeeded after the edits were made.  The"
		$ECHO "original $_configure_file is saved as configure.ac.backup but you should"
		$ECHO "consider either increasing the minimum version of autoconf required"
		$ECHO "by this script or removing the following macros from $_configure_file:"
		$ECHO
		$ECHO "$configure_ac_changed"
		$ECHO
		$ECHO $ECHO_N "Continuing build preparation ... $ECHO_C"
	    fi
	fi
    fi

    $VERBOSE_ECHO "$AUTOHEADER"
    autoheader_output="`$AUTOHEADER 2>&1`"
    ret=$?
    $VERBOSE_ECHO "$autoheader_output"

    if [ ! $ret = 0 ] ; then $ECHO "ERROR: $AUTOHEADER failed" && exit 2 ; fi

    $VERBOSE_ECHO "$AUTOMAKE -a -c -f"
    automake_output="`$AUTOMAKE -a -c -f 2>&1`"
    ret=$?
    $VERBOSE_ECHO "$automake_output"

    if [ ! $ret = 0 ] ; then
	# retry without the -f
	$VERBOSE_ECHO
	$VERBOSE_ECHO "$AUTOMAKE -a -c"
	automake_output="`$AUTOMAKE -a -c 2>&1`"
	ret=$?
	$VERBOSE_ECHO "$automake_output"

	if [ ! $ret = 0 ] ; then
	    if test -f "$LIBTOOL_M4" ; then
		found_libtool="`$ECHO $automake_output | grep AC_PROG_LIBTOOL`"
		if test ! "x$found_libtool" = "x" ; then
		    if test -f acinclude.m4 ; then
			if test ! -f acinclude.m4.backup ; then
			    $VERBOSE_ECHO cp acinclude.m4 acinclude.m4.backup
			    cp acinclude.m4 acinclude.m4.backup
			fi
		    fi
		    $VERBOSE_ECHO cat "$LIBTOOL_M4" >> acinclude.m4
		    cat "$LIBTOOL_M4" >> acinclude.m4

		    $ECHO
		    $ECHO "Restarting the configuration steps with a local libtool.m4"

		    $VERBOSE_ECHO sh $0 "$1" "$2" "$3" "$4" "$5" "$6" "$7" "$8" "$9"
		    sh "$0" "$1" "$2" "$3" "$4" "$5" "$6" "$7" "$8" "$9"
		    exit $?
		fi
	    fi
	    cat <<EOF
$automake_output
EOF
	fi
	$ECHO "ERROR: $AUTOMAKE failed"
	exit 2
    fi
d584 34
a617 17
for file in COPYING INSTALL ; do
    curr="$file"
    if test ! -f "$curr" ; then
	continue
    fi
    back="${_aux_dir}/${file}.backup"
    if test ! -f "$back" ; then
	continue
    fi

    # full contents for comparison
    current="`cat $curr`"
    backup="`cat $back`"
    if test "x$current" != "x$backup" ; then
	if test "x$spacer" = "xno" ; then
	    $VERBOSE_ECHO
	    spacer=yes
d619 2
a620 6
	# restore the backup
	$VERBOSE_ECHO "Restoring $file from backup (automake -f likely clobbered it)"
	$VERBOSE_ECHO "cp -pf \"$back\" \"${curr}\""
	cp -pf "$back" "$curr"
    fi
done
d635 3
a637 3
    if [ "x`echo $ARGS | sed 's/.*[hH][eE][lL][pP].*/help/'`" = "xhelp" ] ; then
	_help=yes
    fi
d640 5
a644 5
    echo "Help was requested.  No configuration and compilation will be done."
    echo "Running: $PATH_TO_AUTOGEN/configure $ARGS"
    $VERBOSE_ECHO "$PATH_TO_AUTOGEN/configure $ARGS"
    $PATH_TO_AUTOGEN/configure $ARGS
    exit 0
@


14.30
log
@why bother looping if aux_dir doesn't exist
@
text
@d123 1
a123 1
_have_sed="`$ECHO no | sed 's/no/yes/'`"
@


14.29
log
@copy the current COPYING and INSTALL to backup even if a backup already exists, add some more verbose echo
@
text
@d429 9
a437 10
for file in COPYING INSTALL ; do
  if test ! -f $file ; then
    continue
  fi
  if test ! -d "${_aux_dir}" ; then
    continue
  fi
  $VERBOSE_ECHO "cp -pf ${file} \"${_aux_dir}/${file}.backup\""
  cp -pf ${file} "${_aux_dir}/${file}.backup"
done
@


14.28
log
@fixes for solaris .. must pass bang to test and fix names in restoration section
@
text
@d420 1
d430 5
a434 7
  if test -f $file ; then
    if test -d "${_aux_dir}" ; then
      if test ! -f "${_aux_dir}/${file}.backup" ; then
	$VERBOSE_ECHO "cp -pf ${file} \"${_aux_dir}/${file}.backup\""
	cp -pf ${file} "${_aux_dir}/${file}.backup"
      fi
    fi
d436 2
d584 1
d600 1
d605 1
d610 4
a613 1
		echo "need to restore backup of $file"
d615 1
@


14.27
log
@don't just blindly copy the backup files back .. check the revision number and only when it's less than the backup revision will it copy it back.  the 'default' has no rcs revision, so it'll be zero (and hence less than any backup).
@
text
@d507 1
a507 1
  [ ! $? = 0 ] && $ECHO "ERROR: $ACLOCAL failed" && exit 2
d511 1
a511 1
    [ ! $? = 0 ] && $ECHO "ERROR: $LIBTOOLIZE failed" && exit 2
d516 1
a516 1
      [ ! $? = 0 ] && $ECHO "ERROR: $LIBTOOLIZE failed" && exit 2
d539 1
d558 2
a559 2
	$VERBOSE_ECHO $0 "$1" "$2" "$3" "$4" "$5" "$6" "$7" "$8" "$9"
	$0 "$1" "$2" "$3" "$4" "$5" "$6" "$7" "$8" "$9"
d572 1
a572 1
  [ ! $? = 0 ] && $ECHO "ERROR: $AUTOHEADER failed" && exit 2
d576 1
a576 1
  [ ! $? = 0 ] && $ECHO "ERROR: $AUTOMAKE failed" && exit 2
d585 2
a586 2
	curr="$$file"
	if ! test -f "$curr" ; then
d589 2
a590 2
	back="${aux_dir}/${file}.backup"
	if ! test -f "$back" ; then
d596 1
a596 1
	if ! test "x$current" = "x$backup" ; then
d627 5
a631 1
[ "x$HAVE_SED" = "xyes" ] && [ "x`echo $ARGS | sed 's/.*[hH][eE][lL][pP].*/help/'`" = "xhelp" ] && _help=yes
@


14.26
log
@oops, missing backticks
@
text
@d582 31
a612 8
for file in COPYING INSTALL ; do
  if test -f $file ; then
    if test -f "${_aux_dir}/${file}.backup" ; then
      $VERBOSE_ECHO "cp -pf \"${_aux_dir}/${file}.backup\" ${file}"
      cp -pf "${_aux_dir}/${file}.backup" ${file}
    fi
  fi
done
@


14.25
log
@if a secondary autoconf fails with an error saying that AC_PROG_LIBTOOL is missing, pull the misc/libtool.m4 in as an acinclude.m4 and restart the configuration.  this should allow a successful autogen on systems that have a libtool that's already moved forward to LT_INIT or otherwise don't have the AC_PROG_LIBTOOL macro.
@
text
@d543 1
a543 1
      found_libtool="$ECHO $autoconf_output | grep AC_PROG_LIBTOOL"
@


14.24
log
@pull back the requirement of libtool to 1.4.2 for the default irix freeware and for solaris
@
text
@d63 2
d540 28
a567 2
  $AUTOCONF -f
  [ ! $? = 0 ] && $ECHO "ERROR: $AUTOCONF failed" && exit 2
@


14.23
log
@force locale setting to C so things like date output as expected
@
text
@d61 1
a61 1
LIBTOOL_PATCH_VERSION=3
@


14.22
log
@ahh, there it is .. was missing the m4 search dir path to the second aclocal run too
@
text
@d91 4
@


14.21
log
@remove the hack.. not sure of the specific version
@
text
@d487 1
a487 1
#  aclocal
d489 1
a489 1
#  aclocal          
d515 2
a516 2
  $VERBOSE_ECHO "$ACLOCAL"
  $ACLOCAL
@


14.20
log
@temporary BRL-CAD hack due to libtool incompatibility
@
text
@a334 11
    # temporary BRL-CAD hack due to libtool incompatibility
    if [ $_maj_version -eq 1 ] ; then
      if [ $_min_version -eq 5 ] ; then
	$ECHO 
	$ECHO "Warning: Libtool 1.5 breaks compatiblity with Libtool 1.4 requiring an edit of"
	$ECHO "         the configure.ac script to replace AC_PROG_LIBTOOL with LT_INIT."
	$ECHO "         Configuration and/or compilation may fail without making that edit."
	$ECHO
      fi
    fi

@


14.19
log
@unify the available options and add --version to just output versions; clean up alternate search dir searching.
@
text
@d334 12
@


14.18
log
@only copyright 2005 by gov
@
text
@a67 1
[ "x$ARGS" = "x--help" ] && HELP=yes
a68 2
[ "x$ARGS" = "x--quiet" ] && QUIET=yes
[ "x$ARGS" = "x-Q" ] && QUIET=yes
d70 16
a85 2
[ "x$ARGS" = "x--verbose" ] && VERBOSE=yes
[ "x$ARGS" = "x-V" ] && VERBOSE=yes
d373 9
d444 3
a446 3
#########################################
# list common misconfigured search dirs #
#########################################
a448 1
# /usr/local/share/aclocal /sw/share/aclocal m4 ; do
d451 1
a451 1
    SEARCH_DIRS="$SEARCH_DIRS -B $dir"
@


14.17
log
@update copyright to 2005
@
text
@d4 1
a4 1
# Copyright (C) 2004-2005 United States Government as represented by
@


14.16
log
@script is beginning to take on a life of it's own.  claim copyright and assign it under bsd license to u.s. gov for the next release (author may still retain/claim copyright on his own version).
@
text
@d4 1
a4 1
# Copyright (c) 2004-2005 United States Government as represented by
@


14.15
log
@fix encounters with version numbers that don't have a patch number (e.g. libtool 1.5), also fix version checks to actually stop checking minor/patch numbers if our major/minor are greater than required.
@
text
@d4 33
a42 1
# This script is in the public domain
@


14.14
log
@? is not doing the job so go with *
@
text
@d106 2
d109 1
a109 1
    [ "x$_maj_version" = "x" ] && _maj_version=0
d111 1
d114 4
a117 2
    elif [ $_min_version -lt $AUTOCONF_MINOR_VERSION ] ; then
      _report_error=yes
d119 1
d158 2
d161 2
d164 1
a164 2
    [ "x$_maj_version" = "x" ] && _maj_version=0
    [ "x$_min_version" = "x" ] && _min_version=0
d166 1
d169 8
a176 4
    elif [ $_min_version -lt $AUTOMAKE_MINOR_VERSION ] ; then
      _report_error=yes
    elif [ $_pat_version -lt $AUTOMAKE_PATCH_VERSION ] ; then
      _report_error=yes
d178 1
d245 1
d250 1
d269 2
d272 2
d275 1
a275 2
    [ "x$_maj_version" = "x" ] && _maj_version=0
    [ "x$_min_version" = "x" ] && _min_version=0
d277 1
d280 8
a287 4
    elif [ $_min_version -lt $LIBTOOL_MINOR_VERSION ] ; then
      _report_error=yes
    elif [ $_pat_version -lt $LIBTOOL_PATCH_VERSION ] ; then
      _report_error=yes
d289 1
d443 1
@


14.13
log
@ws
@
text
@d153 1
a153 1
    _pat_version="`echo $_version_line | sed 's/.* [0-9]\.[0-9][\.-]p\?\([0-9]*\).*/\1/'`"
d253 1
a253 1
    _pat_version="`echo $_version_line | sed 's/.* [0-9]\.[0-9][\.-]p\?\([0-9]*\).*/\1/'`"
@


14.12
log
@little bit more flexibility detecting autotools versions
@
text
@a104 1
    [ "x$_maj_version" = "x" ] && _maj_version=0
d107 1
a107 1
    [ "x$_maj_version" = "x" ] && _max_version=0
d110 1
a110 1
	_report_error=yes
d112 1
a112 1
	_report_error=yes
d158 1
a158 1
	_report_error=yes
d160 1
a160 1
	_report_error=yes
d162 1
a162 1
	_report_error=yes
d258 1
a258 1
	_report_error=yes
d260 1
a260 1
	_report_error=yes
d262 1
a262 1
	_report_error=yes
@


14.11
log
@finally add libtool checks too, starting with 1.4.3 as a minimum; condense the output format a bit too. this begs for a function now.
@
text
@d105 6
a110 5
    _maj_version="`echo $_version_line | sed 's/.*\([0-9]\)\.[0-9][0-9].*/\1/'`"
    _min_version="`echo $_version_line | sed 's/.*[0-9]\.\([0-9][0-9]\).*/\1/'`"

    if [ $? = 0 ] ; then
      if [ $_maj_version -lt $AUTOCONF_MAJOR_VERSION ] ; then
d112 1
a112 1
      elif [ $_min_version -lt $AUTOCONF_MINOR_VERSION ] ; then
a113 1
      fi
d152 7
a158 5
    _maj_version="`echo $_version_line | sed 's/.*\([0-9]\)\.[0-9]\.[0-9].*/\1/'`"
    _min_version="`echo $_version_line | sed 's/.*[0-9]\.\([0-9]\)\.[0-9].*/\1/'`"
    _pat_version="`echo $_version_line | sed 's/.*[0-9]\.[0-9]\.\([0-9]\).*/\1/'`"
    if [ $? = 0 ] ; then
      if [ $_maj_version -lt $AUTOMAKE_MAJOR_VERSION ] ; then
d160 1
a160 1
      elif [ $_min_version -lt $AUTOMAKE_MINOR_VERSION ] ; then
d162 1
a162 1
      elif [ $_pat_version -lt $AUTOMAKE_PATCH_VERSION ] ; then
a163 1
      fi
d252 7
a258 5
    _maj_version="`echo $_version_line | sed 's/.*\([0-9]\)\.[0-9]\.[0-9].*/\1/'`"
    _min_version="`echo $_version_line | sed 's/.*[0-9]\.\([0-9]\)\.[0-9].*/\1/'`"
    _pat_version="`echo $_version_line | sed 's/.*[0-9]\.[0-9]\.\([0-9]\).*/\1/'`"
    if [ $? = 0 ] ; then
      if [ $_maj_version -lt $LIBTOOL_MAJOR_VERSION ] ; then
d260 1
a260 1
      elif [ $_min_version -lt $LIBTOOL_MINOR_VERSION ] ; then
d262 1
a262 1
      elif [ $_pat_version -lt $LIBTOOL_PATCH_VERSION ] ; then
a263 1
      fi
@


14.10
log
@attempt to pull the revision back to 2.52 from 2.57 .. trying to find that convenient supportable version
@
text
@a26 1
# unused for now but informative
d28 2
a29 2
LIBTOOL_MINOR_VERSION=5
LIBTOOL_PATCH_VERSION=0
a47 5
_have_sed="`echo no | sed 's/no/yes/'`"
HAVE_SED=no
if [ $? = 0 ] ; then
  [ "x$_have_sed" = "xyes" ] && HAVE_SED=yes
fi
d74 10
a115 2
  else
    $ECHO "Warning:  sed is not available to properly detect version of GNU Autoconf"
a116 1
  $ECHO
d119 1
d146 1
a164 2
  else
    $ECHO "Warning:  sed is not available to properly detect version of GNU Automake"
a165 1
  $ECHO
d168 1
a193 12
#####################
# check for aclocal #
#####################
for ACLOCAL in aclocal ; do
  $VERBOSE_ECHO "Checking aclocal version: $ACLOCAL --version"
  $ACLOCAL --version > /dev/null 2>&1
  if [ $? = 0 ] ; then
    break
  fi
done


d200 1
d235 1
a235 1
      $ECHO
d239 2
d243 47
d383 1
@


14.9
log
@add verbose and quiet options and corresponding output.  remove convenience passing of autogen args to configure since autogen has it's own args now too.
@
text
@d20 1
a20 1
AUTOCONF_MINOR_VERSION=57
@


14.8
log
@check for and print out automake's version; search for m4 files in common misconfigured aclocal dirs
@
text
@a22 1
# unused for now but informative
d33 13
d66 14
d86 1
d96 1
a96 1
  echo "ERROR:  Unable to locate GNU Autoconf."
d111 1
a111 1
    echo "Found GNU Autoconf version $_maj_version.$_min_version"
d113 1
a113 1
    echo "Warning:  sed is not available to properly detect version of GNU Autoconf"
d115 1
a115 1
  echo
d118 7
a124 7
  echo "ERROR:  To prepare the ${SUITE} build system from scratch,"
  echo "        at least version $AUTOCONF_MAJOR_VERSION.$AUTOCONF_MINOR_VERSION.$AUTOCONF_PATCH_VERSION of GNU Autoconf must be installed."
  echo 
  echo "$PATH_TO_AUTOGEN/autogen.sh does not need to be run on the same machine that will"
  echo "run configure or make.  Either the GNU Autotools will need to be installed"
  echo "or upgraded on this system, or $PATH_TO_AUTOGEN/autogen.sh must be run on the source"
  echo "code on another system and then transferred to here. -- Cheers!"
d134 1
d144 1
a144 1
  echo "ERROR: Unable to locate GNU Automake."
d161 1
a161 1
    echo "Found GNU Automake version $_maj_version.$_min_version.$_pat_version"
d163 1
a163 1
    echo "Warning:  sed is not available to properly detect version of GNU Automake"
d165 1
a165 1
  echo
d168 7
a174 7
  echo "ERROR:  To prepare the ${SUITE} build system from scratch,"
  echo "        at least version $AUTOMAKE_MAJOR_VERSION.$AUTOMAKE_MINOR_VERSION.$AUTOMAKE_PATCH_VERSION of GNU Automake must be installed."
  echo 
  echo "$PATH_TO_AUTOGEN/autogen.sh does not need to be run on the same machine that will"
  echo "run configure or make.  Either the GNU Autotools will need to be installed"
  echo "or upgraded on this system, or $PATH_TO_AUTOGEN/autogen.sh must be run on the source"
  echo "code on another system and then transferred to here. -- Cheers!"
d184 1
d197 1
d211 1
d216 1
a216 1
    echo "Warning:  libtoolize does not appear to be available."
d218 2
a219 2
    echo "Warning:  libtoolize does not appear to be available.  This means that"
    echo "autoreconf cannot be used."
d224 1
d229 6
a234 6
      echo 
      echo "Fortunately, $tool was found which means that your system may simply"
      echo "have a non-standard or incomplete GNU Autotools install.  If you have"
      echo "sufficient system access, it may be possible to quell this warning by"
      echo "running:"
      echo
d239 1
a239 1
	echo "   sudo ln -s $_glti $_gltidir/libtoolize"
d241 3
a243 3
	echo "   ln -s $glti $_gltidir/libtoolize"
	echo 
	echo "Run that as root or with proper permissions to the $_gltidir directory"
d245 1
a245 1
      echo
d256 1
d284 2
d307 1
d320 1
d333 1
d344 1
a344 1
  echo $ECHO_N "Automatically preparing build ... $ECHO_C"
d346 6
a351 1
  $AUTORECONF $SEARCH_DIRS -i -f > /dev/null 2>&1
d353 1
a353 1
    echo "Warning: $AUTORECONF failed"
d356 1
a356 1
      echo "libtoolize being run by autoreconf is not creating ltmain.sh in the auxillary directory like it should"
d359 1
a359 1
    echo "Attempting to run the configuration steps individually"
d376 1
a376 1
  echo $ECHO_N "Preparing build ... $ECHO_C"
d378 1
d381 1
a381 1
  [ ! $? = 0 ] && echo "ERROR: $ACLOCAL failed" && exit 2
d383 1
d385 1
a385 1
    [ ! $? = 0 ] && echo "ERROR: $LIBTOOLIZE failed" && exit 2
d388 1
d390 1
a390 1
      [ ! $? = 0 ] && echo "ERROR: $LIBTOOLIZE failed" && exit 2
d395 1
d401 7
a407 6
      echo
      echo "Warning:  $LIBTOOLIZE is creating ltmain.sh in the wrong directory"
      echo
      echo "Fortunately, the problem can be worked around by simply copying the"
      echo "file to the appropriate location (${_aux_dir}/).  This has been done for you."
      echo
d409 1
a409 1
      echo $ECHO_N "Continuing build preparation ... $ECHO_C"
d413 1
d415 3
a417 2
  [ ! $? = 0 ] && echo "ERROR: $AUTOCONF failed" && exit 2
  
d419 1
a419 1
  [ ! $? = 0 ] && echo "ERROR: $AUTOHEADER failed" && exit 2
d421 1
d423 1
a423 1
  [ ! $? = 0 ] && echo "ERROR: $AUTOMAKE failed" && exit 2
d433 1
d444 2
a445 2
echo "done"
echo
d451 2
a452 4
_help=no
[ "x$HAVE_SED" = "xyes" ] && [ "x`echo $ARGS | sed 's/.*help.*/help/'`" = "xhelp" ] && _help=yes
[ "x$ARGS" = "x--help" ] && _help=yes
if [ "x$_help" = "xyes" ] ; then
d455 1
d461 6
a466 12
##################################################
# summarize.  actually build if arg was provided #
##################################################
if [ ! "x$ARGS" = "x" ] ; then
  echo "The ${SUITE} build system is now prepared.  Building here with:"
  echo "$PATH_TO_AUTOGEN/configure $ARGS"
  $PATH_TO_AUTOGEN/configure $ARGS
  [ ! $? = 0 ] && echo "ERROR: configure failed" && exit $?
  make
  [ ! $? = 0 ] && echo "ERROR: make failed" && exit $?
  exit 0
fi
a467 3
echo "The ${SUITE} build system is now prepared.  To build here, run:"
echo "  $PATH_TO_AUTOGEN/configure"
echo "  make"
@


14.7
log
@match configure.ac's requirements.  require autoconf 2.57 and specify automake 1.6.0 (unenforced).  should probably try to pull the version mins directly ourselves.
@
text
@d28 5
d58 1
a58 1
_autofound=no
d62 1
a62 1
    _autofound=yes
d68 1
a68 1
if [ ! "x$_autofound" = "xyes" ] ; then
d74 2
a75 2
    _maj_version="`echo $_version_line | sed 's/.*\([0-9]\)\..*/\1/'`"
    _min_version="`echo $_version_line | sed 's/.*\.\([0-9][0-9]\).*/\1/'`"
d92 50
a141 1
  echo "        at least version $AUTOCONF_MAJOR_VERSION.$AUTOCONF_MINOR_VERSION of GNU Autoconf must be installed."
a230 11
######################
# check for automake #
######################
for AUTOMAKE in automake ; do
  $AUTOMAKE --version > /dev/null 2>&1
  if [ $? = 0 ] ; then
    break
  fi
done


d289 12
d307 2
a308 1
  $AUTORECONF -i -f > /dev/null 2>&1
d335 1
a335 1
  $ACLOCAL
@


14.6
log
@oops, that dash wasn't intended or desired for head/tail
@
text
@d20 1
a20 1
AUTOCONF_MINOR_VERSION=50
d25 1
a25 1
AUTOMAKE_MINOR_VERSION=4
d71 1
@


14.5
log
@oop, the var setting needs to come before the command to not interfere with $?
@
text
@d46 1
a46 1
    TAIL_N="-n "
@


14.4
log
@test whether the system supports tail -n or not
@
text
@d43 1
a44 1
TAIL_N=""
@


14.3
log
@output a warning about ltmain.sh in auxdirs, comment the actual manual steps being taken, and re-run aclocal after libtoolize like we're told to
@
text
@d43 5
d67 1
a67 1
  _version_line="`$AUTOCONF --version | head -n 1`"
d204 1
a204 1
_aux_dir="`cat $_configure_file | grep AC_CONFIG_AUX_DIR | tail -n 1 | sed 's/^[ ]*AC_CONFIG_AUX_DIR(\(.*\)).*/\1/'`"
@


14.2
log
@tail/head -# is deprecated, use -n #
@
text
@d249 5
d261 9
d274 1
d286 3
@


14.1
log
@dawn of a new revision.  it shall be numbered 14 to match release 7.  begin the convergence by adding emacs/vi local variable footer blocks to encourage consistent formatting.
@
text
@d62 1
a62 1
  _version_line="`$AUTOCONF --version | head -1`"
d199 1
a199 1
_aux_dir="`cat $_configure_file | grep AC_CONFIG_AUX_DIR | tail -1 | sed 's/^[ ]*AC_CONFIG_AUX_DIR(\(.*\)).*/\1/'`"
@


1.38
log
@make the autogen.sh script slightly more package-agnostic by making the name of the software suite a variable.
@
text
@d347 8
a354 8
# Local Variables: ***
# mode: sh ***
# tab-width: 8 ***
# sh-basic-offset: 2 ***
# sh-indentation: 2 ***
# indent-tabs-mode: t ***
# End: ***
# ex: shiftwidth=2 tabstop=8
@


1.37
log
@freebsd made this quite an adventure.. check for autoconf's version as well as everything else using --version; verify automake, libtool, aclocal, autoheader and make the checks consistent.
@
text
@d17 2
d80 1
a80 1
  echo "ERROR:  To prepare the BRL-CAD build system from scratch,"
d334 1
a334 1
  echo "The BRL-CAD build system is now prepared.  Building here with:"
d343 1
a343 1
echo "The BRL-CAD build system is now prepared.  To build here, run:"
@


1.36
log
@protect both COPYING and INSTALL from automakes forcible (erroneous) overwriting, and check to make sure all of the required automake files exist (INSTALL, NEWS, README, COPYING, AUTHORS, ChangeLog).  convert those tests into for/do/done loops since the same thing is done for each file.
@
text
@d21 1
d23 1
a23 1
AUTOMAKE_MINOR_VERSION=5
d43 12
a54 5
#################
# version check #
#################
autoconf -V > /dev/null 2>&1
[ $? = 0 ] && _autofound=yes || _autofound=no
d60 1
a60 1
  _version_line="`autoconf -V | head -1`"
d92 19
a110 5
HAVE_AUTORECONF=yes
autoreconf -V > /dev/null 2>&1
if [ ! $? = 0 ] ; then
  HAVE_AUTORECONF=no
fi
d117 3
a119 2
HAVE_GLIBTOOLIZE=no
libtoolize --version > /dev/null 2>&1
d129 3
a131 10
  _glibtoolize="`glibtoolize --version 2>/dev/null`"
  if [ $? = 0 ] ; then
    HAVE_GLIBTOOLIZE=yes
    echo 
    echo "Fortunately, glibtoolize was found which means that your system may simply"
    echo "have a non-standard or incomplete GNU Autotools install.  If you have"
    echo "sufficient system access, it may be possible to quell this warning by"
    echo "running:"
    echo
    sudo -V > /dev/null 2>&1
d133 2
a134 5
      _glti="`which glibtoolize`"
      _gltidir="`dirname $_glti`"
      echo "   sudo ln -s $_glti $_gltidir/libtoolize"
    else
      echo "   ln -s $glti $_gltidir/libtoolize"
d136 17
a152 1
      echo "Run that as root or with proper permissions to the $_gltidir directory"
d154 22
a175 1
    echo
d177 1
a177 1
fi
d244 1
a244 1
  autoreconf -i -f > /dev/null 2>&1
d246 1
a246 1
    echo "Warning: autoreconf failed"
d257 2
a258 3
  aclocal
  [ ! $? = 0 ] && echo "ERROR: aclocal failed" && exit 2

d260 2
a261 2
    libtoolize --automake -c -f
    [ ! $? = 0 ] && echo "ERROR: libtoolize failed" && exit 2
d263 4
a266 2
    [ "x$HAVE_GLIBTOOLIZE" = "xyes" ] && glibtoolize --automake --copy --force
    [ ! $? = 0 ] && echo "ERROR: glibtoolize failed" && exit 2
d273 1
a273 1
      echo "Warning:  libtoolize is creating ltmain.sh in the wrong directory"
d283 5
a287 5
  autoconf -f
  [ ! $? = 0 ] && echo "ERROR: autoconf failed" && exit 2

  autoheader 
  [ ! $? = 0 ] && echo "ERROR: autoheader failed" && exit 2
d289 2
a290 2
  automake -a -c -f
  [ ! $? = 0 ] && echo "ERROR: automake failed" && exit 2
@


1.35
log
@detect an aux dir instead of assuming a misc dir; account for potential spaces in the dir name
@
text
@d157 5
a161 12
if test ! -f AUTHORS ; then
  touch AUTHORS
fi
if test ! -f ChangeLog ; then
  touch ChangeLog
fi
if test ! -f INSTALL ; then
  touch INSTALL
fi
if test ! -f NEWS ; then
  touch NEWS
fi
d164 9
a172 7
##################################
# protect COPYING from overwrite #
##################################
if test -f COPYING ; then
  if test -d "${_aux_dir}" ; then
    if test ! -f "${_aux_dir}/COPYING.backup" ; then
      cp -pf COPYING "${_aux_dir}/COPYING.backup"
d175 1
a175 1
fi
d181 3
a183 7

if test -d "${_aux_dir}" ; then
  if test -f "${_aux_dir}/config.guess" ; then
    mv -f "${_aux_dir}/config.guess" "${_aux_dir}/config.guess.backup"
  fi
  if test -f "${_aux_dir}/config.sub" ; then
    mv -f "${_aux_dir}/config.sub" "${_aux_dir}/config.sub.backup"
d185 1
a185 4
  if test -f "${_aux_dir}/ltmain.sh" ; then
    mv -f "${_aux_dir}/ltmain.sh" "${_aux_dir}/ltmain.sh.backup"
  fi
fi
d243 8
a250 6
###############################
# restore COPYING from backup #
###############################
if test -d "${_aux_dir}" ; then
  if test -f "${_aux_dir}/COPYING.backup" ; then
    cp -pf "${_aux_dir}/COPYING.backup" COPYING
d252 2
a253 1
fi
@


1.34
log
@Added missing "; then"
@
text
@d137 16
d175 4
a178 2
  if test ! -f misc/COPYING.backup ; then
    cp -pf COPYING misc/COPYING.backup
d187 10
a196 8
if test -f misc/config.guess ; then
  mv -f misc/config.guess misc/config.guess.backup
fi
if test -f misc/config.sub ; then
  mv -f misc/config.sub misc/config.sub.backup
fi
if test -f misc/ltmain.sh ; then
  mv -f misc/ltmain.sh misc/ltmain.sh.backup
d232 1
a232 1
    if test ! -f misc/ltmain.sh ; then
d237 1
a237 1
      echo "file to the appropriate location (misc/).  This has been done for you."
d239 1
a239 1
      cp ltmain.sh misc/ltmain.sh
d258 4
a261 2
if test -f misc/COPYING.backup ; then
  cp -pf misc/COPYING.backup COPYING
@


1.33
log
@only make a backup of COPYING if one doesn't exist
@
text
@d159 1
a159 1
  if test ! -f misc/COPYING.backup
@


1.32
log
@older autoreconf (2.50 reporting as 2.59?) on debian does not like the arguments put together
@
text
@d159 3
a161 1
  cp -pf COPYING misc/COPYING.backup
@


1.31
log
@don't delete the backup -- let make distclean take care of it
@
text
@d184 1
a184 1
  autoreconf -if > /dev/null 2>&1
@


1.30
log
@okay, so -f won't overwrite COPYING, but as -if it will (I'd consider that a bug).  So since it's really needed, just move COPYING out of the way until the automake is done.
@
text
@a237 3
  if test -f COPYING ; then
    rm -f misc/COPYING.backup
  fi
@


1.29
log
@hrm, 2.57 doesn't seem to be overwriting COPYING any more.. give it another shot at forced automake since it's not invalidating Makefile.in's properly.
@
text
@d155 8
d232 10
@


1.28
log
@engrish cappage
@
text
@d176 1
a176 1
  autoreconf -i > /dev/null 2>&1
d220 1
a220 1
  automake -a -c 
@


1.27
log
@fix the non-autoreconf path order so that it matches autoreconf
@
text
@d71 1
a71 1
  echo "        At least version $AUTOCONF_MAJOR_VERSION.$AUTOCONF_MINOR_VERSION of GNU Autoconf must be installed."
d76 1
a76 1
  echo "code on another system and transferred to here. -- Cheers!"
@


1.26
log
@now that the steps are run manually, go ahead and suppress all of autoreconf's output (so we'll just see errors on the second pass)
@
text
@d188 4
d214 3
a216 2
  aclocal
  [ ! $? = 0 ] && echo "ERROR: aclocal failed" && exit 2
d219 1
a221 2
  autoconf -f
  [ ! $? = 0 ] && echo "ERROR: autoconf failed" && exit 2
@


1.25
log
@put a space after the statement since there is often output before the 'done'
@
text
@d176 1
a176 1
  autoreconf -i
@


1.24
log
@continuing the build prep message makes it look better
@
text
@d175 1
a175 1
  echo $ECHO_N "Automatically preparing build ...$ECHO_C"
d187 1
a187 1
  echo $ECHO_N "Preparing build ...$ECHO_C"
d206 1
a206 1
      echo "Continuing build preparation ..."
@


1.23
log
@libtoolize generates ltmain.sh in the wrong directory on our solaris for some reason, so work around the problem by copying the file to the right place
@
text
@d206 1
@


1.22
log
@oops, missed the fi
@
text
@d195 14
@


1.21
log
@if autoreconf fails, try the configuration steps manually
@
text
@d178 2
d181 1
a181 2
    echo "WARNING: autoreconf failed"
    echo "Attempting to run the configuration steps individually"
@


1.20
log
@test echo behavior for printing
@
text
@a128 2
# !!! check where ltmain.sh is put
ln -s ../ltmain.sh misc/ltmain.sh
d173 1
d177 4
a180 1
  [ ! $? = 0 ] && echo "ERROR: autoreconf failed" && exit 2
d182 4
@


1.19
log
@solaris does not like if \! statements
@
text
@d34 6
d129 2
d176 1
a176 1
  echo -n "Automatically preparing build ..."
d180 1
a180 1
  echo -n "Preparing build ..."
@


1.18
log
@generated files were moved to misc/; doesn't complain about libtool
@
text
@d135 1
a135 1
if ! test -f AUTHORS ; then
d138 1
a138 1
if ! test -f ChangeLog ; then
d141 1
a141 1
if ! test -f INSTALL ; then
d144 1
a144 1
if ! test -f NEWS ; then
@


1.17
log
@s/--i/-i/
@
text
@d153 2
a154 2
if test -f config.guess ; then
  mv -f config.guess config.guess.backup
d156 2
a157 2
if test -f config.sub ; then
  mv -f config.sub config.sub.backup
d159 2
a160 5
if test -f ltmain.sh ; then
  mv -f ltmain.sh ltmain.sh.backup
fi
if test -f libtool ; then
  mv -f libtool libtaol.backup
@


1.16
log
@make sure certain generated files do not exist
@
text
@d172 1
a172 1
  autoreconf --i
@


1.15
log
@don't force automake either
@
text
@d131 3
a133 3
##################################
# make sure required files exist #
##################################
d146 18
@


1.14
log
@don't force the autoreconf since it overwrites the COPYING file
@
text
@d169 1
a169 1
  automake -f -a -c 
@


1.13
log
@add local var section and apply ws style change
@
text
@d154 1
a154 1
  autoreconf --force --i
@


1.12
log
@make sure required files exist
@
text
@d4 7
a10 1
# script to prepare the sources
d32 1
a32 1
    [ "x$_have_sed" = "xyes" ] && HAVE_SED=yes
d43 2
a44 2
    echo "ERROR:  Unable to locate GNU Autoconf."
    _report_error=yes
d46 10
a55 14
    _version_line="`autoconf -V | head -1`"
    if [ "x$HAVE_SED" = "xyes" ] ; then
	_maj_version="`echo $_version_line | sed 's/.*\([0-9]\)\..*/\1/'`"
	_min_version="`echo $_version_line | sed 's/.*\.\([0-9][0-9]\).*/\1/'`"
	if [ $? = 0 ] ; then
	    if [ $_maj_version -lt $AUTOCONF_MAJOR_VERSION ] ; then
		_report_error=yes
	    elif [ $_min_version -lt $AUTOCONF_MINOR_VERSION ] ; then
		_report_error=yes
	    fi
	fi
	echo "Found GNU Autoconf version $_maj_version.$_min_version"
    else
	echo "Warning:  sed is not available to properly detect version of GNU Autoconf"
d57 5
a61 1
    echo
d64 8
a71 8
    echo "ERROR:  To prepare the BRL-CAD build system from scratch,"
    echo "        At least version $AUTOCONF_MAJOR_VERSION.$AUTOCONF_MINOR_VERSION of GNU Autoconf must be installed."
    echo 
    echo "$PATH_TO_AUTOGEN/autogen.sh does not need to be run on the same machine that will"
    echo "run configure or make.  Either the GNU Autotools will need to be installed"
    echo "or upgraded on this system, or $PATH_TO_AUTOGEN/autogen.sh must be run on the source"
    echo "code on another system and transferred to here. -- Cheers!"
    exit 1
d81 1
a81 1
    HAVE_AUTORECONF=no
d92 22
a113 3
    HAVE_LIBTOOLIZE=no
    if [ "x$HAVE_AUTORECONF" = "xno" ] ; then
	echo "Warning:  libtoolize does not appear to be available."
d115 3
a117 24
	echo "Warning:  libtoolize does not appear to be available.  This means that"
	echo "autoreconf cannot be used."
    fi

    _glibtoolize="`glibtoolize --version 2>/dev/null`"
    if [ $? = 0 ] ; then
	HAVE_GLIBTOOLIZE=yes
	echo 
	echo "Fortunately, glibtoolize was found which means that your system may simply"
	echo "have a non-standard or incomplete GNU Autotools install.  If you have"
	echo "sufficient system access, it may be possible to quell this warning by"
	echo "running:"
	echo
	sudo -V > /dev/null 2>&1
	if [ $? = 0 ] ; then
	    _glti="`which glibtoolize`"
	    _gltidir="`dirname $_glti`"
	    echo "   sudo ln -s $_glti $_gltidir/libtoolize"
	else
	    echo "   ln -s $glti $_gltidir/libtoolize"
	    echo 
	    echo "Run that as root or with proper permissions to the $_gltidir directory"
	fi
	echo
d119 2
d136 1
a136 1
    touch AUTHORS
d139 1
a139 1
    touch ChangeLog
d142 1
a142 1
    touch INSTALL
d145 1
a145 1
    touch NEWS
d153 3
a155 3
    echo -n "Automatically preparing build ..."
    autoreconf --force --i
    [ ! $? = 0 ] && echo "ERROR: autoreconf failed" && exit 2
d157 16
a172 16
    echo -n "Preparing build ..."
    if [ "x$HAVE_LIBTOOLIZE" = "xyes" ] ; then 
	libtoolize --automake -c -f
	[ ! $? = 0 ] && echo "ERROR: libtoolize failed" && exit 2
    else
	[ "x$HAVE_GLIBTOOLIZE" = "xyes" ] && glibtoolize --automake --copy --force
	[ ! $? = 0 ] && echo "ERROR: glibtoolize failed" && exit 2
    fi
    aclocal
    [ ! $? = 0 ] && echo "ERROR: aclocal failed" && exit 2
    autoheader 
    [ ! $? = 0 ] && echo "ERROR: autoheader failed" && exit 2
    automake -f -a -c 
    [ ! $? = 0 ] && echo "ERROR: automake failed" && exit 2
    autoconf -f
    [ ! $? = 0 ] && echo "ERROR: autoconf failed" && exit 2
d191 4
a194 4
    echo "Help was requested.  No configuration and compilation will be done."
    echo "Running: $PATH_TO_AUTOGEN/configure $ARGS"
    $PATH_TO_AUTOGEN/configure $ARGS
    exit 0
d202 7
a208 7
    echo "The BRL-CAD build system is now prepared.  Building here with:"
    echo "$PATH_TO_AUTOGEN/configure $ARGS"
    $PATH_TO_AUTOGEN/configure $ARGS
    [ ! $? = 0 ] && echo "ERROR: configure failed" && exit $?
    make
    [ ! $? = 0 ] && echo "ERROR: make failed" && exit $?
    exit 0
d214 9
@


1.11
log
@clearly mark out the various sections, and since we are only checking autoconf, say that instead of autotools
@
text
@d118 25
a145 2
_prev_path="`pwd`"
cd "$PATH_TO_AUTOGEN"
d168 5
@


1.10
log
@improve the check for missing libtoolize vs glibtoolize on os x.  remove dependancy on 'which'.  fix manual config error detection.  support older autoconf that may not have the long opts.
@
text
@d2 2
d5 2
a6 1
###
a9 2
MAJOR_VERSION=2
MINOR_VERSION=50
d11 7
d19 4
a22 2
# environment check
###
d30 3
a32 2
# version check
###
d45 1
a45 1
	    if [ $_maj_version -lt $MAJOR_VERSION ] ; then
d47 1
a47 1
	    elif [ $_min_version -lt $MINOR_VERSION ] ; then
d53 1
a53 1
	echo "Warning:  sed is not available to properly detect version of GNU Autotools"
d59 1
a59 1
    echo "        At least version $MAJOR_VERSION.$MINOR_VERSION of the GNU Autotools must be installed."
d62 1
a62 1
    echo "run configure or make.  Either GNU Autotools will need to be installed"
d69 3
a71 2
# check for autoreconf
###
d79 3
a81 2
# check for libtoolize
###
d118 3
a120 2
# prepare build via autoreconf or manually
###
d150 3
a152 3

# check for help arg, and bypass running make
###
d164 3
a166 2
# summarize.  actually build if arg was provided.
###
@


1.9
log
@cleanup sed check
@
text
@d10 1
d19 1
d22 1
a22 1
which autoconf > /dev/null 2>&1
d26 1
a26 1
    echo "ERROR:  Unable to locate the GNU Autotools."
d40 1
a40 1
	echo "Found GNU Autotools version $_maj_version.$_min_version"
d57 48
d109 2
a110 3
which autoreconf > /dev/null 2>&1
if [ $? = 0 ] ; then
    echo -n "Automatically preparing build ... "
d114 16
a129 7
    echo -n "Preparing build ... "
    libtoolize --automake --copy --force || glibtoolize --automake --copy --force
    [ ! $? = 0 ] && echo "ERROR: libtoolize failed" && exit 2
    aclocal && [ ! $? = 0 ] && echo "ERROR: aclocal failed" && exit 2
    autoheader && [ ! $? = 0 ] && echo "ERROR: autoheader failed" && exit 2
    automake --add-missing --copy && [ ! $? = 0 ] && echo "ERROR: automake failed" && exit 2
    autoconf && [ ! $? = 0 ] && echo "ERROR: autoconf failed" && exit 2
d135 2
d140 2
a141 7
if [ "x$HAVE_SED" = "xyes" ] ; then
    if [ "x`echo $ARGS | sed 's/.*help.*/help/'`" = "xhelp" ] ; then
	_help=yes
    fi
elif [ "x$ARGS" = "x--help" ] ; then
    _help=yes
fi
d149 1
d152 8
a159 10
if [ "x$_help" = "xno" ] ; then
    if [ ! "x$ARGS" = "x" ] ; then
	echo "The BRL-CAD build system is now prepared.  Building here with:"
	echo "$PATH_TO_AUTOGEN/configure $ARGS"
	$PATH_TO_AUTOGEN/configure $ARGS
	[ ! $? = 0 ] && echo "ERROR: configure failed" && exit $?
	make
	[ ! $? = 0 ] && echo "ERROR: make failed" && exit $?
	exit 0
    fi
@


1.8
log
@better sed check and put error message in right place
@
text
@d13 1
d15 1
a15 1
  [ "x$_have_sed" = "xyes" ] && HAVE_SED=yes || HAVE_SED=no
@


1.7
log
@condense and clean up a lil
@
text
@d12 4
a15 2
which sed > /dev/null 2>&1
[ $? = 0 ] && HAVE_SED=yes || HAVE_SED=no
a41 1
    echo "ERROR:  To prepare the BRL-CAD build system from scratch,"
d44 1
@


1.6
log
@more foo that should hopefully never come to play, but should save headaches on older systems.
more specifically, make an attempt to detect what version of the autotools are installed
and report accordingly.  also, update all of the error messages to be a bit more obvious.
@
text
@d20 4
a23 1
if [ "x$_autofound" = "xyes" ] ; then
d40 1
a40 2
else
    _report_error=yes
a42 5
    if [ ! "x$_autofound" = "xyes" ] ; then
	echo "ERROR:  Unable to locate the GNU Autotools."
    else
	echo "ERROR:  To prepare the BRL-CAD build system from scratch,"
    fi
@


1.5
log
@report if configure or make fail
@
text
@d7 47
d62 2
a63 2
    autoreconf --force --install
    [ ! $? = 0 ] && echo "autoreconf failed" && exit 1
d67 5
a71 5
    [ ! $? = 0 ] && echo "libtoolize failed" && exit 1
    aclocal && [ ! $? = 0 ] && echo "aclocal failed" && exit 2
    autoheader && [ ! $? = 0 ] && echo "autoheader failed" && exit 3
    automake --add-missing --copy && [ ! $? = 0 ] && echo "automake failed" && exit 4
    autoconf && [ ! $? = 0 ] && echo "autoconf failed" && exit 5
d79 2
a80 2
which sed > /dev/null 2>&1
if [ $? = 0 ] ; then
d82 1
a82 4
	echo "$PATH_TO_AUTOGEN/configure $ARGS"
	$PATH_TO_AUTOGEN/configure $ARGS
	[ ! $? = 0 ] && echo "Configure failed. (returned $?)" && exit 6
	exit
d85 5
a89 1
    echo "$PATH_TO_AUTOGEN/configure $ARGS"
d91 1
a91 2
    [ ! $? = 0 ] && echo "Configure failed. (returned $?)" && exit 6
    exit
d96 10
a105 11
if [ ! "x$ARGS" = "x" ] ; then
    echo "The BRL-CAD build system is now prepared.  Building here with:"
    echo "$PATH_TO_AUTOGEN/configure $ARGS"
    $PATH_TO_AUTOGEN/configure $ARGS
    [ ! $? = 0 ] && echo "Configure failed. (returned $?)" && exit 6
    make
    [ ! $? = 0 ] && echo "Make failed. (returned $?)" && exit 7
else
    echo "The BRL-CAD build system is now prepared.  To build here, run:"
    echo "  $PATH_TO_AUTOGEN/configure"
    echo "  make"
d107 4
@


1.4
log
@add support for running autogen.sh from other directories.
add support for providing build arguments for one-step configure-builds.
check for help.
@
text
@d37 1
d43 1
d53 1
d55 1
@


1.3
log
@use autoreconf if it is available and rephrase progress
@
text
@d5 7
d14 1
a14 1
    echo -n "Autoconfiguring..."
d18 1
a18 1
    echo -n "Configuring..."
d26 1
d29 28
a56 3
echo "The BRL-CAD build system is now prepared.  To build here, run:"
echo "  ./configure"
echo "  make"
@


1.2
log
@run libtoolize silently and copy insead of linking
@
text
@d5 17
a21 8
libtoolize --automake --copy --force || glibtoolize --automake --copy --force
[ ! $? = 0 ] && echo "libtoolize failed" && echo 1
aclocal && [ ! $? = 0 ] && echo "aclocal failed" && exit 2
autoheader && [ ! $? = 0 ] && echo "autoheader failed" && exit 3
automake --add-missing --copy && [ ! $? = 0 ] && echo "automake failed" && exit 4
autoconf && [ ! $? = 0 ] && echo "autoconf failed" && exit 5

echo "BRL-CAD sources are now prepared. To build here, run:"
@


1.1
log
@the ever infamous autogen.sh convenience script
@
text
@d5 1
a5 1
libtoolize --force || glibtoolize --force
@

