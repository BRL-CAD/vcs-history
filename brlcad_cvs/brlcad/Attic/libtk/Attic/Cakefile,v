head	1.19;
access;
symbols
	rel-5-2:1.15.2.1
	rel-5-1-patches:1.15.0.2
	rel-5-1:1.15
	rel-5-0:1.10
	rel-5-0beta:1.10;
locks; strict;
comment	@# @;


1.19
date	2000.12.06.21.21.00;	author bparker;	state dead;
branches;
next	1.18;

1.18
date	2000.09.12.18.55.56;	author jra;	state Exp;
branches;
next	1.17;

1.17
date	2000.08.01.20.23.36;	author jra;	state Exp;
branches;
next	1.16;

1.16
date	2000.07.21.15.12.47;	author jra;	state Exp;
branches;
next	1.15;

1.15
date	2000.07.12.20.53.26;	author jra;	state Exp;
branches
	1.15.2.1;
next	1.14;

1.14
date	2000.06.07.03.00.01;	author mike;	state Exp;
branches;
next	1.13;

1.13
date	99.10.21.19.50.52;	author jra;	state Exp;
branches;
next	1.12;

1.12
date	99.10.20.13.19.55;	author jra;	state Exp;
branches;
next	1.11;

1.11
date	99.10.19.20.01.27;	author jra;	state Exp;
branches;
next	1.10;

1.10
date	99.05.17.15.49.17;	author jra;	state Exp;
branches;
next	1.9;

1.9
date	99.05.15.23.36.58;	author jra;	state Exp;
branches;
next	1.8;

1.8
date	99.01.15.03.39.11;	author butler;	state Exp;
branches;
next	1.7;

1.7
date	98.11.29.03.07.36;	author jra;	state Exp;
branches;
next	1.6;

1.6
date	98.10.30.04.18.05;	author jra;	state Exp;
branches;
next	1.5;

1.5
date	98.10.29.20.31.34;	author jra;	state Exp;
branches;
next	1.4;

1.4
date	98.09.30.01.56.32;	author mike;	state Exp;
branches;
next	1.3;

1.3
date	98.07.13.20.55.08;	author jra;	state Exp;
branches;
next	1.2;

1.2
date	98.06.29.13.04.53;	author jra;	state Exp;
branches;
next	1.1;

1.1
date	98.06.02.19.45.42;	author jra;	state Exp;
branches;
next	;

1.15.2.1
date	2000.08.15.18.14.03;	author jra;	state Exp;
branches;
next	1.15.2.2;

1.15.2.2
date	2000.12.06.21.26.17;	author bparker;	state dead;
branches;
next	;


desc
@Original
@


1.19
log
@Upgrading to newer version
@
text
@/*
 *			libtk/Cakefile
 */
#define SRCDIR	libtk
#define	SRCSUFF	.c
#define MANSECTION	3

#include "../Cakefile.defs"

/* Since we're building a library, we can't also list a regular
 * program (like tclsh) in the PRODUCTS rule, it will confuse
 * the BUILD_LIBRARY rule in Cakefile.defs.
 * Hence the EXTRA_PRODUCTS dodge
 */

#if defined( NFS )
#define TCL_DIR	.libtcl.MTYPE
#else
#define TCL_DIR	libtcl
#endif

#if !defined(BUILD_LIBRARY)
#define BUILD_LIBRARY	ar r
#define TK_OPTS	--srcdir=[[pwd]]/../SRCDIR/"unix" --cache-file cache.MTYPE \
			 --exec-prefix=BASEDIR --prefix=BASEDIR \
			 --x-includes=XINCDIR --x-libraries=XLIBDIR \
			 --with-tcl=../TCL_DIR --quiet
#define PRODUCTS	[[echo libtk''TCLTK_VERS.a]]
#define	AFTER_MAKE	rm -f libtk.a ; ln -s PRODUCTS libtk.a
#else
#define TK_OPTS	--srcdir=[[pwd]]/../SRCDIR/"unix" --enable-shared \
			 --cache-file cache.MTYPE --exec-prefix=BASEDIR --prefix=BASEDIR \
			 --x-includes=XINCDIR --x-libraries=XLIBDIR \
			 --with-tcl=../TCL_DIR --quiet
#define PRODUCTS	[[echo libtk''TCLTK_VERS.so]]
#define	SHARED_PRODUCT  libtk''TCLTK_VERS.so''[[LIBVERS]]
#define	AFTER_MAKE	mv -f libtk''TCLTK_VERS.so SHARED_PRODUCT ; sharedliblink.sh SHARED_PRODUCT ; rm -f libtk.so ; ln -s SHARED_PRODUCT libtk.so
#endif
#define EXTRA_PRODUCTS	wish

/* Rule to see if cake is running with -s flag */
#define MINUS_S	[[echo CAKEFLAGS | tr '\040' '\012' | sed -n -e /-s/p ]]

PRODUCTS: Makefile.MTYPE cache.MTYPE
	make MINUS_S -f Makefile.MTYPE CAKEFLAGS EXTRA_PRODUCTS
	AFTER_MAKE

EXTRA_PRODUCTS: Makefile.MTYPE cache.MTYPE
	make MINUS_S -f Makefile.MTYPE CAKEFLAGS EXTRA_PRODUCTS
	AFTER_MAKE

Makefile.MTYPE cache.MTYPE:		if not exist Makefile.MTYPE or not exist cache.MTYPE
	( \C\F\L\A\G\S=\"GFLAG OPTIMIZER PROFILER\"; \
		\A\F\T\E\R\_\M\A\K\E=\"AFTER_MAKE\"; \
		\R\A\N\L\I\B=\"RANLIB\";\
		\L\D\F\L\A\G\S=\"LDFLAGS\"; \
		\B\U\I\L\D\_\L\I\B\R\A\R\Y=\"BUILD_LIBRARY\"; \
		 export \C\F\L\A\G\S \R\A\N\L\I\B \L\D\F\L\A\G\S \B\U\I\L\D\_\L\I\B\R\A\R\Y \A\F\T\E\R\_\M\A\K\E; \
		 ../SRCDIR/"unix"/configure TK_OPTS; \
		../SRCDIR/fix_makefile.sh > Makefile.MTYPE)

clean&:	Makefile.MTYPE
	make -f Makefile.MTYPE distclean

noprod&:
	rm -rf *.so *.a wish tktest

clobber&: Makefile.MTYPE
	make -f Makefile.MTYPE distclean
	rm -f *.o libtk* wish tktest *.MTYPE tkConfig.sh config.log config.status Makefile 

install&: Makefile.MTYPE
	make -f Makefile.MTYPE install
	(cd BASEDIR/lib; AFTER_MAKE)

install-nobak&: Makefile.MTYPE
	make -f Makefile.MTYPE install
	(cd BASEDIR/lib; AFTER_MAKE)

tktest: Makefile.MTYPE
	make -f Makefile.MTYPE tktest

test&: Makefile.MTYPE
	make -f Makefile.MTYPE test

/* dltest:			if not exist dltest
	cp -r ../SRCDIR/"unix"/dltest .
*/
@


1.18
log
@"clean" target now runs "distclean"
@
text
@@


1.17
log
@Minor cleanup, now clobber removes tktest also
@
text
@d63 1
a63 1
	make -f Makefile.MTYPE clean
d69 1
a69 1
	make -f Makefile.MTYPE clean
@


1.16
log
@Needed to remove the library linbk before recreating it
@
text
@d62 1
a62 1
clean&:
d66 1
a66 1
	rm -rf *.so *.a wish
d68 3
a70 2
clobber&: 
	rm -f *.o libtk* wish *.MTYPE tkConfig.sh config.log config.status Makefile 
@


1.15
log
@Added link to libtk.a or libtk.so
@
text
@d29 1
a29 1
#define	AFTER_MAKE	ln -s PRODUCTS libtk.a
d37 1
a37 1
#define	AFTER_MAKE	mv -f libtk''TCLTK_VERS.so SHARED_PRODUCT ; sharedliblink.sh SHARED_PRODUCT ; ln -s SHARED_PRODUCT libtk.so
@


1.15.2.1
log
@Brought Cakefile for rel-5-1-patches up to date with revision 1.17
@
text
@d29 1
a29 1
#define	AFTER_MAKE	rm -f libtk.a ; ln -s PRODUCTS libtk.a
d37 1
a37 1
#define	AFTER_MAKE	mv -f libtk''TCLTK_VERS.so SHARED_PRODUCT ; sharedliblink.sh SHARED_PRODUCT ; rm -f libtk.so ; ln -s SHARED_PRODUCT libtk.so
d62 1
a62 1
clean&:	Makefile.MTYPE
d66 1
a66 1
	rm -rf *.so *.a wish tktest
d68 2
a69 3
clobber&: Makefile.MTYPE
	make -f Makefile.MTYPE clean
	rm -f *.o libtk* wish tktest *.MTYPE tkConfig.sh config.log config.status Makefile 
@


1.15.2.2
log
@Upgrading to newer version
@
text
@@


1.14
log
@
EXTRA_PRODUCTS rule to not confuse library building.
@
text
@d29 1
a29 1
#define	AFTER_MAKE	/**/
d37 1
a37 1
#define	AFTER_MAKE	mv -f libtk''TCLTK_VERS.so SHARED_PRODUCT ; sharedliblink.sh SHARED_PRODUCT
@


1.13
log
@Mods to use the new TCLTK_VERS macro
@
text
@d10 6
d28 1
a28 1
#define PRODUCTS	[[echo libtk''TCLTK_VERS.a]] wish
d35 1
a35 1
#define PRODUCTS	[[echo libtk''TCLTK_VERS.so]] wish
d39 4
d45 5
a49 1
	make `echo CAKEFLAGS | tr '\040' '\012' | grep -- -s` -f Makefile.MTYPE
@


1.12
log
@Added AFTER_MAKE to get it to actually execute
@
text
@d22 1
a22 1
#define PRODUCTS	libtk.a wish
d29 3
a31 3
#define PRODUCTS	libtk.so wish
#define	SHARED_PRODUCT  libtk.so''[[LIBVERS]]
#define	AFTER_MAKE	mv -f libtk.so SHARED_PRODUCT ; sharedliblink.sh SHARED_PRODUCT
@


1.11
log
@tk 8.2.1 update
@
text
@d36 1
@


1.10
log
@removed the -DTK_NO_SECURITY flag
@
text
@d17 1
d42 2
a43 1
		 export \C\F\L\A\G\S \R\A\N\L\I\B \L\D\F\L\A\G\S \A\F\T\E\R\_\M\A\K\E; \
d54 1
a54 1
	rm -f *.o libtk.* wish *.MTYPE tkConfig.sh config.log config.status Makefile 
@


1.9
log
@Added "AFTER_MAKE" to environment for configure, improved file removal
@
text
@d37 1
a37 1
	( \C\F\L\A\G\S=\"GFLAG OPTIMIZER PROFILER -DTK_NO_SECURITY\"; \
@


1.8
log
@Added support for doing a "clobber" without having to build the Makefile
Added --quiet option to configure
Added check for cake -s flag to support "quiet" builds
@
text
@d38 1
d41 1
a41 1
		 export \C\F\L\A\G\S \R\A\N\L\I\B \L\D\F\L\A\G\S; \
d49 1
a49 1
	rm -rf *.so *.a
d52 1
a52 1
	rm -f *.o *.a *.MTYPE tkConfig.sh config.log config.status Makefile
@


1.7
log
@Added a '-f' option to a 'mv'
@
text
@d20 1
a20 1
			 --with-tcl=../TCL_DIR
d27 1
a27 1
			 --with-tcl=../TCL_DIR
d34 1
a34 1
	make -f Makefile.MTYPE
d50 2
a51 3
clobber&: Makefile.MTYPE
	make -f Makefile.MTYPE clean
	rm -f *.MTYPE
@


1.6
log
@Mods for shared libraries.
@
text
@d30 1
a30 1
#define	AFTER_MAKE	mv libtk.so SHARED_PRODUCT ; sharedliblink.sh SHARED_PRODUCT
@


1.5
log
@nstall wasn't creating he links for shared libraries.
@
text
@a34 1
	AFTER_MAKE
@


1.4
log
@I modified libtk/Cakefile so that the libtk/wish program would link
for me on CAD.  All I did was add these two options to the invocation
of the "unix/configure" program, so that libtk's Makefile would know
about Cakefile.def's settings for which set of X11 libraries to use.
@
text
@d57 1
d61 1
@


1.3
log
@Use BASEDIR rather than BINDIR.
@
text
@d19 1
d26 1
@


1.2
log
@Replaced explicit directory reference with 'BINDIR'.
@
text
@d18 1
a18 1
			 --exec-prefix=BINDIR --prefix=BINDIR \
d24 1
a24 1
			 --cache-file cache.MTYPE --exec-prefix=BINDIR --prefix=BINDIR \
@


1.1
log
@Initial revision
@
text
@d18 1
a18 1
			 --exec-prefix=/usr/brlcad --prefix=/usr/brlcad \
d24 1
a24 1
			 --cache-file cache.MTYPE --exec-prefix=/usr/brlcad --prefix=/usr/brlcad \
@
