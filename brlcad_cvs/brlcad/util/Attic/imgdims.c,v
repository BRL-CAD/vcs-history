head	1.12;
access;
symbols
	ansi-20040405-merged:1.8.2.2
	postmerge-20040405-ansi:1.10
	premerge-20040404-ansi:1.9
	postmerge-autoconf:1.9
	autoconf-freeze:1.8.10.2
	premerge-autoconf:1.9
	postmerge-20040315-windows:1.9
	premerge-20040315-windows:1.9
	windows-20040315-freeze:1.8.4.1
	autoconf-20031203:1.8
	autoconf-20031202:1.8
	autoconf-branch:1.8.0.10
	phong-branch:1.8.0.8
	photonmap-branch:1.8.0.6
	rel-6-1-DP:1.8
	windows-branch:1.8.0.4
	rel-6-0-2:1.6
	ansi-branch:1.8.0.2
	rel-6-0-1-branch:1.6.0.2
	hartley-6-0-post:1.7
	hartley-6-0-pre:1.6
	rel-6-0-1:1.6
	rel-6-0:1.6
	rel-5-4:1.3
	offsite-5-3-pre:1.4
	rel-5-3:1.3
	rel-5-2:1.3
	rel-5-1-branch:1.3.0.2
	rel-5-1:1.3
	rel-5-0:1.2
	rel-5-0-beta:1.2
	rel-4-5:1.2;
locks; strict;
comment	@ * @;


1.12
date	2004.05.21.14.57.41;	author morrison;	state dead;
branches;
next	1.11;

1.11
date	2004.05.10.15.30.50;	author erikg;	state Exp;
branches;
next	1.10;

1.10
date	2004.04.05.05.46.01;	author morrison;	state Exp;
branches;
next	1.9;

1.9
date	2004.02.02.17.39.45;	author morrison;	state Exp;
branches;
next	1.8;

1.8
date	2002.08.20.17.08.58;	author jra;	state Exp;
branches
	1.8.2.1
	1.8.4.1
	1.8.10.1;
next	1.7;

1.7
date	2002.08.15.20.56.11;	author hartley;	state Exp;
branches;
next	1.6;

1.6
date	2001.08.21.17.53.34;	author jra;	state Exp;
branches;
next	1.5;

1.5
date	2001.08.10.20.57.06;	author butler;	state Exp;
branches;
next	1.4;

1.4
date	2000.08.23.19.04.33;	author mike;	state Exp;
branches;
next	1.3;

1.3
date	2000.01.31.16.03.08;	author jra;	state Exp;
branches;
next	1.2;

1.2
date	97.12.03.07.11.07;	author mike;	state Exp;
branches;
next	1.1;

1.1
date	97.10.06.13.46.02;	author pjt;	state Exp;
branches;
next	;

1.8.2.1
date	2002.09.19.18.02.37;	author morrison;	state Exp;
branches;
next	1.8.2.2;

1.8.2.2
date	2004.03.17.21.23.24;	author morrison;	state Exp;
branches;
next	;

1.8.4.1
date	2004.03.11.23.52.30;	author morrison;	state Exp;
branches;
next	;

1.8.10.1
date	2004.02.12.19.43.10;	author erikg;	state Exp;
branches;
next	1.8.10.2;

1.8.10.2
date	2004.03.15.14.08.12;	author erikg;	state Exp;
branches;
next	;


desc
@     Simple front-end to bn_common_image_size()
@


1.12
log
@moved to src/util/
@
text
@/*
 *				I M G D I M S
 *
 *			Guess the dimensions of an image
 *
 *  Author -
 *	Paul J. Tanenbaum
 *  
 *  Source -
 *	The U. S. Army Research Laboratory
 *	Aberdeen Proving Ground, Maryland  21005-5068
 *  
 *  Copyright Notice -
 *	This software is Copyright (C) 1997-2004 by the United States Army.
 *	All rights reserved.
 *
 */
#ifndef lint
static const char RCSid[] = "@@(#)$Header: /n/xoff/cvs/brlcad/util/imgdims.c,v 1.11 2004/05/10 15:30:50 erikg Exp $ (BRL)";
#endif

#ifdef HAVE_CONFIG_H
# include "config.h"
#endif


#include <stdio.h>
#include <ctype.h>
#include <stdio.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <string.h>
#include "machine.h"
#include "externs.h"		/* For getopt(), etc. */
#include "bu.h"
#include "vmath.h"
#include "bn.h"

#define	BELIEVE_NAME	0
#define	BELIEVE_STAT	1
#define	DFLT_PIXEL_SIZE	3

static char usage[] = "\
Usage: 'imgdims [-ns] [-# bytes/pixel] file_name'\n\
    or 'imgdims [-# bytes/pixel] num_bytes'\n";
#define OPT_STRING	"ns#:?"

static void print_usage (void)
{
    (void) bu_log("%s", usage);
}

static int grab_number (char *buf, int *np)
{
    char	*bp;

    for (bp = buf; *bp != '\0'; ++bp)
	if (!isdigit(*bp))
	    return (0);
    if (sscanf(buf, "%d", np) != 1)
    {
	bu_log("imgdims: grab_number(%s) failed.  This shouldn't happen\n",
	    buf);
	exit (1);
    }
    return (1);
}

static int pixel_size (char *buf)
{
    char		*ep;
    struct assoc
    {
	char	*ext;
	int	size;
    }			*ap;
    static struct assoc	a_tbl[] =
			{
			    {"bw", 1},
			    {"pix", 3},
			    {0, 0}
			};

    if ((ep = strrchr(buf, '.')) == NULL)
	return (DFLT_PIXEL_SIZE);
    else
	++ep;

    for (ap = a_tbl; ap -> ext; ++ap)
	if (strcmp(ep, ap -> ext) == 0)
	    return (ap -> size);

    return (DFLT_PIXEL_SIZE);
}

int
main (int argc, char **argv)
{
    char	*argument;		/* file name or size */
    int		bytes_per_pixel = -1;
    int		ch;
    int		height;
    int		how = BELIEVE_NAME;
    int		nm_bytes = -1;
    int		nm_pixels;
    int		width;
    struct stat	stat_buf;

    extern int	optind;			/* index from getopt(3C) */
    extern char	*optarg;		/* argument from getopt(3C) */

    /*
     *	Process the command line
     */
    while ((ch = getopt(argc, argv, OPT_STRING)) != EOF)
	switch (ch)
	{
	    case 'n':
		how = BELIEVE_NAME;
		break;
	    case 's':
		how = BELIEVE_STAT;
		break;
	    case '#':
		if (sscanf(optarg, "%d", &bytes_per_pixel) != 1)
		{
		    bu_log("Invalid pixel-size value: '%s'\n", optarg);
		    print_usage();
		    exit (1);
		}
		break;
	    case '?':
	    default:
		print_usage();
		exit (ch != '?');
	}
    if (argc - optind != 1)
    {
	print_usage();
	exit (1);
    }

    argument = argv[optind];
    if ((stat(argument, &stat_buf) != 0)
     && (!grab_number(argument, &nm_bytes)))
    {
	bu_log("Cannot find file '%s'\n", argument);
	print_usage();
	exit (1);
    }

    /*
     *	If the user specified a file,
     *	determine its size
     */
    if (nm_bytes == -1) {
	if ((how == BELIEVE_NAME)
	 && bn_common_name_size(&width, &height, argument))
	    goto done;
	else
	{
	    nm_bytes = stat_buf.st_size;
	    if (bytes_per_pixel == -1)
		bytes_per_pixel = pixel_size(argument);
	}
    }
    if (bytes_per_pixel == -1)
	bytes_per_pixel = DFLT_PIXEL_SIZE;

    if (nm_bytes % bytes_per_pixel == 0)
	nm_pixels = nm_bytes / bytes_per_pixel;
    else
    {
	bu_log("Image size (%d bytes) is not a multiple of pixel size (%d bytes)\n", nm_bytes, bytes_per_pixel);
	exit (1);
    }

    if (!bn_common_image_size(&width, &height, nm_pixels))
	exit (0);

done:
    printf("%d %d\n", width, height);
    exit (0);
}
@


1.11
log
@change conf.h to a wrapped config.h
@
text
@d19 1
a19 1
static const char RCSid[] = "@@(#)$Header: /cvs/brlcad/util/imgdims.c,v 1.10 2004/04/05 05:46:01 morrison Exp $ (BRL)";
@


1.10
log
@merge of ansi-6-0-branch into head
@
text
@d19 1
a19 1
static const char RCSid[] = "@@(#)$Header$ (BRL)";
d22 5
a26 1
#include "conf.h"
@


1.9
log
@update copyright to include span through 2003
@
text
@d19 1
a19 1
static const char RCSid[] = "@@(#)$Header: /c/CVS/brlcad/util/imgdims.c,v 1.8 2002/08/20 17:08:58 jra Exp $ (BRL)";
d44 1
a44 1
static void print_usage ()
d49 1
a49 5
static int grab_number (buf, np)

char	*buf;
int	*np;

d65 1
a65 4
static int pixel_size (buf)

char	*buf;

d93 1
a93 5
main (argc, argv)

int argc;
char *argv[];

@


1.8
log
@Restoration of entire source tree to Pre-Hartley state
@
text
@d14 1
a14 1
 *	This software is Copyright (C) 1997 by the United States Army.
d19 1
a19 1
static const char RCSid[] = "@@(#)$Header: /c/CVS/brlcad/util/imgdims.c,v 1.6 2001/08/21 17:53:34 jra Exp $ (BRL)";
@


1.8.4.1
log
@sync to HEAD...
@
text
@d14 1
a14 1
 *	This software is Copyright (C) 1997-2004 by the United States Army.
d19 1
a19 1
static const char RCSid[] = "@@(#)$Header: /n/cad/c/CVS/brlcad/util/imgdims.c,v 1.9 2004/02/02 17:39:45 morrison Exp $ (BRL)";
@


1.8.10.1
log
@merge from HEAD
@
text
@d14 1
a14 1
 *	This software is Copyright (C) 1997-2004 by the United States Army.
d19 1
a19 1
static const char RCSid[] = "@@(#)$Header: /c/CVS/brlcad/util/imgdims.c,v 1.9 2004/02/02 17:39:45 morrison Exp $ (BRL)";
@


1.8.10.2
log
@merge from head
@
text
@d19 1
a19 1
static const char RCSid[] = "@@(#)$Header: /c/CVS/brlcad/util/imgdims.c,v 1.8.10.1 2004/02/12 19:43:10 erikg Exp $ (BRL)";
@


1.8.2.1
log
@Initial ANSIfication
@
text
@d19 1
a19 1
static const char RCSid[] = "@@(#)$Header: /c/CVS/brlcad/util/imgdims.c,v 1.8 2002/08/20 17:08:58 jra Exp $ (BRL)";
d44 1
a44 1
static void print_usage (void)
d49 5
a53 1
static int grab_number (char *buf, int *np)
d69 4
a72 1
static int pixel_size (char *buf)
d100 5
a104 1
main (int argc, char **argv)
@


1.8.2.2
log
@sync branch with HEAD
@
text
@d14 1
a14 1
 *	This software is Copyright (C) 1997-2004 by the United States Army.
d19 1
a19 1
static const char RCSid[] = "@@(#)$Header$ (BRL)";
@


1.7
log
@Converted from K&R to ANSI C - RFH
@
text
@d44 1
a44 1
static void print_usage (void)
d49 5
a53 1
static int grab_number (char *buf, int *np)
d69 4
a72 1
static int pixel_size (char *buf)
d100 5
a104 1
main (int argc, char **argv)
@


1.6
log
@Added brackets to ambiguous if/else
@
text
@d19 1
a19 1
static const char RCSid[] = "@@(#)$Header: /c/CVS/brlcad/util/imgdims.c,v 1.5 2001/08/10 20:57:06 butler Exp $ (BRL)";
d44 1
a44 1
static void print_usage ()
d49 1
a49 5
static int grab_number (buf, np)

char	*buf;
int	*np;

d65 1
a65 4
static int pixel_size (buf)

char	*buf;

d93 1
a93 5
main (argc, argv)

int argc;
char *argv[];

@


1.5
log
@Misc compiler warnings eliminated
@
text
@d19 1
a19 1
static const char RCSid[] = "@@(#)$Header: /c/CVS/brlcad/util/imgdims.c,v 1.4 2000/08/23 19:04:33 mike Exp $ (BRL)";
d163 1
a163 1
    if (nm_bytes == -1)
d173 1
@


1.4
log
@
const RCSid
@
text
@d19 1
a19 1
static const char RCSid[] = "@@(#)$Header: /c/CVS/brlcad/util/imgdims.c,v 1.3 2000/01/31 16:03:08 jra Exp $ (BRL)";
d24 2
d32 2
d99 1
@


1.3
log
@Eliminated some unused variables
@
text
@d19 1
a19 1
static char RCSid[] = "@@(#)$Header: /c/CVS/brlcad/util/imgdims.c,v 1.2 1997/12/03 07:11:07 mike Exp $ (BRL)";
@


1.2
log
@PJT improvements to code
@
text
@d19 1
a19 1
static char RCSid[] = "@@(#)$Header: /m/cad/util/RCS/pixclump.c,v 1.1 1997/03/21 18:58:40 pjt Exp $ (BRL)";
a69 1
    char		*bp;
@


1.1
log
@Initial revision
@
text
@d4 13
a16 1
 *		Trivial front-end to bn_common_image_size()
d18 5
d24 15
d40 1
a40 1
print_usage ()
d42 52
a93 1
    fputs("Usage: 'imgdims n'\n", stderr); 
d102 43
a144 5
    int	width;
    int	height;
    int	nm_bytes;
    int	bytes_per_pixel = 3;
    int	nm_pixels;
d146 3
a148 1
    if (sscanf(argv[1], "%d", &nm_bytes) != 1)
d150 1
d154 18
d180 2
a181 4
    if (bn_common_image_size(&width, &height, nm_pixels))
	printf("%d %d\n", width, height);
    else
	printf("Returned 0\n");
d183 2
@
