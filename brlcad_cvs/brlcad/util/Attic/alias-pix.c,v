head	11.9;
access;
symbols
	ansi-20040405-merged:11.6.2.1
	postmerge-20040405-ansi:11.7
	premerge-20040404-ansi:11.6
	postmerge-autoconf:11.6
	autoconf-freeze:11.6
	premerge-autoconf:11.6
	postmerge-20040315-windows:11.6
	premerge-20040315-windows:11.6
	windows-20040315-freeze:11.6
	autoconf-20031203:11.6
	autoconf-20031202:11.6
	autoconf-branch:11.6.0.10
	phong-branch:11.6.0.8
	photonmap-branch:11.6.0.6
	rel-6-1-DP:11.6
	windows-branch:11.6.0.4
	rel-6-0-2:11.4
	ansi-branch:11.6.0.2
	rel-6-0-1-branch:11.4.0.2
	hartley-6-0-post:11.5
	hartley-6-0-pre:11.4
	rel-6-0-1:11.4
	rel-6-0:11.4
	rel-5-4:11.2
	offsite-5-3-pre:11.4
	rel-5-3:11.2
	rel-5-2:11.2
	rel-5-1-branch:11.2.0.2
	rel-5-1:11.2
	rel-5-0:11.2
	rel-5-0-beta:11.2
	rel-4-5:11.1
	ctj-4-5-post:11.1
	ctj-4-5-pre:11.1
	rel-4-4:11.1
	rel-4-0:10.1
	rel-3-5:9.1;
locks; strict;
comment	@ * @;


11.9
date	2004.05.21.14.57.30;	author morrison;	state dead;
branches;
next	11.8;

11.8
date	2004.05.10.15.30.50;	author erikg;	state Exp;
branches;
next	11.7;

11.7
date	2004.04.05.05.46.01;	author morrison;	state Exp;
branches;
next	11.6;

11.6
date	2002.08.20.17.08.53;	author jra;	state Exp;
branches
	11.6.2.1;
next	11.5;

11.5
date	2002.08.15.20.56.06;	author hartley;	state Exp;
branches;
next	11.4;

11.4
date	2000.09.01.17.27.44;	author mike;	state Exp;
branches;
next	11.3;

11.3
date	2000.09.01.03.23.43;	author mike;	state Exp;
branches;
next	11.2;

11.2
date	98.09.22.03.22.24;	author mike;	state Exp;
branches;
next	11.1;

11.1
date	95.01.04.10.11.22;	author mike;	state Rel4_4;
branches;
next	10.2;

10.2
date	94.08.22.20.15.36;	author gdurf;	state Exp;
branches;
next	10.1;

10.1
date	91.10.12.06.47.38;	author mike;	state Rel4_0;
branches;
next	9.1;

9.1
date	89.05.19.06.06.47;	author mike;	state Rel3_5;
branches;
next	1.2;

1.2
date	89.04.21.00.41.49;	author butler;	state Exp;
branches;
next	1.1;

1.1
date	89.04.20.21.58.11;	author butler;	state Exp;
branches;
next	;

11.6.2.1
date	2002.09.19.18.02.34;	author morrison;	state Exp;
branches;
next	;


desc
@Converts Alias (tm) PIX format files to BRLCAD PIX(5) format
@


11.9
log
@moved to src/util/
@
text
@/*			A L I A S - P I X
 *
 *	Convert ALIAS(tm) PIX format image files to BRL PIX fomat files.
 *
 *	Author:
 *	Lee A. Butler
 *
 */
#ifdef HAVE_CONFIG_H
# include "config.h"
#endif



#include <stdio.h>
#include <ctype.h>
#include "machine.h"
#include "externs.h"

char *progname = "(noname)";
void usage(void)
{
	(void) fprintf(stderr, "Usage: %s [ -v ] < ALIASpixfile >BRLpixfile\n", progname);
	exit(1);
}

struct aliashead {
	short	x, y;		/* dimensions of this image in X and Y */
	short	xoff, yoff;	/* offsets of pixels */
	short	bitplanes;	/* the number of bits per pixel */
} hdr;

#define BUFCNT 256
struct pixel {
	unsigned char len, b, g, r;
} buf[BUFCNT];

int verbose = 0;

char *image;

int
main(int ac, char **av)
{
	int pixcnt, i;
	char *p;

	progname = *av;

	if (ac > 2 || isatty(fileno(stdin))) usage();

	if (ac > 1) {
		p = av[1];
		if (*p == '-' && *(p+1) == 'v') verbose = 1;
		else usage();
	}


	/* read header in architecture-independent fashion */
	hdr.x = (getchar() & 0x0ff) << 8;
	hdr.x += (getchar() & 0x0ff);

	hdr.y = (getchar() & 0x0ff) << 8;
	hdr.y += (getchar() & 0x0ff);

	hdr.xoff = (getchar() & 0x0ff) << 8;
	hdr.xoff += (getchar() & 0x0ff);

	hdr.yoff = (getchar() & 0x0ff) << 8;
	hdr.yoff += (getchar() & 0x0ff);

	hdr.bitplanes = (getchar() & 0x0ff) << 8;
	hdr.bitplanes += (getchar() & 0x0ff);
	
	if (hdr.bitplanes != 24) {
		(void) fprintf(stderr, "Weird image file:\n");
		(void) fprintf(stderr,
			"X: %d Y: %d xoff: %d yoff: %d bits/pixel: %d\n", 
			hdr.x, hdr.y, hdr.xoff, hdr.yoff, hdr.bitplanes);
		exit(-1);
	}

	if (verbose) {
		(void) fprintf(stderr,
			"X: %d Y: %d xoff: %d yoff: %d bits/pixel: %d\n", 
			hdr.x, hdr.y, hdr.xoff, hdr.yoff, hdr.bitplanes);
	}


	if ( (image=malloc(hdr.x*hdr.y*3)) == (char *)NULL) {
		(void) fprintf(stderr, "%s: insufficient memory for %d * %d image\n",
			progname, hdr.x, hdr.y);
		exit(-1);
	}

	/* read and "unpack" the image */
	p = image;
	while ((pixcnt=fread(buf, sizeof(struct pixel), BUFCNT, stdin)) > 0) {
		for (i=0 ; i < pixcnt ; ++i)
			do {
				*p++ = buf[i].r;
				*p++ = buf[i].g;
				*p++ = buf[i].b;
			} while (--buf[i].len > 0);
	}

	/* write out the image scanlines, correcting for different origin */
	
	for(i=hdr.y-1 ; i >= 0 ; --i)
		if (fwrite(&image[i*hdr.x*3], hdr.x*3, 1, stdout) != 1) {
			(void) fprintf(stderr, "%s: Error writing image\n", *av);
			exit(-1);
		}


	free(image);
	return(0);
}
@


11.8
log
@change conf.h to a wrapped config.h
@
text
@@


11.7
log
@merge of ansi-6-0-branch into head
@
text
@d9 5
a13 1
#include "conf.h"
@


11.6
log
@Restoration of entire source tree to Pre-Hartley state
@
text
@d17 1
a17 1
void usage()
d39 1
a39 3
main(ac,av)
int ac;
char *av[];
@


11.6.2.1
log
@Initial ANSIfication
@
text
@d17 1
a17 1
void usage(void)
d39 3
a41 1
main(int ac, char **av)
@


11.5
log
@Converted from K&R to ANSI C - RFH
@
text
@d17 1
a17 1
void usage(void)
d39 3
a41 1
main(int ac, char **av)
@


11.4
log
@
Lint
@
text
@d17 1
a17 1
void usage()
d39 1
a39 3
main(ac,av)
int ac;
char *av[];
@


11.3
log
@
Lint fix
@
text
@d44 1
a44 1
	char *p, *malloc();
@


11.2
log
@Fixed printf args
@
text
@d12 4
d38 1
@


11.1
log
@Release_4.4
@
text
@d84 2
a85 2
		(void) fprintf(stderr, "%s: insufficient memor for %d x %d image\n",
			hdr.x, hdr.y);
@


10.2
log
@Added include of conf.h
@
text
@@


10.1
log
@Release_4.0
@
text
@d9 2
@


9.1
log
@Release_3.5
@
text
@@


1.2
log
@*** empty log message ***
@
text
@@


1.1
log
@Initial revision
@
text
@d67 2
a68 2
		fprintf(stderr, "Weird image file:\n");
		fprintf(stderr,
d75 1
a75 1
		fprintf(stderr,
d82 1
a82 1
		fprintf(stderr, "%s: insufficient memor for %d x %d image\n",
d102 1
a102 1
			fprintf(stderr, "%s: Error writing image\n", *av);
@
