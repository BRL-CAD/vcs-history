head	11.10;
access;
symbols
	ansi-20040405-merged:11.7.2.1
	postmerge-20040405-ansi:11.8
	premerge-20040404-ansi:11.7
	postmerge-autoconf:11.7
	autoconf-freeze:11.7
	premerge-autoconf:11.7
	postmerge-20040315-windows:11.7
	premerge-20040315-windows:11.7
	windows-20040315-freeze:11.7
	autoconf-20031203:11.7
	autoconf-20031202:11.7
	autoconf-branch:11.7.0.10
	phong-branch:11.7.0.8
	photonmap-branch:11.7.0.6
	rel-6-1-DP:11.7
	windows-branch:11.7.0.4
	rel-6-0-2:11.5
	ansi-branch:11.7.0.2
	rel-6-0-1-branch:11.5.0.2
	hartley-6-0-post:11.6
	hartley-6-0-pre:11.5
	rel-6-0-1:11.5
	rel-6-0:11.5
	rel-5-4:11.3
	offsite-5-3-pre:11.5
	rel-5-3:11.3
	rel-5-2:11.3
	rel-5-1-branch:11.3.0.2
	rel-5-1:11.3
	rel-5-0:11.3
	rel-5-0-beta:11.3
	rel-4-5:11.2
	ctj-4-5-post:11.2
	ctj-4-5-pre:11.2
	rel-4-4:11.1
	rel-4-0:10.1;
locks; strict;
comment	@ * @;


11.10
date	2004.05.21.14.57.31;	author morrison;	state dead;
branches;
next	11.9;

11.9
date	2004.05.10.15.30.50;	author erikg;	state Exp;
branches;
next	11.8;

11.8
date	2004.04.05.05.46.01;	author morrison;	state Exp;
branches;
next	11.7;

11.7
date	2002.08.20.17.08.54;	author jra;	state Exp;
branches
	11.7.2.1;
next	11.6;

11.6
date	2002.08.15.20.56.06;	author hartley;	state Exp;
branches;
next	11.5;

11.5
date	2000.09.01.03.23.43;	author mike;	state Exp;
branches;
next	11.4;

11.4
date	2000.08.23.19.04.10;	author mike;	state Exp;
branches;
next	11.3;

11.3
date	98.09.22.03.22.24;	author mike;	state Exp;
branches;
next	11.2;

11.2
date	96.07.16.22.56.03;	author jra;	state Exp;
branches;
next	11.1;

11.1
date	95.01.04.10.11.26;	author mike;	state Rel4_4;
branches;
next	10.2;

10.2
date	93.07.07.15.22.13;	author pjt;	state Exp;
branches;
next	10.1;

10.1
date	91.10.12.06.47.42;	author mike;	state Rel4_0;
branches;
next	1.1;

1.1
date	91.06.27.13.00.54;	author pjt;	state Exp;
branches;
next	;

11.7.2.1
date	2002.09.19.18.02.34;	author morrison;	state Exp;
branches;
next	;


desc
@Transform coordinates in R3 for azimuth-elevation rotations
@


11.10
log
@moved to src/util/
@
text
@/*
 *				A Z E L . C
 *
 *	     This program reads data for points in Euclidean 3-space
 *	and prints out the same data, having transformed the coordinates
 *	of the points according to an azimuth-elevation rotation.
 *
 *	     Each point in the input must be of the form:
 *
 *			a  b  c  field_1  field_2  ...  field_n.
 *
 *	The default behavior of the program is to interpret (a, b, c) as
 *	the point (x, y, z) in unrotated coordinates and to output
 *
 *			d  h  v  field_1  field_2  ...  field_n.
 *
 *	where (d, h, v) are the "viewer's coordinates."
 *
 *	     The -p option causes the program to output the projection
 *	of the point onto a plane normal to the line of sight:
 *
 *			 h  v  field_1  field_2  ...  field_n.
 *
 *	     The -i option causes the program to invert the rotation.
 *	(a, b, c) is interpreted as the point (d, h, v) in the viewer's
 *	coordinates, and the point is output in derotated form:
 *
 *			x  y  z  field_1  field_2  ...  field_n.
 *  Author -
 *	Paul J. Tanenbaum
 *  
 *  Source -
 *	The U. S. Army Research Laboratory
 *	Aberdeen Proving Ground, Maryland  21005-5066  USA
 *  
 *  Distribution Status -
 *	Public Domain, Distribution Unlimitied.
 */
#ifndef lint
static const char RCSid[] = "@@(#)$Header: /n/xoff/cvs/brlcad/util/azel.c,v 11.9 2004/05/10 15:30:50 erikg Exp $ (BRL)";
#endif

#ifdef HAVE_CONFIG_H
# include "config.h"
#endif



#include <stdio.h>
#include <ctype.h>
#include <math.h>

#include "machine.h"
#include "externs.h"

#define		DEG2RAD		0.01745329	/* Convert degrees to radians */
#define		OPT_STRING	"a:c:e:ipr?"	/* For getopt(3) */
#define		fpeek(f)	ungetc(fgetc(f), f)

void	PrintUsage(void);
void	GetCoord(FILE *Whence, double *Coord, char Label, int LineNm, char *FileName);

int
main (int argc, char **argv)
{
    char            *inFname = "stdin"; /* Name of input source */
    char            *outFname = "stdout";  /* Name of output destination */
    char            *Label;             /* Names of input coordinates */
    char            Tail[1024];         /* Rest of input line beyond coords */
    extern char     *optarg;            /* argument from getopt(3C) */
    FILE            *inPtr = stdin;     /* Pointer to input */
    FILE            *outPtr = stdout;   /* Pointer to output */
    double          Azim = 0.0;         /* Azimuth angle (in degrees) */
    double          Elev = 0.0;         /* Elevation angle (in degrees) */
    double          CelSiz = 1.0;       /* Size of cells (dimensionless) */
    double          Cazim;              /* Cosine of the azimuth angle */
    double          Celev;              /* Cosine of the elevation angle */
    double          Sazim;              /* Sine of the azimuth angle */
    double          Selev;              /* Sine of the elevation angle */
    double          U1;                 /* Input coords of current point */
    double          V1;                 /*   "      "    "    "      "   */
    double          W1;                 /*   "      "    "    "      "   */
    double          U2;			/* Output coords of current point */
    double          V2;                 /*   "      "    "    "      "   */
    double          W2;                 /*   "      "    "    "      "   */
    double          UU;                 /* Weight of U1 in computing U2 */
    double          UV;                 /*    "    " U1  "     "     V2 */
    double          UW;                 /*    "    " U1  "     "     W2 */
    double          VU;                 /* Weight of V1 in computing U2 */
    double          VV;                 /*    "    " V1  "     "     V2 */
    double          VW;                 /*    "    " V1  "     "     W2 */
    double          WU;                 /* Weight of W1 in computing U2 */
    double          WV;                 /*    "    " W1  "     "     V2 */
    double          WW;                 /*    "    " W1  "     "     W2 */
    int             Invert = 0;		/* Undo az-el rotation? */
    int             PlanarProj = 0;	/* Project points onto plane? */
    int             Round = 0;		/* Round the output coords? */
    int             LineNm = 0;         /* How far through input? */
    int             Ch;                 /* Input character */
    int             i;                  /* Dummy variable for loop indexing */
    extern int      optind;             /* index from getopt(3C) */
    
    /* Handle command-line options */
    while ((Ch = getopt(argc, argv, OPT_STRING)) != EOF)
	switch (Ch)
	{
	    case 'a':
		if (sscanf(optarg, "%lf", &Azim) != 1)
		{
		    (void) fprintf(stderr,
			"Bad azimuth specification: '%s'\n", optarg);
		    PrintUsage();
		    exit(1);
		}
		break;
	    case 'c':
		if (sscanf(optarg, "%lf", &CelSiz) != 1)
		{
		    (void) fprintf(stderr,
			"Bad cell-size specification: '%s'\n", optarg);
		    PrintUsage();
		    exit(1);
		}
		break;
	    case 'e':
		if (sscanf(optarg, "%lf", &Elev) != 1)
		{
		    (void) fprintf(stderr,
			"Bad elevation specification: '%s'\n", optarg);
		    PrintUsage();
		    exit(1);
		}
		break;
	    case 'i':
		Invert = 1;
		break;
	    case 'p':
		PlanarProj = 1;
		break;
	    case 'r':
		Round = 1;
		break;
	    default:
		fprintf(stderr, "Bad option '-%c'\n", Ch);
	    case '?':
		PrintUsage();
		exit (Ch != '?');
	}

    if (PlanarProj && Invert)
    {
	fputs("Incompatible options: -i and -p\n", stderr);
	PrintUsage();
	exit (1);
    }

    /* Determine source and destination */
    if (argc - optind > 0)
    {
	inFname = argv[optind];
	if ((inPtr = fopen(inFname, "r")) == NULL)
	{
	    fprintf(stderr, "azel:  Cannot open file '%s'\n", inFname);
	    exit(1);
	}
	if (argc - optind > 1)
	{
	    outFname = argv[optind + 1];
	    if ((outPtr = fopen(outFname, "w")) == NULL)
	    {
		fprintf(stderr, "azel:  Cannot create file '%s'\n", outFname);
		exit(1);
	    }
	}
	if (argc - optind > 2)
	{
	    PrintUsage();
	    exit (1);
	}
    }

    /* Compute transformation coefficients */
    Cazim = cos(Azim * DEG2RAD);
    Celev = cos(Elev * DEG2RAD);
    Sazim = sin(Azim * DEG2RAD);
    Selev = sin(Elev * DEG2RAD);
    if (Invert)
    {
	UU = Celev * Cazim;
	VU = -Sazim;
	WU = -(Selev * Cazim);
	UV = Celev * Sazim;
	VV = Cazim;
	WV = -(Selev * Sazim);
	UW = Selev;
	VW = 0.0;
	WW = Celev;
    }
    else
    {
	UU = Celev * Cazim;
	VU = Celev * Sazim;
	WU = Selev;
	UV = -Sazim;
	VV = Cazim;
	WV = 0.0;
	UW = -(Selev * Cazim);
	VW = -(Selev * Sazim);
	WW = Celev;
    }

/* * * * * Filter Data * * * * */
    Label = Invert ? "DHV" : "XYZ";

    while ((Ch = fpeek(inPtr)) != EOF)
    {
/* Read U1, V1, and W1 of next point in input frame of reference */
        GetCoord(inPtr, &U1, *Label, LineNm + 1, inFname);
        GetCoord(inPtr, &V1, *(Label + 1), LineNm + 1, inFname);
        GetCoord(inPtr, &W1, *(Label + 2), LineNm + 1, inFname);

/* Compute U2, V2, and W2 for this point */
	U2 = (U1 * UU + V1 * VU + W1 * WU) / CelSiz;
	V2 = (U1 * UV + V1 * VV + W1 * WV) / CelSiz;
	W2 = (U1 * UW + V1 * VW + W1 * WW) / CelSiz;

	if (Round)
	{
	    U2 = floor(U2 + .5);
	    V2 = floor(V2 + .5);
	    W2 = floor(W2 + .5);
	}

/* Read in the rest of the line for subsequent dumping out */
        for (i = 0; (Ch = fgetc(inPtr)) != '\n'; i++)
            if (Ch == EOF)
            {
                Tail[i] = '\n';
                break;
            }
            else
                Tail[i] = Ch;
        Tail[i] = '\0';

/* Write out the filtered version of this line */
	if (! PlanarProj)
	    fprintf(outPtr, "%g\t", U2);
        fprintf(outPtr, "%g\t%g\t%s\n", V2, W2, Tail);
        LineNm++;
    }
    exit (0);
}
/* ======================================================================== */
void
PrintUsage (void)
{
    fputs("Usage:  'azel [-a azim] [-e elev] [-c celsiz] [-{ip}r] [infile [outfile]]'\n", stderr);
}
/* ======================================================================== */
void
GetCoord (FILE *Whence, double *Coord, char Label, int LineNm, char *FileName)

                        /* File from which to read */
                        /* Where to store coordinate */
                        /* Name of coordinate */
                        /* How far in input? */
                        /* What input stream? */

{
    int     Ch;

/* Skip leading white space */
    while (((Ch = fgetc(Whence)) == ' ') || (Ch == '\t'))
        ;

    if (ungetc(Ch, Whence) == EOF)
    {
        fprintf(stderr, "azel:  Premature end-of-file, file %s\n",
                FileName);
        exit(1);
    }
    if (Ch == '\n')
    {
        fprintf(stderr, "azel:  Premature end-of-line on line %d, file %s\n",
                LineNm, FileName);
        exit(1);
    }
    
    if (fscanf(Whence, "%lf", Coord) != 1)
    {
        fprintf(stderr, "azel:  Bad %c-coordinate at line %d, file %s\n",
                Label, LineNm, FileName);
        exit(1);
    }
}
@


11.9
log
@change conf.h to a wrapped config.h
@
text
@d40 1
a40 1
static const char RCSid[] = "@@(#)$Header: /cvs/brlcad/util/azel.c,v 11.8 2004/04/05 05:46:01 morrison Exp $ (BRL)";
@


11.8
log
@merge of ansi-6-0-branch into head
@
text
@d40 1
a40 1
static const char RCSid[] = "@@(#)$Header$ (BRL)";
d43 5
a47 1
#include "conf.h"
@


11.7
log
@Restoration of entire source tree to Pre-Hartley state
@
text
@d40 1
a40 1
static const char RCSid[] = "@@(#)$Header: /c/CVS/brlcad/util/azel.c,v 11.5 2000/09/01 03:23:43 mike Exp $ (BRL)";
d56 2
a57 2
void	PrintUsage();
void	GetCoord();
d60 1
a60 5
main (argc, argv)

int     argc;
char    **argv;

d251 1
a251 1
PrintUsage ()
d257 1
a257 1
GetCoord (Whence, Coord, Label, LineNm, FileName)
d259 5
a263 5
FILE    *Whence;        /* File from which to read */
double  *Coord;         /* Where to store coordinate */
char    Label;          /* Name of coordinate */
int     LineNm;         /* How far in input? */
char    *FileName;      /* What input stream? */
@


11.7.2.1
log
@Initial ANSIfication
@
text
@d40 1
a40 1
static const char RCSid[] = "@@(#)$Header: /c/CVS/brlcad/util/azel.c,v 11.7 2002/08/20 17:08:54 jra Exp $ (BRL)";
d56 2
a57 2
void	PrintUsage(void);
void	GetCoord(FILE *Whence, double *Coord, char Label, int LineNm, char *FileName);
d60 5
a64 1
main (int argc, char **argv)
d255 1
a255 1
PrintUsage (void)
d261 1
a261 1
GetCoord (FILE *Whence, double *Coord, char Label, int LineNm, char *FileName)
d263 5
a267 5
                        /* File from which to read */
                        /* Where to store coordinate */
                        /* Name of coordinate */
                        /* How far in input? */
                        /* What input stream? */
@


11.6
log
@Converted from K&R to ANSI C - RFH
@
text
@d56 2
a57 2
void	PrintUsage(void);
void	GetCoord(FILE *Whence, double *Coord, char Label, int LineNm, char *FileName);
d60 5
a64 1
main (int argc, char **argv)
d255 1
a255 1
PrintUsage (void)
d261 1
a261 1
GetCoord (FILE *Whence, double *Coord, char Label, int LineNm, char *FileName)
d263 5
a267 5
                        /* File from which to read */
                        /* Where to store coordinate */
                        /* Name of coordinate */
                        /* How far in input? */
                        /* What input stream? */
@


11.5
log
@
Lint fix
@
text
@d40 1
a40 1
static const char RCSid[] = "@@(#)$Header: /c/CVS/brlcad/util/azel.c,v 11.4 2000/08/23 19:04:10 mike Exp $ (BRL)";
d56 2
a57 2
void	PrintUsage();
void	GetCoord();
d60 1
a60 5
main (argc, argv)

int     argc;
char    **argv;

d251 1
a251 1
PrintUsage ()
d257 1
a257 1
GetCoord (Whence, Coord, Label, LineNm, FileName)
d259 5
a263 5
FILE    *Whence;        /* File from which to read */
double  *Coord;         /* Where to store coordinate */
char    Label;          /* Name of coordinate */
int     LineNm;         /* How far in input? */
char    *FileName;      /* What input stream? */
@


11.4
log
@
const RCSid
@
text
@d40 1
a40 1
static const char RCSid[] = "@@(#)$Header: /c/CVS/brlcad/util/azel.c,v 11.3 1998/09/22 03:22:24 mike Exp $ (BRL)";
d43 2
d49 3
d59 1
@


11.3
log
@Fixed printf args
@
text
@d40 1
a40 1
static char RCSid[] = "@@(#)$Header: /c/CVS/brlcad/util/azel.c,v 11.2 1996/07/16 22:56:03 jra Exp $ (BRL)";
@


11.2
log
@Minor mods for IRIX 6.2
@
text
@d40 1
a40 1
static char RCSid[] = "@@(#)$Header: /m/cad/util/RCS/azel.c,v 11.1 1995/01/04 10:11:26 mike Rel4_4 jra $ (BRL)";
d138 1
a138 1
		fprintf(stderr, "Bad option '-%s'\n", Ch);
@


11.1
log
@Release_4.4
@
text
@d40 1
a40 1
static char RCSid[] = "@@(#)$Header: /m/cad/util/RCS/azel.c,v 10.2 93/07/07 15:22:13 pjt Exp $ (BRL)";
d51 3
d248 1
d254 1
@


10.2
log
@Changed from copyright to public domain
@
text
@d40 1
a40 1
static char RCSid[] = "@@(#)$Header$ (BRL)";
@


10.1
log
@Release_4.0
@
text
@a28 1
 *
d33 2
a34 3
 *	SECAD/VLD Computing Consortium, Bldg 394
 *	The U. S. Army Ballistic Research Laboratory
 *	Aberdeen Proving Ground, Maryland  21005-5066
d36 2
a37 3
 *  Copyright Notice -
 *	This software is Copyright (C) 1990 by the United States Army.
 *	All rights reserved.
d40 1
a40 1
static char RCSid[] = "@@(#)$Header: /m/cad/util/RCS/azel.c,v 1.1 91/06/27 13:00:54 pjt Exp $ (BRL)";
@


1.1
log
@Initial revision
@
text
@d43 1
a43 1
static char RCSid[] = "@@(#)$Header$ (BRL)";
@
